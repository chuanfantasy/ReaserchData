电子科技大学
UNIVERSITY OF ELECTRONIC SCIENCE AND TECHNOLOGY OF CHINA
专业学位硕士学位论文
MASTER THESIS FOR PROFESSIONAL DEGREE

论文题目 基于集成学习的网络安全态势评估 系统的设计与实现

专业学位类别 学号 作者姓名 指导教师 学院

工程硕士 201922090609
刘鹏鹏 朱清新 教授 信息与软件工程学院

分类号 UDC 注 1

密级

公开

学位论文

基于集成学习的网络安全态势评估系统的设计与实现
（题名和副题名）
刘鹏鹏
（作者姓名）

指导教师

朱清新 电子科技大学

教授 成都

（姓名、职称、单位名称）

申请学位级别

硕士

专业学位类别

工程领域名称

软件工程

提交论文日期 2022 年 3 月 16 日 论文答辩日期

学位授予单位和日期

电子科技大学

工程硕士
2022 年 5 月 12 日 2022 年 6 月

答辩委员会主席

评阅人 注 1：注明《国际十进分类法 UDC》的类号。

Design and Implementation of Network Security Situation Assessment System Based on Ensemble
Learning
A Master Thesis Submitted to University of Electronic Science and Technology of China

Discipline

Master of Engineering

Student ID

201922090609

Author

Liu Pengpeng

Supervisor

Prof.Zhu Qingxin

School School of Information and Software Engineering

独创性声明

本人声明所呈交的学位论文是本人在导师指导下进行的研究工 作及取得的研究成果。据我所知，除了文中特别加以标注和致谢的地 方外，论文中不包含其他人已经发表或撰写过的研究成果，也不包含 为获得电子科技大学或其它教育机构的学位或证书而使用过的材料。 与我一同工作的同志对本研究所做的任何贡献均已在论文中作了明 确的说明并表示谢意。

作者签名：

日期： 2022 年 05 月 26 日

论文使用授权

本学位论文作者完全了解电子科技大学有关保留、使用学位论文 的规定，有权保留并向国家有关部门或机构送交论文的复印件和磁 盘，允许论文被查阅和借阅。本人授权电子科技大学可以将学位论文 的全部或部分内容编入有关数据库进行检索，可以采用影印、缩印或 扫描等复制手段保存、汇编学位论文。
（保密的学位论文在解密后应遵守此规定）

作者签名：

导师签名： 日期： 2022 年 05 月 26 日

摘要
摘要
随着电力企业对信息化建设的加强，电力信息系统的规模也一直在扩大，其所 包含的服务数量较多、种类多样，集中监测所有的服务，及时发现网络风险故障， 对系统的安全稳定运行有着十分重要的意义。但是面对结构复杂、数据量庞大的 数据，需要耗费大量时间成本去分析。而各服务的态势可以直接反应其安全运行 状况，再对态势较低的服务进行分析，能滤除很多无用冗余信息，从而减少大量 的安全运维工作。
现有相关研究主要面向单一系统，忽略了在实际业务场景中，往往包含了多种 服务。因此，本文设计并实现了一个基于集成学习的安全态势评估系统，通过对 指标数据和告警数据的挖掘分析，对多服务场景下的电力信息系统进行态势评估， 并对系统的未来运行状态进行有效预测，为运维人员做出及时和正确判断提供技 术支撑。实验表明，该系统比现有的安全态势评估方法更准确，更能体现系统的 整体实际情况，对系统整体运行状态的预测效果良好，本文的重点研究内容如下：
1、研究基于电力信息系统网络安全相关数据的数据预处理方法。本文将采集 自某电力信息系统的数据划分为指标和告警数据，对指标数据采用邻域均值方式 进行缺失值填充、数据降维等处理；对告警数据提取了告警关键信息，最后对指 标数据和告警数据进行了数据融合。
2、研究基于集成学习的安全态势评估模型。本文采用 Boosting 算法对安全态 势进行评估，并对 Boosting 算法进行了改进，提出了一种基于改进 Boosting 算法 的网络安全态势评估模型，使得网络安全态势评估模型准确率得到了提升。
3、研究层次化的安全态势量化模型。本文分析了原有层次化评估方法，充分 考虑了层次模型层次结构划分的合理性，提出了一种改进的安全态势量化层次模 型，结合 AHP 算法对各服务和整体安全态势进行了层次化计算。
4、研究态势预测模型。本文采用长短期记忆网络 LSTM 对系统未来运行状况 进行预测，并通过粒子群算法 PSO 对 LSTM 态势预测模型进行了优化。
5、研究网络安全态势评估系统。设计并实现了适用于多服务场景的态势评估 系统，并进行可视化展示，提高了决策人员或运维人员对电力信息系统网络安全 状况的感知能力。
关键词：安全态势评估，安全态势量化，时序预测，集成学习
I

Abstract
Abstract
With the strengthening of information construction in power enterprises, the scale of power information system has been expanding, which includes a large number of services and a variety of types. Centralized monitoring of all services and timely detection of network risk faults are of great significance to the safe and stable operation of the system. However, in the face of complex structure and huge amount of data, it takes a lot of time and cost to analyze. The situation of each service directly reflects its safe operation status, and then the analysis of services with low situation can filter a lot of useless information and reduce a lot of operation and maintenance work. Existing researches mainly focus on a single system, ignoring that in the actual business scenario, it often contains a variety of services. Therefore, in this thesis a security situation assessment system based on ensemble learning is designed and implemented. Through the mining and analysis of index data and alarm data, it assesses the situation of power information system under multi-service scenarios, and effectively predicts the future operation status of the system, which provides technical support for operation and maintenance personnel to make timely and correct judgments. Experiments show that the system is more accurate than the existing security situation assessment methods, and can better reflect the overall actual situation of the system. The prediction effect of the overall operation state of the system is good. The key research contents of this thesis are as follows:
1. The data preprocessing method based on the data related to network security of power information system is studied. In this thesis, the data collected from an electric power information system is divided into index data and alarm data, and the index data is processed by neighborhood mean value to fill missing values and reduce data dimensions; the alarm key information is extracted from the alarm data, and finally the index data and alarm data are fused.
2. The model of security situation assessment based on ensemble learning is studied. In this thesis, Boosting algorithm is used to assess the security situation and improve the Boosting algorithm. And a network security situation assessment model based on the improved Boosting algorithm is proposed, which improves the accuracy of the network security situation assessment model.
II

Abstract
3. The hierarchical security situation quantification model is studied. In this thesis, we analyze the original hierarchical evaluation method, fully consider the rationality of the hierarchical structure division of the hierarchical model, and propose an improved hierarchical model of security situation quantification, which combines with AHP algorithm to calculate the security situation of each service and the whole.
4. The situation prediction model is studied. In this thesis, LSTM is used to predict the future operation of the system, and the particle swarm optimization (PSO) is used to optimize the LSTM situation prediction model.
5. The network security situation assessment system is studied. A situation assessment system suitable for multi-service scenarios is designed and implemented, and the visualization display is carried out, which improves the ability of decision makers or operation and maintenance personnel to perceive the network security situation of power information system. Keywords: Security situation assessment, Security situation quantification, Time series
prediction, Ensemble learning
III

目录
目录
第一章 绪论 .....................................................................................................................1 1.1 研究背景和意义 .................................................................................................1 1.2 国内外研究现状 .................................................................................................2 1.2.1 国外研究现状 ...........................................................................................2 1.2.2 国内研究现状 ...........................................................................................3 1.3 关键问题 .............................................................................................................4 1.4 研究内容 .............................................................................................................4 1.5 结构安排 .............................................................................................................5
第二章 相关原理和技术 .................................................................................................7 2.1 数据预处理理论基础 .........................................................................................7 2.1.1 数据清洗 ...................................................................................................7 2.1.2 数据降维 ...................................................................................................8 2.2 网络安全态势评估理论基础 .............................................................................8 2.2.1 网络安全态势评估概述 ...........................................................................9 2.2.2 安全态势评估经典模型 ...........................................................................9 2.2.3 其他安全态势评估模型 .........................................................................12 2.3 集成学习描述 ...................................................................................................21 2.4 态势评估评价指标 ...........................................................................................24 2.5 本章小结 ...........................................................................................................25
第三章 基于集成学习的网络安全态势评估模型研究 ...............................................26 3.1 模型总体框架设计 ...........................................................................................26 3.2 数据预处理层 ...................................................................................................27 3.2.1 时序指标数据预处理 .............................................................................27 3.2.2 告警关键信息提取 .................................................................................32 3.2.3 指标告警数据融合 .................................................................................33 3.3 态势评估层 .......................................................................................................34 3.3.1 Boosting 评估算法实现 .......................................................................... 34 3.3.2 改进 Boosting 评估算法 ........................................................................ 37 3.4 态势量化层 .......................................................................................................42 3.4.1 层次化计算体系 .....................................................................................43
IV

目录
3.4.2 风险类型量化评分 .................................................................................44 3.4.3 层次化安全态势量化过程 .....................................................................45 3.5 态势预测层 .......................................................................................................46 3.5.1 LSTM 态势预测模型构建 ......................................................................46 3.5.2 态势预测模型优化 .................................................................................48 3.6 实验结果分析 ...................................................................................................49 3.6.1 态势评估层实验结果和分析 .................................................................49 3.6.2 态势量化层实验结果和分析 .................................................................51 3.6.3 态势预测层实验结果和分析 .................................................................53 3.7 本章小结 ...........................................................................................................56 第四章 系统需求分析 ...................................................................................................57 4.1 总体需求概述 ...................................................................................................57 4.2 功能需求分析 ...................................................................................................58 4.2.1 数据采集模块 .........................................................................................58 4.2.2 数据预处理模块 .....................................................................................59 4.2.3 服务态势评估模块 .................................................................................59 4.2.4 整体态势评估模块 .................................................................................61 4.2.5 态势预测模块 .........................................................................................61 4.2.6 用户管理模块 .........................................................................................62 4.2.7 日志模块 .................................................................................................63 4.3 非功能需求分析 ...............................................................................................64 4.4 本章小结 ...........................................................................................................64 第五章 系统设计 ...........................................................................................................65 5.1 系统架构设计 ...................................................................................................65 5.2 数据库设计 .......................................................................................................66 5.3 系统功能模块设计 ...........................................................................................70 5.3.1 用户管理服务 .........................................................................................71 5.3.2 数据采集服务 .........................................................................................72 5.3.3 数据预处理服务 .....................................................................................73 5.3.4 安全态势评估服务 .................................................................................74 5.3.5 态势预测服务 .........................................................................................75 5.4 本章小结 ...........................................................................................................76 第六章 系统实现与测试 ...............................................................................................77
V

目录
6.1 系统界面实现 ...................................................................................................77 6.1.1 用户管理界面实现 .................................................................................77 6.1.2 态势评估界面实现 .................................................................................78 6.1.3 态势预测界面实现 .................................................................................80 6.1.4 日志管理界面实现 .................................................................................80
6.2 系统实现伪代码 ...............................................................................................81 6.2.1 数据采集模块伪代码 .............................................................................81 6.2.2 数据预处理模块伪代码 .........................................................................82 6.2.3 态势评估模块伪代码 .............................................................................82 6.2.4 态势预测模块伪代码 .............................................................................83
6.3 系统测试 ...........................................................................................................84 6.3.1 测试环境 .................................................................................................84 6.3.2 系统功能测试 .........................................................................................85
6.4 本章小结 ...........................................................................................................88 第七章 全文总结与展望 ...............................................................................................89
7.1 全文总结 ...........................................................................................................89 7.2 展望 ...................................................................................................................89 致谢 .................................................................................................................................91 参考文献 .........................................................................................................................92
VI

第一章 绪论
第一章 绪论
1.1 研究背景和意义
随着网络信息系统的不断发展，信息网络的规模越来越大，网络结构越来越 复杂。同时，随着我国政治、经济、文化的不断发展，计算机网络在人民社会生 活的各个方面参与度越来越高。网络给人们带来了在衣、食、住、行等各个方面 便利的同时，存在于网络中的攻击行为也在不断增多，涌现出大量自动化的攻击 工具，网络攻击事件以多种多样的方式出现，网络攻击行为变得越发猖獗，严重 影响了人民生产生活的各个方面。国家、企业和个人的财产、信息安全面临着极 大的挑战，所以有效地加强对信息系统网络安全状况的感知十分重要。
2021 年 7 月 20 日，国家计算机网络应急技术处理协调中心发布了《2020 年 中国互联网网络安全报告》[1]。报告称，在对网络信息系统的安全缺陷进行的累 计监控和通报情况中，受到黑客攻击、个人资料被盗和不法销售等重大资料安全 性问题超过 3,000 次；目前，各大主流的 DB 如 MySQL、PostgreSQL、Redis 等 都受到了严重的攻击，其中 DB 被删库、拖库、植入恶意代码、植入后门等事件 频发；全国信息安全漏洞分享中心（China National Vulnerability Database，CNVD） 共收到 20,704 个安全缺陷，并持续增涨，同比增加 27.9%；历史上存在的重大漏 洞使用的危险仍然比较大，通过取样监控，我们可以看到，每天有 2,000,000 多起 使用网络安全缺陷的远程入侵，包括扫描和代码执行等；CNVD 所列常见类型的 安全缺陷，其中，安全产品类型的安全缺陷达到了 424 个，较上年同期增加了 110.9%；当前，我国的工业信息化网络安全问题依然十分突出，其中，工业企业 的信息化系统已经成为网络黑客的主要目标，海外网络攻击者将对国内工业企业 的信息化系统作为了重点攻击目标，在对能源、轨道交通等重点信息基础设施的 在线监测中，有 20%的生产管理系统存在较高的风险安全漏洞。随着我国信息技 术的发展，我国政府、企业面临着越来越多的安全挑战。
在这样的背景之下，网络安全态势感知技术也随之诞生和发展。而网络安全 态势评估技术是网络安全态势感知的核心和重要环节。网络安全态势评估是通过 对可能影响网络安全的各方面数据进行数据处理和综合分析，并通过机器学习等 模型方法进行分析计算，最终得出整体网络安全态势，通过可视化技术将评估结 果实时展示给网络决策者。决策者通过评估结果可以实时了解和掌握当前及历史
1

电子科技大学硕士学位论文
的网络安全状况，对网络中存在风险和故障进行准确和及时溯源，提升对网络风 险和故障的处理能力，降低由于网络攻击行为造成的资产及财产损失。
1.2 国内外研究现状
1.2.1 国外研究现状
Endsley 在 1988 年中首次提出“态势感知是捕捉和理解一定时间和空间内影 响环境的因素，从而达到预测未来的目的”[2]，他提出的三层感知模型包含态势要 素提取、态势理解、态势预测三个层面，在此之后态势感知受到广泛关注和研究。 而 NSA（NetWork Situation Awareness，网络安全态势感知)的概念是在 1999 年由 Tim Bass 首次提出[3]，他首次将空域交通管理中的相关感知技术应用到了网络安 全防护和管理领域，为网络决策者及时感知网络安全状况提供了可能。2001 年， Tim Bass 提出了五层感知模型[4]，包含提炼数据、攻击收集、评估态势、评估威 胁和资源调配五层，融合了网络中众多传感器的数据，并对融合后的数据进行网 络安全感知，数据融合的重要性在该模型中得到了充分体现，在此之后针对网络 安全态势感知的相关研究逐渐成为了研究热点。2004 年，LBNL（Lawrence Berkeley National Labs，美国劳伦斯伯克利国家实验室）通过采用三位坐标中的点 来表征系统网络流量相关信息[5]，进一步提升了网络安全态势的感知能力。2006 年 Salmon P 等人[6]分析了各节点之间相互影响，提出了一种分布式场景下的态势 感知框架，增强了对分布式情景的感知能力。2007 年，Monsur H 提出了态势感 知在一定程度上可以在两个相邻节点之间转移这样的假设[7]，并且基于这个假设， 采用了特征向量法和公平 BET 法，将网络生成的值与节点的给定质量特征相结 合，这种方法综合考虑了网络拓扑结构的影响。2008 年，Roman R 等人[8]将态势 感知应用在了传感器网络中，传感器节点可以利用态势感知机制来确定其周围是 否存在异常事件，并将感知机制作为高层监控服务的基础，来保证传感器在没有 外部管理的情况下长时间运行。2010 年，Mathew S 等人[9]针对多层网络攻击，提 出了一种基于网络连接和攻击推进语义的多层攻击模型，该模型可产生多层攻击 模式，通过语义与攻击模式进行关联，并构建了网络攻击识别系统（the Event Correlation for Cyber Attack Recognition System，ECCARS），为分析人员提供对 可能的攻击及其进展的有效感知、理解和预测。Jakobson G 在 2011 年提出了基于 扩展概念图的网络安全态势评估模型[10]，引入了网络地形的概念，即包含服务和 资产及其相互依赖关系的多层次信息网络结构，还描述了任务的模型，以及以统
2

第一章 绪论
一方式呈现网络地形和任务之间依赖关系的影响依赖图，以及直接影响如何通过 资产间、服务和任务依赖性传播。2014 年 Bhatt P 等人[11]提出了一个支持跟踪和 预测多阶段网络攻击的网络安全态势感知框架，使用大数据技术更快地关联事件 日志，感知不同的安全事件，理解当前网络安全形势。2016 年，Liu X 等人[12]将 安全态势感知流程与安全数据生命周期相结合，提出了一个多层次的安全态势感 知分析框架。2019 年，Rodriguez A 和 Okamura K[13]提出了一个端到端的实时网 络态势感知系统，该系统对检索到的数据进行分类和聚合，并基于数据分析和情 绪分析技术提供实时网络态势感知信息。
从整体上看，国外的对于网络安全态势感知的研究开展较早，早期更注重感 知模型的研究，后期主要着重于感知框架的设计，以及针对不同的应用场景如分 布式、大数据等场景，制定更合理的评估策略，加强对攻击行为、态势信息的理 解，提高态势评估性能。
1.2.2 国内研究现状
随着我国信息化的进一步提升，国家越来重视网络信息安全，大量的研究者 开始投入到安全态势感知相关领域的研究和应用，该领域逐渐受到学界及工业界 的关注。
陈秀真等人[14]提出的安全风险层次化态势量化评估模型，为国内后续态势感 知研究奠定了基础，该模型采用的评估流程是从上到下、先具体后整体的方式， 按照攻击、服务、主机及整个网络的层次顺序计算安全态势，该方法的优点是结 果较为直观。文献[15]中提出了基于简单加权和灰色理论的网络安全态势感知模型 （Network Situation Awareness Model，NSAM），其构建分为两个阶段：实时网 络安全态势评估建模和潜在的网络安全风险预测建模，根据被攻击的各个服务受 到的风险威胁大小，建立了风险加权融合的网络安全态势评估模型，并通过对历 史和当前的网络安全形势，采用灰色理论进行预测，构建了潜在的网络安全形势 预测模型。文献[16]采用隐马尔可夫模型，综合考虑了系统自身安全漏洞和外部风 险威胁两方面的因素对系统安全运行状态影响，从风险攻击、设备节点、设备、 系统四个层次依次进行评估，然后自下而上加权融合得出各层次的安全态势值。 汤永利等人[17]对 D-S 证据理论进行改进，用于安全态势评估，将来自多方面的数 据进行数据融合，通过反向传播神经网络来计算 D-S 证据理论的基础概率的分配 情况，再通过 D-S 证据理论依次进行计算。文献[18]提出了一种基于聚类分析的网 络安全态势计算方法，该方法通过聚类融合主机多源异构数据，并逐步量化，得 到网络安全态势。文献[19]针对网络风险攻击具有攻击协同性较强、规模较大、分
3

电子科技大学硕士学位论文
步攻击的特点，并对以往的评估方法进行了分析，综合考虑到攻击目的与系统基 础设置信息之间的关联关系，提出了一种基于入侵目的判别的安全态势评估方法， 首先对攻击发起者和风险攻击事件进行因果关联分析，识别并提取攻击路径，判 定每个攻击步骤，然后实现基于攻击步骤分析的态势评估，再根据已有的攻击步 骤，结合脆弱性和网络拓扑关系，识别入侵目的并预测下一个攻击步骤。
国内的对于网络安全态势感知的相关研究对比国外相对要晚一些，还处在发 展阶段，为了适应国内不断信息化的需求，进一步提高网络安全防护能力，降低 网络攻击造成的信息、财产损失，还需要科研人员进一步探索研究。
1.3 关键问题
本文实现的基于集成学习的网络安全态势评估系统，主要涉及安全态势相关 数据采集，数据预处理、安全态势评估、预测等任务。目前在相关领域已存在大 量优秀的相关算法，但是实现本文系统所需功能还要进一步研究如何有效的融合 这些相关算法并应用到实际的业务场景中，因此主要存在以下关键问题：
1、多类型数据综合分析的问题。电力信息系统中存在大量安全相关指标数据 和告警数据，但目前缺少综合处理、统一分析的手段。
2、针对性的模型改进问题。以往的态势评估模型，少有针对具体数据问题进 行相应改进的情况。而在电力信息系统的实际数据中，经常存在一些困难样本和 噪声样本，导致模型整体性能下降，因此如何进行针对性的改进是本文要解决的 一个关键性问题。
3、多服务场景的态势计算问题。在电力信息系统实际运行业务场景中，往往 包含了多个服务，每个服务中的主机、指标、数据情况都不相同。当前很多对于 系统态势评估的研究，都是针对单一系统，模型构建方法也较为单一，难以应用 于多服务的业务场景。如何设计出适用于多个服务的统一的安全态势评估计算模 型是本论文需要解决的关键性问题。
1.4 研究内容
本文针对某电力信息系统数据特点，进行了数据预处理研究，采用集成学习 Boosting 算法对安全态势进行评估，并对 Boosting 算法进行了改进，提出了一种 基于改进 Boosting 算法的网络安全态势评估模型，针对电力信息系统的多服务场 景，开展了层次化的安全态势量化研究，最后对态势评估系统进行了实现。
4

第一章 绪论
本文主要的研究内容包括以下几点： 1、研究基于电力信息系统网络安全相关数据的数据预处理模型。某电力企业 信息系统的数据包含指标数据和告警数据，对指标数据采用平均值法和临近值法 相结合的方式进行缺失值填充、重复值删除、数据降维等处理；对告警数据进行 告警关键信息提取，最后对指标数据和告警数据进行数据融合。 2、研究基于集成学习的安全态势评估模型。本文采用 Boosting 算法对安全 态势进行评估，并对 Boosting 算法进行改进，提出一种基于改进 Boosting 算法的 网络安全态势评估模型。针对噪声样本和困难样本，一方面，改进 Boosting 算法 对样本权重更新进行限制，限制对于困难样本和噪声样本过度关注；另一方面， 权重过高的样本进行随机特征裁剪，降低噪声对于模型的影响。 3、研究层次化的安全态势量化模型。本文分析原有层次化评估方法，充分考 虑了层次模型层次结构划分的合理性，提出一种改进的安全态势量化层次模型， 结合 AHP 算法对多个服务和整体安全态势进行层次化计算，使其适用于多服务的 态势计算场景。
1.5 结构安排
本文一共分为七章，主要结构如下： 第一章是绪论，首先阐述了网络安全态势评估的研究背景和意义，从国内外 两个方面阐述了安全态势评估的研究现状，然后分析了目前的研究中存在的问题， 最后阐述了本文的主要研究内容。 第二章是理论基础，首先阐述了数据预处理技术的理论基础，包括数据清洗 和数据降维两个方面，然后描述了网络安全态势评估的概念，阐述了三种经典的 安全态势感知模型的结构，随后阐述了安全态势评估的一些其他方法并描述了集 成学习算法，最后介绍了态势评估中会用到的评价指标。 第三章研究基于集成学习的网络安全态势评估模型，对安全态势评估总体框 架进行了设计，然后从数据预处理层、态势评估层、态势量化层和态势预测层四 个层面对安全态势评估和预测过程进行了详细的阐述，并通过实验验证了评估和 预测算法的有效性。 第四章从当前安全态势评估存在的问题和某电力企业的实际需求入手，从系 统功能性需求和非功能性需求两个方面，对基于集成学习的安全态势评估系统进 行了详细的需求分析。 第五章从服务划分的角度阐述态势评估系统的架构设计，按照非关系型数据
5

电子科技大学硕士学位论文
和关系型数据阐述数据库的设计，最后按照功能模块的划分，分别对各个模块进 行设计。
第六章首先对系统界面实现进行展示并对系统实现伪代码进行介绍，然后描 述系统测试环境，并根据测试方案依次进行系统功能性测试和性能测试。
第七章对全文进行了总结，并分析了接下来安全态势评估的研究重点和方向。
6

第二章 相关原理和技术
第二章 相关原理和技术
2.1 数据预处理理论基础
随着信息系统需求的不断增加，功能的不断拓展，系统结构也越来越复杂， 系统在运行过程中会产生海量的数据，这些数据包括一定时间间隔的指标数据、 系统中不断触发的日志告警数据等。随着数据量的增多，数据的质量往往不能够 得到保证，所以在流入评估模块之前，需要进行数据预处理，以提高评估的准确 性。数据预处理没有统一的处理流程，通常根据处理目的和数据本身特点的不同 而采用不同的处理方法，数据预处理一般包含数据清洗、数据降维等过程。
2.1.1 数据清洗
在数据采集的过程中，由于受网络以及系统的影响，可能会采集到重复的、 异常的数据，也有可能会发生漏采的情况。这样的数据并不能反应系统的真实状 况，如果直接流入评估模块，会严重评估的准确性。因此需要对采集到的数据进 行数据清洗，包含缺失值填充、删除重复值、异常数据检测等。
缺失值填充解决的是数据漏采的问题，通常包含以下几种填充方式：人工填 写，通过人工的方式进行填充，对于缺失较多的数据以及大数据量的场景下，并 不适用；特殊值填充，在缺失数据的位置上填充特殊值，如“na”或“unknow”等， 这种方式认为空缺值也是包含一定信息的，因为空缺有别于其他数据；平均值填 充，对于数值类型的数据采用该指标其他未缺失数据的平均值进行填充，而对于 非数值类型的数据采用该指标其他未缺失数据的众数来填充；临近值填充，采用 该数据的相邻未缺失前值或者未缺失后值进行填充；热卡填充，寻找一个与该缺 失数据最为相似的数据进行填充，这种方法的缺点是难以定义相似的概念，主观 影响较多；最邻近法，通过计算正常数据与该缺失数据的欧氏距离或通过相关性 分析的方式，例如寻找距离缺失数据最近的 t 个样本，填充这 t 个样本的加权均 值。
重复值删除主要解决的是由于网络抖动等原因造成的数据重复采集问题，一 般可以采用覆盖旧值或删除新值的方式进行处理。
异常值检测主要针对的是采集到的错误或异常的数据，这些数据会导致值域 异常大或异常小，无法正常提取数据中的特征。一般可以根据数据分布设置规则
7

电子科技大学硕士学位论文
将其剔除。
2.1.2 数据降维
采集到的数据往往会存在一些冗余指标，重复计算这些冗余指标会增加不必 要的计算量。而数据降维是一个提取有效信息摒弃冗余信息的过程，有效的数据 降维是十分必要的。数据降维的手段主要有经验法、主成分分析法、自编码器法 等。
经验法是指通过经验人为的去挑选和去除一些冗余的指标，十分依赖专家经 验，工作量随指标数量的增长而增长，当指标过多时，工作量是巨大的。
主成分分析[20-24]是通过某种投影关系，将高维的数据映射到低维空间，并期 望数据的方差在投影维中最大，从而使用更少的数据维，保留更多原始数据点的 特征。
自编码器降维的主要思想是通过多层神经网络将高维数据编码为低维数据， 然后通过重构高维数据达到降维的目的。其结构图如图 2-1 所示。
图 2-1 自编码器结构图
编码部分采用分层递减的方式对信息进行编码；译码是以数据的抽象化表达 为核心，逐步地将神经网络数目递增，以完成对输入的数据进行重建。
可以看出，自编码器在训练时不需要使用额外的样本标签，本质上，该方法 以输入与输出两种方式，以最大限度地减少重建损失，从而实现对样例的抽象性 表达。此方法具有较好的普适性。
2.2 网络安全态势评估理论基础
8

第二章 相关原理和技术
2.2.1 网络安全态势评估概述
随着信息技术的不断发展，网络与人们的生产生活密切相关，人们享受着网 络带来的便捷的同时，网络所伴随的信息泄露及财产损失问题也日益凸显。网络 攻击技术也随之发展，传统的网络安全防御手段和安全工具渐渐不能满足人们日 益增长的安全防护需求，急需一种有效的安全防护手段，安全态势感知提供了一 种可行的解决方案，而安全态势评估是其重要的步骤。网络安全态势评估是对网 络安全相关信息进行关键信息提取、安全状况宏观分析和评价的一个过程。
态势感知这一概念源于美国空军航天报警系统的研究，后被广泛应用于航空 交通管制、战场态势分析等场景。态势是对系统整体安全状况的宏观描述，态势 感知则是对系统安全状况基于安全相关信息的融合、抽象和理解的过程。态势感 知的重点在于对系统输出的安全相关信息进行综合分析，如网络相关设备的指标 数据、用户的行为数据、系统相关资产数据以及系统运行过程中产生的日志告警 等数据，并将分析评估的结果输出为态势，进行可视化的展示以方便人对态势的 理解。而态势评估的关键在于评估的准确性，以及缩短从系统安全相关信息到决 策的距离。
2.2.2 安全态势评估经典模型
在当前的许多网络安全态势评价模型中，最典型的是 Endsley[25]三层感知模 型、JDL 模型[26]和 Tim Bass 模型，这一节重点介绍了三种典型的模型。 2.2.2.1 Endsley 模型
三层感知模型是模拟人类的认知行为，并根据认知行为的三个阶段：觉察 （Perception）、理解（Comprehension）、预测（Projection），构造了感知模型 的三个阶段：态势要素提取、态势理解、态势预测。如图 2-2 所示。
态势感知过程和分析能够对态势造成影响的各方面因素的过程是该模型的两 个关键环节，可以将对系统的态势产生影响的整体因素分为两个方面，即系统因 素和个人因素，整体因素会影响态势感知最后的决策行为和实施效果，态势感知 的最终实施结果还会影响下一步骤的感知过程。
9

电子科技大学硕士学位论文
图 2-2 Endsley 三层感知模型
2.2.2.2 JDL 模型 JDL（Joint Directors of Laboratories）模型主要应用在军事和战场场景的态势
感知中。JDL 模型可以高效的感知战场态势，提高决策者对战场形势的感知能力。 由于该模型无法不加改动就用于其他场景，所以很多研究人员对该模型进行了改 进。JDL 网络安全态势模型可以划分为六个层次。如图 2-3 所示。
第 0 层：数据预处理层，通过对安全相关数据进行分析，对攻击行为进行检 测并输出告警。
第 1 层：对象提取层，将第 0 层的输出数据作为输入，并对来自多个方面的 数据进行融合。
第 2 层：状态提取层，将第 1 层的输出数据作为输入，进行态势的分析和感 知。
第 3 层：威胁评估层，根据第 2 层输出的态势数据来评估入侵者对整个系统 产生的安全风险程度。
第 4 层：动态监控融合层，分析历史的态势信息来加强融合的过程。 第 5 层：知识提炼层，通过对系统交互信息的融合，提升人机交互的有效性。
10

第二章 相关原理和技术
图 2-3 JDL 模型
2.2.2.3 Tim Bass 模型 Tim Bass 于 1999 年首次提出网络安全态势评估这一概念,他将空域交通管理
中的相关感知技术应用到了网络安全防护和管理领域，为网络决策者及时感知系 统网络安全状况提供了可能。到 2001 年，他提出了五层结构的网络安全态势感知 模型，融合了网络中众多传感器的数据，并对融合后的数据进行网络安全感知， 数据融合的重要性在该模型中得到了充分体现。该模型的体系结构如图 2-4 所示。
Tim Bass 五层模型; 第 0 层：数据提炼层，从网络中传感器等设备采集数据，并对其进行数据预 处理。 第 1 层：攻击提取层，对第 0 层输出的数据进行规范化处理，并在时间和空 间上进行关联。 第 2 层：态势评估层，基于第 1 层输出的数据进行态势评估。 第 3 层：威胁评估层，根据第 2 层的评估结果，评估可能遭受的安全威胁。 第 4 层：资源管理层，对整个过程中的资源进行管理。
11

电子科技大学硕士学位论文
图 2-4 Tim Bass 五层感知模型
2.2.3 其他安全态势评估模型
2.2.3.1 层次分析模型 陈秀真等人提出的安全风险层次化态势量化评估模型采用的评估流程是从上
到下、先具体后整体的方式，按照攻击、服务、主机及整个网络的层次顺序计算 安全态势。其结构如图 2-5 所示。
从上至下地分析该模型，最上层为网络层，网络层中的安全态势由主机层向 上传递，通过对不同主机赋予不同的重要性权重，计算出网络层的安全态势；第 二层为主机层，主机层地安全态势由服务层向上传递，通过对同一主机上不同的 服务赋予不同的重要性权重，计算出主机层的安全态势；第三层为服务层，服务
12

第二章 相关原理和技术
层的安全态势由攻击层向上传递，综合攻击的威胁强度、攻击次数等因素，计算 出服务层的安全态势；最下面一层为攻击层，攻击层中的数据为攻击行为的描述 信息，如攻击类别、攻击等级、攻击路径等信息。
该模型的优点是层次结构清晰，便于可视化及易于理解，但这种方法弊端也 很明显，攻击层和服务层进行数据综合的过程以及网络层和主机层赋权的过程受 一定的主观因素影响。
图 2-5 层次分析模型
2.2.3.2 基于神经网络的模型 神经网络算法参考了人类的神经元结构，一个人类神经元包含轴突、树突、
神经核[27-29]。神经网络模型是建立在多个神经元的基础上，每个神经元都可以看 作一个学习单元。这些神经元将某些特征作为输入，并通过加入参数计算获得输 出。神经网络因其具有非线性拟合能力强、学习规则简单、便于实现、健壮性等 优点，已经被广泛应用于生产生活的各个方面。
BP 神经网络（Back Propagation Neural Networks）在进行训练时，会把误差 信息进行逆向传递。首先，输入训练样本，在计算输入层和隐藏层之后，将计算 结果输出到输出层，再由输出层进行计算，再将其与实际数据的差值进行反向传 递。在此基础上，由隐层反馈到各神经元，由各神经元的误差信息进行权重修正。 然后，反复进行该步骤，直至错误小于一个特定的数值，或者达到预定的循环次 数为止。这时，整个网络已经建立起来，网络的训练也就结束了。其结构图如图
13

2-6 所示。

电子科技大学硕士学位论文

图 2-6 BP 神经网络结构

BP 算法步骤如下： 第 h 个隐藏层神经元的输入为：
d
 h  vih xi i0

经过隐藏层激活函数，第 h 个隐藏层神经元的输出为：
bh  f h   h 
其中，函数 f 为激活函数，  h 为第 h 个神经元阈值。 隐藏层到输出层：
l
  j  whjbh h1

经过输出层激活函数，输出层输出为：

  y

k
j



f

 j  j

14

（2-1） （2-2） （2-3） （2-4）

第二章 相关原理和技术

其中， j 为第 j 个输出层神经元阈值。 计算输出层误差：

 Ek



1 2

l j 1



y

k j





y

k j

2 

综合以上各式，可得权重参数的调整公式如下：

whj





Ek whj

（2-5） （2-6）

vih





Ek vih

（2-7）

然后进行下一组训练数据的输入，重复这个计算过程，直到误差小于一定值 或者达到设定的迭代次数时就训练完成了。
RBF 神经网络把 RBF（Radical Basis Function，径向基函数）作为隐藏层神 经元的基组成隐藏层，无需经过权值连接即可将输入矢量映射到隐藏层。在 RBF 的中心点被确定之后，就建立了对应的映射关系。RBF 神经网络可以看作是一种 多对多映射，以网络安全相关指标为输入，以安全态势评估结果为输出。其结构 如图 2-7 所示。

图 2-7 RBF 神经网络结构
广义回归神经网络（Generalized Regression Neural Network，GRNN）是改进
15

电子科技大学硕士学位论文
的 RBF 神经网络，相比于传统神经网络而言，其存在收敛速度较快、自学习能力 较强的优点，常被用于函数逼近、回归建模等场景[30]。
GRNN 是由大量 RBF 神经元作为基本单元构成。RBF 神经元结构如图 2-8 所示，GRNN 网络结构如图 2-9 所示。
图 2-8 RBF 神经元结构
图 2-9 GRNN 网络结构
神经网络这种方式同样也存在不足之处，一方面神经网络在训练过程中对参 数的选取较为敏感，不恰当的训练参数会严重影响模型精度，所以对训练参数的 选取要十分谨慎。 2.2.3.3 基于支持向量机的模型
支持向量机(Support Vector Machine，SVM)在面对小样本、非线性及高维模 式识别等场景具有很大优势[31-33]。
16

第二章 相关原理和技术
图 2-10 SVM 结构图
支持向量机实质上是一种核方法，通过引入 KF（Kernel Function，核函数） 求解低维线性不可分问题，该方法主要是利用 KF 把输入的数据转换成一个具有 较高维度的特性，把输入的非线性问题转换成一个线性问题。SVM 具有较强的适 应性和较强的泛化性能。其结构如图 2-10 所示。
图 2-11 划分超平面
17

电子科技大学硕士学位论文

支持向量机的基本想法就是当训练数据集被正确划分时让从最接近超平面的
点到超平面的间隔被最大化。对于训练样本集
D  x1, y1,x2, y2 ,,xm, ym , yi 1,1，在样本空间中，超平面可以用式（2-8）
表示，如图 2-11 所示。

wT  x  b  0

（2-8）

其中，由法矢量 w 来确定这个超平面的方位；由位移矢量 b 确定此超平面至 原点的距离。
样本数据中各点到超平面的距离大小可以表示为

wT x  b w

（2-9）

其中， w 为二阶范数， w  w12  w22    wm2 。

支持向量到超平面的距离为 r，即

 wT  

x w

b



r,

y



1

 

wT



x w

b



r,

y



1

（2-10）

由于 r  0 ，所以可以转换为

  

wT x w

 r

b



1,

y



1

  

wT x w

 r

b



1,

y



1

（2-11）

为了方便计算，令 w r 为 1，那么两个不相同类别支持向量到超平面的距离 的和表示为

 2 w

（2-12）

为了找到距离最远的分割超平面，必须找到符合限制的 w 、b 两个参数，使  最大：

18

第二章 相关原理和技术

max 2 w,b w
  s.t. yi wT xi  b  1,i  1,2,m
最大化 w 1 ，等价于最小化 w 2 ，所以可改写为
min w 2 w,b
  s.t. yi wT xi  b  1,i  1,2,m

（2-13） （2-14）

2.2.3.4 基于贝叶斯网络的模型

Frigault 等人[34]在 2008 年提出了基于动态贝叶斯网络的评估方法。以贝叶斯 公式为基础的贝叶斯网络是一种采用概率推理的图形信念网络，利用有向无环图 来描述属性之间的依赖关系。
贝叶斯网络通过有向无环图来描述节点和节点之间的依赖关系，其中结点表 示随机变量，条件概率表示相互之间关系的强度，对于无父结点则用先验概率来 进行信息表达。贝叶斯网络结构图如图 2-12 所示。

图 2-12 贝叶斯网络结构图
贝叶斯网络结构主要包含顺连、分连、汇连三种连接形式。如图 2-13、2-14、 2-15 所示。
19

电子科技大学硕士学位论文
图 2-13 顺连结构
如图 2-13，在 w 为未知的情况下，变量 u 的改变会对 w 的置信性产生影响， 进而间接地对 v 产生影响，因此 u 和 v 是相关的；如果给定 w 一个置信度，u 将 不会对 v 产生作用，因此，u 和 v 是不受任何相互干扰的，这是由于 u 和 v 的信 道被阻塞了。
图 2-14 分连结构
如图 2-14，分连指一种可能产生多种可能的情况，如果 w 是确定的，那么变 量 u 与 v 是不可交互的，变量 u 与 v 不能互相作用，所以是彼此无关，但如果变 量 w 是不确定的，则 w 能够使变量 u 与 v 间进行相互影响，因此变量 u 与 v 彼此 作用而非彼此分离。
图 2-15 汇连结构
20

第二章 相关原理和技术

如图 2-15，汇连表示一种结果是多个因素造成的，在知道了一个变量 w 后， 变量 u 的可信性增大将使 v 的可信性下降，使 u 和 v 彼此产生作用。在 w 为未知 置信的情况下，u 的可信性不随 v 可信性的变化，且它们彼此无关。
对于贝叶斯网络的学习过程，只要知道了网络的构造，也就是知道了各特征 之间的相关性，那么就可以通过学习相关的参数来估算各结点的状态机率。而在 现实中，由于对其网络拓扑的不了解，贝叶斯网络的主要就是在训练集的基础上， 找到最适合贝叶斯网络的结构。一般采用打分查找的方式对结构进行质量评定， 首先给出一个评定公式，对贝叶斯网络和训练数据进行匹配，然后根据评定公式 找到最佳的网络架构。
对于训练集 D  x1, x2,, xm，贝叶斯网络 B  G，  在数据集 D 上的评定
公式为

sB | D  f   B  LLB | D

（2-15）

其中， B 是贝叶斯网络参数的数量； f  是描述每个参数所需的信息量；

LLB

|

D



m


log

PB

xi



i 1

（2-16）

LLB | D是贝叶斯网络的对数似然，用于求出结构 B 所对应的概率分布描述样本 集 D 的所需信息量。因此，将研究工作转换成寻求一种结构，使得评定公式 sB | D
最小。
若 f    1，即用一个字节描述一个参数，则得到 AIC 评分函数

AICB | D  B  LL(B | D)

（2-17）

若贝叶斯网络 B  G， 的结构是不变的，那么评定公式的前面一项就是固

定的，此时最小化评定公式等价于对参数的最大似然估计，而最优参数能直接在

训练集上通过经验估计获得。所以为了进行最小化评定公式，只需要对网络结构

进行搜索。一种是从一个特定的结构开始，一次对一个边进行一次修正，直至评

分不下降；第二种方法是限制网络的网络结构，减少网络的搜索范围。

2.3 集成学习描述
当人们进行复杂问题建模时，单一个体分类器往往无法达到性能要求。集成 学习（Ensemble Learning）[35-39]不是指机器学习中的某个特定算法，而是指通过 一定的结合策略将多个弱学习器结合到一起，构建一个强学习器的过程。集成学
21

电子科技大学硕士学位论文
习的一般结构如图 2-16 所示。首先，把训练样本数据当作一个输入，对多个体的 学习器进行训练，再利用组合的方法将各个学习器的分类效果进行综合，最后将 得出强学习器的分类结果作为输出。

图 2-16 集成学习一般结构

集成学习将多个弱学习器以一定的策略进行组合，其泛化性能一般要好于单 一学习器。对于一个二分类任务，其结果集为 y ∈ −1, + 1 ，分类器的错误率如 式（2-18）所示。

Phx  f x  

（2-18）

式中，h x 为该分类器函数；f x 为真实函数；ε为分类器错误率。 使用投票策略将T 个弱分类器组合到一起，那么所组合成的集成分类器如式
（2-19）所示。

 H

x



sign 

T i 1

hi

x


（2-19）

如式（3-14）所示，对于一个样本如果分类正确的弱分类器超过一半，那么 所组合成的集成分类器结果就正确。
集成学习对于弱学习器的组合方式包含同构（Homogeneous）方式和异构 （Heterogenous）方式，同构方式仅对同种类型的弱学习器进行组合，例如只包 含神经网络或只包含决策树的组合；异构方式可以对不同类型的弱学习器进行组 合，例如组合既包含神经网络又包含决策树。如图 2-17 所示。

22

第二章 相关原理和技术
图 2-17 同构集成和异构集成结构
集成学习还可以按照执行模式分类，可分为串行模式和并行模式，其结构分 别如图 2-18 和 2-19 所示。
图 2-18 串行模式
图 2-19 并行模式
2000 年，Dietterich[40]分析了将学习器进行结合可能会带来统计方面、计算方 面和表示方面的三方面好处：首先，从统计方面来说，使用单一学习器可能因为 对某些样本数据错误分类而导致泛化能力下降，而组合多个弱学习器可以降低因 单一学习器对某些样本数据错误分类导致的泛化性能下降的可能；从计算方面来
23

电子科技大学硕士学位论文
说，学习算法存在可能陷入局部极小的情况，当陷入部分局部极小点时，其可能 的泛化性能也会很差，而对多个弱学习器通过一定策略进行组合可以减低陷入部 分泛化性能差的局部极小点的可能；从表示方面来说，一些样本数据的真实情况 可能并不属于当前单一学习算法所考虑的范围内，对于单一学习器而言分类效果 是不好的，而对多个弱学习器通过一定策略进行组合有可能学得更好的近似情况。
下面是常见的结合策略： （1）平均法，一般适用于算法输出是数值类型数据的情况。一般而言通常使 用加权平均法，加权平均法在二十世纪五十年代就已被广泛使用[41]，当加权平均 法的权值相同时，就退化为了朴素平均法，因此朴素平均法是加权平均法的一个 特殊情况。一般，会根据弱学习器的性能去分配权值，当所有弱学习器性能差不 多时，可以使用朴素平均法。 （2）投票法，一般适用于算法输出是标志类型数据的情况。投票法顾名思义， 根据各个弱学习器输出的标志数据，对其进行统计，得票数最多的并且超过一半， 那么就可以组合输出该标志类型，否则拒绝进行输出，通常用在可靠性要求较高 情况下。还有一种投票方式并不要求得票数必须超过一半，只要求得票数最多即 可进行结果输出，如果得票数最高的有多个标志类型，那么可以随机输出其中的 一个标志类型。 对于弱学习器通常指通过训练数据对某一个单一学习算法进行训练而得到的 一个学习器，而集成学习器是指通过对多个弱学习器以一定的组合策略进行组合 来获得更好的泛化能力。 集成学习是一个对一组弱学习器不断反复训练并将弱学习器最终组合为强学 习器的过程，其中弱学习器为不稳定的学习算法，即对同一学习器在同一样本集 上反复训练，其性能只略优于随机猜测的学习器，也就说错误率略低于 0.5 的学 习器，并且要求对训练集的变化敏感。
2.4 态势评估评价指标
网络安全态势评估是对影响网络安全状况的相关指标数据及告警等数据进行 分析计算，对当前安全态势做出正确的识别和分类。对网络安全态势评估的评价 即对模型输入相同的数据，比较模型输出的评估结果于真实安全态势的差别，差 别越小则模型的性能越好。
分类问题中较为常用的评价指标有召回率（Recall）和准确率（Accuracy）。 召回率也可以被叫作查全率，它表示的是测试集中的正例有多少被正确分类
24

第二章 相关原理和技术

了。所以存在两种情况，一种是把原来的正例正确分类成真正例，另一种就是把

原来的正例错误分类为反例，如果召回率越高，就说明有越多的正例会被正确分

类。其公式如式（2-18）所示。

准确率也可以被叫作查准率，它代表了在被分类为正的样本数据中有多少是

真实的。因此，有两种类型的结果，一种是把正例的正确分类为正例，另一种是

将反例错误分类为正例，如果准确率越高，就说明被分类为正例的样本中真正的

正样本也越多。其公式如式（2-19）所示。

Re call  TP TP  FN

（2-18）

Accuracy



TP TP  FP

（2-19）

其中，TP 为真正例（True positives），当一个样本为正例样本时，其分类结果也 为正例样本；FP 为假正例（False positives），当一个样本为反例样本时，其分类 结果为正例样本；FN 为假反例(False negatives)，当一个样本为正例样本时，其分 类结果为反例样本；TN 为真反例（True negatives），当一个样本为反例样本时， 其结果也为反例样本。
Confusion 矩阵如表 2-1 所示。

表 2-1 Confusion 矩阵

真实情况

分类结果

正例

反例

正例

TP

FP

反例

FN

TN

2.5 本章小结
本章主要针对本文相关的理论和技术进行研究，首先阐述了数据预处理技术 的理论基础，包括数据清洗和数据降维两个方面，然后描述了网络安全态势评估 的概念，阐述了三种最为经典模型的结构，随后阐述了其它几种常用的评估方法 并介绍了集成学习方法，最后描述了会用到的评价指标。

25

电子科技大学硕士学位论文
第三章 基于集成学习的网络安全态势评估模型研究 3.1 模型总体框架设计
本文研究的内容为基于集成学习的安全态势评估，该框架主要包含数据预处 理层、态势评估层、态势量化层和态势预测层。总体框架图如图 3-1 所示。
图 3-1 总体框架图
步骤 1：数据预处理层，对采集到的时序指标数据和时序告警数据进行预处 理。采集的原始时序指标数据存在缺失、重复等现象，并且具有数据量大维度多
26

第三章 基于集成学习的网络安全态势评估模型研究
等特点，因此对指标数据进行了平均值和临近值结合方式缺失值填充、重复值删 除和数据降维等处理；考虑充分利用告警数据，进行了告警数据的关键信息提取。
步骤 2：态势评估层，本文基于融合后的时序指标数据和告警关键信息，采 用 Boosting 算法进行安全态势评估，并提出了改进的 Boosting 算法。
步骤 3：态势量化层，本文提出了一种改进的网络安全态势量化层次模型。 改进的网络安全态势量化层次模型充分考虑了层次模型层次结构划分的合理性， 并参照 CVSS 通用漏洞评分系统，结合 AHP 算法对网络安全态势进行了层次化计 算。
步骤 4：态势预测层，本文采用 LSTM 时序预测模型对未来整体态势值进行 预测，并使用粒子群算法 PSO 对态势预测模型进行了优化。
3.2 数据预处理层
本文所用数据对象均采集自某电力企业的某安全运维系统，该系统收集了该 企业内所有信息系统服务的安全相关数据，包含时序指标数据和告警数据。由于 时序指标数据和告警数据在结构上存在差异性，因此分别采取不同的预处理方式。
3.2.1 时序指标数据预处理
图 3-2 服务-主机-指标关系结构
27

电子科技大学硕士学位论文

本文所采集的指标数据是按照信息系统结构包含关系进行采集的，即一个服 务包含多个主机，一个主机包含多个指标，并以此结构顺序采集该企业电力信息 系统中的所有服务、主机的指标数据。服务-主机-指标关系结构如图 3-2 所示。
服务 Si 包含多个主机，分别为主机 H1 、…、主机 Hn ；主机 Hi 又包含多个指 标，分别为指标 Ii1 、…，指标 Iik 。
3.2.1.1 缺失值填充
采集到的指标数据存在一定的缺失现象，对于部分指标的缺失率和完整率如 表 3-1 所示。

表 3-1 部分指标缺失率和完整率

指标 网络出流量 网络入流量 响应码状态 CPU 使用率 内存使用率 内存使用大小 交换区使用大小

缺失率 6.70% 6.24% 4.23% 4.18% 3.84% 2.43% 1.85%

完整率 93.30% 93.76% 95.77% 95.82% 96.16% 97.57% 98.15%

在第二章已经对缺失值填充的方法进行了介绍，本文采用邻域均值填充的方 式进行填充，即选取缺失数据的前 5 条数据和后 5 条数据，并计算这 10 条数据的 平均值，填充到该缺失位置。
本文选取了内存使用率这一指标在 2021 年 06 月 01 日 00 时至 2021 年 06 月 06 日 12 时的 1523 条完整数据，并随机剔除 5%的数据，以构造数据缺失现象， 对平均值填充、临近值填充和本文所采用的邻域均值填充方式进行测试。
这里采用均方根误差来评价缺失数据填充的准确性，均方根误差的公式为

RMSE 

n
 Ri  Pi 2
i 1
n

（3-1）

其中， n 为缺失数据的个数； Ri 为真实值； Pi 为填充值。 使用以上数据对三种填充方法的测试结果如表 3-2 所示。

28

第三章 基于集成学习的网络安全态势评估模型研究

表 3-2 三种填充方式测试结果

填充方式 平均值填充 临近值填充 邻域均值填充

RMSE 0.31 0.16 0.07

从表 3-2 可以看出，本文采用的邻域均值填充方式的填充结果更为准确，效 果更优。

3.2.1.2 数据降维
本文所采集的指标数据具有数据量大、维度多等特点，因此在设计安全态势 评估模型时，首先应当考虑的就是数据降维。
在第二章已经对数据降维做了基本的介绍，本文采用 SAE 作为数据降维算 法。SAE（Sparse AutoEncoder）[42-44]是一种自编码器模型，在原始损失函数中加 入控制稀疏性的正则项。稀疏约束可以强制编码器每一层中只有一些神经元被激 活，从而将样本映射为低维稀疏特征向量。SAE 降维具体步骤如 3.2.1.3 中步骤 5 所示。

3.2.1.3 指标数据预处理总体步骤
数据预处理阶段的主要任务是将原始的、存在缺失、重复问题的、不规范的
和冗余的网络安全相关信息属性 x  x1, x2 ,, xn 输出为规范的、降维后的数据
  xh  x1h , x2h ,, xmh , m  n 。
步骤 1：数据采集，采集各个历史时间监测点的网络安全相关指标数据等， 记录所有属性字段对应的数据。
步骤 2：缺失值填充，采用邻域均值填充法，选取该条数据的前 5 条数据和 后 5 条数据，使用这 10 条数据的平均值对该缺失字段进行填充。
步骤 3：重复值删除，对于网络抖动或系统原因导致的极短时间内重复采集 的情况，采用忽略新值的方式解决，即在记录数据时检查改时间点是否已有数据， 如果已有则不记录该条数据。
步骤 4：数据归一化，对于步骤 2 和步骤 3 数据清洗后的数据进行归一化， 采用最小-最大值标准法，将数据的大小范围缩小到 0 到 1 之间。如式（3-2）所 示。

29

电子科技大学硕士学位论文
x  x  x min x max x min

（3-2）

表 3-3 数据清洗及归一化伪代码

输入：原始数据 x  x1, x2 ,, xn  输出：数据清洗及归一化后的数据 x  x1, x2 ,, xn 

1. For k=1 : n

2.

IF 该条数据和前一数据时间戳相同

3.

删除该条重复数据

4.

For i=1 : 指标数

5.

IF 该条数据该指标为缺失值

6.

取前后各 5 条该指标的值求均值

7.

填充该值

8.

对该条数据该指标采用最大-最小值法归一化

9.

End For

10. End For

步骤 5：数据降维，对于步骤 4 归一化后的数据 x  x1, x2 ,, xn ，采用 SAE
进行数据降维，通过隐含层将每个不带标签的训练数据 n 维矢量 x 映射成 m 维的
  编码矢量 xh ，进而将高维数据表示为低维数据 xh  x1h , x2h ,, xmh , m  n ，具体过
程如下：
步骤 5.1：将归一化后的数据 x  x1, x2 ,, xn 使用 sigmoid 激活函数和线性函
  数，通过在隐含层映射以获得编码后的结果 xh  x1h , x2h ,, xmh , ，即:

xh



1

1
exp w1x



b1 

（3-3）

将编码后的结果使用 sigmoid 激活函数和线性函数，通过在重构层映射以获
得解码后的结果 x  x1, x2,, xk， x 的维度与原始数据 x 的维度一致，即:

   x



1

exp



1 w2 xh



b2

（3-4）

步骤 5.2：如果某个隐含层神经元的输出结果靠近于 1，那么这个神经元就是 活跃的状态；与之相反的，如果某个隐含层神经元的输出结果靠近于 0，那么这

30

第三章 基于集成学习的网络安全态势评估模型研究

个神经元就是不活跃的状态。这里对隐含层的多数单元进行抑制，使多数单元为 不活跃的状态，而少数单元为活跃状态，来实现稀疏的效果。那么隐含层第 i 个 单元的激活量均值就是：

   ˆi



1 n

n
ai
k 1

k

（3-5）

这里使用 KL 散度作为 PN 表达式，用来惩罚 ˆi 偏离一个接近于 0 的常数  ， 从而使多数隐含层单元得到抑制来实现稀疏的效果。

PN



sh


KL

||

ˆ

j



j 1

（3-6）

KL

||

ˆi  



log

 ˆi

 1





log

1 1

 ˆi

（3-7）

式（3-6）中， sh 代表隐含层的神经元数量， KL || ˆi 代表 ˆi 与  之间的相对信
息熵，相对信息熵可以度量两种分布间的区别性。由于相对信息熵函数是凸的，

当 ˆi   时，KL 达到最小值。定义损失函数为：

      J w,b  1 n

n || xi  xi ||2  

i 1

2

|| w1 ||2

 || w2 ||2



sh KL
j 1

 || ˆ j

（3-8）

式中，n 为样本的数量，λ为规则化系数， xi 为第 i 组样本数据的输出结果，β是 惩罚项的系数。公式（3-8）是由均方差项、规则化项和惩罚项这三个部分构成。
步骤 5.3：这里使用梯度下降法来优化式（3-8）和参数 w ，b ，如式（3-9）、 式（3-10）、式（3-11）和式（3-12）所示。

 
wi

J w,b 

1 n

n i 1

 wi

J

w,

b,

x,

x



2wi

（3-9）

 
bi

J w,b 

1 n

n i 1

 b

i

J

w,

b,

x,

x

（3-10）

wi



wi



 wi

J w,b

（3-11）

31

电子科技大学硕士学位论文

bi

 bi



 bi

J w,b

（3-12）

wi 为第 i 个样本数据的权重向量，bi 为偏置，α为学习率。在一定的迭代次数 后，隐含层单元就学得了高维数据的特征，同时 SAE 就训练完成了，并获得了对 应的权重向量 w 和偏置向量 b ，将 w 和 b 代入式（3-3）就得到了 SAE 处理后的数 据 xh 。

表 3-4 SAE 算法伪代码

输入：归一化后的数据 x  x1, x2 ,, xn 
学习率α
  输出：高维数据的低维表示 xh  x1h , x2h ,, xmh , m  n
1. 初始化参数 w ， b

2. While True

3.

使用 sigmoid 激活函数和线性函数映射到隐层单元

4.

  得到编码结果 xh  x1h , x2h ,, xmh ,

5.

同样的方式映射到重构层单元得到解码后的结果 x  x1, x2,, xk

6.

计算损失函数

7.

IF 损失小于预期

8.

Break

9.

使用梯度下降法来优化式（3-8）和参数 w ， b

10. 将 w 和 b 代入式（3-3）,得到降维后的数据 xh

3.2.2 告警关键信息提取
本文所用的告警信息包含来自某电网公司自 2018 年以来的 15 万多条告警信 息，每条告警信息包含告警时间、告警主机、告警等级、告警类型、告警处置时 间等字段。
本文提取的告警关键信息为主机最近未处置告警时间、最近未处置告警等级、 最近未处置告警类型、未处置告警总数、未处置告警平均等级、未处置告警最大 等级。即包含该主机最近一条未处置的告警信息和其他未处置告警信息。告警关 键信息提取流程如图 3-3 所示。

32

第三章 基于集成学习的网络安全态势评估模型研究
图 3-3 告警关键信息提取流程
3.2.3 指标告警数据融合
在将数据输入到评估层之前还需要进行指标告警数据的融合，将指标数据和 告警关键信息拼接时序规范数据，并且还需要对结果状态进行数值化处理，使用 数值类别标号去标记所有结果状态，可能出现的五种分类结果分别为“正常”、“风
33

电子科技大学硕士学位论文
险类型 1”、“风险类型 2”、“风险类型 3”、“风险类型 4”，分别使用“-2，-1，0，1， 2”这五个数值类别标号去标记这五种分类结果。
指标数据和告警数据融合后时序规范数据的结构如图 3-4 所示。
图 3-4 指标告警数据融合结构
3.3 态势评估层
网络安全态势评估[45-49]是对影响当前网络安全状况的相关指标进行计算，并 对当前安全态势做出正确的识别和分类，完成对当前网络安全状况的感知，为决 策者做出及时和正确判断提供技术支撑。网络安全态势评估系统的核心是网络安 全态势评估算法，因此态势评估层算法的准确率十分重要。
安全态势受多方面指标因素影响，相关指标数量较多，对于传统的基于数学 模型的方法而言，需要大量的专家经验，工作量巨大，并且评估存在一定的主观 因素。安全态势评估对准确率的要求较高，传统单一的分类器相比于集成分类器 往往泛化性能一般，并且稳定性较差，安全态势评估的结果不够准确。因此本文 采用集成学习中 Boosting 算法对安全态势进行评估，而对于电力信息系统实际数 据中，存在一些困难样本和噪声样本，Boosting 算法会对困难样本和噪声样本过 度关注，导致模型整体性能下降，针对这个问题本文还对 Boosting 算法进行了改 进。
3.3.1 Boosting 评估算法实现
本文采用 Boosting 算法作为评估层算法，Boosting 是一种按执行模式分类的 串行模式组合的集成学习算法。Boosting 算法的工作机制先对训练数据赋值初始 权重，并使用带有初始权重的训练数据对第一个分类器进行训练，得到第一个弱 分类器，结合样本权重计算该弱学习器的误差，然后根据该弱学习器的误差表现 对训练集样本权重进行调整，对于错误分类的样本则权重增加，对正确分类的样 本则权重降低，这样被错误分类的样本就会在后续的训练中得到更多的关注。再 使用更新样本权重后的训练数据去训练下一个弱学习器，并重复这一步骤，直到 完成所有弱学习器的训练过程，最后对这些弱学习器以一定的结合策略组合到一
34

第三章 基于集成学习的网络安全态势评估模型研究
起，构成我们所需要的强学习器。Boosting 算法的基本结构图如图 3-5 所示。

图 3-5 Boosting 基本结构图

Boosting 算法要求弱学习器可以对带有权重的训练样本数据集进行学习，以 便于对训练过程中对样本权重进行更新，本文采用的 BPNN 作为弱学习器具有这 个特性。对于不具有这种特性的单一学习算法也可以通过对训练数据采样来完成
训练样本数据集的样本权重调整，采样时可以将本轮更新后的样本权重作为样本
数据的分布进行重采样的操作，再用采样后的训练样本数据集进行下一轮训练。
对于 m 个样本点的训练数据集 X  x1, y1, x2, y2,, xm, ym，其中 xi 表示第
i 个样本点， yi 表示样本对应的类别。本文 Boosting 算法从训练数据中不断根据 本轮分类错误情况调整样本数据的权重，串行学习到所有的弱学习器，并将这些
训练完成的弱学习器线性组合为一个强学习器。具体步骤如下：
（1） Dk  wk1, wk2,, wkm  表示训练第 k 个弱分类器时的训练样本数据集权
重向量，将训练样本集的权重初始化为：

D1



w11,w12,,w1m

,

w1i



1 m

,i

 1,2,,m

（3-13）

（2）对于 k  1,2,,T ，使用带有权重 Dk 的样本训练 Gkx，这里的 Gkx可
以是神经网络、决策树等，这些算法的原理和训练过程不再赘述。
（3）计算弱学习器 Gk x的分类误差：

35

电子科技大学硕士学位论文

     ek  PGk x  y  m wki I Gk xi  yi i 1

（3-14）

其中， I t  是一个通用函数，当参数 t 为真时，输出为 1；当参数为 t 为假时，输
出为 0。
（4）由前向分步算法，弱分类器 Gk x的系数为：

k



1 2

ln 1 ek ek

（3-15）

（5）更新下一轮即训练 Gk x时的训练样本集权重分布 Dk1 :

   wk1,i



wki Zk

exp

k

yiGk

xi

,i  1,2,m

（3-16）

    m
Zk  wki exp   k yiGk xi
i 1

（3-17）

其中， Zk 为归一化因子。 （6）重复（2）（3）（4）（5）步，直至 T 个弱学习器训练完成。 （7）对训练完成的所有弱分类器通过式（3-15）进行系数加权，将所有训练
完成的弱分类器组合到一起，得到最终我们需要的强分类器：

 Gx



sign 

T k 1



k

Gk

x




（3-18）

Boosting 算法伪代码如表 3-5 所示。

36

第三章 基于集成学习的网络安全态势评估模型研究

表 3-5 Boosting 算法伪代码

输入：m 个样本点的训练集， X  x1, y1, x2, y2,, xm, ym
弱学习算法

迭代次数 T
输出：强分类器 G(x)

1. For k=1 : T

2.

计算样本权重 Dk

3.

对于样本权重 Dk ，训练弱分类器 k,输出 Gk x

4.

计算弱学习器 Gk x的分类误差 ek

5.

IF ek >=0.5

6.

本轮作废，k 值不变，重新训练

7.

计算弱分类器 Gk x的系数k ，

8.

更新训练样本集权重用于下一轮弱分类器训练

9.

k=k+1

10. End For

3.3.2 改进 Boosting 评估算法
从 3.3.1 小节可以看出，Boosting 算法的训练样本数据集调整权重的规则是根 据本轮弱分类器在样本集上表现出的错误率，对于错分的样本会将器权重提高， 使得算法会在下一轮训练时更加关注被错误分类的样本，但这种更新规则在一些 情况下也会存在不足：如果训练样本数据集中存在一些困难样本或者是存在噪声 的样本数据，根据 Boosting 算法的更新规则会更加关注困难样本和存在噪声的样 本数据，如果在很多轮训练中都没有正确分类，会将这些样本的权重急剧增大。 同时根据 Boosting 算法权重更新规则，在权重更新时，会对训练样本数据集的权 重进行归一化处理，如果将一些困难样本和存在噪声的样本数据的权重无限制增 加，那么会使得那些被正确分类的样本权重急剧降低，呈指数减小，从而导致算 法整体性能下降。

37

电子科技大学硕士学位论文
图 3-6 改进 Boosting 算法结构图
针对以上问题，本文对 Boosting 算法进行了以下两方面的改进，其结构图如 图 3-6 所示。
一方面本文改进了 Boosting 算法权重的更新规则，具体实施方式为：在每一 轮对弱分类器的训练过程中，在权重更新前去计算训练样本数据集的权重平均值 m 和标准差σ，如果某一样本权重和更新前样本权重平均值 m 的偏差大于 3σ时， 那么这个样本对应的权重就不再增加。
另一方面本文采用一种针对训练集数据的随机特征裁剪方法来对抗噪声导致 的过拟合现象，具体实施方式为：弱分类器训练之前，选取上一轮弱分类器训练 后样本权重最大的一部分数据，并在这些样本中随机选取特征点置零。在 Boosting 算法中，样本权重过大可能是由于这些样本中包含了噪声下影响产生的异常数据， 随机特征裁剪方法降低了这种异常带来的影响，使网络避免学习到这些不能反映 样本信号统计特性的异常特征，从而提升了网络的泛化性能。特征裁剪示意图如 图 3-7 所示。
38

第三章 基于集成学习的网络安全态势评估模型研究

样本

难分类

选取 C 个

样本特征
特征裁 剪后

随机选取 Q 个特征置零

易分类 …
… …
… …

图 3-7 特征裁剪示意图

模型训练阶段的主要任务是使用改进 Boosting 算法对一组弱学习器在上述数 据样本集中不断反复训练，得到一组带权重的弱学习机序列，再将这组带权重的 弱学习机通过加权平均的策略进行组合，最终构成强学习机。模型训练的具体步 骤如下。
步骤 1：设定集成学习算法最大迭代次数 T、特征裁剪样本数 C 和特征数 Q。
步骤 2： Dk  wk1, wk2,, wkm 表示训练第 k 个弱分类器时的训练样本数据集
权重向量，将训练样本集的权重初始化为：

D1



w11,w12,,w1m

,

w1i



1 m

,i

 1,2,,m

（3-19）

步骤 3：对于 k  1,2,,T ，使用带有权重 Dk 的样本训练一个弱学习器 Gkx 步骤 4：计算弱学习器 Gk x的分类误差：

     ek  PGk x  y  m wki I Gk xi  yi i 1

（3-20）

其中， I t  是一个通用函数，当参数 t 为真时，输出为 1；当参数为 t 为假时，输
出为 0。
步骤 5：由前向分步算法，弱分类器 Gk x的系数为：

39

电子科技大学硕士学位论文

k



1 2

ln 1 ek ek

步骤 6：计算本轮各样本权重平均值  和标准差 。

   1

m
wki

m i1

（3-21） （3-22）

   

1

m

w2 ki





2

m i1

（3-23）

步骤 7：选择本轮训练样本权重最大的 C 个样本，随机裁剪 Q 个特征。

步骤 8：更新下一轮即训练第 k+1 个弱学习器时的训练样本集权重分布 Dk1：

expk , yi  Gk(xi)     wk  1, i  wki exp k , yi  Gk(xi)且wki    
Zk 1, yi  Gk(xi)且wki     

（3-24）

    m
Zk  wki exp   k yiGk xi
i 1

（3-25）

其中， Zk 为归一化因子。 步骤 9：重复步骤 3 至 8，直至 T 个弱学习器训练完成。 步骤 10：使用各个弱分类器的系数加权将所有弱分类器进行线性组合，得到
最终的强分类器：

 Gx



sign 

T k 1



k

Gk

x




（3-26）

在线工作阶段的主要任务是使用训练完成的强学习器对当前主机网络安全 态势进行评估分析，可以分为 2 个步骤。
步骤 1：将当前时间点指标数据和告警数据融合后的数据，输入到训练完成 的强学习器。
步骤 2：使用训练完成的强分类器对主机网络安全态势进行评估分析。 在上述两个阶完成后，构成了基于改进 Boosting 算法的网络安全态势评估， 实现了对目标主机网络的实时安全运行状况的评估感知，评估结果为目标主机的 风险类型。改进后的 Boosting 算法伪代码如表 3-6 所示，结合数据预处理层基于

40

第三章 基于集成学习的网络安全态势评估模型研究

改进 Boosting 算法的网络安全态势评估结构图如图 3-8 所示。

表 3-6 改进 Boosting 算法伪代码

输入：m 个样本点的训练集， X  x1, y1, x2, y2,, xm, ym
弱学习算法

迭代次数 T 特征裁剪样本数 C 随即裁剪特征数 Q
输出：强分类器 G(x)

1. For k=1 : T

2.

计算样本权重 Dk

3.

对于样本权重 Dk ，训练弱分类器 k,输出 Gk x

4.

选择本轮权重最大的 C 个样本，随即裁剪 Q 个特征

4.

计算弱学习器 Gk x的分类误差 ek

5.

IF ek >=0.5

6.

本轮作废，k 值不变，重新训练

7.

计算 Gk x的系数k

8.

IF 某一样本权重和更新前样本权重平均值 m 的相差大于 3σ

9.

该样本对应的权重就不再增加

10. 更新参数用于下一轮计算

11.

k=k+1

12. End For

41

电子科技大学硕士学位论文
图 3-8 基于改进 Boosting 的安全态势评估流程图
3.4 态势量化层
很多针对网络安全态势的研究中，仅仅是对网络安全态势进行了评估，而没 有安全态势的量化过程，未量化的安全态势评估结果不够直观，无法构建安全态 势趋势图，不利于决策人员或运维人员对于安全态势趋势的把握。
随着信息网络的不断发展，很多层次化评估模型未考虑到信息网络结构的变 化，其层次结构划分已经不符合当前的信息网络结构，层次划分不够合理。
42

第三章 基于集成学习的网络安全态势评估模型研究
本 节 对 传 统 的 层 次 划 分 进 行 了 改 进 ， 参 照 通 用 漏 洞 评 分 系 统 （ Common Vulnerability Scoring System，CVSS），并结合层次分析法（Analytic Hierarchy Process，AHP）算法，基于安全态势评估的分类结果进行了层次化的计算，最终 计算出服务和整体的态势值。
3.4.1 层次化计算体系
在 2.2.3.1 小节中描述的安全风险层次化评估模型采用的评估流程是从上到 下、先具体后整体的方式，按照攻击、服务、主机及整个网络的层次顺序计算安 全态势。
该模型存在的主要问题：随着分布式技术的发展和应用，以及企业对于服务 稳定需求的增长，通常一个服务会分布式部署到多台主机上来保证服务稳定性， 即一个服务通常对应多台主机，在一个系统中主机的数量要远多于服务的数量， 而该模型将主机层放在服务层之上，无论对于决策者或者运维人员进行故障溯源， 还是对于安全态势值的计算都是十分不友好的。
针对上述问题，本文对该模型进行了改进，将主机层放在服务层之下，即划 分为攻击层、主机层、服务层和整个系统的四个层面。攻击层负责收集网络安全 相关信息；主机层负责对该主机相关的网络安全相关信息进行信息融合，并通过 网络安全态势评估模型进行安全态势的分析评估，并参照 CVSS 通用漏洞评分系 统并基于主机层的安全态势分类结果进行主机风险量化计算；服务层根据主机相 关信息通过 AHP 计算出各主机重要性权重，结合主机的风险值计算出服务的安全 态势值；最后基于系统中各个服务的安全态势值进行整体态势值的融合计算。改 进后的安全态势量化层次结构图如图 3-9 所示。
43

电子科技大学硕士学位论文

图 3-9 改进后的安全态势量化层次结构图

3.4.2 风险类型量化评分

CVSS[50-52]诞生于 2007 年，是隶属于美国国家基础设施顾问委员会（National Infrastructure Advisory Board Committee，NIAC）旗下的一个研究项目，该项目旨 在通过制定统一通用的规范建立一个具有通用性风险漏洞评估的框架，针对不同 计算机系统中的安全漏洞进行影响性评估。
根据不同风险类型在不同要素维度上所对应的可选值，参照 CVSS 计算风险 类型的量化评分，制定 CVSS 评分计算表如表 3-7 所示。

表 3-7 CVSS 评分计算表

要素

可选值

评分

攻击途径(AV)

本地/远程

0.7/1.0

攻击复杂度(AC)

高/中/低

0.6/0.8/1.0

认证(AU)

需要/不需要

0.6/1.0

机密性(C)

不受影响/部分/完全

0/0.7/1.0

完整性(I)

不受影响/部分/完全

0/0.7/1.0

可用性(A)

不受影响/部分/完全

0/0.7/1.0

设机密性权重、完整性权重、可用性权重分别为1、2、3，根据 CVSS

44

第三章 基于集成学习的网络安全态势评估模型研究

评分计算方法，风险类型 i 的量化评分为：  = 10 ∗  ∗  ∗  ∗  ∗ 1 +  ∗ 2 +  ∗ 3

（3-27）

3.4.3 层次化安全态势量化过程

层次化的安全态势量化过程按照层次关系可以分为四个步骤，下面进行详细 介绍。
步骤 1：攻击层进行网络安全相关数据的采集、整理。 步骤 2：计算主机安全风险值。 步骤 2.1：将攻击层采集到的网络安全相关数据和主机进行关联，对和该主机 相关的网络安全相关数据进行数据预处理，并通过网络安全态势评估模型进行安 全态势的分析评估，得到主机安全态势的分类结果，即主机的风险类型。 步骤 2.2：根据主机的态势分类结果，并根据式（3-27）进行主机安全态势的 量化，得到主机的安全风险值。 步骤 3：计算服务安全态势值。 步骤 3.1：根据主机相关属性信息，利用 AHP 算法[53-56]计算各主机重要性权 重。 构建主机的成对比较矩阵如式（3-28）所示。

1

A



a12 

an1

a12 1  

   an(n1)

a1n a2n

  

a3n 1

  

（3-28）

其中 aij 表示主机相对于主机的重要程度。 计算特征向量 w ，计算公式如式（3-29）所示。

Aw   max w

（3-29）

并进行一致性检验，定义一致性指标和一致性比率如式（3-30）和（3-31）

所示。

CI   max n n 1

（3-30）

CR  CI RI

（3-31）

其中 RI 为平均随机一致性指标，其取值见表 3-8 所示，一般去情况下认为一致性

45

电子科技大学硕士学位论文

比率 CR  0.1 时，认为成对比较矩阵 A 的不一致程度在许可范围之内，其一致性 可以满足需要，通过一致性检验，可以使用成对比较矩阵 A 的归一化特征向量 w 作为权重向量，最终得到同一服务下 n 个主机的重要性权重 w 。

表 3-8 平均随机一致性指标 RI 取值参考表

阶数

RI

阶数

RI

1

0

7

1.36

2

0

8

1.41

3

0.52

9

1.46

4

0.89

10

1.49

5

1.12

11

1.52

6

1.26

12

1.54

步骤 3.2：对同一服务中 n 个主机的安全风险值 R  r1, r2,, rn，通过主机重
要性权重向量 w 进行权重组合，计算该服务安全态势值 Si ，如式（3-32）所示。

 Si  100  1 n rjwj
n j 1

（3-32）

步骤 4：计算整体安全态势值。根据服务相关属性，同样利用 AHP 计算服务 的重要性权重，对所有服务态势值权重组合，计算得到整体态势值 Sall 。如式（3-33） 所示。

 Sall



1 m

m i 1

Sivi

（3-33）

其中， Si 为第 i 个服务的安全态势值； vi 为第 i 个服务的重要性权重。

3.5 态势预测层
态势预测层的任务是基于量化后的态势值对未来一段时间的态势值进行预 测，计算系统未来一段时间的安全运行状况，为某电力企业的运维人员或决策者 掌握系统安全态势的未来趋势提供预见性参考。

3.5.1 LSTM 态势预测模型构建
本文采用长短期记忆人工神经网络LSTM算法进行安全态势预测。LSTM是一
46

第三章 基于集成学习的网络安全态势评估模型研究

个特殊的循环性神经元网络。该方法采用三种“门”结构，克服了传统的循环神经 网络存在的梯度消失和梯度爆炸现象，可以较好地拟合时间序列依赖关系。
LSTM隐藏层结构如图 3-10 所示，A表示单元具有相同结构，X表示输入隐藏 层 的 数 据 ， L 表 示 数 据 窗 口 长 度 ， 所 以 输 入 数 据 X  {X1, X2,, X L} ， H  {H1, H 2 ,, H L} 为输入数据X对应隐藏层的输出。

−2 −2

−1



−1

⊗

⊕



tanh

A

⊗⊗
  

−1

σ σ tanh σ



+1 +1
A +1

−1



+1

图 3-10 LSTM 隐藏层结构图

如图 3-10 所示，每一个LSTM单元包含三个门控逻辑，分别是遗忘门、输入

门、输出门。

遗忘门的作用是对旧单元状态中的信息进行选择性的丢弃，即去掉旧的无用

信息。遗忘门的对前状态的信息留存量用 ft 表示，其计算公式为：

  ft   Wf [Ht1, Xt ]  bf

（3-34）

其中， Ht1 为前一时刻输出。 输入门限表示为 it ，候选单元状态表示为 Ct ，其计算公式为：
it   Wi  Ht1, Xt  bi 

（3-35）

Ct  tanhWC  Ht1, X t  bC 

（3-36）

更新当前单元状态 Ct ，其计算公式为 Ct  ft  Ct1  it  Ct

（3-37）

其中， Ct1 表示前一时刻单元状态。 输出门限表示为t ，当前单元输出表示为 Ht ，其计算公式如下：

47

电子科技大学硕士学位论文

t   Wo Ht1, Xt  bo  Ht  t  tanhCt 

（3-38） （3-39）

其中， Ht1 表示前一时刻单元输出， Ct 表示单元状态。 选用均方误差MSE作为损失函数，根据隐藏层输出以及态势实际值，构造损
失函数，对LSTM网络进行训练。 通过最小化均方误差，对模型进行更新，从而得到最终的LSTM态势预测模
型。

开始

划分训练集、标准化
训练 LTSTM 网络 否
当迭代次数>=总迭代次数 是
利用训练好的 LSTM 进行预测
结束

图 3-11 LSTM 态势预测流程图
3.5.2 态势预测模型优化
本文采用粒子群算法PSO来优化LSTM。在预测过程中靠经验确定的学习率、 迭代次数等参数具有随机性，从而影响模型的精度和拟合效果。可以通过粒子群 算法在训练过程中对参数寻优。
粒子群算法思想来源于对鸟类觅食习性的研究，它是利用最简便的方式，在 最靠近食物的鸟所位于的区域搜寻食物，然后利用鸟和鸟之间的相互协作和分享 信息来完成种群的进化。利用位置、速度和适应度等参数描述候选解，在候选解 空间中通过更新公式进行迭代，对最优区域进行搜索，从而得到满足迭代终止目 标的最优解。
48

第三章 基于集成学习的网络安全态势评估模型研究

在候选解空间中，种群由多个粒子构成，第t轮更新后的粒子速度为,，位 置为,，在迭代过程中通过更新公式对粒子位置和速度进行更新，得到局部最优 解e和全局最优解e。在搜索过程中，通过式（3-40）和式（3-41）更新 粒子的速度和位置。

,+1 = , + 1 rand ( pbest − ,) + 2 rand ( gbest − ,)

（3-40）

,+1 = , + ,+1

（3-41）

其中，为惯性系数；1，2分别为个体和种群学习系数；rand为[0,1]区间的随机 数；为速度系数。
构建PSO-LSTM模型进行优化预测，首先将数据划分为训练集和测试集；其 次，将LSTM模型中的窗口大小、迭代次数、学习率做为优化目标。定义适应度

函数为：



=

1 

 =1

|

−0 0

|

（3-42）

其中，K为验证数据集大小；为预测数据；0为真实数据。 根据式（3-42）适应度函数得到粒子在验证数据上的适应度值，通过适应度
值计算结果确定e和e；通过式（3-40）和式（3-41）对粒子的,和, 进行更新；如果满足迭代终止条件，则输出最优参数，如果不满足，重新计算适

应度值，重复上述迭代过程。

3.6 实验结果分析
本文使用 Java1.8 实现所有算法，并在配置为 Intel Core i9-9900K 处理器、32G 内存、安装 JDK1.8 的计算机上进行算法的实现、训练和测试。
3.6.1 态势评估层实验结果和分析
本文基于采集自某电网公司的某安全运维系统安全态势相关数据，选取了某 主机 2021 年 09 月 01 日 00 时至 2021 年 09 月 11 日 12 时的 3024 条数据，以 70% 的数据作为训练集，以 30%的数据作为测试集，验证评估层算法 Boosting 算法和 改进 Boosting 算法的有效性。
实验中选择 BPNN 作为基学习器，设按样本权重从大到小选取的样本数为 C， 随机裁剪的特征数为 Q，为了选择合适的 C 和 Q，分别对 C 为 5、10、15、20 和
49

电子科技大学硕士学位论文
Q 为 1 至 15 时进行了实验，实验结果如图 3-12 所示。 其横坐标为随机裁剪特征数 Q，纵坐标为在测试集上的总错误率 E，由实验
结果可知，当参与特征裁剪的样本数 C 为 10，随机裁剪特征数 Q 为 6 时，总错 误率最低，也就是性能表现最好，因此设置模型的 C 为 10，Q 为 6。
图 3-12 不同特征裁剪参数对比
本文还选择了 BPNN 神经网络、决策树和 SVM 三种经典算法进行横向比较， 以说明 Boosting 和改进 Boosting 算法的优势。其他对比算法均采用默认参数，试 验对比了改进 Boosting 算法和其他算法在测试集上的性能。实验结果如表 3-9 所 示。
50

第三章 基于集成学习的网络安全态势评估模型研究

表 3-9 不同算法在测试集上的性能对比

安全态势评估 算法

风险类别

正确分类 记录数

错误分类 记录数

召回率

精确率

总正确 率

正常

584

风险类型 1

96

改进Boosting 风险类型 2

74

风险类型 3

52

风险类型 4

40

正常

563

风险类型 1

93

Boosting

风险类型 2

68

风险类型 3

47

风险类型 4

36

BPNN

-

738

SVM

-

777

决策树

-

746

32

94.8% 95.4%

10

90.6% 89.7%

8

90.2% 88.1% 93.3%

6

89.1% 88.1%

5

88.9% 88.9%

53

91.4% 92.9%

13

87.7% 82.3%

14

82.9% 81.9% 90.1%

11

81.0% 79.7%

9

80.0% 78.2%

169

-

-

81.4%

130

-

-

85.7%

161

-

-

82.2%

由表 3-9 可以看出基于改进 Boosting 算法的安全态势评估模型的准确率为 93.3%，要好于其他横向比较算法。现根据表 3-9 的实验结果，进行实验分析：
1.集成学习算法是通过一定的策略对多个弱学习器进行结合来构建强学习 器，改变训练样本集的分布并进行反复训练来提升弱学习机的准确率，在工作方 式上要优于传统的机器学习算法，因而 Boosting 算法和改进 Boosting 算法整体准 确率较高。
2.改进 Boosting 算法相对于 Boosting 算法，在遇到噪声样本和困难样本时， 一方面对样本权重更新进行了限制，限制了对于困难样本和噪声样本过度关注； 另一方面，权重过高的样本进行了随机特征裁剪，降低了噪声对于模型的影响。 因而改进 Boosting 算法在整体准确率上要高于 Boosting 算法。

3.6.2 态势量化层实验结果和分析

51

电子科技大学硕士学位论文
为了验证态势值计算结果的有效性，选取 2021 年 07 月 9 日“保障体系”服 务的态势值和告警数据进行对比，对于告警数据，根据该服务在此段时间内的真 实告警情况对服务健康程度进行打分。若无告警，则为 100 分；若有告警，根据 不同的情况，如具体告警等级，给出相应的分数。对比结果如图 3-13 所示。
其中，棕色线最低点表示在此刻发生了告警，而对应的蓝色线该服务态势值 也在此时刻降为最低，从而用发生的告警验证了态势值计算的有效性。
图 3-13 态势值计算效果对比图
本文选取了 2020 年 06 月 06 日 01 时该时间点所有主机的安全态势评估分类 结果，按照 3.4.3 的计算步骤分别计算了所有服务的安全态势值，并选取了其中 12 种服务的安全态势值进行展示，如表 3-10 所示。还选取了系统中某一时间段 的整体安全态势值计算结果，如图 3-14 所示。
52

第三章 基于集成学习的网络安全态势评估模型研究

表 3-10 某时间点各服务安全态势值量化结果

服务 财务管理 营销管理 安全生产 协同办公 人力资源 物资管理

态势值 88.4 100 100 86.6 100 90.1

服务 项目管理 综合管理 规划计划 保障体系 一体化平台 公共基础应用

态势值 97.5 98.9 96.8 100 100 85.7

图 3-14 某时间段内整体安全态势值趋势图
从图 3-14 的网络安全态势值量化结果可知，整体网络安全态势值绝大部分时 间是处于较为健康的状态，分析其原因可能是由于攻击者的职业特性，攻击者往 往不会持续性的进行攻击，攻击通常具有突然性。
3.6.3 态势预测层实验结果和分析
本文选取了 2021 年 02 月 18 日 00 时至 2021 年 02 月 24 日 00 时的 864 条某 服务态势值数据，以 80%的数据作为训练集，以 20%的数据作为测试集，分别对 LSTM 时序预测模型和 PSO-LSTM 时序预测模型进行训练和测试。
划分后的训练集和测试集如图 3-15 所示。图中蓝线表示训练集数据，橘线表
53

示测试集数据。

电子科技大学硕士学位论文

图 3-15 时序数据集划分

图 3-16 LSTM 预测结果
54

第三章 基于集成学习的网络安全态势评估模型研究
LTSM 时序预测模型及 PSO-LSTM 时序预测模型在测试集上的实验预测结果 详细展示如图 3-16、图 3-17 所示。

图 3-17 PSO-LSTM 预测结果

通过式（3-1）计算 RMSE，如表 3-11 所示。

表 3-11 预测效果对比

时序预测模型 LSTM
PSO-LSTM

RMSE 0.2625 0.1081

通过图 3-16、图 3-17，以及在测试集上的 RMSE 可知，PSO-LSTM 态势预测 模型的预测效果要优于 LSTM 预测模型。

55

电子科技大学硕士学位论文
3.7 本章小结
本章首先对安全态势评估总体框架进行了设计，然后从数据预处理层、态势 评估层、态势量化层和态势预测层对安全态势评估过程进行了详细的阐述，并通 过实验验证了评估算法和预测算法的有效性。
56

第四章 系统需求分析
第四章 系统需求分析
4.1 总体需求概述
本系统以某电力企业“网络安全态势评估系统研究”项目为基础，重点研究 基于该企业网络安全相关数据进行网络安全态势的评估，实现数据的采集、数据 预处理、安全态势评估、安全态势量化以及态势预测等算法功能，最终提供一个 对网络安全态势评估以及态势预测的可视化平台。
目前该电力企业在安全运维方面存在如下几方面问题： 1. 该企业信息系统中存在多种服务，但缺少多服务场景下对系统安全运行状 况的感知能力，安全运维效率较低。 2. 缺少提前感知系统异常的手段。 本系统根据该企业在安全运维方面存在的问题，实现包含数据采集、指标数 据和告警数据综合处理、安全态势评估和预测等功能需求，同时，系统还需设计 一套交互友好的操作界面以方便用户进行操作。基于集成学习的安网络全态势评 估系统的总体功能需求涵盖以下几方面： 1. 数据采集功能，采集该企业信息系统中的原始指标数据及告警数据，用于 后续处理和分析，包含实时采集和历史数据采集，并提供采集状态显示。 2. 数据预处理功能，对采集到的数据进行预处理，为后续感知系统安全运行 状况提供基础。 3. 服务态势评估功能，对该企业信息系统中各服务的安全态势进行评估，感 知服务的安全运行状况，提高安全运维效率。 4. 整体态势评估功能，针对多服务的场景感知该企业信息系统的整体安全运 行状况。 5. 态势预测功能，基于当前及历史服务安全态势数据，预测未来某一时刻的 安全态势，提前感知系统异常。 6. 用户管理功能，提供用户登录及管理的功能。 7. 日志功能，记录用户对于系统的操作信息以及系统报错信息。 系统总体用例图如图 4-1 所示。
57

电子科技大学硕士学位论文
图 4-1 系统总体用例图
4.2 功能需求分析
本小节结合系统需求从数据输入输出的角度对各模块进行功能需求分析。
4.2.1 数据采集模块
数据采集包含实时和历史指标告警数据采集，实时指标告警数据采集是对当 前时间点的数据进行采集，历史数据采集是对时间段内的数据进行采集。其输入 是当前时间点或一个时间段，从目标系统获取该时间点或时间段内的数据，存储 到本地数据库中，在采集完成后应发出通知，通知预处理模块对数据进行预处理。 其输入输出数据流图如图 4-2 所示。
58

第四章 系统需求分析

目标库

开始时间 结束时间

t1

t2

输入

数据采集 模块

输出

通知预处 理模块

本地库

图 4-2 采集模块输入输出数据流图
4.2.2 数据预处理模块
数据预处理模块需能够对缺失数据进行填充、对非标准数据进行标准化、对 指标和告警数据进行融合，因此该模块的输入为原始指标和告警数据，输出为完 整的、标准化的、融合后的规范数据。其输入输出数据流图如图 4-3 所示。

原始数据

指标 1 指标 2

……

v1

v2

……

告警 1 告警 2
……

输入

数据预处 理模块

输出

规范数据
指标数据 告警特征数据

图 4-3 预处理模块输入输出数据流图
4.2.3 服务态势评估模块
服务态势评估模块包含服务态势评估、当前服务态势展示、历史服务态势查

59

电子科技大学硕士学位论文
询功能。 服务态势评估的输入为预处理后的规范数据，输出为服务的安全态势值，并
存储到数据库中，其输入输出数据流图如图 4-4 所示。

规范数据
指标数据 告警特征数据

输入

服务态势 评估模块

输出

服务安全 态势值
存储

本地库

图 4-4 服务态势评估输入输出数据流图
当前服务态势展示需要输入当前时间，根据输入时间在本地库中进行查询， 输出为所有服务的当前安全态势值，并展示到前端页面。其输入输出数据流图如 图 4-5 所示。

当前时间 t

输入

当前服务 态势展示
模块 查询
本地库

输出

服务 1 服务 2

……

v1

v2

……

展示到前 端页面

图 4-5 当前服务态势展示输入输出数据流图
历史服务态势查询应需要输入一个时间段以及服务 id，需能够根据输入的信 息对该服务历史态势进行查询，输出服务在该时间段内的安全态势值。其输入输 出数据流图如图 4-6 所示。

60

第四章 系统需求分析

开始时间 结束时间

t_beigin

t_end

服务 id s

输入

历史服务 态势查询
模块
查询

输出

时间点 服务态势值

t1

v1

t2

v2

……

……

本地库

展示到前 端页面

图 4-6 历史服务态势查询输入输出数据流图
4.2.4 整体态势评估模块
整体态势评估模块包含整体态势评估、当前整体态势展示和历史整体态势查 询功能。
整体态势评估的输入数据应为各服务态势数据，最终应输出为整体态势值， 并存储到数据库中。其输入输出数据流图如图 4-7 所示。

服务 1 服务 2

……

v1

v2

……

输入

整体态势 评估模块

输出

整体安全 态势值
存储

本地库
图 4-7 整体态势评估模块输入输出数据流图
当前整体态势展示功能需要输入当前时间，根据输入时间在本地库中进行查 询，输出为当前整体安全态势值，并展示到前端页面。
历史整体态势查询应需要输入一个时间段，需能够根据输入的信息对历史整 体态势进行查询，输出在该时间段内的整体安全态势值。
4.2.5 态势预测模块

61

电子科技大学硕士学位论文
态势预测模块需要输入的安全态势值时间序列，该模块应能够根据输入的时 序态势数据对整体或服务态势进行预测，输出下一时间点的整体或服务态势预测 值。其输入输出数据流图如图 4-8 所示。

时间点 时刻 1 时刻 2
… 时刻 L

态势值 v1 v2 … vL

输入

展示到前 端页面

态势预测 模块

输出

时间点 态势值

时刻 L+1

vL+1

存储

本地库

图 4-8 态势预测模块输入输出数据流图
4.2.6 用户管理模块
用户管理模块包含用户登录、添加用户、修改密码等功能。 用户登录功能的输入数据应为用户名及密码，输出应有两种情况，用户名或 密码错误时提示登录失败，返回登录页面，否则登录成功，进入系统主页。其输 入输出数据流图如图 4-9 所示。

用户名 name

密码 pd

输入

用户登录 功能

输出

验证

进入系统主页 提示登陆失败

本地库

图 4-9 用户登录功能输入输出数据流图
62

第四章 系统需求分析

添加用户功能首先只有管理员才有使用这一功能的权限，管理员可以输入新 用户相关信息，添加新用户，将用户信息存储到数据库，提示用户添加成功或添 加失败的信息。
修改密码功能输入数据为原密码以及新密码，在原密码验证通过后，将新密 码更新到数据库，并返回修改成功或失败。其输入输出数据流图如下图所示。

4.2.7 日志模块
日志记录功能的输入应为用户对系统的操作，输出应为用户操作信息或系统 报错信息，并将输出信息存储到数据库备查。其输入输出数据流图如图 4-10 所示。

输入
用户操作

日志记录 功能

用户操作信息

输出

用户名 操作时间 操作方法 返回信息
……

存储

本地库

图 4-10 日志记录功能输入输出数据流图
日志查询功能是方便于管理员查看各用户对系统的操作记录，以及排查系统 错误信息。该功能输入应为时间和用户名，应能分别按照用户名和时间进行查询， 其输出为系统日志记录。

63

电子科技大学硕士学位论文

开始时间 结束时间

t_beigin

t_end

用户名 name

输入

日志查询 功能

输出

查询

日志列表
日志记录 1 日志记录 2
……

本地库

图 4-11 日志查询功能输入输出数据流图
4.3 非功能需求分析
系统在满足功能性需求的同时，还应具备的非功能性特质如下： 1. 易用性 本系统是人机交互的系统，要求系统在操作上方便简单，实现用户界面友好。 2. 可靠性 由于系统需要有较高的可靠性，在系统出现错误时，要求应用系统能报告相 应的详细错误信息给操作员，提示错误和问题，以便理解与分析。 3. 可升级性 系统软件本身应该具备可升级性，各个功能模块之间解耦并可随着系统更新 单独替换，如态势预测算法后续可以无损地替换成其他算法以增加预测效率。
4.4 本章小结
在本章中首先进行了系统需求的总体描述，然后按照功能模块分别对各功能 需求进行了详细分析，最后对系统非功能性需求进行了描述。

64

第五章 系统设计
第五章 系统设计
5.1 系统架构设计
为了便于系统功能模块的扩展，本文采用微服务架构实现整个安全态势评估 系统。系统主要包含：
用户管理服务，实现用户的登录、修改密码等用户管理的功能。 数据采集服务，主要用于和网络安全运维系统对接，对目标系统中的指标数 据和告警数据进行采集和存储。 数据预处理服务，主要完成对当前已采集的指标数据进行缺失值填充、删除 重复数据、数据归一化等功能，对告警数据进行关键信息提取，最后融合指标和 告警数据。 安全态势评估服务，实现对历史数据和实时数据进行安全态势评估以及安全 态势查询等功能。 安全态势预测服务，实现通过时序预测模型对未来整体态势预测的功能。 系统主要架构图如图 5-1 所示。 可视化展示为用户提供和系统交互的可视化界面，包括用户管理、日志管理、 安全态势评估展示等页面。 服务注册与发现用于将服务注册到服务中心以及服务间的相互发现；服务配 置用于对系统中的服务相关参数进行配置的更新。 Mysql 数据库用于将采集到的数据以及处理和评估的结果进行数据存储和持 久化；MongoDB 用于存储非关系型的指标数据；Redis 用于将经常被请求或近期 被请求的数据缓存下来，提高数据请求效率。
65

电子科技大学硕士学位论文
图 5-1 系统架构微服务架构图
5.2 数据库设计
数据采集系统采集到的指标数据为非关系型结构，而且对于不同时段采集到 的指标在结构和类型上会有差异，因此这里使用 MongoDB 数据库，可以方便采 集指标的拓展。MongoDB 数据库存储结构如图 5-2 所示。
66

第五章 系统设计

图 5-2 MongoDB 数据库存储结构图

Mysql 数据库用于存储用户信息表、系统日志表、资产主机信息表、服务信 息表、资产关联表和监控指标表等。下面进行具体的描述。
1）用户信息表

表 5-1 用户信息表

字段 uesr_id user_name password role_id role_name login_status

类型 varchar varchar varchar
int varchar
int

描述 用户 id 用户名 用户密码 角色 id 角色名称 登陆状态

用户信息表为用户登录注册、权限划分而服务，存储了用户 id、用户名、密 码以及角色信息。如表 5-1 所示。
2）系统日志表

67

电子科技大学硕士学位论文

表 5-2 系统日志表

字段 log_id log_time calling_method message log_level user_id client_ip

类型 varchar datetime varchar varchar varchar varchar varchar

描述 日志 id 日志时间戳 调用方法 返回结果 日志级别 用户 id 客户端 ip

系统日志表只对管理员权限用户可见，为系统管理员提供了查看其他用户历 史访问记录的途径。系统日志表包含日志 id、时间戳、调用方法等日志描述。如 表 5-2 所示。

3）资产主机信息表 资产主机信息表描述了主机的相关信息，包括主机 id、主机 ip 等字段。如表 5-3 所示。

表 5-3 资产主机信息表

字段 host_id host_name place oper_dep host_ip host_type_code

类型 varchar varchar varchar varchar varchar
int

描述 主机唯一标志
主机名称 主机所属机房机柜
主机所属部门 主机 ip
主机类型代码

4）服务信息表 服务信息表描述了服务的相关信息，是进行服务安全态势值计算的基础表， 主要包含服务 id、服务名称、服务描述等字段。如表 5-4 所示。

68

第五章 系统设计

表 5-4 资产服务信息表

字段 appsystem_id appsystem_name app_type_code
oper_dep remarks

类型 varchar varchar
int varchar varchar

描述 服务 id 服务名称 服务类型代码 服务所属部门 服务描述

5）资产关联表 资产关联表描述了服务和主机间多对多的关联关系，在态势计算中用于主机 和服务的层次划分，包含服务 id 和主机 id。如表 5-5 所示。

表 5-5 资产关联表

字段 appsystem_id
host_id

类型 varchar varchar

描述 服务 id 主机 id

6）监控指标表 监控指标表用于存储需要采集的指标信息，主要包含指标 id、采集间隔等字 段。如表 5-6 所示。

表 5-6 监控指标表

字段 kpi_id kpi_name kpi_discribe collect_interval

类型 varchar varchar varchar
int

描述 指标 id 指标名称 指标描述 采集间隔

7）服务态势表 服务态势表用于存储服务态势评估的结果，主要包含服务 id、时间戳、服务 态势值等字段。如表 5-7 所示。

69

电子科技大学硕士学位论文

表 5-7 服务态势表

字段 appsystem_id
time appsystem_situation

类型 varchar datetime double

描述 服务 id 评估时间 服务态势值

8）整体态势表 整体态势表用于存储整体态势评估的结果，主要包含时间戳、整体态势值字 段。如表 5-8 所示。

字段 time appsystem_situation

表 5-8 整体态势表
类型 datetime double

描述 评估时间 服务态势值

5.3 系统功能模块设计
本文将安全态势评估系统划分为了五个服务，分别为用户管理服务、数据采 集服务、数据预处理服务、安全态势评估服务和安全态势预测服务。总体功能模 块图如图 5-3 所示。

图 5-3 系统总体功能模块图
70

第五章 系统设计
5.3.1 用户管理服务
用户管理服务主要包含用户登录注册、用户信息修改的功能，具体功能介绍 如下：
1）用户登录注册 在提交用户名和密码后，依次验证用户是否存在，用户名和密码是否正确， 是否已在别处登录，验证失败则给出相应提示，验证成功则进入系统。因此登录 的流程如图 5-4 所示。
图 5-4 登录流程图
2）用户信息修改功能 用户信息修改主要用于对用户密码的修改，首先验证原密码是否正确，然后 验证新密码格式，验证成功后，则修改密码成功；否则修改失败，返回修改页面。 用户密码修改流程如图 5-5 所示。
71

电子科技大学硕士学位论文
图 5-5 修改密码流程图
5.3.2 数据采集服务
数据采集服务包含指标数据采集和告警数据采集。 指标数据采集服务包含数据导入、数据拼接。指标数据导入模块是负责将按 照监控指标表将指标数据采集出来并导入到 MongoDB 数据库中；数据拼接模块 是负责将 MongoDB 中的指标数据按照主机 id 和时间戳进行拼接，并将拼接后的 数据输入到数据预处理模块。 指标数据采集流程如图 5-6 所示。
72

第五章 系统设计
图 5-6 指标数据采集流程图
告警数据采集负责将告警数据从企业数据库告警表采集到本地数据库中，并 输入到数据预处理模块。
告警数据采集流程如图 5-7 所示。
图 5-7 告警数据采集流程图
5.3.3 数据预处理服务
数据预处理服务是安全评估服务的基础，该服务对数据采集服务采集到的数 据转换成能够进行安全态势评估的规范化数据。数据预处理服务包含指标数据预
73

电子科技大学硕士学位论文
处理和告警数据预处理。指标数据处理包含缺失值填充、重复值删除、数据归一 化、数据降维等步骤，告警数据预处理主要是对告警关键信息的提取。数据预处 理流程如图 5-8 所示。
图 5-8 数据预处理流程图
5.3.4 安全态势评估服务
安全态势评估服务可以基于实时采集的数据进行安全态势的分析评估，将预 处理后的指标告警规范数据输入到安全态势评估模型，得到主机的风险类型；根 据服务信息表、主机信息表、资产关联表得到服务和主机的关联关系，根据同一 服务中各主机的风险类型以及主机的重要程度，对服务的安全态势进行量化，得 到服务的安全态势值；根据服务相关信息计算服务的重要程度，结合各服务的安 全态势值，计算出整体安全态势。安全态势评估服务还包含当前整体态势展示、 历史整体态势查询、当前服务态势展示和历史服务态势查询功能。安全态势评估
74

的流程如图 5-9 所示。

第五章 系统设计

图 5-9 安全态势评估流程图
5.3.5 态势预测服务
态势预测服务是对未来整体及服务态势进行预测，首先查询整体或服务历史 整态势，并将计算完成的当前态势和历史态势进行时序数据拼接，输入到训练好 的 LSTM 时序预测模型，输出未来整体或服务态势预测值，并对未来整体或服务 态势预测值进行可视化展示。安全态势预测的流程如图 5-10 所示。
75

电子科技大学硕士学位论文
图 5-10 安全态势预测流程图
5.4 本章小结
本章首先从服务划分的角度阐述了态势评估系统的架构设计，然后描述了系 统非关系型数据库和关系型数据库的设计，最后按照功能模块的划分，分别对各 个模块进行了设计。
76

第六章 系统实现与测试
第六章 系统实现与测试 6.1 系统界面实现
系统最终要通过可视化的手段向用户展示安全态势评估和预测的结果，为用 户及时感知系统网络安全运行状况提供技术支撑。系统界面主要包含用户管理模 块界面、态势评估模块界面、态势预测模块界面、日志模块界面。
6.1.1 用户管理界面实现
用户管理模块主要为用户提供了用户登录和修改用户信息等功能，其界面实 现如图 6-1、6-2 所示。
图 6-1 系统登录界面
77

电子科技大学硕士学位论文
图 6-2 修改用户信息界面
6.1.2 态势评估界面实现
图 6-3 当前整体安全态势展示界面
78

第六章 系统实现与测试
态势评估模块包含当前整体态势展示界面、历史整体态势查询界面、当前各 服务态势展示界面和服务历史态势查询界面。
当前整体态势展示界面用圆环图的形式向用户展示了当前整体安全态势，并 可以通过点击“近三日”、“近一周”和“近两周”按钮选择展示近几日的整体 安全态势趋势图，如图 6-3 所示。
历史整体态势展示界面向用户提供了态势历史查询的功能，用户通过选择开 始时间和结束时间进行查询，如图 6-4 所示。
图 6-4 历史整体安全态势查询界面
当前各服务安全态势展示界面通过柱状图的方式向用户展示了当前各服务的 安全态势。如图 6-5 所示。
图 6-5 当前各服务安全态势展示界面
79

电子科技大学硕士学位论文
服务历史安全态势查询界面向用户提供了服务态势历史查询的功能，用户通 过选择服务、开始时间和结束时间进行查询。如图 6-6 所示
图 6-6 服务历史态势查询界面
6.1.3 态势预测界面实现
态势预测模块是对服务未来态势进行预测，并向用户展示预测结果，其界面 如图 6-7 所示。
图 6-7 态势预测界面
6.1.4 日志管理界面实现
80

第六章 系统实现与测试
日志管理模块用于管理员查看用户的操作记录以及排查系统报错，可以通过 输入时间按照时间查询，也可以输入用户名按用户名查询日志。其界面实现如图 6-8 所示。

图 6-8 日志查询界面实现

6.2 系统实现伪代码

6.2.1 数据采集模块伪代码

表 6-1 数据采集伪代码

输入：采集时间点 t 输出：无

1. 查询主机表，获取被采集所有主机 id，放入集合 H

2. For h : H

3.

查询指标表，获取被采集指标 id，放入集合 I

4.

For i : I

5.

向目标系统查询时间点 t 主机 h 的指标 i

6.

将主机 h->时间点 t->指标 i->指标值存入 MongoDB

7.

End For

8.

拼接主机 h 的所有指标存入 Mysql

9.

向目标系统查询时间点 t 到上一时间点主机 h 的所有告警

10. 将时间段内的所有告警存入 Mysql

11. End For

81

电子科技大学硕士学位论文
数据采集模块是对目标系统的指标数据和告警数据进行采集，并导入本地数 据库，其伪代码如表 6-1 所示。

6.2.2 数据预处理模块伪代码

数据预处理模块是对采集到的指标数据和告警数据进行预处理，并输入到评 估模块，其伪代码如表 6-2 所示。

表 6-2 数据预处理伪代码

输入：原始数据 输出：规范数据

1. 从采集服务获取采集到的指标数据和告警数据

2. For 还有指标未处理

3.

选择一个指标

4.

缺失值填充

5.

数据归一化

6. End For

7. 指标数据降维

8. For 还有告警未处理

9.

选择最近告警

10. 计算最大告警等级、平均告警等级、告警总数

11. End For

12. 告警关键信息提取

13. 指标告警数据融合为处理后的规范数据

6.2.3 态势评估模块伪代码
态势评估模块是将预处理后的规范数据输入到态势评估模型，并计算服务态 势值和整体态势值，其伪代码如表 6-3 所示。

82

第六章 系统实现与测试

表 6-3 态势评估伪代码

输入：预处理后的规范数据

输出：服务态势值

整体态势值

1. 查询服务信息表，获取所有服务 id，放入集合 S

2. For s : S

3.

选择一个服务 s

4.

查询资产关联表，获取服务包含的所有主机 id，放入集合 H

5.

For h : H

6.

选择一个主机 h

7.

获取主机 h 预处理后的规范数据

8.

输入到态势评估模型，得到主机风险类型

9.

对主机风险类型量化评分，得到主机风险值并存入集合 R

10. End For 11. 根据主机相关属性信息构造成对比较矩阵 12. 计算服务 s 中各主机重要性权重 13. 根据各主机重要性权重和风险值，计算服务 s 的态势值

14. End For 15. 根据各服务相关属性信息构造成对比较矩阵 16. 计算各服务重要性权重

17. 根据各服务态势值和重要性权重计算整体态势值

6.2.4 态势预测模块伪代码
态势预测模块是将历史时序态势值序列输入到态势预测模型预测下一时间点 的态势值，其伪代码如表 6-4 所示。

83

电子科技大学硕士学位论文

表 6-4 态势预测伪代码

输入：时间点 t 输出：态势预测值

1. 查询服务信息表，获取所有服务 id，放入集合 S

2. For s : S

3.

选择一个服务 s

4.

查询服务 s 在时间 t 及之前的 n 个时间点的态势值

5.

输入到服务 s 对应的 LSTM 时序预测模型

6.

得到服务 s 在下一时间点的态势预测值

7. End For

8. 查询在时间 t 及之前的 n 个时间点的整体态势值

9. 输入到整体态势预测模型

10. 得到在下一时间点的整体态势预测值

6.3 系统测试

6.3.1 测试环境

表 6-5 测试环境

服务器名称 Web 服务器

服务器硬件配置

CPU 内存

硬盘

8核

16G

512G

服务器软件配置

操作系统

其余软件

Centos7

Tomcat8(64)

数据库缓存服务器

8核

16G

512G

（Redis）

Centos7

Redis5.0.9

数据库服务器 （MongoDB）

8 核 16G

512G

Centos7

MongoDB3.2.0

数据库服务器 （Mysql） 应用服务器

8核

16G

512G

8核

16G

512G

Centos7 Centos7

Mysql8.0 Jdk11、python3.10

本系统来源于某电力企业“网络安全态势感知”项目，根据该项目的需求说

明在三方测试公司进行了功能性测试和安全性测试，测试的目的是验证本系统是

84

第六章 系统实现与测试

否满足项目的指标要求。因为本系统只是该项中的一部分，所以本文以介绍安全 态势评估系统的功能测试为主。系统测试环境如表 6-5 所示。

6.3.2 系统功能测试
1、当前整体安全态势展示 当前整体安全态势展示向用户提供展示当前整体态势和近几日态势的功能。 测试结果如表 6-6 所示。

测试项

表 6-6 当前整体安全态势展示功能测试 预期结果

测试结论

界面进入 1、能够进入当前整体安全态势展示界面。

当前整体安 全态势展示

当前整体 态势展示 近几日态
势展示

2、能够显示当前整体态势环形图。 3、能够显示近几日安全态势趋势图；

符合预期 符合预期 符合预期

2、当前各服务安全态势展示 当前各服务安全态势展示向用户提供展示当前各服务安全态势和服务健康 占比的功能。测试结果如表 6-7 所示。

表 6-7 当前各服务安全态势展示功能测试

测试项

预期结果

测试结论

界面进入 1、能够进入当前各服务安全态势展示界面。

当前各服务 安全态势展
示

当前各服 务安全态
势展示 服务健康
占比

2、能够显示当前各服务安全态势条形图。 3、能够显示当前各服务健康占比环形图。

3、历史整体安全态势查询

符合预期 符合预期 符合预期

85

电子科技大学硕士学位论文

历史整体安全态势查询向用户提供查询所选时间段内整体安全态势的功能。 测试结果如表 6-8 所示。

表 6-8 历史整体安全态势查询功能测试

测试项

预期结果

测试结论

界面进入 1、能够进入历史整体安全态势查询界面。

历史整体安 全态势查询

历史整体 态势趋势

2、能够显示时间区间内的安全态势趋势图。

图展示

符合预期 符合预期

4、历史各服务安全态势查询 历史各服务安全态势查询向用户提供查询所选时间段内服务安全态势的功 能。测试结果如表 6-9 所示。

测试项

表 6-9 历史各服务安全态势查询功能测试 预期结果

测试结论

界面进入 1、能够进入历史各服务安全态势查询界面。

符合预期

历史各服务 安全态势查
询

历史各服 务类安全 态势趋势

2、能够显示时间区间内的服务安全态势趋势图。 符合预期

图查询

5、态势预测功能测试 态势预测是对未来整体或服务态势值进行预测，向用户展示预测值，并展示 真实态势数据和预测数据的曲线对比图。测试结果如表 6-10 所示。

86

第六章 系统实现与测试

测试项

表 6-10 态势预测功能测试 预期结果

界面进入 1、能够进入系统态势预测界面。

测试结论 符合预期

态势 预测

态势预测 2、能够成功预测未来态势并展示。
真实和预 测数据对 3、能够显示预测数据和真实数据对比曲线图
比

符合预期 符合预期

6、用户登录测试 用户登录向用户提供登录系统的功能，登录成功则进入系统。测试结果如表 6-11 所示。

测试项

表 6-11 用户登录功能测试 预期结果

测试结论

用户 登录

界面进入 1、能够进入系统登录界面。

符合预期

2、用户名、密码正确时能够成功进入系统；否

登录功能

符合预期

则，返回登录界面，并提示错误。

8、用户信息修改测试 用户信息修改向用户提供修改用户信息的功能，如修改密码、邮箱、手机号 等信息。测试结果如表 6-12 所示。

测试项

表 6-12 用户信息修改功能测试 预期结果

测试结论

用户信 息修改

界面进入 信息修改

1、能够进入系统信息修改界面。

符合预期

2、原用户名、密码正确时能够成功修改用户信息； 符合预期
否则，返回信息修改界面，并提示错误。

87

电子科技大学硕士学位论文

9、日志查询测试 日志查询向管理员提供对系统日志进行查询的功能，可以通过输入用户名或 时间进行查询。测试结果如表 6-13 所示。

测试项

表 6-13 系统日志查询功能测试 预期结果

测试结论

用户信 息修改

界面进入 日志查询

1、能够进入系统日志查询界面。

符合预期

2、用户输入用户名或时间后，能够分别按照用户
名或时间进行查询，也可以按照两个条件一起查 符合预期
询，按照日志时间顺序排序，并通过列表进行展

示。

6.4 本章小结
本章首先根据功能划分介绍了系统的界面实现以及系统实现伪代码，然后描 述了系统的测试环境，并根据测试方案依次进行了系统功能性测试，测试结果功 能均符合预期。

88

第七章 全文总结与展望
第七章 全文总结与展望
7.1 全文总结
随着信息技术的不断发展，互联网与人们生活的联系日益密切，企业信息化 的步伐也逐渐加快，随之而来的网络安全问题日益凸显，网络犯罪层出不穷，黑 客攻击日益猖獗，企业、个人和政府的信息网络安全正面临着空前的挑战。面对 网络安全前所未有迅猛增长的需求，研发满足用户需要、与当前互联网环境相适 应的网络安全产品十分必要。
本文介绍了国内外安全态势评估的现状，并从数据预处理层、态势评估层、 态势量化层和态势预测层四个层面分别阐述了基于集成学习的网络安全态势评估 模型，完成了基于集成学习的网络安全态势评估系统的设计与实现。本文主要开 展的工作包括：
1、研究基于电力信息系统网络安全相关数据的数据预处理模型。本文将采集 自某电力信息系统的数据划分为指标和告警数据，并分别采用了不同的预处理方 式，最后对指标数据和告警数据进行了数据融合。
2、研究基于集成学习的安全态势评估模型。本文采用 Boosting 算法对安全 态势进行评估，并对 Boosting 算法进行了改进，提出了一种基于改进 Boosting 算 法的网络安全态势评估模型，提升了网络安全态势评估模型准确率。
3、研究层次化的安全态势量化模型。本文分析了原有层次化评估方法，对该 层次模型进行改进，改进的安全态势量化层次模型相比于传统的层次模型，充分 考虑了层次模型层次结构划分的合理性，结合 AHP 算法对网络安全态势进行了层 次化计算。
4、研究安全态势预测模型。本文采用了 LSTM 时序预测方法对时序整体态 势数据进行了预测，并通过粒子群算法 PSO 对 LSTM 态势预测模型进行了优化。
5、设计并实现了基于集成学习的网络安全态势评估系统，将系统服务划分 为数据采集服务、数据预处理服务、安全态势评估、态势预测等服务，实现了基 于指标告警数据进行安全态势评估、态势预测的功能，并进行可视化展示，提高 了决策人员或运维人员对系统网络安全状况的感知能力。
89

电子科技大学硕士学位论文
7.2 展望
随着信息技术的发展，必然会出现越来越多的安全问题，因此要不断研究满 足用户需要、与网络环境发展相适应的网络安全态势评估模型。本文研究了基于 集成学习的安全态势评估模型，设计并实现了安全态势评估系统，可以对目标系 统的安全状况进行实时的评价，对当前的安全风险进行及时的感知，并对其进行 历史的分析。但是，仍然有很多问题需要不断地解决和完善：
1、安全态势评估和分析依赖于采集的数据，大量原始数据在从目标系统到 本系统的网络中传播会浪费大量的时间，造成安全态势评估滞后。因此，在未来 的研究中应当将计算向采集端移动，将本系统嵌入到目标系统中减少网络中的数 据传输，进一步提高态势评估的实时性。
2、随着信息网络的不断扩展，输入到安全态势评估系统的数据量也会不断 增加，在面对海量网络安全数据时，态势计算的实时性也会下降。因此，下一步 应当将分布式计算应用到态势评估过程中，以提高安全态势计算的速度。
90

