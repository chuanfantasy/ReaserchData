密

级

保
：

密

期

限

：  

１ ／
硕 士 学 位 论 文  

题 目 ： 基 于 区 块 链 的 农 副 产 品 溯 源 系 统  

的研究与实现



  

学 号  ：

２ ０ １ ９ １ ４０４９４

  

姓名 ：

ＭＭ



  

专

业 ：

计算机技术



  

导师 ：



  

学 院 ： 计 算 机 学 院 （ 国 家 示 范 性 软 件 学 院 ）

年 ２ ０ ２ ２

０ ４ 月 ０ ８ 日

中 国 ■ 北 京  

密

级

保
：

密

期

限

：

分 嚏 仰 ？ 大 聲
硕 士 学 位论文  
？  

题

目

基于 区块链
：

的农副

产

品溯源系

统  

的研 究与实现



  

学号 ：

２０ １ ９ １ ４０４９４



  

姓

名 ：

ａ？



  

专业 ：

计算机技术



  

导师 ：

Ｓ２



  

学院 ：

计算 机 学 院 （ 国 家 示 范 性 软 件学 院 ）  

年 ２ ０ ２ ２

０ ４ 月 ０ ８ 日

Ｌ  Ｃ Ｓ ｅ ｃ ｒ ｅ ｔ  ｅｖ ｅ ｌ ：

 Ｐ ｏ ｎ ｆｉ ｄ ｅ ｎ ｔ ｉ ａ ｌ ｉ ｔｙ

ｄ ｅ ｒ ｉ ｏ

：

Ｂ Ｅ ＩＪ ＩＮ ＧＵ Ｎ Ｉ Ｖ Ｅ Ｒ Ｓ Ｉ Ｔ ＹＯ Ｆ  
Ｐ Ｏ Ｓ Ｔ ＳＡＮ Ｄ   Ｔ ｅ ｌ ｅ ｃ ｏ ｍ ｍ ｕ ｎ ｉ ｃ ａｔ ｉ ｏ ｎ ｓ  

Ｔ Ｍ Ｄ ｈ ｅ ｓ ｉ ｓｆｏ ｒ

ａ ｓ ｔ ｅ ｒ

ｅ ｇ ｒ ｅ ｅ

Ｔ Ｉ Ｔ Ｌ Ｅ ：ＲＥ Ｓ Ｅ Ａ Ｒ Ｃ ＨＡ Ｎ ＤＩＭ Ｐ Ｌ Ｅ Ｍ Ｅ Ｎ ＴＡＴ Ｉ Ｏ Ｎ   Ｏ ＦＡ Ｇ ＲＩ Ｃ ＵＬＴ Ｕ ＲＡＬＡＮ ＤＳ Ｉ Ｄ Ｅ Ｌ Ｉ Ｎ ＥＰ Ｒ Ｏ Ｄ Ｕ Ｃ Ｔ  
Ｔ ＲＡ Ｃ Ｅ Ａ Ｂ Ｉ Ｌ Ｉ Ｔ ＹＳ Ｙ Ｓ Ｔ Ｅ ＭＢ Ａ Ｓ Ｅ ＤＯ Ｎ   Ｂ Ｌ Ｏ Ｃ Ｋ Ｃ ＨＡ Ｉ Ｎ  

Ｄ Ｓ ｔ ｕ ｄ ｅ ｎ ｔ Ｉ

 ：

２０ １ ９ １ ４０４９４



  

Ｃ ａ ｎ ｄ ｉ ｄ ａ ｔ ｅ  ：

Ｌ ｕＬ ｉ ｕ



  

Ｃ Ｔ  Ｓ ｕ ｂ ｅ ｃ ｔ ： ｊ



ｏ ｍ ｐ ｕ ｔｅ ｒ ｅｃ ｈ ｎ ｏ ｌ ｏ ｇｙ
  

Ｓ ｕ ｐ ｅ ｒｖ ｉ ｓ ｏ ｒ  ：

Ｆ ａ ｎ ｇＤ ｅ ｎ ｇ



  

  Ｃ  Ｉ ｎ ｓ ｔ ｉ ｔ ｕ ｔ ｅ ：

Ｓｃｈ ｏｏｌ

ｏｆ

ｏ ｍ ｐ ｕｔｅｒ

Ｓ ｃ ｉ ｅ ｎ ｃ ｅ  

Ｎ Ｐ Ｅ （

ａ ｔ ｉ ｏ ｎ ａ ｌ  ｉ ｌ ｏ ｔ  Ｓ ｏ ｆｔｗ ａ ｒ ｅ 

ｎ ｇ ｉ ｎ ｅ ｅ ｒ ｉ ｎ ｇ Ｓ ｃ ｈ ｏ ｏ ｌ ）

Ａｐ

ｒ

ｉ

ｌ

０

８

，

２


０

２

２

基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 研 究 与 实 现  

摘 要  

基 于 区 块 链 的 农 副 产 品 溯 源 系 统 旨 在 为 农 副 产 品 提 供 一 个 基 于  

区块链 的去 中 心化可信溯源 ，

为 食 品 安 全 问 题 提 供 一 个 可 靠 透 明 的 解  

决方案 ，

同 时 解 决 在 中 心 化 溯 源 过 程 中 遇 到 的 因 数 据 存 储 中 心 化 而 带

来 的 一 系 列 漏 洞 和 问 题 。 通 过 对 国 内 外 的 传 统 溯 源 发 展 现 状 与 区 块 链  

溯 源 发 展 现 状 的 研 宄 ， 发 现 了 传 统 溯 源 存 在 中 心 化 存 储 的 问 题 同 时 区  

块 链 溯 源 系 统 普 遍 较 为 简 单 且 不 支 持 大 文 件 的 上 链 存 储 。 针 对 目 前 存  

在 的 问 题 本 文 进 行 了 研 宄 并 进 行 了 如 下 工 作 ：  

１ ． 对 现 有 的 共 识 算 法 进 行 了 学 习 ， 重 点 对 基 于 权 威 证 明 ＰｏＡ 的  

ｃｌ ｉｑｕｅ 算 法 进 行 了 研 究 。 结 合 ｃｌｉｑｕｅ 的 主 要 思 想 设 计 了 基 于 Ｐ ｏＡ 共 识  

的权威 节 点 动 态选择 算法 ，

通 过 动 态 改变 权 威 节 点 确 保 参 与 出 块 的 权

威 节 点尽 可能保持在线 ，

从而使得系统 出 块更加稳定 。

对 算 法 的 效 果  

进 行 了 验 证 和 测 试 。  

２ ． 对 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 需 求 进 行 了 分 析 ， 在 此  

基 础 上 完 成 了 系 统 整 体 架 构 和 功 能 模 块 的 设 计 。 对 区 块 链 溯 源 流 程 、

大 文 件 链 上 存 储 、 溯 源 数 据 的 页 面 展 示 及 数 据 库 进 行 了 设 计 。

３ ． 完 成 了 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 详 细 设 计 和 实 现 ，

使用

ｔ ｙ ｓ ｏ ｌ ｉ ｄ ｉ

语言进行智 能合约 的编写并搭建 区块链环境 ， 通过

ｆ ｌ ｔｒｕ

ｅ

框 架 实 现 合 约 的 部 署 并 通 过 ｗｅｂ３ 提 供 的 ａｐ ｉ 和 ｔｒｕｆ ｌｅ 获 取 的 合 约 实 例 来 实 现 系 统 与 以 太 坊 的 交 互 。 结 合 ｗｅｂ ｇ ｉ ｓ 和 ｅｃｈａｒｔｓ 对 溯 源 查 询 的   结 果 进 行 直 观 的 图 表 统 计 和 地 图 展 示 。  

４ ． 最 后 对 系 统 效 果 进 行 了 展 示 并 对 系 统 进 行 了 测 试 ， 将 系 统 实

现 于 实 际 的 智 慧 社 区 项 目 中 完 成 了 系 统 的 应 用 。  

关 键 词 ： 区 块 链 以 太 坊 智 能 合 约 溯 源 Ｐ ｏＡ  

ＲＥ Ｓ ＥＡＲＣＨＡＮＤＩＭＰＬＥＭＥＮＴＡＴＩ ＯＮＯＦ   Ａ ＧＲＩ Ｃ ＵＬＴＵＲＡＬＡＮＤＳ ＩＤＥＬ ＩＮＥＰＲＯＤＵＣ Ｔ   ＴＲＡＣＥＡＢ ＩＬＩ Ｔ ＹＳ Ｙ Ｓ ＴＥＭ Ｂ Ａ Ｓ ＥＤＯＮＢ Ｌ Ｏ ＣＫＣＨＡＩＮ  

ＡＢ Ｓ ＴＲＡ Ｃ Ｔ

Ｔｈ ｅ ａｇｒｉ ｃｕ ｌｔｕ ｒａｌ ａｎ ｄ ｓ ｉ ｄ ｅ ｌ ｉ ｎｅ ｐｒｏ ｄｕ ｃｔ ｔｒ ａｃ ｅ ａｂ ｉ ｌ ｉｔｙ ｓ ｙ ｓｔｅｍ ｂ ａｓ ｅ ｄ ｏ ｎ  

ｂ ｌ ｏ ｃ ｋｃ ｈ ａｉｎ  ａｉ ｍ ｓ  ｔ ｏ ｐ ｒｏｖ ｉ ｄ ｅ ａ ｂ ｌ ｏ ｃ ｋｃｈ ａｉ ｎ － ｂ ａｓ ｅ ｄ  ｄｅ ｃ ｅ ｎｔｒａｌ ｉ ｚ ｅ ｄ  ａｎ ｄ  ｔｒｕ ｓ ｔｅ ｄ

ｔｒａ ｃ ｅ ａｂ ｉ ｌ ｉｔｙ  ｓｙ ｓ ｔｅｍ  ｆｏｒ  ａｇ ｒ ｉ ｃｕ ｌ ｔｕｒａｌ  ａｎｄ  ｓ ｉ ｄ ｅ ｌ ｉｎ ｅ ｐ ｒｏ ｄｕ ｃ ｔｓ ，  ａｎ ｄ  ｔｏ  ｐｒ ｏ ｖ ｉ ｄ ｅ ａ  

Ａ ｒｅ ｌ ｉ ａｂ ｌ ｅ ａｎ ｄ  ｔｒ ａｎ ｓ ｐ ａｒ ｅｎｔ  ｓ ｏ ｌｕｔｉ ｏｎ  ｔｏ ｆｏ ｏ ｄ  ｓ ａｆｅｔｙ  ｉ ｓ ｓ ｕ ｅ ｓ ． 

ｈ ｔ  ｔ ｅ  ｓ ａｍ ｅ  ｔｉｍ ｅ ，  ｉ ｔ  

ｓ ｏ ｌｖ ｅ ｓ  ａ  ｓ ｅｒｉ ｅ ｓ  ｏ ｆ ｌ ｏ ｏｐ ｈ ｏ ｌ ｅ ｓ  ａｎｄ  ｐ ｒｏ ｂ ｌ ｅｍ ｓ  ｃ ａｕ ｓ ｅ ｄ  ｂｙ  ｔｈ ｅ ｃ ｅｎｔｒ ａｌ ｉ ｚａｔ ｉ ｏ ｎ  ｏ ｆ  
Ｔ ｄ ａｔａ ｓｔｏ ｒａｇ ｅ ｅｎｃ ｏ ｕｎｔ ｅｒ ｅ ｄ  ｉｎ  ｔｈ ｅ  ｐ ｒ ｏ ｃ ｅ ｓ ｓ  ｏ ｆ  ｃ ｅ ｎｔｒａｌ ｉ ｚ ｅ ｄ  ｔｒａ ｃ ｅ ａｂ ｉ ｌ ｉ ｔｙ ．  ｈｒ ｏ ｕｇ ｈ

ｔｈ ｅ  ｒｅ ｓ ｅ ａｒｃ ｈ  ｏ ｎ  ｔｈ ｅ  ｄ ｅｖ ｅ ｌ ｏｐ ｍ ｅｎｔ  ｓｔａｔｕ ｓ  ｏ ｆ  ｔｒ ａｄ ｉ ｔ ｉ ｏ ｎ ａ ｌ  ｔｒ ａｃ ｅ ａｂ ｉ ｌ ｉｔｙ  ａｔ  ｈ ｏ ｍ ｅ

ｙ ａｎ ｄ  ａｂｒｏ ａｄ ａｎ ｄ  ｔｈｅ ｄ ｅｖ ｅ ｌ ｏｐ ｍ ｅｎｔ ｓ ｔａｔｕ ｓ ｏ ｆ ｂ ｌ ｏ ｃｋ ｃｈ ａｉ ｎ ｔｒ ａｃ ｅ ａｂ ｉ ｌ ｉｔ

 ｉ ｔ  ｉ ｓ
，

    ｆｏ ｕｎ ｄ ｔｈ ａｔ  ｔｈ ｅ ｒｅ ｉ ｓ  ａ ｐ ｒ ｏｂ ｌ ｅｍ  ｏ ｆ ｃ ｅｎｔｒ ａｌ ｉ ｚｅ ｄ ｓ ｔｏ ｒａｇ ｅ  ｉｎ ｔｒａｄ ｉ ｔｉ ｏ ｎ ａｌ  

Ａ ｙ ｂ ｔｒａｃ ｅ ａ ｉ ｌ ｉｔ ． 

ｔ  ｔｈ ｅ  ｓ ａｍ ｅ ｔｉ ｍ ｅ ，  ｉｔ  ｉ ｓ  ｆｏ ｕｎ ｄ  ｔｈ ａｔ  ｔｈ ｅ  ｂ ｌ ｏ ｃｋ ｃｈ ａｉｎ  ｔｒａｃ ｅ ａｂ ｉ ｌ ｉｔｙ

ｓ ｙ ｓ ｔｅｍ ｉ ｓｇｅｎ ｅｒ ａｌ ｌｙ ｒｅ ｌ ａｔ ｉｖ ｅ ｌ ｙ ｓ ｉｍｐ ｌ ｅ ａｎｄ  ｄ ｏ ｅ ｓ  ｎ ｏ ｔ ｓ ｕｐｐ ｏ ｒｔ  ｔｈ ｅ ｏｎ － ｃ ｈ ａｉｎ  

Ａ ｇ ｇ ｏ ｏ ｓｔ ｒａ

ｅ

ｆ ｌ ａｒ 

ｅ ｅ  ｆｉ ｌ

ｓ ．

ｉｍ ｉｎ ｇ  ａｔ  ｔｈ ｅ  ｃｕｒｒｅｎｔ  ｐ ｒｏ ｂ ｌ ｅｍ ｓ ，  ｈ ｔ ｉ ｓ  ｐ ａｐ ｅ ｒ  ｈ ａｓ  ｃ ａｒｒ ｉ ｅ ｄ

ｏ ｕｔ  ｒｅ ｓ ｅ ａｒｃｈ  ａｎ ｄ  ｃ ａｒｒｉ ｅ ｄ  ｏｕｔ  ｔｈ ｅ  ｆｏ ｌ ｌ ｏ ｗｉｎｇ  ｗ ｏｒｋ ：

Ｔ １  ． ｈ ｅ  ｅ ｘ ｉ ｓ ｔ ｉｎｇ  ｃ ｏｎ ｓ ｅｎ ｓ ｕ ｓ  ａｌ ｇｏ ｒｉｔｈｍ ｓ ａｒ ｅ  ｓｔｕ ｄ ｉ ｅ ｄ ，  ｗｉｔｈ  ｅｍｐｈ ａ ｓ ｉ ｓ ｏ ｎ  

Ｐ Ａ Ｃ ｔｈ ｅ  ｃ ｌ ｉ ｑｕ ｅ  ａｌ ｇ ｏｒｉ ｔｈｍ  ｂ ａ ｓ ｅ ｄ  ｏｎ  ｏ

．

ｈ ｏ ｍ ｂ ｉｎｅ ｄ  ｗ ｉ ｔ

ｈ ｑ  ｔ ｅ  ｍ ａｉｎ  ｉ ｄ ｅ ａ  ｏ ｆ  ｃ ｌ ｉ ｕ ｅ ，

Ａ   ａ  ｄｙ ｎ ａｍ ｉ ｃ ｓ ｅｌ ｅ ｃｔｉ ｏｎ  ａｌ ｇ ｏｒｉｔｈｍ ｏ ｆ ａｕｔｈ ｏｒｉｔａｔｉｖ ｅ ｎ ｏ ｄ ｅ ｓ ｂ ａｓ ｅ ｄ  ｏ ｎ  Ｐ ｏ

Ｂ ｃ ｏｎｓ ｅｎ ｓｕ ｓ  ｉ ｓ  ｄ ｅ ｓ ｉ ｇ ｎ ｅ ｄ ．  ｙ  ｄ ｙ ｎ ａｍ ｉ ｃ ａｌ ｌｙ  ｃ ｈ ａｎｇ ｉｎ ｇ  ｔｈ ｅ  ａｕｔｈｏ ｒｉ ｔ ａｔｉ ｖ ｅ  ｎ ｏ ｄ ｅ ｓ ，

ｉ ｔ  ｅ ｎ ｓ ｕ ｒｅ ｓ  ｔｈ ａｔ  ｔｈ ｅ ａｕ ｔｈｏ ｒｉ ｔａｔｉｖ ｅ  ｎ ｏ ｄ ｅ ｓ  ｐ ａｒｔ ｉ ｃ ｉ ｐ ａｔｉｎ ｇ  ｉｎ  ｔｈ ｅ  ｂ ｌ ｏ ｃｋ  ｐ ｒ ｏ ｄ ｕ ｃｔｉ ｏ ｎ   ｒｅｍ ａｉｎ  ｏｎ ｌ ｉ ｎ ｅ ａｓ ｍｕ ｃｈ  ａｓ ｐ ｏ ｓ ｓ ｉｂ ｌ ｅ ，  ｔｈｕ ｓ  ｍ ａｋｉ ｎｇ  ｔｈ ｅ ｓｙ ｓｔｅｍ ｂ ｌ ｏ ｃｋ  

Ｔ ｐ ｒｏ ｄｕ ｃｔｉ ｏ ｎ  ｍ ｏ ｒｅ  ｓｔａｂ ｌ ｅ ． 

ｈ

ｅ



ｅ ｆ ｆｅ

ｃｔ



ｏ

ｆ 

ｔｈｅ



ａｌ

ｇ

ｏ

ｒｉｔｈｍ



ｉ

ｓ

ｖ

ｅ

ｒｉ

ｆｉ

ｅ

ｄ



ａｎ

ｄ



ｔ

ｅ

ｓｔ

ｅ

ｄ

．

Ｔ ２  ． ｈ ｅ ｄ ｅ ｍ ａｎｄ  ｆｏｒ ｔｈｅ ａｇ ｒｉ ｃｕ ｌｔｕ ｒａ ｌ ａｎ ｄ  ｓ ｉ ｄ ｅ ｌ ｉ ｎ ｅ  ｐ ｒｏ ｄｕ ｃｔ  ｔｒａｃ ｅ ａｂ ｉ ｌ ｉｔｙ  

ｓｙ ｓｔｅｍ ｂ ａｓ ｅ ｄ ｏ ｎ  ｂ ｌ ｏ ｃ ｋｃ ｈ ａｉ ｎ ｉ ｓ  ａｎ ａｌ ｙ ｚｅ ｄ ， ａｎ ｄ ｔｈ ｅ ｄ ｅ ｓ ｉ ｇｎ ｏ ｆ ｔｈ ｅ ｏ ｖ ｅｒａｌ ｌ  

ｓ

ｔｒｕ

ｃ

ｔｕ

ｒｅ

ａｎ

ｄ



ｆｕ

ｎ

ｃ

ｔｉ

ｏｎ

ａｌ



ｍ

ｏ

ｄｕ

ｌ

ｅ

ｓ



ｏ

ｆ 

ｔｈ

ｅ



ｓｙ

ｓ

ｔ

ｅｍ



ｉ

ｓ



ｃ

ｏｍｐ

ｌ

ｅ

ｔｅ

ｄ



ｏｎ



ｔｈ

ｉ

ｓ



ｂ

ａ

ｓ

ｉ

ｓ

．

Ｔ ｋ ｈ ｈ ｅ ｂ ｌ ｏ ｃ

ｃ ｈ ａｉｎ  ｔｒ ａ ｃ ｅ ａｂ ｉ ｌ ｉｔｙ  ｐ ｒｏ ｃ ｅ ｓ ｓ ，  ｔｈ ｅ  ｓ ｔｏ ｒ ａｇ ｅ  ｏ ｆ  ｌ ａｒｇ ｅ  ｆｉ ｌ ｅ ｓ  ｏ ｎ  ｔｈ ｅ  ｃ

ａｉｎ ，

ｔｈｅ ｐ ａｇ ｅ  ｄ ｉ ｓｐ ｌ ａｙ  ａｎｄ  ｄａｔａｂ ａ ｓ ｅ  ｏ ｆ ｔｒ ａ ｃｅ ａｂ ｉ ｌ ｉｔｙ  ｄ ａｔ ａ ａｒ ｅ  ｄ ｅ ｓ ｉ ｇｎ ｅ ｄ ．  

     ３ ．

Ｃ ｏｍｐ ｌ ｅｔｅｄ ｔｈ ｅ

ｄ ｅｔａ ｉ ｌ ｅｄ ｄ ｅ ｓ ｉ ｇ ｎ  ａｎ ｄ ｉ ｍｐ ｌ ｅｍ ｅｎｔａｔｉ ｏ ｎ  ｏ ｆ ｔｈ ｅ  

ｙ ａ ｇ ｒｉ ｃｕ ｌｔｕｒａｌ  ａｎ ｄ  ｓ ｉ ｄｅ ｌ ｉ ｎ ｅ ｐ ｒｏ ｄｕ ｃｔ  ｔｒ ａｃ ｅ ａｂ ｉ ｌ ｉｔ  ｓｙ ｓｔ ｅｍ  ｂ ａｓ ｅ ｄ  ｏｎ  ｂ ｌ ｏ ｃｋ ｃ ｈ ａｉｎ ，  

ｙ ｕ ｓ ｅ ｄ  ｔｈｅ  ｓ ｏ ｌ ｉ ｄｉｔ  ｌ ａｎｇｕ ａｇ ｅ  ｔｏ ｗｒｉｔ ｅ  ｓｍ ａｒｔ  ｃ ｏｎｔｒａ ｃｔ ｓ  ａｎ ｄ  ｂ ｕ ｉ ｌ ｔ  ａ  ｂ ｌ ｏ ｃｋ ｃｈａｉｎ  

ｅｎｖ ｉ ｒｏ ｎｍ ｅｎｔ ，  ｉｍ ｐ ｌ ｅｍ ｅｎｔｅｄ ｔｈ ｅｃ ｏ ｎｔｒ ａｃｔ ｄ ｅｐ ｌｏ ｙｍ ｅｎｔ ｔｈｒｏ ｕ ｇｈ ｔｈ ｅｔｒｕ ｆｆ ｌ ｅ  
ｆ ｒａｍ ｅｗ ｏｒｋ ，  ａｎｄ  ｏ ｂｔａｉｎ ｅ ｄ  ｃ ｏｎ ｔｒａ ｃｔｓ  ｔｈｒｏ ｕｇｈ  ｔｈ ｅ ａｐ ｉ  ｐ ｒｏｖ ｉ ｄ ｅ ｄ  ｂ ｙ  ｗ ｅｂ ３ ａｎ ｄ

Ｅ ｔｒｕ ｆｆｌ ｅ  Ｉ ｎ ｓ ｔａｎｃ ｅ  ｔｏ  ｒ ｅ ａｌ ｉ ｚ ｅ  ｔｈ ｅ ｉｎｔ ｅ ｒａ ｃ ｔｉ ｏ ｎ  ｂ ｅｔｗ ｅ ｅｎ  ｔｈ ｅ  ｓｙ ｓｔ ｅ ｍ  ａｎ ｄ 

ｈ ｕｍ ｔ ｅｒｅ

．

Ｔｈ ｅ ｓｙ ｓｔ ｅｍ  ｃｏ ｍｂ ｉｎ ｅ ｓ  ｗｅｂ ｇ ｉ ｓ ａｎｄ  ｅ ｃｈ ａｒｔｓ ｔ ｏ ｐ ｅ ｒｆｏｒｍ  ｉｎｔｕｉ ｔｉ ｖ ｅ ｃｈ ａｒｔ

ｓ ｔａｔｉ ｓｔ ｉ ｃ ｓ  ａｎ ｄ  ｍ ａｐ  ｄｉ ｓｐ ｌ ａｙ  ｆｏ ｒ  ｔｈ ｅ  ｔｒａｃ ｅ ａｂ ｉ ｌ ｉ ｔｙ  ｑｕ ｅｒｙ  ｒ ｅ ｓｕ ｌ ｔｓ ．

Ｆ ４ ．  ｉ ｎａｌ ｌ ｙ ，  ｔｈｅ  ｓｙ ｓｔ ｅ ｍ  ｅ ｆｆｅ ｃ ｔ  ｉ ｓ  ｄ ｅ ｍ ｏ ｎ ｓｔｒａｔｅ ｄ  ａｎ ｄ  ｔｈ ｅ  ｓ ｙ ｓｔｅ ｍ  ｉ ｓ  ｔ ｅ ｓ ｔｅ ｄ ，  

ｈ ａｎｄ  ｔ

ｅｓｙ

ｓｔｅｍ ｉｓｉ ｍｐ

ｌ

ｅｍ

ｅ ｎｔｅ ｄ

 ｉ ｎ  ｔｈｅａ ｃｔｕ

ａｌｓｍ

ａｒｔｃ

ｏ

ｍ

ｍ

ｕ

ｎ

ｉ

ｔ

ｙ



ｐ

ｒ

ｏ ｊ

ｅ

ｃｔ  ｔｏ

ｃ ｏ ｍｐ ｌ ｅｔ ｅ  ｔｈｅ  ａｐｐ ｌ ｉ ｃ ａｔｉ ｏｎ  ｏ ｆ  ｔｈ ｅ  ｓ ｙ ｓｔ ｅｍ ．

Ｋ Ｙ Ｗ ＯＲＤ   Ｅ 

Ｓ ： ｂ ｌｏ ｃｋｃｈ ａｉｎ

Ｅｔｈ ｅｒｅｕｍ  ｓｍ ａｒｔ ｃ ｏｎｔｒａｃｔ  ｔｒａｃ ｅ ａｂ ｉ ｌ ｉｔｙ

Ｐ ｏＡ  

Ｉ Ｖ

目 录

第 章 绪 论 一



１  

选 题 背 景 及 意 义 １ ．

１



１

１２ ．

国 内 外 研 宄 现 状 及 分 析  ２

传 统 溯 源 发 展 现 状 ２ １ ．

１
．

２


块 链 源 发 状 ２ ２ １ ．

．

区

溯

展现

２


外 研 究 现 状 小 结 国 内 ２ ３ １ ．

．

  ３  

１ ． ３ 主 要 研 宄 内 容 及 创 新 点  ３  

主 要 研 宄 容 ３ １ ．

１ ．

内

 ３  

论 文 创 点 ３ ２ １ ．

．

亲开

４  


１４ ．

硕士在读期间 主要工作 

４  

论 文 组 织 架 构 １ ５ ．

 ５  

本 章 小 结 ６ １ ．

 ６

第 二 章 相 关 理 论 与 技 术 研 宄  ７

２１ ．

区 块 链 原 理 及 相 关 技 术 研 宄  ７

２２ ．

以 太 坊 与 智 能 合 约 相 关 技 术 研 宄  １ ０

以 太 坊 ２ ２ ．

１ ．

 １ ０

智 能 合 约 ２ ２ ２

．

．



１ １

２３ ．

星 际 文 件 系 统 ＩＰ ＦＳ 的 原 理 及 相 关 技 术 研 宄  １ ２

本 章 小 结 ２ ４ ．

 １ ３  

第 三 章 基 于 Ｐ ｏ Ａ 共 识 的 权 威 节 点 动 态 选 择 算 法 的 研 宄 与 实 现 ． ． ． ． ． ． ． １ ５  

见 共 算 法 介 常 ３ ． １

识

简

 １ ５  

基 于 共识 算法 原 ３ ． ２

ＰｏＡ 的

Ｃ ｌｉｑｕｅ

理  １ ６

Ｃ 概 述 ２ ３ ．

． １

ｌｉｑｕｅ



 １ ６

出 块 控 制 ３ ２ ２

．

．

 １ ６

签 名 者 的 更 换 ２ ３ ．

３ ．

 １ ８  

算 法 优 缺 点 分 析 Ｃ ３ ． ３

ｌｉｑｕ ｅ

 １ ９

３４ ．

算 法 改 进一 权 威 节 点 动 态 选 择 算 法  ２ ０

实 验 与 验 证 ３ ． ５

 ２ ３  

实 验 配 置 ３ ５ １

．

．

 ２ ３  

３５２

．

．

节 点 状 态 变 化 趋 于 稳 定 的 实 验 结 果  ２ ４  

３ ． ５ ． ３ 节 点 状 态 变 化 剧 烈 的 实 验 结 果  ２ ６

实 验 结 果 分 析 ３ ５ ４

．

．

２ ７


本 章 小 结 ３ ６ ．

 ２ ８  

第 四 章 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 需 求 分 析 与 总 体 设 计 ２ ９

．

．

．

．

统 需 求 分 析 系 ４ １ ．

 ２ ９

系 统 用 例 设 计 ４ １ １ ．

．

２ ９


块 链 源 ４ ２ １ ．

．

区

溯 信 息 存 取 需 求  ３ ０

块 链 大 文 件 存 储 求 ４ ３ １ ．

．

区

需

 ３ １

共 识 算 法 需 求 ４ ４ １ ．

．

 ３ １

４２ ．

系 统整体架构 设计

３ ２

统 逻辑 结 构 设 计 ４ ２ ．

１
．

系

 ３ ２

系 统 架 构 设 计 ４ ２ ２

．

．

 ３ ２

模 块 ４ ３ 系 统 功 能 ．

设 计  ３ ４  

链 ４ ４ 系 统 区 块 ．

源 设 计 溯

 ３ ５  

块链 溯 源 流程 设 计 ４ ４ １

．

．

区

 ３ ５  

４４２

．

．

区 块 链 大 文 件 存 储 设 计 方 案  ３ ７

数 据 面 ４ ４ ３ 溯 源

．

．

的页

设 计 展 示

 ３ ７

数 据 库 设 计 ４ ５ ．

 ３ ８  

本 章 小 结 ４ ６ ．

４ ０


第 五 章 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 详 细 设 计 与 实 现  ４ １

现 ５ １ ． 智 能 合 约 的 详 细 设 计 与 实

 ４ １

智 合 约 语 言 ５ １ １ ．

．

會匕

ｄ ｙ ｏ ｓ

ｌｉ

ｉｔ

４ 

１

能 合 运 行 交 ５ ２ １ ．

．

智

约的

与

互 ４ 

１

智 能 合 约 容 ５ ３ １ ．

．

内

４ ２


块 链 境 搭 建 ５ ２ 区

环

．

 ４ ５  

５３ ．

系 统 功 能 模 块 详 细 设 计 与 实 现  ４７

登 录 注 册 模 块 ５ ３ １

．

．

４ ７


用 户 管 理 模 块 ５ ３ ２

．

．

 ４ ８  

产 溯 源 模 块 ５ ． ３ ． ３

品

 ４ ９

统 效 果 展 示 系 ５ ４ ．

 ５ ４  

登 录及 注 册 界 面 ５ ４ １

．

．

 ５ ４  

用 户 审 核 界 面 ５ ４ ２

．

．

 ５ ５  

信 息 录 入 界 面 ５ ４ ３

．

．

 ５ ６

溯 源查 询 界 面 ５ ４ ４

．

．

 ６ １

系 统 落 地 应 用 ５ ４ ５

．

．

 ６ １

统 测 试 与 估 系 ５ ５ ．

评

 ６ ３  

测 试 环 境 ５ ５ ．

１ ．

 ６ ３  

主 要 功 能 测 试 ５ ５ ２

．

．

 ６ ４  

系 统 性 能 测 试 ５ ５ ３

．

．

 ７ ０

本 章 小 结 ５ ６ ．



７ １

第 六 章 总 结 与 展 望  ７ ３  

工 作 总 结 ６ １ ．

 ７ ３  

研 宄 展 望 ６ ２ ．

４   ． 



７

参 考 文 献  ７ ７

第一章 绪论



  

第 一 章 绪 论  

１ ． １ 选題 背 景及意义  

食品安全 问 题是食品消 费者最为关心 的

题 之 问

一 ，

也 是 影 响 食 品 产 品 质 量 的

关 键 ， 食 品 溯 源 可 以 有 效 保 障 食 品 安 全 ， 因 此 溯 源 结 果 的 真 实 可 信 在 一 个 完 整 的

食 品 供 应 链流 程 的 各 个环 节 都 尤 为 重 要 。 而 在 产 品 经 销 的 整 个 供 应 链 过 程 中 ， 地  

域 跨 度 巨 大 、 涉 及 中 间 环 节 众 多 以 及 人 员 追 责 困 难 都 是 溯 源 过 程 中 面 临 的 难 题 。  

设 计 出 一 个 高 效 便 捷 同 时 具 有 易 用 性 的 溯 源 系 统 ， 通 过对 产 品 的 经 销 过 程 进 行 信  

息化管理从而进行精准快速的溯源 ，

这不仅有利于解决突 发情况 ，

而 且对 保 障 食  

品 安 全 和 公 共 卫 生 安 全 也 意 义 重 大 。 但 与 此 同 时 ， 传 统 溯 源 过 程 中 数据 的 中 心 化  

存 储 管 理 以 及 如 何 建 立 各 方 的 互 信 也 是 有 待 解 决 的 重 要 问 题 。  

近 年 来 ， 互 联 网 技 术 飞 速 发 展 ， 区 块 链 作 为 一 个 刚 刚 兴 起 的 前 沿 技 术 Ｗ ， 受  

到 了 大 量 的 关 注 和 追捧 ， 拥 有 极 高 的 话 题 量 和 热 度 。 区 块 链 的 概 念 第 一 次 被 提 出

是在 中本聪的论文

特 《 比

币：

种 一 点 对 点 式 的 电 子 现 金 系 统 》 ｒ ａ 中 ，

其 核 心 思 想  

就是去 中 心化和 防篡改 。

区块链技术正在飞速发展 ，

除 了 比特币之外，

太 坊 以

、  

ＨｙｐｅｒＬｅｄｇｅｒ 等 区 块 链 平 台 也 逐渐 出 现 并 被 大 众 所 熟 知 。 以 太 坊 是 众 多 公 共 区 块   链 平 台 之 一 ， 其 在 开 源 的 同 时 提 供 了 图 灵 完 备 的 编 程 语 言 ， 使 得所 有 用 户 都 可 以

参与进来通过 以太坊来搭建属 于 自 己 的 去 中 心化应用 程序

ＤＡ （

ｐｐ ） ，

这种 特 性 使  

得 以 太坊 备 受 追 捧 。 与 此 同 时 ， 越 来 越 多 用 户 的 加 入 以 及 其 开 源 的 代 码 也 推 动 以

太 坊 的 发 展 更 加 迅 速 以 及 完 善 。 因 此 ， 以 太 坊 完 备 的 技 术 和 详 细 的 参 考 手 册 会 使  

得 通 过 以 太 坊 来进 行 ＤＡｐｐ 开 发 的 过 程 更 加 便 捷 高 效 ， 也 使 得 应 用 程 序 更 加 完  

善 。  

区块链的特点包括去 中 心化 、

透明 公开 、

不可篡改 、

分布式存储 、

可信度高 ，

这 些 特 点 不 仅 使 得 区 块 链 拥 有 极 高 的 受 欢 迎 程 度 和 众 多 的 拥 趸 ， 同 时 使 得 区 块 链  

技 术 在 金 融 、 医 疗 、 供 应 链 等 方 面 都 有 着 广 泛 的 应 用 前 景 和 研 究 价 值 ［３］ ， 因 此 其  

也 在 解 决 供 应链 过 程 中 的 溯 源 问 题 、 提 高 溯 源 可 信 度 方 面 发挥 着 巨 大 的 优 势 ， 可  

以 有 效 地 确 保产 品 的 质 量 和 安 全 。 使 用 区 块 链 进 行 产 品 的 溯 源 ， 不 仅 使 得 数 据 更  

加 地 公 开 和 透 明 ， 能 够 更 加 容 易 地 在 各 个 用 户 间 形 成 和 建 立 互 信 ， 同 时 也 使 得 供  

应 链 的 全 过 程 能 够 被 更 加 有 序 地 管 理 和 记 录 。  

１  

北京邮 电大学工程硕士学位论文



  

１ ．２ 国 内外研究现状及分析  

２ １ ．

．１

传统溯 源发 展现状  

食 品 溯 源 最 早 起 源 是 在 欧 洲 ， 英 国 的 疯 牛 病 以 及 苏 格 兰 大 肠 杆 菌 等 一 系 列 事  

件 使 得 大 家 高 度 关 注 食 品 安 全 问 题 ， 同 时 也 推 动 了 欧盟 通过 立 法来保护 食 品 安 全  

和 食 品 溯 源 发 展 。  

从 年 起 ２ ０ ０ １

，

对 农 产 品 和 食 品 进 行 追 踪 的 系 统 开 始 在 日 本 得 到 了 使 用 和 普  

及 。 这 些 产 品 的 生 产 信 息 被 存 储 在 标 签 中 ， 再 使 用 ＲＦＩＤ（ 射频 识 别 技 术 ） 来 将  

产 品 和 标签 进 行 绑 定 ， 实 现农 产 品 与 食 品 的 追 踪 溯 源 ［４］ 。  

美 国 学者使用 了 多 种技术来解决食品溯源过程 中 遇到 的 问 题 ：

等 人   Ｒ Ｂ ａｌ ｆ

ｉｌ ｌ

将

统 地 信 息 ＧＩ Ｓ（

理

系

）、

ＰＤＡ（ 手持终端 ）

以 及 ｗｅｂ 服 务 这 三 者 相 结 合 ， 获 取  

并 记 录 农 产 品 产 地 的 一 些 土 壤 信 息 等 来 实 现 对 农 场 更 加 有 序 的 管 理 ［５］ 。  

而 在 国 内 ， 闫 师 杰 和 姜 德 科 ｍ 等 人 把 无 线 传 感 器 网 络 和 ＲＦＩＤ 相 结 合 来 对  

牛 肉 进 行 溯 源 。 他 们 建 立 了 个 一 射 频 网 络 来 完 整地 获 取 数 据 并 存 储 在 数据 库 中 ，  

使得数据 的上传更加准确和高效。

李

久

林

［

８ ］

结

合

了

二

维

码

和

加

密

算

法

来

实

现

在

蔬  

菜溯 源 信 息 管 理平 台 中 对 蔬菜 溯 源信 息 的 加 密 存 储 有 利 于 规 范 化信 息 的 管 理 并   ，

方 便政 府 部 门 的 组 织 管 理 。  

２ ２ １ ．

．

区块翻 源 发 展 现状  

国 外 率 先 在 食 品 溯 源 中 使 用 区 块 链 技 术 。 一 家 美 国 公 司 在 鸡 蛋 生 产 到 贩 卖 的

流 程 中 使 用 了 区 块 链 技 术 ， 通 Ｂ ｕｍｂｌａｕｓｋａｓ Ｍ 过 这 个 案 例 明 确 了 如 何 通 过 区 块 链  

来实现更加精准和透 明地在全球 的供应链 网络 中 运输货物 。

过 块   ＾ｌ Ｐ ｈ ｒａｓ

１（
ａｒ ［

区

链 以 太 坊 来 解 决 问 题 ， 他 通过 智 能 合 约 来 实 现 对 供 应 链 网 络 中 涉 及 到 的 所 有 人 员

的 信 息 的 管理 ，

从而保证食 品 的 安全 。

设 计 个 追 溯 餐 型 Ｇ ｎ

ｅ〇 ｒｇｅ ［

］

可 了 一

的

厅原

，  

它 是 借 助 产 品 标识 符 和 区 块 链 来 实 现 的 。 泰 国 学 者 Ｓｕｒａｓａｋｔ Ｍ 借 助 了 物 联 网 和 Ｅ

块 链 ， 两 者 相 互 辅 助 来 实 现 对 农 产 品 的 追 溯 。 Ｋａｍｉ ｌａｒｉ ｓ ｔ Ｗ 通 过 对 区 块 链 在 食 品 供  

应 链 这方 面 的 影 响 的 研 宄 指 出 了 其 在 使 得 供 应 链 更 加 透 明 公 开 这方 面 很 有 前 途 ，  

但 是 在 技 术 、 监 管 、 政 策 和 教 育 等 层 面 上 依 然 存 在 障 碍 与 风 险 。 为 了 将 区 块 链 、

模糊逻辑和 物联 网 技术等较为新颖 的 技术应用

到食品保质

期 管 理方面 ，

并且构 建  

一个可用 的 系 统 ，

＃ 进 行 Ｔｓａｎ

４ ］

了

研

究

并最终提

出

了

一

种基于

区

块链和

物联

网

的

食 品 追溯 系 统 。  

近年来 ，

区块链技术在 国 内 逐渐受到关注并开始兴起 ，

许 多 高 校和 企业 也 都  

开始对区块链技术进行研究 。

禹

忠

等

人

［

１

５
：＞

设

计

并

开

发

了

基

于

区

块

链

的

医

药

品

溯  

源 系 统 来进 行 药 品 的 防 伪 。 董 云 峰 利 用 区 块 链 技 术 来进 行 粮 油 食 品 追 溯 模 型  

２

第一章 绪论



  

的 构 建 ， 有 力 地 保 障 了 所 追 溯 到 的 信 息 的 准 确 性 以 及 所存 储 数 据 的 可 靠 性 。 陶 启

等人 １ ［

使 ７ ］

用

区

块链技

术来存

储大米产

业链

中

的

质

量

信

息

，

对 食 品 质 量 和 食 品 安  

全进 行 了 管 制 。 与 此 同 时 ， 国 内 的 众 多 大 型 公 司 如 阿 里 、 腾 讯 等 也 将 区 块 链 技 术  

应 用 到 溯 源 方 面 进 行 食 品 和 商 品 的 防 伪 等 ， 如 天 猫 国 际 使 用 了 区 块 链 来进 行 进 口  

商 品 的 防 伪 和 溯 源 。  

１ ．２ ３ ． 国 内外研究现状小结  

通过 对传 统 溯 源 和 区 块 链溯 源 的 研 究 ， 可 以 发 现 目 前 存 在 的 问 题 主 要 有 ： 传  

统溯源是 中 心化的 ，

存在一定风险 ；

基 于 区 块 链 的 溯 源 系 统 页 面 大 多 比 较 简 单 ，  

结 果 展 示基本基 于 表 单 ，

不够直观 ；

链上主要存储一些 固 定的简单信息 ，

无 法 满  

足 存 储 图 片 、 附 件 等 文 件 的 需 求 。 本 文 针 对 目 前 存 在 的 系 一 列 问 题 进 行 了 研 宄 并  

设 计 方 案 来 进 行 解 决 。  

１ ．３ 主麵究 内容及创 新点  

３ １ ．

１ ．

主要研究 内容

针 对 农 副 产 品 溯 源 的 去 中 心 化 解 决 方 案 ， 本 文 重 点 围 绕 基 于 区 块 链 平 台 以 太  

坊 的 产 品 溯 源 问 题和 展 示 效 果 更 加 直 观 的 溯 源 系 统 的 设 计 与 实 现 进 行 展 开 ， 研 宄

内 容 主 要 分 为 以 下 三 个 部 分 ：  

１ ． 基 于 ＰｏＡ 共 识 的 权威 节 点 动 态 选 择 算 法 的 研 究 与 实 现 ： 研 宄 现 有 的 几 种  

共 识 算 法 以 及 以 太 坊 使 用 的 两 种 共 识 算 法 ｅｔｈａｓｈ 和 ｃｌｉｑｕｅ ， 重 点 研 究 更 加 适 合 私   链 的 基 于 权 威 证 明 的 ｃｌ ｉｑｕｅ 算 法 ， 并 结 合 ｃｌｉ ｑｕｅ 的 主 要 思 想 设 计 了 权 威 节 点 动 态   选 择 算 法 实 现 共 识 算 法 的 改 进 使 其 更 加 满 足 系 统 的 需 求 。  

２ ． 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 需 求 分 析 与 总 体 设 计 ： 对 系 统 的 用 例  

以 及 通 过 区 块 链溯 源 时 的 需 求进 行 分 析 ， 在 此 基础 上 完 成 系 统 整 体 架 构 和 功 能 模  

块 的 设计 。

借助对智 能合约 函 数的调用 来设计 区块链溯源的流程 ，

借 并 助 Ｉ Ｐ Ｆ Ｓ  

来 满 足 大 文 件 链 上 存 储 的 需 求 按 照 数据 类 型 的 不 同 完 成 溯 源 数 据 的 页 面 展 示 设   ，

计 ，

并 通 过 对 数 据 库 的 设 计 来 满 足 对 非 去 中 心 化 数 据 的 存 储 需 求 。  

３ ． 基 于 区 块链 的 农 副 产 品 溯 源 系 统 的 具 体 设 计 与 实 现 ： 设 计 并 实 现 能 与 以

太 坊 进 行 交 互 的 区 块 链 农 副 产 品 溯 源 系 统 ， 实 现 对溯 源 信 息 的 上 传 ， 使 用 ｓｏｌ ｉ ｄｉｔｙ  

语言进行智 能合约 的编写 ，

完成溯源信息 的上链存储 。

通 过 ｔｒｕｆ ｌｅ 框 架 实 现 合 约  

的 部 署 并 通 过 ｗｅｂ３ 提 供 的 ａｐｉ 和 ｔｒｕｆ ｌｅ 获 取 的 合 约 实 例 实 现 系 统 与 以 太 坊 的 交  

互 。 并 结 合 ｗｅｂ ｇｉ ｓ 和 ｅ ｃｈａｒｔｓ 对 溯 源 查 询 的 结 果 进 行 直 观 的 展 示 。  

３

北京 邮 电大学工程硕士学位论文



  

１ ．３ ２ ． 论文创 新点  

１ ． 基 于 区 块链 的 溯 源解 决 方 案 设 计  

鉴 于 传 统 溯 源 方 式 下 中 心 化 数 据 管 理 会 有 数 据 被 篡 改 的 风 险 以 及 用 户 与 机  

构存在 的互信

题 问

，

本研究课题使用

区块链 的去

中 心 化 特 点 和 安 全 性 来 解 决 此 问

题 。 选 择 以 太 坊 作 为 区 块 链 的 平 台 来 搭 建 联 盟 链 ， 并 通 过 智 能 合 约 来 进 行 产 品 信

息 溯 源 ， 使 得 溯 源 过 程 透 明 ， 溯 源 信 息 安 全 可 靠 。  

２ ．

根据具体需求改进共识 算法，

提 高 系 统 效率  

在 以 太坊 提 供 的 基 于 Ｐ 〇Ａ 的 共 识 算 法 Ｃｌｉ ｑｕｅ 的 基 础 上 ， 使 得 消 费 者 这 一 角 色 不 参 与 共 识 过 程 从 而 确 保 节 点 的 权威 性 ， 同 时 对 己 授 权 的 节 点 成 员 进 行 动 态 的

增 加 和 删 除 ， 确 保拥 有 出 块 权 力 的 授 权节 点 不 仅 是 具 有 权 威 的 商 家 ， 同 时 保 证 这  

些 节 点 是 经 常 在 线 并 且 保 持 活 跃 的 ， 从 而 确 保 出 块 的 速度 和 效 率 不 受 影 响 ， 使 得  

系 统 保 持 稳 定 。  

３ ．

对 溯 源 结 果 的 可 视 化 直 观 展 示 和 大 文 件 的 上链 的 解 决方案  

系 统可根据用 户 角 色 的不 同进行权限管理和 页 面定制 ，

根据生产商 、

零 售 商

等不 同 的 角 色的 需要进行不 同 的页面展示和信息录入 ；

使 用 ｗｅｂｇｉ ｓ 将 溯 源 的 每  

个 中 间 过程 直 接 展 示 在 地 图 上 并 结 合 ｅｃｈａｒｔｓ 对 结 果 进 行 分 析 ， 使 得 信 息 简 洁 易

读 ， 也 使 得 产 品 整 个 运 输 经 销 过 程更 加 清 晰 ， 提 升 用 户 体验 和 系 统 友好程 度 。 借  

助

ＩＰＦ Ｓ

使链上只 存储哈希值 ，

减 少 区 块 链 冗 余 从 而 解 决 大 文 件 的 链 上 存 储 问 题 。  

１ ． ４ 硕 士在 读期 间 主要工作  

本 人 在 攻 读 硕 士 期 间 对 区 块 链 的 相 关 原 理 与 其技 术 应 用 进 行 了 充 分 的 学 习

和研究 ，

为本文的工作打下 了基础 ；

同时积极认真参与项 目 实践与开发，

为 论 文  

中 完 成 系 统 的 编 码 实 现 并 进 行 优化 提 供 了 很 大 帮 助 同 时 实 现 系 统 的 落 地 应 用 并   ；

取 得 软 件 著 作 权 。 参 与 的 主 要 工 作 包括 ：  

１．

完成溯源系统的设计与开发 ：

完成系统 的设计工作 ，

包 括 整 体 架 构 设 计 、

功 能 模块 设 计 ， 以 及 智 能 合 约 的 结 构 设 计 和 逻 辑 设 计 ， 完 成 系 统 、 ＩＰＦ Ｓ 与 以 太 坊  

的 交互设计 ，

完成系 统的 界面展示设计 。

完成系统 的 代码开 发工作 ，

在 前 端 使 用

框 架 和 完 成 代 编 使 使 得 面 更 ｖｕｅ ｊ ． ｓ

Ｕ ｅ ｌｅ ｍ ｅｎｔ Ｉ

码写 ，

用 和 ｗｅｂｇｉ ｓ

ｅｃｈａｒｔｓ

页

加 直  

观 ；

后端使用

ｓｐｒ ｉｎｇ ｂｏ ｏｔ

框架和

ｍｙ ｓ ｑｌ

数据库实现 中 心化 的功 能逻辑和数据存储 ；  

使 完 能 合 编 用 ｓｏｌｉ ｄｉｔｙ

成智

约的

写 。  

２ ．

完 成基 于 ＰｏＡ 共 识 的 权威节 点 动 态选择算法 ：

设 计 并 实 现 算法 的 编 码 ，

实 现 权 威 节 点 的 动 态 选 择 和 改 变 ， 改 进 ｃｌｉｑｕｅ 算 法 中 原 有 的 缺 陷 ， 确 保 系 统 出 块   稳 定 。  

４

第一章 绪论



  

３ ． 将 系 统 应 用 至 实 验 室 的 智 慧 社 区 项 目 中 ： 将 系 统 应 用 至 润 泽 远 成 智 慧 社  

区 项 目 中 ， 在 社 区 帮 购 和 社 区 电 商 环 节 为 社 区 中 的 农 副 产 品 提供基 于 区 块链 的 可  

信溯源 ，

从而确保食品 安全 ，

实 现 项 目 的 实 际 落地 。  

４ ． 发 表软 件 著 作 权 并 获 得 登 记 证 书 ： 依 据 该 论 文 研 究 内 容 ， 发 表 软 件 著 作 权  

《 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 》 并 为 学 生 一 作 ， 登 记 号 Ｒ ２ ０ ２ １ Ｓ １ ５ ７６ ８ ６ １ ， 并  

己 经 获 得 国 家 版 权 局 颁 布 的 证 书 ， 证 书 号 ： 软 著 登 字 第 ８ ２９ ９４ ８ ７ 号

５ ． 参 与 研 宄 生 创 新 创 业 项 目 ： 以 《 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 》 为 题 ，  

作 为 项 目 主 要 负 责 人 申 请 并 参 与 研 究 生 创 新 创 业 Ａ 级 项 目 。  

１ ． ５ 论文组织＿  

本文总共有六章 ，

容 要 主

内

如 下 ：  

第 章 一 ，

绪论 。

主要介绍本文的选题背景及研究意义 ，

本 文对 传 统 溯 源和 区

块 链溯 源 的 国 内 外 研 究 现 状 进 行 了 分 析 并 进 行 了 对 比 ， 阐 述本 文 的 主 要 研 宄 内 容  

及 创 新 点 ， 最 后 ， 对 硕 士 在 读 期 间 的 主 要 工 作 和 本 文 的 组 织 架 构 进 行 介 绍 。  

第 二 章 ， 相 关 理 论 与 技 术 研 究 。 介 绍 区 块 链和 以 太 坊 的 相 关 技 术 ， 包 括 区 块  

链 的 基 本 原 理 与 相 关 技 术 以 太 坊 与 智 能 合 约 的 原 理 等 对 星 际 文 件 系 统 ＩＰＦ Ｓ  

；

；

的 原 理 研 究 以 及 交 互 方 法 进 行 研 究 。  

第 三 章 ， 基 于 ＰｏＡ 共 识 的 权 威 节 点 动 态 选 择 算 法 的 研 究 与 实 现 。 本 章 首 先  

简 要 介 绍 了 常 见 的 共 识 算 法 ， 接着 对 以 太 坊 所 使 用 的 共 识 算 法 ｃｌｉ ｑｕｅ 的 原 理 进 行  

了 研 究 ， 并 在 此 基 础 上 提 出 了 权 威 节 点 动 态 选 择 算 法 ， 其 与 ｃｌｉｑｕｅ 相 互 配 合 完 成  

共识算法的 改进 ；

最后对算法 的 效果进行测试与验证 ，

证 明 了 其 对 出 块 稳 定 性有  

提 升 明 显

。  

第 四 章 ， 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 需 求 分 析 与 总 体 设 计 。 本 章 主 要  

介 绍 了 系 统 的 需 求 分 析 与 总 体 设 计 ， 包 括 与 区 块 链 相 关 的 溯 源 实 现 方 案 的 需 求 与  

设 计 以 及 系 统 整 体 架 构 设 计 等 的 系 统 功 能 设 计 。  

第 五 章 ， 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 详 细 设 计 与 实 现 。 本 章 介 绍 了 系  

统 的 具 体实现 ，

包括智 能合约 以及系 统各个功能模块 的详细设计与实现 ，

同 时 对  

系 统 的 最 终 效 果 进 行 了 展 示 并 进 行 了 测 试 评 估 。  

第 六 章 ， 总 结 与 展 望 。 对 本 文 的 研 究 内 容 进 行 总 结 与 归 纳 ， 分 析 工 作 的 不 足  

之处 ，

并 在 此 基 础 上 提 出 可 能 的 改 进 措 施 来 进 行 优 化 。  

５

北京 邮 电大学工程硕士学位论文



  

１ ．６ 本章 小 结  

本 章 首 先 介 绍 了 本 文 的 选 题 背 景 与 选题 意 义 ， 接着 从 传 统 溯 源 的 发 展现状 和   区 块 链 溯 源 的 发 展 现 状 出 发 ， 分 析 了 食 品 溯 源 在 国 内 外 的 研 究 现 状 并 总 结 出 其 中   存 在 的 中 心 化 以 及 功 能 页 面 单 一 等 问 题 ， 在 此 问 题 的 基础 上 提 出 解 决 方 案 并 展 开   研 宄 。

６

第二章 相 关理论与技术研宄



  

第 二 章 相 关 理 论 与 技 术 研 究  

本 章 对 溯 源 系 统 中 所 涉 及 到 的 区 块 链 的 相 关 技 术 及 其 原 理 进 行 介 绍 ， 在 区 块  

链 的 众 多 平 台 中 选 择 了 支 持 智 能 合 约 的 以 太 坊 ， 并 对 以 太 坊 和 智 能 合 约 进 行 了 研  

究与介绍 ，

最 后 对 星 际 文 件 系 统 进 行 研 究 使 其 作 为 大 文 件 上 链 存 储 的 支 撑 。  

２ ． １ 区块链原 理 及 相 关 技 术 研究  

区 块 链 作 为 一 个 信 息 技 术 领 域 的 术 语 ， 其 本 质 就 是 一 个 支 持 所 有 人 共 享 的 分  

布 式 数 据 库 。 与 普 通 数 据 库 不 同 的 是 ， 区 块 链 中 保 存 的 数 据 或 信 息 可 以 防 伪 ， 同

时也是透明 公开的 ，

因 此 这 些 信 息 都 是 可 追 溯 的 。 这 些 特 性 使 得 区 块 链 可 以 更 好  

地在用 户 之间建立互信 ，

增强用 户 间 的信任。

区 块 链 能 够 很 好 地 解 决 信 息 的 不 对  

称 问 题，

实现多个用 户 节点之 间 的行动一致性并建立 良好的信 任关系 ，

在 许 多 领  

域都具有广 阔 的运用 前景 。

区块链技术所具有 的

去 化 “

中心

” 、

“ 不可篡改 ”

等 特  

性 ，

为 溯 源 问 题 提 供 了 天 然 的 解 决 方 案 。

自 ２ ０ ０ ８ 年 区 块 链 横 空 出 世 至 今 ， 区 块 链 的 主 要 发 展 时 期 为 两 个 ， 以 比 特 币  

为代表 的数字货 币

０ １ ．

时期到 以 以 太坊为代表 的 智 能合约

２ ０ 时期

．

；

块 链 区

３ ０  

．

目 前 正 在 发 展 中 ， 包 括 稳 定 币 ｍ ａｋｅｒ ｄ ａｏ 、 各 种 联 盟 链 ， 其 主 要 与 物 联 网 相 结 合 。  

相 较 主 要 用 于 交 易 的 比 特 币 ， 以 太 坊 对 智 能 合 约 的 支 持 提 供 了 二 次 开 发 的 可 能 ，

使 得 其 有 了 更 好 的 拓 展 性 。 以 上 所 介 绍 的 区 块 链 主 要 概 念 的 示 意 图 如 下 图 ２ １ － 所  

／ Ｎ  〇 Ｊ

  广  響 特 丨

点

一

不―

 ＂ 分 类 一 ！

｜

彳

．

｜

区块

：

 可 追 潔

 ｍｍ   

…

Ｉ

的 共 報 ＿

ｊ

｜  

Ｉ

ｒ ＊ ＊

－ ＿ ＿ ■ ■ ■

■＿

？

 公 开 透 明 ！  

｜

 集体维护
Ｉ



Ｉ

丨

丨

—…

…

「发展阶段

１  

   Ｉ





 — 

  ＜

士  

ｉ

；

区 块 链  区 块 链  区 块 链 ０ １ ．

２．０

  ３ ． ０

＊ Ｉ







 ｎ ｝

级像  ！
匕 多

  ｜

ｗ？ Ｍ ｃ 

二

：

一

 ｗ  ｗｔ ｌ ｔ Ｓ ？ ａ ｊ 一  

Ｏ４＃ ｈｎ  ， 一

ｌ

岭 Ｕ ＇

、１

；


ｉ

 入  ｉ
ｓ Ｉ

Ｉ  

  Ｊ ａｍ
！

Ｓ ｆ ｔ ｒ

。

 Ｊ

下

Ｔ呈  

｜

超 级 羝     

本

 … …

－

ｊ

图 ２－ １

区 块 链 主 要 概 念 示 意 图

７

北京 邮 电大学工程硕士学位论文



  

为 了 确 保 数 据 安 全 ， 区 块 链 中 使 用 到 了 许 多 密 码 学 知 识 ， 其 中 最 主 要 的 就 是  

非 对 称 加 密 技 术 与 数 字 签 名 技 术 。 非 对 称 加 密 技 术 的 密 钥 不 是 一 个 而 是 一 对 ： 公  

钥和私钥 。 私钥类似于密码 ，

由 一方用 户

自 行进行安全保管，

不 泄 露给 他 人使 用 ；  

而 公 钥 则 是 公 开 的 ， 想 要 使 用 的 人 发 送 请 求 即 可 获 得 。 为 了 确 保 区 块 链 用 户 在 进  

行 交 易 过 后 不 对 自 己 的 操 作 进 行 抵 赖 ， 区 块 链 使 用 了 数 字 签 名 技 术 。 数 字 签 名 即  

用 户 基 于 交 易 的 内 容 来 进 行 签 名 并 发 送 出 去 ， 其 可 以 用 来 表 明 交 易 确 实 由 本 人 发

起 并 对 内 容 确 认 无 误 ， 接 收 方 使 用 公 钥 来 对 数 字 签 名 进 行 验 证 从 而 确 保 该 交 易 确

实出

发 送 方 之 手 自

１８

［

］

。

在 区 块链 网络 中 的数字签名 与交 易 内 容有关ｆＭ ，

不 同 的 交  

易 内 容 对 同 一 私 钥 也 会 有 不 同 的 签 名 结 果 ， 这 就 避 免 了 恶 意 用 户 对 数 字 签 名 进 行

复 制 从 而 伪 造 身 份 。 例 如 在 区 块 链 比 特 币 的 交 易 中 ， 每 个 一 比 特 币 的 来 源 都 是 由  

一系 列 交 易 所 串 联起来 的

因 此 该 交 易 的 签 名 和 与 其 相 关 联 的 所 有 交 易 有 关 ，

从 理 论 上 来 防 止 篡 改 交 易 。

块 使 来 存 其 区

链

用 Ｍ Ｔ ｅ ｒｋｌ ｅ  ｒ ｅ ｅ

进 行 数 据 储 验 与

证 ，

Ｍ Ｔ ｋ ｅ ｒ

ｅ ｌ



ｒｅｅ

本 质 是 一 种  

哈希树 ，

它是一种 由 梅夫 瑞克尔在 ．

１ ９７９

年首次提 出 的一种数据结构Ｐ１］ ，

其 具 体  

数 据 结 构 如 图 ２ １ － 所 示 。 其 最 底 层 的 数 据 存 储 形 式 为 一 个 个 小 的 数 据 块 ， 每 块 都  

有属 于

自

己 的 哈 希值 ，

Ｍ Ｔ ｅ ｒ ｋ ｌ ｅ  ｒ ｅ ｅ

中 将 每 两 个 相 邻 的 数 据 块 的 哈 希 值 合 并 再 次

计 算 个 新 哈 希 值 一

的

２２

［

］

，

以 此类推直到计算到最顶层 的树根 ，

这 个 树 根 即 为  

Ｍ Ｒ ｅ ｒｋｌ ｅ 

ｏ ｏ ｔ 。  

Ｔ ｏ ｐ  Ｈ ａ ｓ ｈ

  ｈ ａ ｓ ｈ  （

， ）  

 Ｈ ａ ｓ ｈ  ０

Ｈ ａ ｓ ｈ  １  

Ｈ 伽  ｉ

０ －

Ｈ ａ ｈ Ｃ ｓ

Ｊ－

＊

．

      ｈ ａ ｓ ｈ （

－

）

  ｈ ａ ｓ ｈ （

＋ ）

Ｍ    Ｈ ａ ｓ ｈ  Ｃ

）

Ｈａｓ

０ ｈ 

－

１

Ｎ ａ ｓ ｈ１ ０

Ｈ ａ ｓ ｈ  １ － １  

 

； ；

      ｖ  －

、＂

１

輪



；

｜

；

ｊ

｜

｜

ｊ

            ｈ ａ ｓ ｈ （

ＬＩ

）

 ｈ ａ ｓ ｈ （

２ １

）

ｈ ａ ｓｈ（

Ｌ３

）

ｈａ ｓ ｈ（

Ｌ４

）  

   ｉ

  Ｌ Ｉ

 Ｌ ２

Ｌ３

Ｌ４

Ｄ ａｔ ３
｜


１

Ｂ ｏ  ｌ

ｃ ｋｓ

：  

数 据 构 示 意 图 Ｍ Ｔ ２ － ２

ｅ ｒｋ ｌ ｅ ｒ ｅ ｅ

结

图

如 图 ２ ＿ ２ 所 示 是 区 块 链 数 据 结 构 示 意 图 ， 区 块 链 整 体 的 数 据 结 构 可 以 看 做 是  

一个首尾相连 的链表 ，

以 比特 币 的数据结构为例 ，

每 一 个 区 块 主 要 分 为 区 块 头 和

８

第 二章 相 关理论与 技术研 宄



  

区块体两 个部分 ，

区块体中 存储 了 所包含交 易 的详细数据 ，

而 区 块 头 中 主 要 存 储  

一些摘要数据 。 在 区块头 中 有几个重要 的部 分 ：

随 机 数 及   Ｍ Ｒ 以 ｎ ｏ ｎｃ ｅ 、

ｅ

ｋ ｒ

ｌ

ｅ

ｏｏｔ

前 一 个 区 块 的 哈 希 值 。 不 同 于 一 般 的 链 表 数 据 结 构 ， 区 块 链 这 条 链 表 中 的 “ 指 针 ”  

存储 的 不是地址而是前一个 区块 的 哈希值 ，

由 于 整 个 区 块 链 通 过 哈 希 值 进 行 连接  

２３

［

］

，

因此只 要更 改其 中 一个区块的信息 ，

其之后 的每个区块都需要进行更改 ，

这  

种特性保证 了 区块链 的不可篡改性 。

称 数 字 用 户 基 于 非 对

加 密 的 ２ ４

［

］

签名 技术 ２５

［

］

实现对 区块链 中 交 易 的签署 与验证 ，

这 些 交 被 组 织 并 存 储 在 易

Ｍ ｋ Ｔ ＊ ２ ６

ｅｒ

ｅ ｌ



ｒｅｅ ［

］

。

如 下 图 所 示 ， 当 任 何 一 个 交 易 被 更 改 后 ， 其 所 在 的 Ｍ Ｔ ｅｒｋｌ ｅ ｒｅ ｅ 上 包 含 该 交 易 的

路 径 上 的 所 有 节 点 哈 希 值 都 将 发 生 更 改 ， 从 而 导 致 链 上 当 前 区 块 后 的 所 有 区 块 哈  

希 值 都 将 发 生 更 动 ， 因 此 理 论 上 保 证 了 数 据 的 不 可 篡 改 。  

５

   区块头 区 块 祕

区 块 头  

｜

＿ 

个 区 块 辁 ＃  降 鉍  二 一



？１

－

ｎ

－ ｃ

ｎ

＆

＾ ＂ — ？ 

ｊ

区 决 ＃  数 上 Ｓ 块 上 一 个

哈

；


 ｒ ｍ ｆ ？



—

个 一

ｊ

今

 ；

     Ｍ ｅｒ ｋ ｌ ｅ  Ｒ ｏ ｏ ｔ

Ｍ ｅｒ ｋｉ ｅ  Ｒ ｏ ｏｔ
｜

ｊ

ｊ

Ｍ  ｅ ｆ ｋ ｌ ｅ  Ｒ ｏ ｏ ｔ 丨

—
「

一—

：

＼  

  ｅ ｅ ｆ ｙ ｆ

ｅ Ｔ ｋ ｒ

ｌ



ｒ

ｅ

ｉ

，

一

妄  

Ｈ ｈ ；

ａｓ

２ ４  ２

３

 ；  

    ｓ

Ｈａ ｓ ｈ １ ２

：

Ｈ ａ ｓｈ３ ４

；  

：



；

；

     Ｈ ａ ｓ ｈ  １

Ｈ ａｓ ｈ ２

Ｈａ ｓ ｈ３

ｉ

Ｈ ａｓｈ４

；  

丫 丫 工 Ｔ

ｉ  

交 易 ｌ  交 易 ２  交 易 ３  交 羃 ａ  

图 ２ ３ － 区 块 链 数 据 结 构 示 意 图

交 易 在 发 布 后 会 被 负 责 出 块 的 节 点 即 矿 工 打 包 成 区 块 并 链 接 在 最 长 合 法 链  

上 ，

整 个 区 块 链 网 络 中 的 共 识 就 是 通 过 这 种 方 式 达 成 的 。  

区 块 链 主 要 分 为 公 有 链 、 联 盟 链 和 私 有 链 三 大 类 ［ ２ ７ ］ 。 所 有 节 点 都 可 以 接 入 公  

有 链 并 对 区 块 链 进 行 维 护 公 链 数 据 量 较 为 庞 大 如 以 太 坊 的 主 网 络 而 私 有 链  

，

，

；

即 个人搭建的独享 的 区 块链 网络 ，

它不对其他节点 公开 ，

只 为特定 的节点独有 ；  

联 盟 链 即 为 拥 有 固 定 成 员 的 获 得 许 可 后 才 可 接 入 的 区 块 链 网 络 ， 联 盟 链 其 实 也 是  

一 种 私 有 链 。 在 区 块 链 网 络 中 接 入 的 节 点 主 要 分 为 两 大 类 ： 全 节 点 和 轻 节 点 。 全  

节 点会下载并维护整条区块链 的全部 区块信息 ，

因 此 对 节 点 用 户 具 有 较 高 的 硬 件  

资 源 和 算 力 要 求 全 节 点 可 以 参 与 出 块 竞 争 并 打 包 区 块 获 得 出 块 奖 励 轻 节 点 只

，

；

需要维护 区块头信 息 ，

因 此处理 的数据量较小 比较轻量级 ，

但 与 此 同 时 也 意 味 着  

轻 节 点 只 能 进 行 一 些 发 布 和 验 证 交 易 等 简 单 的 操 作 ， 无 法 进 行 出 块 。  

９

北京邮 电大学工程硕士学位论文



  

２ ． ２ 以 太 坊 与 智 能 合 约 相 关 技 术 研 究  

坊   以 太 ２ ２ ．

．１

太 坊 个 开 源 以

是 ２ ８

［

］

一

的

公共

区 块链平

台

，

它

不

仅

可

编

程

２９

［

］

而

且

具

有

区

块

链  

知晓、

价

值

知

晓和

图

灵完

备 ３ ［

（） ］

等特

点

。

以 太 坊 相 当 于 加 密 货 币 和 智 能 合 约 语 言 虚  

拟 机 的 结 合 体 。 以 太 坊 使 用 的 加 密 货 币 是 以 太 币 Ｅｔｈｅ ｒ 。 以 太 坊 具 有 智 能 合 约 功

能 ，

其可 以 通过 以 太坊虚拟 机 ＥＶＭ 来支 持 智 能合 约 的 运行 ，

这 都 使 得 其 相 比 比

特 币 脚本而 言功 能更加 强大和健全 。 和其他 区块链网络相 同 ，

以 太 坊 也 是 点 对 点

的 。 如 图 ２ － ４ 为 以 上 所 介 绍 的 以 太 坊 特 性 图 。  

开 源  

公 共 区 块 链 平 台

ｆ顯 智 能 合 约 功 能

太 坊 虚 娜 以

Ｖ Ｖ ｌ Ｅ

ｆ

Ｉ

以 太 坊 ＿

Ｉ

以 太 币

占 Ｍ 占  

图 ２ － ４ 以 太 坊 特 性 图

以太坊 区块链本质 上是一个状态机 ，

交易可

以 作 为输入来对

以 太 坊 状 态 机 进  

行驱动 ３ １

［

］

。

如 图 ２ ５ － 所 示 为 以 太 坊 状 态 转 换 示 意 图 ，

交 易 的 执 行 会 使 得 以 太 坊 从

初 始 状 态 不 断 转 变 到 不 同 的 最 终 状 态 ， 每 一 次 交 易 执 行 完 毕 时 以 太 坊 的 现 状 都 可  

以 将 其 视 作 一 种 最 终 状 态 。 以 太 坊 的 众 多 交 易 被 包 含 在 不 同 的 区 块 中 这 些 区 块   ，

首 尾 相 连 串 联 在 一 起 。  

 ＿ ？    ？

 ｔ ｒ ａ ｎ ｓ ａ ｃ ｔ ｉ ｏ ｎ

 ｔ ｒ ａ ｎ ｓ ａ ｃ ｔ ｉ ｏ ｎ

… …  

图 ２ ５ － 以 太 坊 状 态 转 换 示 意 图

与 比特 币 中 使用 ＵＴＸＯ 来标记每个 比特 币 的 使用 情况不 同 ，

以 太 坊 中 使 用

的 是 对 于 用 户 更 易 接 受 和 理 解 的 账 户 来 记 录 以 太 币 的 消 费 情 况 。 以 太 坊 的 状 态 是  

所有节 点共享的 ，

由许多账户 组成 ，

它 们 能 够 通 过 一 个 消 息 传 递 框 架 相 互 通 信 。  

每 个 帐 户 都 有 属 于 自 己 的 状 态 和 长 度 为 ２ ０ 字 节 的 账 户 地 址 。

以 太坊有两种 账户 类型 ：  

？ 外部帐户 ：

是用 户 自 主创建的 ，

使 用 密 钥 来 对 其 进 行 管 理 。

１ ０

第 二 章 相 关理论与 技术研宄



  

？ 合 约 账 户 ： 即 为 合 约 账 户 ， 包 含 合 约 代 码 ， 由 代 码 来 进 行 驱 动 。  

以太坊 中 依然使用

来 存 储 要 信 ＭｅｒｋｌｅＴｒｅｅ

主

息

，

主要有三种树 ：

状态 树 、  

交 易 树 和 收 据 树 。 状 态 树 主 要 存 储 包 括 账 户 余 额 等 在 内 的 账 户 状 态 信 息 ； 交 易 树  

中 存 储 了 区 块链 中 的 交 易 列 表 收 据 树 存 储 交 易 完 成 后 生 成 的 与 交 易 内 容 相 关 的 ；

收 据 ， 收 据 树 上 的 节 点 与 交 易 树 上 的 一 一 对 应 。  

在

以

太

坊

中

每

进

行

一

笔

交

易

都

需

要

支

付

费

用

ｆｅ ｅ
（

ｓ

）

，

费 用 主 要 通 过 ｇａｓ 来 支  

付。

每 笔 交 都 有 被 发 方 设 置 和 一

易

送

的 ｍ ｇ ａ ｓ  ｌ ｉ

ｉｔ

ｇ ａｓ ｐｒｉ ｃ ｅ ，

其 表 示 发 送 方 想 要 为  

交 易 的 执 行 所花 费 的 以 太 币 数 额 。 当 账 户 余 额 充 足 时 交 易 可 以 被 顺 利 执 行 费 用 将  

会被扣除 ；

如果余额不足时交 易将会失败 同 时会进行事务 的 回 滚操作 ，

但 是 已 经  

支 付 的 费 用 并 不 会 被退 回 。  

２． ２ ． ２ 智 能合约

以 太 坊 智 能 合 约 ［３ ２］ 是 运 行 在 ＥＶＭ 中 的 一 段 被 部 署 在 以 太 坊 上 的 程 序 ， 程 序  

按 照 代 码 编 写 的 逻 辑和 规 则 运 行 在 以 太 坊 中 ， 其 和 其 他 高 级 语 言 所 编 写 的 代码 运  

行 情 类 似 的 况

３３

［

］

。

以 太坊 使 用 ｓｏｌｉ ｄｉｔｙ 语 言 来进 行 智 能 合 约 的 编 写 ，

和 其他 高 级  

语 言 样 一 ，

也 是 灵 完 备 ｓ ｏ ｌ ｉ ｄｉｔｙ

图

的 ，

用 户 通 过 发 起对 合 约 账 户 的 交 易 实 现对 合  

约 数 调 函

的

用 ３４

［

］

。

智 能 合 约 旦 一 部 署 会 生 成 一 个 合 约 账 户 ，

其 中 主 要 存 储此 时 运  

行 的 状 态 ， 主 要 包 括 账 户 余 额 、 交 易 次 数 、 合约 源 代 码 、 合 约 执 行 过程 中 存 储 的  

数 据 等 。  

当 其 他 用 户 创 建 的 外 部 账 户 想 要 发 起 对 智 能 合 约 的 调 用 时 ， 需 要 进 行 以 下 几  

个 步 骤 ： 首 先 要 发 起 一 笔 向 被 调 用 的 智 能 合 约 账 户 发 起 转 账 的 交 易 。 当 被 调 用 的

函 数 被 ｐａｙ ａｂｌ ｅ 关 键 字 修 饰 时 则 该 合 约 可 以 进 行 转 账 交 易 ， 在 ｖａｌｕｅ 域 中 填 入 转   账 金 额 。 Ｄ ａｔａ 域 中 需 要 填 写 被 调 用 的 函 数 名 和 参 数 ， 之 后 发 布 这 个 交 易 。 矿 工 在  

接 收 到 这 个 交 易 后 执 行 这 个 交 易 进 行 验 证 ， 验 证 无 误 则 交 易 被 打 包 到 区 块 中 并 被  

发 布 到 区 块链 网 络 中 。 合 约 想 要 彼 此 调 用 主 要 通 过 以 下 两 种 方 式 ： 获 取 想 要 调 用

的 合约 实例 后直接对 函 数进行调 用 和 借助

ａｄ ｄｒｅ ｓ ｓ

类型 的

函 数 〇 Ｃａｌｌ

。

以 太 坊 中 的

交 易 执 行操 作 是 原 子 的 ， 要 么 全 部 执 行 成 功 转 账 完 成 ； 要 么 执 行 失 败 并 抛 出 异 常 ，

那 么 之 前 所 进 行 的 所 有 操 作 都 需 要 进 行 回 滚 ［３ ５］ 。  

智 能 合 约 对 接 收 到 的 信 息 进 行 反 应 ， 它 既 可 以 接 收 和 储 存 价 值 ， 也 可 以 向 外  

发 送 信 息 和 价 值 。 智 能 合 约 的 这种 特性 与 溯 源 系 统 的 需 求 相 吻 合 ， 将 溯 源 全 部 信  

息 发 送 并 存 储 在 智 能 合 约 中 ， 在 需 要 查 询 时 读 取 出 来 进 行 展 示 ， 就 可 以 实 现 基 于  

区 块 链 的 溯 源 。 然 而 令 用 户 直 接操 作 以 太 坊 客 户 端 显 然 是 不 现 实 的 ， 因 此溯 源 信  

息 不 仅 需 要 在 链 上 进 行 存 储 ， 同 时 需 要 建 立 系 统 与 以 太 坊 的 连 接 来 对 数 据 进 行 操  

代 作 及 框 架 可 实 现 以 。 ｗｅｂ ３ ． ｓ ｊ

ｔｒｕｆ ｌ ｅ

以

ｊｓ

码与 以太坊 的交互 ，

避 免 了 直 接 与 以

１ １  

北京邮 电大学工程硕士学位论文



  

太 坊 客 户 端 交 互 的 繁 琐 和 不 现 实 性 。  

２ ． ３ 星 际文 件 系 统 ＩＰ Ｆ Ｓ 的 原 理及 相 关 技 术 研 究

全 称 为 星 际 文 件 系 统 它 是 个 对 等 分  Ｉ Ｐ Ｆ Ｓ （ Ｉ ｎｔｅ ｒｐ ｌ ａｎ ｅｔａｒｙ Ｆ ｉ ｌ ｅＳ ｙ ｓｔ ｅｍ ）

一 ，

的

布

式

文

件

系

统

３
［

６

］

，

存 储 在 其 中 的 内 容 会 被 组 织 链 接 成 为 一 个 广 义 的 Ｍｅｒｋｌ ｅ 有 向

无 环 图 （ Ｄ Ａ Ｇ ） 。 Ｉ Ｐ Ｆ Ｓ 能 够 避 免 单 点 故 障 并 且 在 节 点 间 建 立 信 任 机 制 。 Ｉ Ｐ Ｆ Ｓ 使 用

哈 希 值来 进 行 文 件 表 示 ［３ ７］ ，

更 加 有 利 于 缓 存 。  

ＩＰ Ｆ Ｓ 主 要 由 ８ 个 元 素 组 成 ： 节 点 的 身 份 ＋ 节 点 相 互 连 接 的 网 络 ＋对 节 点 进 行  

定

位

的

路

由

＋

数

据

交

换 Ｍ ＋

ｅ ｒｋｌ

ｅ

有 向 无环 图 ＋版 本控 制 ＋命名 ＋ｗｅｂ

页面 ，

如 图 ２ － ６  

所 示 。  

丨 Ｐ Ｆ Ｓ 星 际 文 件 系 统  

Ａ ■
： ．
． ．

－  
／

飯 本 酬  命 名

 定 鎌 由

ｗｅ ｂ 页 面

  节 点 的 身 份

数据交换 研图

７  

节 点 网 络  



    

成 意 图 组 ２ － ６  Ｉ Ｐ Ｆ Ｓ

示

图

每个节 点 都拥有

自

己的

Ｄ ｎ ｏ ｄ ｅ ｌ

来进行 区分 ，

小于等于

１ ＫＢ

的 数 据 会 被 直 接  

存 储 并 获 得 一 个 Ｄ ｎｏ ｄ ｅ ｌ Ｉ Ｐ Ｆ Ｓ 会 把 较 大 的 数 据 拆 分 成 小 块 并 存 储 拥 有 这 些 块 的 ；

节 点 列 表 Ｄ ｎ ｏ ｄ ｅ ｌ

。  

由 于 Ｉ Ｐ Ｆ Ｓ 是 基 于 内 容 寻 址 的 ， 因 此 文 件 的 内 容 定 了 ， 其 地 址 即 访 问 路 径 也

就 确 定 了 。 这 不 同 于 一 般 的 文 件 系 统 。 由 于 Ｉ Ｐ Ｆ Ｓ 是 基 于 内 容 寻 址 的 ， 因 此 数 据  

只 要发生变动 ，

数据 的访 问 地址就将发生变化 ，

想 借 助 修 改 文 件 达 到 目 的 的 难 度  

就 大 大 増 加 了 。 因 此 Ｉ Ｐ Ｆ Ｓ 具 有 防 篡 改 的 天 然 优 势 。 接 入 Ｉ Ｐ Ｆ Ｓ 的 节 点 不 会 存 储 整

个网络中全部的信息 ，

各个节点按照

自

愿的原则来同步

自

己想要维护 的

内

容 ３８

［

］

，  

当 网 络 中 拥 有 足 够 多 数 量 的 节 点 时 就 可 以 实 现 对 整 个 网 络 内 容 的 完 整 备 份 。

ＩＰＦ Ｓ 会 为 每 个 存 储 在 其 中 的 文 件 计 算 一 个 哈 希 值 这 个 哈 希 值 的 计 算 主 要   ，

包 括 以 下 步 骤 ：  

算 法 要 使 哈 希 算 法 每 个 存 ＨＡ Ｈ １ ．

Ｓ

Ｈ 主 Ｓ

Ａ２ ２ －

５６ ：

用的

是 ＨＡ Ｓ

２－２５ ６ 。

入 Ｉ Ｐ Ｆ Ｓ  

１ ２

第二章 相 关理论与技术研究



  

网 络 的 文件都会有一个唯一 的 哈希

（ ＨＡＳＨ ）

值 ，

通过该值可 以确定文件 ，

进 而  

访 问 数据 。

只 要文件 内 容稍 微修改，

ＨＡＳＨ 就会变 化 。

使 Ｉ ＰＦ Ｓ

用 ＳＨＡ２ － ２ ５ ６ 将 任  

意 大 小 的 内 容 转 变 为 固 定 的 ３ ２ 个 字 节 。  

扩 求 来 实 态 选 择 算 ２ ．

展需

采 用 了 ｍ ｕｌｔｉｈａｓｈ ：  Ｉ ＰＦ Ｓ

 ｍｕｌ ｔｉｈａｓｈ

现动

ＨＡ ＳＨ 法  

的设计 。

虽然

目

前

ＨＡ Ｓ

２－２ ５ ６

算法安全性较高

，

但 不 能 保证 以 后 该 算 法 不会 被 破  

解 ；

因此为 了 后续可 以继续更换和 改进哈希算法，

采 来 作 为   ＩＰＦ Ｓ

用 了ｍｕｌｔｉｈａｓｈ

哈 希 表 示 方 法 ， 使 其 能 够 支 持 多 种 哈 希 算 法 。 ｍｕｌｔｉｈａｓｈ 是 一 个 包 含 了 三 个 部 分 的

字 符 串 ： 哈 希 算 法 编 码 、 哈 希 值 的 字 节 数 即 长 度 、 哈 希 值本 身 。  

３．

用 需 求 易

Ｂ ａｓ ｅ ５ ８ ：

经过 以 上计算后 得到 的 哈希值长度过长 ，

不 利 于 理解  

和 阅读，

所 以最好再压缩一下字符 串 的长度使其更加利于往后 的传播 。

此 因

ＩＰ Ｆ Ｓ  

在 经 过 了 前 两 轮 计 算 后 再 次 使 用 了Ｂ ａｓｅ ５ ８ 来 对 数据 进 行 压 缩 处 理 。 一 些 二 进 制  

字 符 串 可 以 借 助 Ｂ ａｓｅ６４ 来 转 换 成 为 可 读 性 更 高 的 字 符 串 ， 但 其 存 在 字 符 不 和 谐  

从而造成混淆 的 显著缺点 ，

因此，

种 字 符 诞 生 了 是 Ｂ ａｓｅ ５ ８

Ｂ 。

ａｓｅ ５ ８

一

二进制

串

编码 ，

其 原 理和 Ｂ ａｓｅ６４ 类 似 ，

可 以将输入转换为一个长度为 ５８ 的字符 串 ，

在 将  

二 进 制 字 符 串 转 换 为 可 读 字 符 的 同 时 进 行 了 对 有 干 扰 字 符 的 剔 除 。  

个 作 为 一

Ｐ２Ｐ

的星 际文件系 统 ，

任 何 想 要 加 入 网 络 的 用 户 都 可 以 在 本 地搭  

建 个 节 一

ＩＰＦ Ｓ

点，

在命令行 启 动节 点 服务器并实现文件的上传和获取 ；

Ｉ ＰＦ Ｓ 同

时 提 供 了 可 在 浏 览 器 查 看 的 Ｕ ｗｅｂ Ｉ 界 面 来 供 使 用 者 更 加 方 便 地 查 看 自 己 上 传 的  

文 件 。  

２ ． ４ 本 章 小 结  

本 章 介 绍 了 区 块 链 是 一 个 通 过 哈 希 值 首 尾 相 连 的 链 表 结 构 等 一 系 列 基 本 工  

作 原理和 区 块链所涉及到 的一些相关技术 ，

为 本 文 接 下 来 的 研 宄 内 容 奠 定 基 础 。  

同 时 进 一 步 介 绍 了 区 块 链 的 应 用 之 一 以 太 坊 和 智 能 合 约 的 工 作 原 理 最 后 对本 文   ；

使 用 到 的 分 布 式 星 际 文 件 系 统 ＩＰＦ Ｓ 进 行 了 介 绍 。  

１ ３

北京 邮 电大学工程硕士学位论文



  

１ ４

第三章 基 于 ＰｏＡ 共识 的 权 威节 点 动态选择 算法 的研 究 与 实现



  

第 三 章 基 于 Ｐ〇Ａ 共 识 的 权 威 节 点 动 态 选 择 算 法 的 研 究 与 实
现  

本 章 主 要 对 常 见 的 几 种 共 识 算 法进 行 简 单 介 绍 ， 接着 对 以 太坊 现 有 的 基 于 权   威 证 明 的 共 识 算 法 ＰｏＡ 进 行 了 研 究 与 介 绍 ， 并 分 析 此 算 法存 在 的 缺 陷 ， 在 此 基   础 上 设 计 并 实 现 了 权 威 节 点 动 态 选 择 算 法并对 算 法进 行 了 实 验验 证 ， 使 得 区 块 链   中 负 责 出 块 的 权 威 节 点 尽 可 能 保 持在 线 ， 提 升 系 统 稳 定 性 。  
３ ． １ 常见共识算法 简 介  

在 区 块链 的 点 对 点 网 络 中 ， 网 络 的 延 迟 会 导 致 节 点 对 事 物 到 达 先 后 顺 序 认 知

不 致 的

一

，

因 此 区块链 的节点 间 需要对这些事务 的顺序来达成一致 ，

这种 用 于 达  

成 一 致 共 识 的 算 法 即 为 共 识 算 法 。 在 区 块 链 网 络 中 ， 整 个 区 块 链 主 要 是 由 负 责 出

块 的 矿 工 节 点 来 维 护 的 ， 而 共 识 算 法 决 定 了 由 谁 负 责 出 块 ， 因 此 可 以 说 共 识 算 法  

影 响 了 区 块 链 的 运 行 ， 很 大 程 度 上 决 定 了 整 个 区 块 链 网 络 的 运 行 情 况 和 稳 定 性 。  

算 类 在 共 分 为 现 常 见 的 识 法 主 要

以下几

Ｗ Ｄ Ａ ： Ｐ ｏ

、 Ｐｏ Ｓ 、

Ｐｏ Ｓ 、 Ｐｏ

Ｂ Ｔ 、 Ｐ Ｆ

。  

１ ．ＰｏＷ 工 作 量证 明

也 被称 为挖 矿 ，

矿 工 节 点 通过 自 身 的 算 力 来 计 算 出

一个符合要求 的 随机数 ，

最先计算 出 的节点将获得 出 块的权利 ，

把 交 易 打 包进 区

块

中

后

其

他

节

点

再

对

区

块

进

行

验

证

４Ｇ

［

］

。

以 太 坊 主 网 使 用 的 就 是 这 种 基 于 Ｐ ｏＷ 的

共 算 法 识

Ｅｔｈａｓｈ 。

其优点 是完全地去 中 心 化 同 时节 点 更加 自 由 ，

但 同 时 也 需 要 消

耗 大量 的 资 源 和 算 力 ， 挖 矿 造 成 大 量 的 资 源 浪 费 不 仅 不 利 于 环 保 ， 同 时 也 不 适 用

于 私 链 或 者 商 业 应 用 等 场 景 。  

权 益 证 明 ２ ． Ｐ ｏ Ｓ

４１

ｆ

］

，

它 是 ＰｏＷ 的 一种升级和 优化 。

节 点 的 挖 矿 难 度 由 各 个  

节 点 所 各 自 拥 有 的 代 币 数量 和 持 有 的 时 间 来 决 定 ， 这种 算 法 在 达 成 共 识 的 过 程 中

相 比工作量证 明耗时更短 ，

目 前 以 太 坊 也 正 在 计 划 进 行 从 ＰｏＷ 向 Ｐ ｏ Ｓ 的 逐 步 过  

渡 转 与

变 。  

Ｄ ３ ．  Ｐ ｏ Ｓ

份 授 权 股

证 明 ４２

［

］

，

这 种 算 法 可 以 由 拥 有 代 币 的 节 点 来 投 票 选 出 一 些  

节 点 代 替 自 己 进 行 区 块 验 证 等 操 作 ， 这 种 算 法 可 以 减 少 参 与 出 块 竞 争 的 节 点 数 量 。  

４ ．ＰＢ Ｆ Ｔ 实 用 拜 占 庭 容 错 算 法 ［４＼ 它 是 一 种 状态 机 拜 占 庭 系 统 。 这 种 算 法 最  

初 是 为 了 解 决 分 布 式 系 统 中 的 一 致 性 问 题 而 诞 生 的 ， 与 区 块 链 的 分 布 式 特 性 吻 合 ，  

其 可 以 提 高 网 络 的 容 错 性 ， 这 种 算 法 目 前 正 被 区 块 链 平 台 之 一 的 超 级 账 本 所 使 用 。  

权 威 证 明 ５ ． ＰｏＡ

４４

［

］

，

这是一种主要依靠名 誉 的共识算法 ，

多 用 于 区 块链 的

私 链 中 ， 可 以 减 少 算 力 消 耗 ， 更 加 快 速 和 高 效 。 想 要 成 为 出 块 节 点 的 节 点 需 要 是  

１ ５

北京 邮 电大学工程硕士学位论文



  

有 声 誉 和 可 信 任 的 ， 出 块节 点 的 个 数 也 是 有 限 的 。 因 此 当 区 块链 中 使 用 了 基 于 权  

威 证 明 的 共 识 算 法 时 ， 则 其 主 要 由 有 限 数 量 的 权 威 节 点 进 行 维 护 。 以 太 坊 的 测 试  

网络使用

的就是基于权威证 明

的共识算法

Ｃ ｑｕ ｌ ｉ

ｅ 。  

３ ．２ 基于 ＰｏＡ 的 共 识算法 Ｃｌｉｑ ｕ ｅ 原 理  

Ｃ ３ ． ２ ． １ 

ｌｉ ｑ ｕ ｅ

在 以 太 坊 中 主 要 提 供 了 可 更 换 的 两 种 共 识 算 法 可 供 选 择 ： 基 于 工 作 量证 明  

基 权 威 太坊 所 使 是 和 于 的 Ｐ ｏＷ

ｅｔｈａｓｈ

证 明 的 以 Ｐ ｏＡ

ｃ ｌ ｉ ｑｕｅ ，

主网 中

用的

ｈ ｈ ｅｔ ａｓ

，  

使 一 些 测 试 网 络 中 用 的 是 ｃｌｉｑｕｅ 。 由 于 溯 源 系 统 为 了 安 全 性 和 一 定 的 保密 性 需 要  

在 自 行 搭 建 的 私 链 上 运 行 ， 而 在 私 链 中 使 用 ＰｏＷ 不 仅 会 浪 费 系 统 的 算 力 ， 同 时  

也 会 影 响 系 统 的 效 率 ， 因 此 ＰｏＡ 是 在 私 链运 行 时 的 一 种 更 优 解 。 以 太 坊 提 供 的

ｃｌｉｑｕｅ 算 法具 有 达 成 共 识 快 、

耗能低和扩展性强的特点 ，

更加适合于私链 ４５

［

］

。  

ｃｌｉｑｕｅ 算 法 是 一 种 ＰｏＡ 算 法 ， 因 此 使 用 此 算 法 的 区 块 链 网 络 是 由 权 威 节 点 来  

进 行 维护 的 ， 拥 有 权 威 的 认 证 节 点 才 拥 有 出 块 的 权 利 。 因 此 在 ｃｌｉｑｕｅ 算 法 中 的 节  

点 主要分为两类 ：

权

威

节

点

和

非

权

威

节

点

４
［

６

］

，

两者可 以互相进行转换 。

前 者 具  

有 签署 区 块 的 权 利 ， 可 以 认 为 相 当 于 工 作 量 证 明 中 的 矿 工 节 点 后 者 不 能对 区 块   ；

进行签署 ，

只 是普通的 同 步节 点 ，

太 坊 算 法 使 以

的 Ｃ ｌ ｉ ｑｕｅ

中

用 录 具   Ｈ ｓ

ｉ

ｇｎｅｒ

ｓ

４
［

７

己

有 出 块 权 利 的 权 威 节 点 。  

作为一个牺牲 了 一定去 中 心化特性 的算法 ，

其必然面临两个 问 题 ：

如 何控 制  

出 块 时 机 以 及 如 何 实 现 签 名 者 的 更 换 。  

３ ． ２ ． ２  

在 算 法 ｃｌｉ ｑｕｅ

中 ，

对

于

出

块

实

际

的

控

制

主

要

是

通

过

两

种

方

式

来

实

现

４
［

８

］

：  

期 是 否 过 块 籲 近

出

【 ｒｅｃ ｅ ｎｔ 】  

否 轮 到 块 籲 是

自 己出

【 ｉｎｔｕｍ 】  

１ ） 近 期 是 否 出 过 块  

在 ｃｌｉｑｕｅ 算 法 中 节 点 不 能 够 连 续 出 块 需 要 保 持 一 定 的 间 隔 ， 这 样 才 能 保 证 有  

恶意 的节点无法连续获得 出 块的权利 ，

从

而

避

免

系

统

遭

遇

连

续

的

攻

击

４９

［

］

。

ｃ ｌ ｉ ｑｕｅ  

中 规定对于每一个权威节点 ，

在 连 续 的 ＳＩ ＧＮＥＲＪＬＩＭＩ Ｔ 个 区 块 中 最 多 只 有 一 个  

区 块 能 被 该 节 点 签 发 其 中 【

ＧＮ Ｒ Ｍ ＧＮ Ｒ ＯＵＮ Ｓ Ｉ

Ｅ

ＬＩ

＿

Ｔ ｆｌ Ｉ

＝





ｏｏｒ（ Ｓ Ｉ

ＥＣ
＿

Ｔ ＋  ／  ２ ） 

 １ ，

ＳＩ ＧＮＥＲ Ｃ ＯＵＮＴ 为 权 威 节 点 数 量 】 ； 即 如 果 当 前 的 节 点 刚 刚 出 过 块 ， 并 且 上 一   ＿

次 所 出 的 块 的 高 度 和 最 新 所 出 区 块 的 高 度 之 差 在 所 有 签 名 者 数 量 的 半 一 （ 严 格 计  

算 是 半 加 一

１）

以内 ，

则不允许该节点再次 出 块 。

这 样 的 机 制 主 要 是 通 过 ｒ ｅｃｅｎｔ

来 控 制 的 。  

１ ６

第 三 章 基于 ＰｏＡ 共 识 的 权 威节 点 动态选择算法 的 研 究与 实现



  

这 种 设 计可 以 使 得 恶 意 节 点 占 总 节 点 数 的 半 数 以 下 时 不 能 因 为 持 续 获 得 出

块 权 力 而 对 系 统 造 成 攻 击 和 威 胁 。

２ ） 是 否 轮 到 自 己 出 块  

从 上 面 的 分 析 中 可 以 得 知 ， 其 实 是 有 大 约 一 半 数 量 的 签 名 者 都 是 可 以 参 与 出

块 竞 争 的 。 但 是 在 理 想 情 况 下 ， 每 一 个 时 刻 最 好 只 有 一 个 节 点 来 出 块 。 在 ｃｌ ｉ ｑｕｅ  

中 是 使 用 的 机 制 实 现 的 ｉｎｔｕｒｎ／ｎｏｔｕｍ

５ ［

（） ］

。  

ｉｎｔｕｍ 简 单 来 说 就 是 当 前 是 否 轮 到 自 己 出 块 ， 判 断 方 法 是 看 当 前 块 的 高 度 是  

否 和 该 节 点 在 签 名 者 列 表 中 的 顺 序 一 致 。 判 断 是 否 为 ｉｎｔｕｍ 的 节 点 的 方 法 是 将 区

块 号 ｍｏｄ 权 威 节 点 个 数 ， 对 比 结 果 和 该 节 点 在 权 威 节 点 列 表 中 的 顺 序 是 否 致 一 ，  

致 该 节 节 如 果 一 则

点 为 ｉｎｔｕｍ

点 。

在 是 否 为 的 值 会 被 写 入 字 段 中 中 Ｃｌ ｉ ｑｕｅ ． Ｐｒｅｐａｒｅ

ｉ ｎｔ ｕ ｍ

Ｈ Ｄ ｆ ｉ ｅ ａｄｅｒ．

ｉ

ｃｕ ｌ ｔ ｙ

，  

难 度 值 为 其 他 难 度 值 为 然 在 节 点 ｉｎｔｕｍ

的

更高

２，

节点 的

１。

后

Ｃ 中 ｌ ｉ ｑｕｅ ． Ｓ ｅ ａｌ

，  

值 会 断 依 据 中 的 Ｈ Ｄ ｆ ｉ ｅａｄｅｒ．

ｉ

ｃｕｌ ｔｙ

成 为 是 否 为 ｉｎｔｕｍ 的 判

。

如果不是 ，

则 节 点 将  

需 要 随 机 多 等 待 一 段 时 间 来 保 证 该 出 块 节 点 的 优 先 出 块 权 ， 随 机 等 待 时 间 不 超 过  

ｌ ｅｎ（ ｓｎ ａｐ ．

Ｓ ｉ ｇｎｅｒｓ）／２＋

ｌ

＊ ５
）

０ ０ ｍ ｓ  

但是即便

ｉ ｎｔ ｕ ｍ

节点 能够签发 区块 ，

其他节点也 同样会参与 出 块竞争 。

因 为  

ｉｎｔｕｍ 节 点 此 时 可 能 并 不 处 于 在 线 状 态 从 而 无 法 进 行 区 块 的 签 发 ， 此 时 其 他 节 点

可 以 填 补 ｉｎｔｕｍ 节 点 的 空 缺 ， 继 续 为 网 络 签 发 区 块 。 不 过这 也 可 能 会 因 为 其 他 节  

点 签 发 的 区 块 难 度 相 同 而 导 致 区 块 链 产 生 分 叉 ， 同 时 存 在 多 条 状 态 不 同 的 链 ， 这  

种 状 态 最 终 会 因 为 接 下 来 的 轮 次 中 ｉｎｔｕｍ 节 点 签 发 的 高 难 度 区 块 而 达 成 收 敛 。  

综上 ，

过 两 种 方 式 控 块 机 通 ｃｌ ｉｑｕｅ

和 ｒ ｅ ｃ ｅｎｔ

ｉｎｔｕｍ

制出 时 ，

最 终 给 了 该 出 块  

的 节 点 优 先 的 出 块 权 。  

块 所 为 算 法 控 制 如 图 ３ １ －

示

ｃ ｌｉ ｑｕｅ

的出

流 程 图 ：  

１ ７

北京 邮 电大学工程硕士学位论文



  

 £ ＂ ｑ ｕ ｅ

ｍ ｉ ｎ ｅ ｒ

ｒ

？

 ￣  ￣ ￣ ￣ ￣ ￣ ￣

＂  

  ？ — 

ｔ

新 块 导 入  定 时 器

？

Ｌ    Ｐ ｒ ｅ ｐ ａ ｒ ｅ



ｉ

（ ｃｈ ａ ｎ Ｈ ｅ ａ ｄＣｈ ）

ｍ Ｃ （ ｔ ｉ

ｅｒ．

）

ｆ ｒ  Ｙｅ ＇

威

、 、

  Ｖ

ｊ  

＇



一

＾    １

一，

＾  

  ｊ

咖 ｉ ｍ  ｌｉｉ ｌ Ｓ

咖 ｍ 丨

ｉ  

＾—— 

   －  — 

ｅ

ｎｇ

ｉ

ｎ

ｅ

Ｐ
． 

ｒｅ

ｐ

ａ

ｒ ｅ

 ‘

＊

 将 当 ｆ ｅ ｇ ｎ ｅ ｒｓ 列 魏 Ａ

填 總蔡信 息

鱗 商 （

）

丨

  Ｈ ｅ ａ ｄ ｅ ｒ ． Ｃｏ ｉ ｎ ｂ ａ ｓｅ

他 虹 ￡伽

，  

 ｐ    Ｈ ｓ ａ ｄ ｅ ｒ ， ｎ ｏ ｎ ｃｅ 

 ＜ ｙ

ｅｎｇ

ｉ

ｎｅ

Ｆ ｎ ． 

ｉ

ａｌ

ｉ

ｚ ｅ

墣 充 Ｈ Ｄ ｅ ３ ｅ （ Ｊ

ｒ．

ｉ ｆ ｆ ｃ ｕ ｉ ｔ ｙ

   ｗ ｎ ｛ ｉ

ｔ

ｎ ／ｎ ｏ ｔ ｕ ｒｎ ）

；

｜

、

、

， ，

ｕ Ｃ ｈ ｅ ｎ ｇ ｎ ｊ ｅ ． Ｓ ｅ ａ ！ ｛ ｒ ｅ ｓ

ｔ
｜

，  

ｓ ｔ ｏ ｐ Ｃ ｈ ）  

填 充 Ｈ ｅ ａ ｄ ｅ ｒ ． Ｔ ｉ ｍ ｅ  

ｍ Ｎ ａ ｘ （

ｐａ

ｒｅ

ｎｔ

．

Ｔｉ

ｍ ｅ＋ Ｐ ｅ ｒ ｏ ｓ ｄ

． ．

ｏｗ ）  

 ｜

 ＾  

；

    ＂

ｔ

ｌ

 一  —

‘ —

 Ｓ ｅ ａ ｌ
ｌ ：

Ｍ ｉｒ ＾

ｋ Ｃｈ ＼  

Ｙｍ  ｜

 ｆ

 

〈

近 担 Ｓ  ７＞  

 ￡

ｆｉ ｏ

隱

ｉ  雜 —

—
＂ 、

Ｊ

计 算 如物 值  
；

ｄ ｙ ｅ Ｊ ａ

ａ ｍ ＋

＝ 

ｒ

ｉ  

、

 ＇

  ？
－



．  

、

；

ｗ ｇ ｅ ？



ｉ

ｇｉ

；  

ｓ ｕ ｏ ｅ ｓ ｓ ：

  Ｉ 

Ｉ

ｊ

  ＾ ， Ｍ ￣

 ＼ ＼ ＊  

…

―

ｓ  

骂 入 ｈ ｅ ａ ｄ ｅ ｒ  

等待ｄ ｅ 丨 ａ ｙ 时 间  

ｒｅ  ｓ ｔ ｏ

ｄ

   

｜   

ｒ ｅ ｓ ｕ Ｈ  



  

算 控 制 图 ３ － １  ｃ ｌ ｉ ｑ ｕ ｅ

法出块

流 程 图

３ ． ２ ． ３ 签 名 者 的 更 换  

在 Ｐ ｏ Ａ 算 法 中 ， 由 于 整 个 链 是 由 权 威 节 点 进 行 维 护 的 ， 因 此 需 要 保 证 这 些  

权 威 节 点 在 多 数 情 况 下 是 保 持 在 线 的 。 然 而 随 着 项 目 的 不 断 运 行 与 权 威 节 点 的 加  

入 ，

不可能保证当 前链 中 所有 的权威节点都是有资源并且有意愿继续工作 的

有

；

可能 出 现权威节点离线甚至作恶的情况 。

针对这种考虑 ，

ｃ ｌ ｉ ｑ ｕｅ 算 法 提 供 了 权 威  

１ ８

第三章 基于 ＰｏＡ 共识 的权 威节 点 动态选择算法 的 研 宄与 实现



  

节 点 的 变 更 方 法 。 ｃ ｌ ｉ ｑｕｅ 算 法 中 权 威 节 点 的 更 换 是 通 过 已 经 成 为 签 名 者 的 节 点 的

投 票 来 实 现 的 ， 节 点 通 过 调 用 ｐｒｏ ｐ ｏ ｓ ｅ 方 法 和 ｄ ｉ ｓ ｃ ａｒｄ 方 法 可 以 发 起 加 入 或 删 除

权 威 节 点 的 投 票 ， 当 半 数 以 上 的 节 点 具 有 致 一 的 投 票 结 果 时 即 完 成 更 改 。

算 如 图 为 ２ ３ －

ｃｌ ｉ ｑｕｅ

法投票过程不意 图 ，

一 次 具 体 的 投 票 过 程 如 下 ：  

？ 用 户 通 过 ｒｐ ｃ 接 口 发 起 对 节 点 的 状 态 变 更 请 求 ， 该 请 求 会 缓 存 在 本 地 的

池 等 待 被 应 用 ｐ ｕｒｐ ｏ ｓ ａ ｌ

中

；  

＊ 权 威 节 点 会 随 机 选 择 一 条 没 有 应 用 的 ｐｕｒｐ ｏ ｓ ａｌ 在 打 包 区 块 时 一 并 把 信 息  

填入区块头并在全网节点之间 广播 ；

＊ 其 他 节 点 在 接 收 到 区 块 后 将 信 息 封 装 为 ｖｏｔｅ 并 存 储 起 来 应 用 至 本 地 ， 若  

半 数 以 上 的 节 点 对 状 态 更 改 的 投 票 结 果 为 认 同 ， 则 更 改 目 标 节 点 状 态 。  

将 其 添 加 进 权 威 节 点 列 表 或 从 列 表 中 删 除 。  

Ｐ ｕ ｒ ｐ ｏ ｓ ｅ

Ｊ ？ Ｉ ｓｓ

：＾ ．

）  

算 过 图 ｕ ３ － ２  ｃ ｌ ｉ ｑ

ｅ

法 投 票 程 示 意 图

算 Ｃ ３ ． ３

ｌｉｑ ｕｅ

法 优缺 点 分析  

ｃ ｌ ｉ ｑ ｕｅ 算 法 使 用 ｒ ｅｃ ｅ ｎｔ 机 制 来 确 保 近 期 己 经 参 与 出 块 的 节 点 不 会 持 续 出 块 ， 从 而 避 免 了 恶 意 节 点 连 续 获 得 区 块 的 签 发 权 而 引 来 的 一 系 列 问 题 同 时 其 借 助  
；
ｉｎｔｕｒｎ／ｎｏ ｔｕｍ 机 制 确 定 当 前 哪 个 区 块 具 有 优 先 出 块 的 权 力 避 免 过 度 竞 争 的 同 时 避   免 了 因 选 定 节 点 离 线 而 导 致 的 无 法 出 块 问 题 。  
但 从 上 述 的 研 宄 中 也 可 以 很 明 显 地 从 这 个 算 法 中 看 出 缺 陷 ， 那 就 是 从 理 论 上   来 说 ｉｎｔｕｍ 节 点 是 可 预 知 的 因 此 恶 意 节 点 能 够 通 过 提 前 预 知 出 块 节 点 而 在 该 轮  
，

１ ９

北京邮 电大学工程硕 士学位论文



  

次对其发起攻击 ，

这是

ｃ ｌ ｉｑｕｅ

算法 的 主 要缺 陷 之一 ；

同 时 权 威 节 点 中 ｉｎｔｕｍ 节 点

的 离 线 会 对 区 块 链 的 出 块 造 成 影 响 。  

尽 管 ｃｌｉ ｑｕｅ 决 定 了 权 威 节 点 的 出 块 时 机 并 提 供 了 改 变 权 威 节 点 的 接 口 ， 但 是  

ｃｌｉ ｑｕｅ 并 未 提 供 算 法 去 自 动 加 入 和 删 除 权 威 节 点 ， 只 能 通 过 用 户 自 己 发 起 ｒｐｃ 请   求 ， 如 果 网 络 中 的 大 部 分 权 威 节 点 处 于 离 线 状 态 则 必 然 会 影 响 系 统 出 块 的 速度 从  

而 影 响 系 统 的 稳 定 性 ， 体 现 在 溯 源 系 统 中 就 是 可 能 会 出 现 用 户 的 交 易 打 包 延 迟 较  

大 ， 即 用 户 操 作 响 应 速 度 受 到 影 响 。 再 结 合 前 边 提 到 的 由 于 ｉｎｔｕｍ 节 点 可 预 知 而  

带 来 的 风 险 ， 可 以 基 于 这 个 思 想 设 计 出 一 个算 法 来对 权 威 节 点 进 行 动 态 的 调 整 使  

得 节 点 的 顺 序 不 是 一 直 固 定 的 ， 并 且 保 证 网 络 中 的 权 威 节 点 尽 可 能地 处 于 在 线 状  

态 ， 从 而 有 效 维 持 系 统 的 稳 定 性 。  

算法 ３ ． ４

咖 节 点 动 态 选 择 算 法  

基 于 上 述 提 到 的 问 题 可 以 对 算 法 进 行 改 进 ， 设 计 出 一 个 动 态 的 权 威 节 点 选 择  

算法 ，

与原有的

ｃｌ ｉ ｑｕｅ

算法相 互配合 ，

满足溯源系统的需求 。

算 法 的 主 要 思 想 是  

保证 参 与 出 块 的 权 威 节 点 尽 可 能 地 保持 活 跃 和 在 线 。 由 于 在 区 块 链 网 络 中 必 须 保  

证 当 前网络中 有一半 以上的权威节点处于在线状态 ，

能 致 否 则 可 导

“
Ｓ ｉ ｇｎｅ ｄ  

错 误 使 得 统 持 续 等 待 块 甚 死 锁 状 态 无   ”

ｒｅ ｃ ｅ ｎｔｌ ｙ，  ｍｕ ｓｔ  ｗ ａｉ ｔ  ｆｏ ｒ  ｏ ｔｈｅ ｒ ｓ

，

系 陷入

出

至

法出块 ，

也 无法继续加 入和 删 除 节 点 ；

动 态 调 整 节 点 时 使 用 固 定 的 时 间 间 隔 可 能

在 较 多 节 点 离 线 的 情 况 下 使 出 块 陷 入 死 锁 ， 同 时 也 有 可 能 在 节 点 较 为 稳 定 时 频 繁

进 出 反而 影 响 效 率 。 针对 上 述 问 题 该 算 法 不 固 定 设 置 权 威 节 点 调 整 的 时 间 间 隔 而  

采 用 依 据 系 统 吞 吐 量进 行 一 定 范 围 内 的 灵 活 调 整 。 在 系 统 吞 吐 量 持 续 下 降 一 段 时

间 后 就 立 刻 加 入 新 的 权 威节 点 而 不 再 等 待 固 定 时 间 间 隔 的 到 来 ， 从 而 尽 可 能地 避  

免 出 现 一 半 节 点 离 线 的 情 况 在 系 统 吞 吐 量 保持 稳 定 时 不 进 行 权 威 节 点 的 调 整 提   ；

高 效 率 。  

在 使 用 溯 源 系 统 的 用 户 角 色 中 消 费 者 的 数 量 应 该 是 最 多 的 ， 但 是消 费 者 只 需

要 对溯 源 结 果 进 行 查 询 而 无 需 上 传 信 息 ， 消 费 者 虽 然活 跃 但 是 在 线 时 间 并 不 长 而

且 通 常 不 具 有 权 威 ， 因 此 消 费 者 无 需 成 为 权 威 节 点 。 权 威 节 点 将 在 在 线 时 间 较 为  

稳 定 并 且 通 过 审 核 的 商 家 用 户 中 产 生 。  

基 于 Ｐ ｏＡ 共 识 的 权 威 节 点 动 态 选 择 算 法 的 流 程 图 如 图 ３ － ３ 所 示 设 置 系 统 ，

中 负 责 出 块 的 节 点 总 数 为 ｎ 个 ， 单 位 时 间 间 隔 为 ｔ 秒 ， 其 中 ｎ 和 ｔ 的 值 由 输 入 值

决定 ，

缺省值分别为

个 和 秒 １ ０

６０

。

进 行 权 威 节 点 的 动 态 选择 的 时 间 间 隔 由 系 统

的 交 易 数吞吐量 的变化幅度决定 ， 当 系 统 的交 易 数呈现较为稳定时时 间 间 隔 更长 ；  
当 系 统 交 易 数 出 现 剧 烈 波 动 如 剧 烈 下 降 等 则 表 示 当 前 权 威 节 点 离 线 的 可 能 性 很

２ ０

第三章 基于 ＰｏＡ 共识 的 权威节 点 动 态选择算法 的研 究与 实现



  

大 ，

则 时 间 间 隔 变 短 。

     

１

飞

＋  

｜

，

＾

选 定 权 威 节 点 Ｃ ｌ ｉ ｑ ｕ ｅ 打 包 交 易  

 出 块   ｓ ｇ ｉ ｎ ｅ ｒｓ

  ＾  ：

＇

！

＾
？

一一

＞   、  

 ｊ ｆｃ

．

，

设定 嫌 出  

鎌 户  ’ Ｙ ｋ

＜  适 出 过   ， ，

 －－

＂
＞  

商 户  

 馨

Ｉ  

Ｂ 通过 审

．

一

？

  Ｉ

：

算 计

值   ｄ ｅ ｉ ａ ｙ

 務’

！  

  ＾

秦

ｄ

ｅ

ｌ

ａｙ

＋


＝

ｒａ

ｎ

ｄ  

觀 后 駿  一

ｗ （

ｉ ｇ ｇ ｊ ｅ ）

綱 爾綠序  Ｉ

 ｒ  

卜  鲋

＾  
－ 一 一＿

 ；

，  


 按 最通ｔ務 内 交

写 入 ｈ ｅ ａ ｄ ｅ ｒ  

 ｉ 霧 数锤 序 ＿

：  

 Ｉ Ｉ



１





，  

按 秒 内 每 个   Ｗ＃ ＾  １ ０１

一

｜

ｄｅｌ ａｙ

ｆｅ ３

１  

   ＴＸＴ 秒 ｔ： 交 ■数方差餐Ｗ ！

ｉ

Ｉ

Ｉ

Ｉ

＇

 选 取 酋ｎ／ Ｚ 个 活ｇ

ｚ
． ．

．

，

．

 錄 户 加 Ａ ｓ＿ ｒｓ

、
＇ 、

、

、

结  

＞５薇＾

ｙ ｒ ｅ ｓ ｕ ｌ ｔ

链 成 功  

 ｔ ＾
从 ｓ ｉ ｇ ｎｅｒ＊ 中 鼷 除 ＆   ｎ／２ 个 不 活 跃 《 户 

－ ｍｍ  

 ｍｍ

１

  ＇

Ｊ Ｕ

—

１

 １  

图 ３ － ３ 基 于 Ｐ ｏＡ 共 识 的 权 威 节 点 动 态 选 择 算 法 流 程 图

使 具 生 成 时 时 设 定 初 始 参 与 块 账 １ ）

用 工 ｐ ｕｐ ｐ ｅ ｔ ｈ

ｇｅｎｅ ｓｉ

ｓ

．
ｊ

ｓｏｎ

同

出 的户 ；

计 算 动 态 选 择 ２ ）

的 时 间 间 隔 ｎ ｖ ｉ

ｔｅｒ

ａｌ ，

之 后 每 隔 固 定 的 时 间 间 隔 后 进 行 如 下  

步 骤 ３ － ７ 初 始 时 设 定 调 用 动 态 选 择 算 法 的 时 间 间 隔 为 ｔ 秒 。 当 该 ｔ／６ 秒 内 的 吞 吐   ；

量 与 上 ｔ／６ 秒 内 相 比 变 化 超 过 ２ ０ ％ 时 立 刻 调 用 权 威 节 点 动 态 选 择 算 法 更 换 权 威 节  

执 点

行 步 骤 ３ ７ － ，

而不再等待 固 定时 间 间 隔 的到来 ，

尽 可 能 避 免 半 数 以 上 节 点 离  

线 的状况 ，

同 时将 时 间 间 隔重置为 ｔ 秒 ；

当 该 ｔ 秒 的 吞 吐 量 与 上 ｔ 秒 相 比 变 化 不  

超过 １ ％时增加调 用 动态选择算法的 时 间 间 隔 ，

每次将 当 前时 间 间 隔 增加

ｔ

秒 ，

当 增 加 至 ５ ｔ 秒 时 不 再 增 加 当 这 ｔ 秒 的 吞 吐 量 与 上 ｔ 秒 相 比 变 化 超 过 ５ ％ 但 不 超   ；

过 ２０％时减少调 用 动态选择算法 的 时 间 间 隔 ，

每次将当前时间 间 隔减少

ｔ

秒 ，

当

减少至 ｔ 秒时不再减少

变化超过

２０％立刻 改变权威节 点执行步骤

３ ７ － 。

不 断 调  

；

整 选 择 权 威 节 点 的 时 间 间 隔 可 以 使 得 当 系 统 多 数 权 威 节 点 离 线 时 快 速 更 换 权 威  

２ １  

北京 邮 电大学工程硕士学位论文



  

节 点 从 而 避 免 半数 以 上 节 点 离 线 造成 系 统 的 出 块 死 锁 同 时 避 免 系 统权 威 节 点 都   ；
在 线 的 情 况 下 频 繁切 换 权威 节 点 反而 影 响 系 统 效 率  

３ ） 遍 历 所 有 用 户 ， 选 取 通 过 审 核 的 商 家 用 户 作 为 备 选节 点 ， 备 选 节 点 和 当 前 区 块链 中 的 权威 节 点 参 与 之 后 优 先 级 的 计 算  

４ ） 从 备 选 节 点 中 选 取 并 保 留 最 后 一 笔 交 易 时 间 最 邻 近 当 前 时 间 的 ｎ 个 账 户 ，

依 次 设 定 优 先 级 为 ｎ ２ １ ０

．．．

０、

０ １

，

以 同样方式计算

ｓ ｉ ｇｎｅｒ ｓ

的优先级 ，

因 为 交 易 时

间 越 邻 近 当 前 时 间 的 节 点 其 目 前 依 然 在 线 的 可 能 性 最 大 ， 因 此 将 此 因 素 的 优 先 级  

设 定 为 最 筒  

５ ） 计 算 备 选 节 点 和 ｓｉｇｎｅｒｓ 中 每个 账 户 最 近 ｔ 秒 内 的 交 易 数 ， 从 最 多 的 开 始  

每 个 优 先 级 加 ２ｎ ４ ． ． ．

、

２ ，

因 为在近期在线 的前提下 ，

最 近 段 一 短 期 时 间 内 交 易 数  

较 多 的 节 点 会 更 加 活跃 ， 在 接 下 来 的 时 间 内 依 然 保 持 在 线 的 可 能 性 更 大  

６ ） 以 每 一 个 ｔ 秒 的 交 易 数 为 单 位 ， 计 算 备 选 节 点 和 ｓｉ ｇｎｅｒｓ 中 每 个 账 户 最 近  

ｌ 〇ｔ 秒 内 的 交 易 数方 差 ，

方差从 小 到 大给优先级 加

ｎ ２ ． ． ．

、

１，

方 差 体 现 了 稳 定 性 ，  

即 每个账户 交 易数的稳定性 ，

如 果 一 个 账 户 在 保 持 活 跃 的 同 时 能 够 保持 相 同 时 间

间 隔 内 的 交 易 数 相 差 不 大 则 说 明 该 账 户 在 线 时 间 较 为 稳 定 ， 在 接 下 来 的 时 间 内 依  

然 保 持 在 线 的 可 能 性 更 大  

７ ） 在 依 照 这 些 标 准 计 算 出 每 个 候 选 节 点 的 优 先 级 后 ， 选 取 优 先 级 最 大 的 ｎ／２  

个 账 户 加 入 ｓｉｇｎｅｒｓ ， 将 ｓ ｉ ｇｎｅｒｓ 中 账 户 按 照 优 先 级 进 行 排 序 ， 去 除 优 先 级 最 小 的

个 ｎ／２ ，

即 使用 活跃的节点 替换一半可能离线 的节 点 ，

使 得 下 一 轮 的 ｉｎｔｕｒｎ 节 点

最大可能地保持在线状态 ，

避 免 延 时 影 响 系 统 的 出 块  

该算法的伪代码如 下 图

３ －４

所示 ：

２ ２

第三章 基于 ＰｏＡ 共 识 的权 威节 点动 态选择算法 的 研 究 与 实现



  

算法

 １

ＰＰ〇Ａ

共 识 的 权 威 节 点 选择 算 法  

 Ｍ Ｏ Ｖ Ｍ Ｎ Ｎ ｄ １ ： 

ｆｕ ｎｃ ｔｉ ｏ ｎＩ

ＰＲ

Ｅ

Ｅ

Ｔ （ 

ｓｉｇ ｎｅ

ｒ

ｓ ａ ｃｘｘｎｍ ，

ｔ

ｓ

ａ ． 

ｌ

ｔｅｒ

ｎａｔ

ｉ

ｖ

ｅ

ｏ

ｅ ｓ ｎ ， 

ｆ

，

）  

选 取 屯 核 通 过 的 商 家 用 户   ｄ ２ ：

ｆｏ ｒ  ｉ  ＝  ０

  — １

ｏ／ ／

 ｈ Ｓ ｋ ｈ ３ ：

ｆ ｉ

 ＼

ｍ

ｃｒ ｃ

ａ ｎｔ

£ ｔ ｘ＇〇ｎｔ ａ ｎｓ

｛ ａ ｃ ｃ． ＜ｍ ｎ ｔ ｓ

ｉ ［］

ｘ： ａ ｔ ｃ ｇ ｏｉ ＇ ｙ ）

： ａ ｃ＾ｘｎ ｉ ｎｔ ８ ｉ ． ｃ ｈ ｅ ｃ ｋ ｅ ｄ  ＝ ＝  ｔ ｒ ｕ ｅ  ｔ ［］

ｅ ｎ  

Ｎ ４


：

ａ

ｌ

ｔｃ

ｒ

ａ ｉ ｉ

ｔｉ

ｖｅ

ｄ ｏ

ｅｓ．

ｃｉ ｄ ｄ（ ａｃｃｏ ｕ

ｎｔｓ

？．

［

］

）  

ｄ ５ ：  ｅ ｎ  ｉ ｆ  

６ ：  ｅ ｎ ｄ  ｆｏ ｒ

咖  ７ ：

Ｓ

ＯＲＴ

Ｂ

ｙ

Ｔｘ

Ｄ ａｔｅ

（

ｎｅｒｓ ，

ｎ ）／／

依 照最近义易 时间对权威节点和 备选节点排序并选取前

ｎ

个

Ｂ Ｔ Ｎ ＇
８ ：  Ｓ Ｏ Ｋ＼

＼

＼ Ｔ＞ ＸＶ Ｅ ａ ｌ ｔ ｅ ｒ ｎ ａｔ ｉ ｖ ｅ

（

ｏｄｅ ｓ ｎ

，

）  

 汾 算 权 威 节 点 和 备 选 节 点 的 优 先级 ？

９：

ｆｏ ｒ  ？  ＝  ０  —  ａ ／ ｆ ｅ ｒ ｎ ａ

Ｖ ％ 、 ｄ ｏ ； ｅ ｉ

＜

ｅ ｓ ｆ

ｓ ． ．

？

ｅ

 — １

（ ）

？
／ ／ｉ ｜

，

Ｉ Ｏｉｌ ． ２０ 、

１ ０

Ｎ ｙ  １ ０ ：  ａ ｌ ｔ ｃＴ ｎ ａｔ ｉ ｖ ｅ

ｏ ｄｅ ｓ

ｉ ［］

． ｊｒｒ ｉ

ａｒ ｉ ｔ

１ ０ ＊ ｎ （

ｔ ）

＇

ｐ  ｇ ｎｅ  ｓ １ １ ：

ｉ

ｒｓ ｉ ． ［］

ｒ ｉ ｏｒ ｉ ｔｙ

１ ０＊

ｎ—



？

（

）  

１ ２ ：  ｅ ｎ ｄ  ｆｏ ｒ  

坳 Ｍ １

３

ｓｏ
：

ｒｔ

Ｂ

ｙ

Ｔ

ｘ

Ｘ

ｕｍ

（

ｗｒ

）／／

依照 前

ｔ

秒 内 交 易 数 对 权 威 节 点 和 备 选 节 点 排 序

Ｂ Ｔ Ｎ Ｎ １

４


：

Ｓ

Ｏ ＲＴ

ｙ

ｘ

Ｕ Ｍ ａｌ ｔ ｅ ｒ ｎ ａ ｔ ｉ ｖ ｅ

ｄ ｏ ｅ ｓ ｔ ， 

｛

）  

 細 ５ １

：

ｆｏ ｒ  ？：  ＝  ０  ４  ａ ／ ｆ ｅ ｒ ｎ ａ

计 算 权 威 节 点 和 备 选 节 点 的 优 先 级  １ ｄ ｏ ／ ／

．

２ ４ ｉ ｉ ．

．

．

、

２

Ｎ ｄ ｙ ｙ １ ６ ：  ａ ｌ ｔ ｅ ｒ ｎ ａｔ ｉ ｖ ｅ

ｏ ｅｓ ｉ ．
｛］

ｒ ｉ 〇Ｔ ｉ ｔ

２ ＊ ｎ －

―

＾





（

—



 ｉ ）  

ｐ  ｇ ７ １

：

ｓｉ

ｎｅ ｒ ｓ ｉ ．
［］

ｒｉ ｏｒ ｉ ｔ ｙ４

２＊ —





 （ ？ｉ 

ｉ ）  

１ ８ ：  ｅ ｎ ｄ  ｆｏ ｒ  

依 前 秒 每 个 抄 交 数 方 差 对 权 威 节 点 和 选 节   Ｂ Ｖ Ｍ １

９


：

Ｓ

Ｏ

ＲＴ

Ｙ

ＡＫ

Ｉ

Ａ

Ｎ

Ｃ

Ｅ

（

？ ．

：

３

ｎｅ

ｒ

）／ ／

照

ｌ ｏｔ

内

－ —

ｔ

内易

备

点 排 序

Ｖ Ｕ Ｎ Ｂ ２ ０ ：  Ｓ Ｏ ＲＴ ｙ Ａ ｍ Ａ ｌ＾ Ｃ Ｅ ａ ｃ ｒ ７ ｉ ａ ｔ ｉ ｖ ｅ

ｏｄｅｓ Ｊ

（

）  

 ｆ ｏ  ｔ ｏ ｔ ｏ Ｗ 算 权 威 节 点 和 备 选 节 点 的 优 先 级 ２ １ ：

ｒ  ｆ  ＝ ０

ａ

ｒｎａ

ｅ ｉＶ

』 ｄ ｏ ／ ｓ ？ ＜

．

？：

２ｅ

（

－１ ）

／

ｉ 丨

，

２ １ １ ．

．

．

、

１

Ｎ ｋ ｐ  ２２

：



ａ

ｌ

ｔ

ｃ

ｍ ７

－

ａ

ｔ

ｉｖ

ｅ

〇（

ｓ ｉ

ｉ

．

［］

ｎ ａｒ ｉ ｔ ｙ

ｎ
（

ｉ ）  

ｐ ｙ  ｇ ２ ３ ：  ｓ ｉ

ｎｅｒ ｓ ｉ ． ［］

ｒ ｉ ｏｒｉｔ

ｎ—

 （

 ｉ ）

２ ４ ：  ｅ ｎ ｄ  ｆｏ ｒ  

Ｂ ％ ２ ５ ：  Ｓ 〇 Ｒ Ｔ

ＹＰ Ｒ ！ ＯＲ ＩＴＹ ６ （

ｎ ｅｒｓ ）／／

依 照 优 先级 大 小 对 权 威 节 点 和 备 选 节 点 排 序  

Ｂ Ｐ Ｎ  Ｒ ２ ６ ：

ＳＯ Ｔ 

Ｙ

ＲＩ ＯＲ Ｉ ＴＹ ａ／ ｔｅ ｒｎ ａ ｔｉ ｖｅ



（

ｏｄｅ ｓ ）  

备 选 节 点 优 先级 ？ 高 的 个 替 换 权 威 节 点    ｆ ｏ  Ａｂ Ｏ ２７ ：

ｒｆ＝０

ａ ／ ｆ ｅ ｒ ｎ ａ ｔｉ ｔ’ ｅ

ｒ ｆ ｅ ｓ ． ｓ ｆ ｃ ｅ

ｄ ／ Ｓ  －  １ 

ｏ／／

中

ｎ／２

中 优 先 级 低 的 ｎ ／ ２ 个 ，

ｐ Ｎ ｄ ｄｄ ２ ８


：

ｃｌ

ｉ

ｑ

ｕｅ

．

ｒ ｏｊ） 〇 ｓ ｅ （ ａ ｌ ｔ ｅ ｍ ｏｔ ｉ ｖ ｅ

ｏ

ｅ ｓ ｉ ａ ．

［

］

ｒ ｅ ｓ ｓ ｒ ｔ ，  ｕ ｅ ）  

 ｄ ｄ ｄ ２９ ：

ｉｑ ｕｅ ．

ｄ ｎ ａ ｄ ｉ ｓ ｃａ ｒ

（ ｓ ｉ ｇ ｎｅ ｒ ｓ ［

１ —





—



ｉ

．

］

ｒｅｓ ｓ ）  

３ ０ ：  ｅ ｎ ｄ  ｆｏ ｒ

３ １ ：  ｅ ｎ ｄ  ｆｕ ｎ ｃ ｔ ｉ ｏ ｎ  

图 ４ ３ － 基 于 Ｐ ｏ Ａ 共 识 的 权 威 节 点 动 态 选 择 算 法 伪 代 码 图

３ ． ５ 实 验 与 验 证  

验 实 配 置   ３ ５ ．

．１

为 了 模拟联盟链的运行效果 ，

在

ｍ ｘ ｌ ｉ

ｉ

服务器上搭建 以 太坊环境 ，

使 用

创 建 文 件 修 改 共 识 算 法 为 使 动 私 链 作 为   ｐ ｕｐｐ ｅｔｈ

ｇｅｎｅ

ｓ

ｉ

ｓ

．
ｊ

ｓｏｎ

，

ｕ ｑ ｃ ｌ ｉ

ｅ ，

用 启 ｇ ｅ ｔ ｈ

区块链环境 。

因 为实验主要是为 了 验证改进后 的算法相 比原

ｃ ｌ ｉ ｑ ｕｅ

算 效 法 的

果 ，

ｎ 和 ｔ 值的设定合理即可 ，

因此选用 缺省值 即权威节点个数

ｎ ０ ＝

１

，

单 位 时 间 间 隔  

秒 即 分 钟 ＝
ｔ

６

０

一
。

１０

个节 点 作为权威节 点 参与

块 出

，

在 服 务 器 上 １ ０ 个 不 同 的 端  

上 动 个 节 口 启

１０

点 ｐｅｅｒｓ ，

查看各个节点 的

ｅｎｏ ｄ ｅ

信息 ，

令 命 建 使 用 ａ

ｄ

ｄ

Ｐ

ｅ

ｅ

？
ｉ

立  

２ ３  

北京邮 电大学工程硕士学位论文



  

连 接 之 的 ｐ ｅｅｒｓ

间

，

至此准备工作完成 ，

原 始 私 链 搭 建 成 功 。  

算 法是 为 了 确 保 区 块 链 顺 利 打 包 交 易 并 出 块 即 用 户 的 请 求 尽 快得 到 响 应 ， 当

所有 权 威 节 点 都保 持在线 时 ， 区 块 链 中 每 个 区 块 可 打 包 的 交 易 数 即 系 统 的 吞 吐 量  

是 区 块 链 的 决 定 的 而 可 在 中 手 动 配 置 ＴＰ Ｓ

由

ｇ ａｓ  ｌｉｍｉｔ

，

ｇ ａｓ  ｌ ｉｍｉｔ

ｇ ｅｎｅ ｓ ｉ ｓ ｊ ． ｓ ｏ ｎ

，  

即 在 不 出 意 外 的 情 况 下 系 统 的 吞 吐 量 是 基 本 不 变 的 ， 因 此测 试 无 需 对 系 统 发 送 大  

量 的 交 易 进 行 压 力 测 试 。 本 文 只 对 在 有 权威 节 点 离 线 的 情况 下 系 统 吞 吐 量 的 变化  

进 行 验 证 。

实 验 共 设 置 ２ ５ 个 节 点 ， 其 中 １ ０ 个 为 权 威 节 点 ， 剩 下 １ ５ 个 为 备 选 节 点 ， 模  

拟 节 点 在 网 络 中 的 在 线 离 线 状 态 变换 ， 主 要 模拟 两种 情况 ： 节 点 状 态 变 化趋 于 稳  

定 同 时保证区块链网络 中 半数 以 上的权威节点保持在线 ，

避免系统无法出 块 ；

另

一 种 则 是 节 点 状 态 变 化 剧 烈 ， 且 可 能 存 在 半 数 以 上 权 威 节 点 离 线 的 情 况 。 第 一 种

情 况 更接 近 真 实 情 况 ， 因 为 一 般情 况 下 接 入 区 块 链 网 络 的 用 户 不 会 过 于 频 繁 地进  

出 网 络 ， 通 常 会 保 持 一 段 持 续 时 间 的 在 线 。 第 二 种 情 况 主 要 是 为 了 测 试 在 特 殊情  

况 下 节 点 状 态 剧 烈 变 动 而 导 致 同 时 有 半 数 以 上 的 权 威 节 点 处 于 离 线 状 态 时 该 算  

法 能 否 保 证 区 块链 网 络 的 正 常 运 行 。  

为 了 便 于 观 察 ， 系 统 采 取 定 时 发 送 交 易 进 行 实 验 ， 在 两 种 情 况 下 都 分 别 采 取  

每

Ｉｓ

发送一 次交 易 和 每

５ ０ ０ｍｓ

发 送一 次交 易 ，

发 送交 易 的 节 点 是 在 当 前 在 线 节  

点 中 随 机 选 取 的 。 每 １ ０ 分 钟 记 录 一 次 区 块 链 中 被 打 包 的 交 易 数 作 为 吞 吐 量 即 纵  

坐 标 ， 以 时 间 为 横 坐 标 ， 单 位 为 １ ０ 分 钟 ， 记 录 １ ０ ０ 分 钟 内 使 用 动 态 节 点 选择 算  

法和 不 使 用 算 法 的 交 易 数 并 进行对 比 ， 在 无 权 威 节 点 离 线 的 情 况 下 系 统每 十分 钟

被 打 包 的 交 易 数 应 为 ６ ０ ０ 和 １ ２０ ０ 。  

３ ． ５ ． ２ 节点状态变化趋于稳定 的 实验结果  

下 面 两 张 图 为 节 点 状 态 变 化 趋 于 稳 定 时 不 同 交 易 发 送 频 率 的 吞 吐 量 对 比 结

果 ：  

所 每 次 如 下 图 ３ ５ －

示为

发 交 改进 后 算 法 始 Ｉ ｓ

送一

易时

的 ｃｌｉ ｑｕｅ

和原

ｃ ｌ ｉ ｑｕ ｅ  

算 法 实 验 对 比 结 果 示 意 图 。 如 图 ３ －５ 所 示 可 以 看 出 原 始 的 ｃｌｉ ｑｕｅ 算 法 所 打 包 的 交  

易数即 吞吐量明 显受到 了 离线权威节点 的影响 ，

吞吐量下 降较多 ；

而 改进后 的 算

法 所 受 到 的 影 响 很 小 ， 吞 吐 量 的 下 降 很 小 且 基 本 趋 于 稳 定 。  

２ ４

第 三 章 基于 ＰｏＡ 共 识 的 权 威节 点动 态 选择 算 法 的 研 究 与 实 现



  

每 Ｉ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比  
６ １ ０

６ ０ ０ 胤  ＾  
 ５ ９ ０ ＾  
錢  

５ ８ ０
＾

｜ ５ ７ ０  


靠 念    ＾ ＃  會 ＾ ５ ６ ０

、 ＾ ８８

＊＊ ＊＊＊＊＊ ＊

＊＊８ ５

８８８ ９

＾？＊＾ 

ｙ

；

：

ｎ ＊ ＊８ １＊

   ＾  

ｄ ＊  
Ｉ

５ ５ ０  

５ ４ ０

５ ３ ０  

１ ０ 分 钟２ ０分 钟３ ０ 分 钟４０ 分 钟５０ 分 钟６ ０ 分 钟７ ０分 钟８ ０ 分 钟９ ０ 分钟

单 位 分 钟 时 间 【

：

１０

】  

１ ０ ０ 分 钟

权 威 节 动 选 算  改 进 ｑ ｕ ｅ ｃ

ｌ

ｉ

：

点态择法

原始ｃ ｌ

ｑ ｉ

ｕ ｅ

图 ３ － ５ 状 态 趋 于 稳 定 每 一 Ｉ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比 图

如 Ｆ 图 ３ － ６ 所 不 为 每 ５ ０ ０ ｍ ｓ 发 送 一 次 交 易 时 改 进 后 的 ｃ ｌ ｉ ｑ ｕ ｅ 算 法 和 原 始  

ｃ ｌ ｉ ｑ ｕｅ 算 法 实 验 对 比 结 果 示 意 图 。 如 图 ３ － ６ 所 示 可 以 看 出 原 始 的 ｃ ｌ ｉ ｑ ｕｅ 算 法 的 吞  

吐量受到离线权威节点 的影响变得更大 ，

相较于 图 ３－５ 而言吞吐量下 降更多 ；

而  

改进后 的算法吞吐量下 降 虽然相较于 图

为 而 更 ３ － ５

言

明显，

但 是 下 降 幅 度 并 不 大

且 吞 吐 量 较 为 稳 定 。

每 ５ ０ ０ ｍ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比

１ ２ ０ ０

  １ １ ９ ０

＊ ＾ ， ， ＞



ｊ

 



１ １ ８ ０
淼  
识  １ １ ７ ０

蓮 １ １ ６ ０   
￥ 金  １ １ ５ ０  
〇  
§
１ １４。



－

 ＊  

１ １ ３ ０

― ：  

１ １ ２ ０  

１ ０ 分 钟 ２ ０ 分 钟  ３ ０ 分 钟  ４ ０ 分 钟  ５ ０ 分 钟  ６ ０ 分 钟  ７ ０ 分 钟  ８ ０ 分 钟  ９ ０ 分 钟 １ ０ ０ 分 钟  

时 单 位 分 钟 间 〖

： １０

】  

改 进 权 威 节 态 选 择 算 法  始 ｑ ｕ ｅ ｃ

：

ｌ

ｉ

点动

原

ｃ ｌ ｉ ｑ ｕ ｅ

图

３ －６

每 状 态 趋 于 稳 定 一

５００ｍｓ

发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比 图

２ ５

北京 邮 电大学工程硕士学位论文



  

３ ． ５ ． ３ 节 点 状态 变 化剧 烈 的 实 验结 果  

下面两张 图 为节点状态变化剧烈 时不 同 交 易 发送频率 的吞吐量对 比结果 ：

每 如 所 为 图 ３ ７ －

７Ｋ

Ｉ ｓ 发 送 一 次 交 易 时 改 进 后 的 ｃ ｌ ｉ ｑ ｕ ｅ 算 法 和 原 始 ｃ ｌ ｉ ｑ ｕｅ 算

法 实 验 对 比 结 果 示 意 图 。 如 图 ３ － ７ 所 示 可 以 看 出 相 较 于 节 点 状 态 变 化 趋 于 稳 定 时  

的 图 ３－５

的结果而言 ，

在 节 点 状 态 变 化 剧 烈 时 两 种 算 法 吞 吐 量 的 下 降 都 更 加 明 显  

和剧烈 ，

其 尤 算 是 原 始 的 ｃ ｌ ｉ ｑｕ ｅ

法 ，

吞吐量的下 降达到半数 以上 。

而 改 进 后 的 算  

法虽然吞 吐量也 有 下 降但是相

比于原始算法而言 下 降幅度并不算大 ，

并 且 吞 吐 量  

依 然 保 持 着 较 为 稳 定 的 水 平 。

每 ｉ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比
７ ０ ０  

６ ０ ０  

毅 ５ ０ ０

运 ４ ０ ０ 卸  

 ３ ０ ０
誉 Ｂ  ２ ０ ０

Ｍ ＭＳ ％ ｇｅ９００ａＳＳＳＳＳａ

ｉ ｌ

＾０

ｓ ｉ ｓ ｌ

＾

＾＾Ｍ  

 ■

—ｒ

１ ０ ０

０
１ ０ 分 钟  ２ ０ 分 钟  ３ ０ 分 钟  ４ ０ 分 钟  ５ ０ 分 钟  ６ ０ 分 钟  ７ ０ 分 钟  ８ ０ 分 钟  ９ ０ 分 钟 １ ０ ０ 分 钟

单 位 分 钟 时 间 【

： １０

】  

改 进 威 选 择 ｑ ｅ ｃ

ｌ

ｉ

ｕ

：

权

节点动态

算 法原 始ｃ ｌ

ｉ

ｑ

ｕ

ｅ

图 ３ － ７ 状 态 变 化 剧 每 烈 一 Ｉ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比 图

所 为 每 次 交 进 后 算 法 始 如 图 ３ － ８

不

发 送 ５ ０ ０ ｍ ｓ

一

易时改

的 ｃ ｌ ｉ ｑｕ ｅ

和原

ｃ ｌ ｉ ｑ ｕ ｅ  

算 法 实 验 对 比 结 果 示 意 图 。 如 图 ３ － ８ 所 示 可 以 看 出 相 较 于 节 点 状 态 变 化 趋 于 稳 定

时 的 图 ６ ３ －

的结果而言 ，

在 节 点 状 态 变 化 剧 烈 时 两 种 算 法 吞 吐 量 的 下 降 都 更 加 明

显和剧烈 ；

而和 图 ３－７ 比较后也发现吞吐量的下 降幅度更大 了 。

而 改 进 后 的 算 法  

依 然 能 够 保 证 吞 吐 量 的 下 降 幅 度 在 可 接 受 的 范 围 内 ， 并 且 吞 吐 量 基 本 保 持 稳 定 。  

２ ６

第三 章 基于 ＰｏＡ 共识 的权 威节 点 动 态选择算法 的 研究 与 实现



  

 １ １ ０ ０ ￣  

１ ０ ０ ０

錢

９ ０ ０

Ｓ  ８ ０ ０  
切   ｔｅ 葚  ７ ０ ０

〇  

 Ｂ

６ ０ ０

每 ５ ０ ０ ｍ ｓ 发 送 一 次 交 易 时 两 种 算 法 吞 吐 量 对 比  

５ 。 。  

４ ０ ０

１０分 钟２０分 钟３０分 钟４０分 钟５０分钟６０ 分 钟７０分 钟８０ 分钟９０分 钟

单 位 分 钟 时 间 【

：

１０

】  

１ ０ ０ 分 钟

改 进 权 威 节 动 态 选 择 算 法  始 ？ ＿

—

ｑ ｕ ｅ ｃ

：

ｌ

ｉ

点

原

ｃ ｌ

ｉ

ｑ

ｕ

ｅ

图 ３－８

每 状 态 变 化 剧 烈 一

５００ｍ ｓ

发 送 一 次 交 易 时 两 种 算 法 呑 吐 量 对 比 图

３ ． ５ ． ４ 实 验 结 果 分 析  

当 节 点 状 态 变 化 不 剧 烈 时 ， 从 图 中 的 实 验 结 果 中 都 可 以 看 出 在 使 用 权 威 节 点

动 态 选 择 算 法 后 区 块 链 可 以 保 持 稳 定 出 块 ， 并 且 吞 吐 量 受 到 离 线 节 点 的 影 响 并 不  

大。

从两次交 易 发送频率不 同 的实验结果对 比 中 可 以看 出 ，

系统交易 数越多 ，

用

户 交易越频繁 ，

离线权威节点对于 系统 出 块的 影响就越大 ，

改 进 算 法 就 更 能 发 挥  

作用 。

根据之前对于

ｃ ｌ ｉ ｑｕｅ

算法 的研 究 ，

这 个 结 论 其 实 并 不 难 以 得 出 。  

在 算 法 节 机 时 计 算 方 式 如 ｃ ｌ ｉ ｑ ｕｅ

中 ， ｎ ｏ ｔｕｍ

点 的 随 延 迟 间 ｄｅ ｌ ａｙ

下 ：

零 ｅ １

’

抑 ｅ ｎ

＋ Ｄ Ｄ ｄ ｅ ｌ ａｙ  －  ｄ ｅ ｌ ａ ｙ 

ｍ  ｔ ｉ

ｅ ．

ｕ

ｒａ

ｔ

ｉ

ｏ

ｎ


（

ｒ

ａ

ｎ

ｄ 

（

ｔ

ｉ

ｍ

ｅ

．



ｕｒａｔｉｏｎ
（

ｆ

＋   ｉ

＊ｗ ｉｇｇ ｌ ｅ Ｔｉ ｍｅ

＾ ｊ 

ｊ

其 中 Ｔ ｗ ｉ ｇ ｇ ｌ ｅ

ｉ ｍ ｅ＝５ ０ ０ ｍ ｓ ，

３－ １

（

）  

算 法 会 在 超 权 威 个 数 即 ｃ ｌ ｉ ｑ ｕｅ

不过 （

节点

＋ ／ ２

＊
１ ）

５ ００ｍｓ

的 时 间 内 随机推迟

ｎ ｏ ｔｕｍ

节点 的出块 ，

因 此系 统每秒接受 的交 易 数越 多 ，  

节 不 线 当 ｉ ｎｔｕ ｒｎ

点在时 ，

该 延 迟 时 间 对 于 系 统 性 能 的 影 响 就 越 大 。  

当 节 点 状 态 变 化 较 为 剧 烈 时 ， 可 以 看 出 虽 然 改 进 后 的 算 法 也 明 显 受 到 了 影 响 ，

系 统 吞 吐 量 有 了 定 一 的 下 降 ， 但 是 影 响 并 不 是 非 常 大 同 时 吞 吐 量 的 变 化 趋 势 也 相  

对较为稳定 ；

但是对 比没有使用 改进算法的 系 统吞吐量下 降非常 明 显 ，

这 是 因 为  

可 能 存 在 半 数 以 上 的 节 点 同 时 离 线 的 情 况 ， 此 时 系 统 出 块 陷 入 死 锁 无 法 继 续 出 块  

也 就 无 法 继 续 打 包 交 易 ， 系 统 吞 吐 量 将 持 续 为 ０ 直 到 当 前 的 权 威 节 点 中 半 数 以 上  

的 节 点 重 新 回 到 在 线 状 态 。 因 此 改 进 后 的 算 法 可 以 作 为 这 种 特 殊 情 况 的 兜 底 ， 使

２ ７

北京 邮 电大学工程硕士 学位论文



  

得 系 统 即 使 处 于 节 点 状 态 剧 烈 变 化 的 情 况 下 也 能 保 持 一 定 的 吞 吐 量 继 续 出 块 ， 尽   量 降 低 影 响 。  

３ ． ６ 本章小 结  

本 章 首 先 对 常 见 的 共 识 算 法 进 行 了 介 绍 ， 并 对 以 太 坊 中 使 用 的 基 于 ＰｏＡ 的

算 共 识

体 行 宄 其 机 法 的 具 ｃｌ ｉ ｑｕｅ 原 理 进

了研

， 通过对

以 及 ｒｅｃｅｎｔ

ｉ ｎｔ ｕｒ ｎ ／ｎｏ ｔ ｕ ｍ

制  

的 研 究 明 确 了ｃｌｉ ｑｕｅ 算 法 中 控制 出 块 的 时 机 并 发 现 了 由 于 ｉｎｔｕｍ 节 点 可 预 知 而 给  

ｃｌ ｉｑｕｅ

算法带来 的 潜在风 险 ；

通 过对 ｃｌｉｑｕｅ 中 权 威 节 点 变 更 方 法 的 研 究 明 确 了 权  

威 节 点 与 非 权 威 节 点 之 间 互 相 转 换 的 可 行 性 。 针 对 上 述研 究 以 及 分 析 ， 在 ｃｌｉｑｕｅ   算 法 的 基 础 上进 行 改 进 ， 在 此 之 上 提 出 了 权 威 节 点 动 态 选 择 算 法 。 不 将 消 费 者 纳  

入权 威 节 点 的 考 虑 范 围 内 ， 同 时 不 断 更 新 权 威 节 点 列 表 使 得 列 表 中 节 点 尽 可 能 地  

保持活跃 ，

从而使得 出 块速度和 系统稳定性都得到提升 。

通 过 ｇｅｔｈ 提 供 的 工 具  

ｐｕｐｐｅｔｈ 来 生 成 创 世 纪 区 块 时 可 实 现对 共 识 算 法 的 更 改 ， 开 放 ｒｐｃ 接 口 实 现 与 以 太坊 节 点 间 的 交 互 。 通过 实 验对 比 发 现 改 进 算法 使 得 系 统 吞 吐 量 得 到 了 提 升 ， 能

使 系 统 保 持 持 续 稳 定 的 出 块 ， 当 交 易 越 频 繁 时 ， 算 法 的 提 升 效 果 越 明 显 。  

２ ８

第 四 章 基于 区块链 的农副产 品溯源系统的需求分析与总体设计



  

第 四 章 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 需 求 分 析 与 总 体   设 计  

本 章 对 本 溯 源 系 统 进 行 了 需 求 分 析 与 总 体 设 计 ， 明 确 了 系 统 对 于 区 块 链 存 储  

溯源信息 的 需求

以及系统的主要功能需求 ；

并 在 此基 础 上 进 行 了 系 统 的 逻 辑 结 构  

设 计 、 功 能 模 块 设 计 以 及 数 据 库 设 计 等 。  

４． １ 系统 需 求 分析  

４． １ ． １ 系统用 例设计  

系 统 最 主 要 的 需 求 是 实 现 核 心 的 溯 源 功 能 ， 其 主 要 包 括 了 上 传 溯 源 信 息 和 查  

询溯源信息 ；

系 统还包括最基础 的登录注册功 能 ，

以 太 坊 的 接入 申 请 以 及 对 接 入  

申 请 的 审 核 功 能 。  

如 图 ４ １ － 所示 为 系 统 用 例 设 计 图 ， 系 统 中 用 户 主 要 分 为 管 理 员 、 生 产 商 、 经  

销 商 、 零 售 商 和 消 费 者 五 大 类 。 除 了 管 理 员 之 外 的 其 他 角 色 用 户 首 次 使 用 系 统 时  

需 要进 行 注 册 ， 注 册 成 功 后 消 费 者 可 以 直 接 进 行 溯 源 查 询 ， 但 是 商 家 用 户 需 要 额  

外 的 接 入 申 请 才 能进 行 溯 源 信 息 的 上传 。 管 理 员 通 过 审 核 后 商 家 用 户 可 以 进 行 信  

息 上 传 。 管 理 员 和 消 费 者 只 拥 有 根 据 溯 源 编 码 查 看 溯 源 信 息 的 功 能 ， 其 他 三 种 商  

家 角 色 可 以 上 传 交 易 信 息 和 产 品 信 息 至 区 块 链 。  

２ ９

北京邮 电大学工程硕士学位论文



  

农 ＿ 产 品 溯 源 系 统  

用 户 审 核  
Ｚ
．
Ｚ  源 查  

ｍ  

，

一

Ｗ  

 ＼ Ｚ ／   ：
（  ｇ Ａ ＾  ｉｉ Ｉ  ｘ  ／

Ｍｍ  

ｓｍ ｍ ，

消 费 ＃  

— 八，

々   ， ： ＇

：

：

：

＇
Ｂｒ
画ｐ  ＼ 义 ＾＞ ；

—

－

ｒ

—— —— ——

．．

．

．

—

減臟上

Ｈ ｉ ＾：３

｜

 Ｚ
生产商 ，

戀賴 薄靈 商

＇  
，

图 ４－ １

系 统 用 例 设 计 图

系 统 主 要 的 功 能 需 求 如 下 ：  

（ １ ） 登 录 ／注 册 ： 所 有 用 户 接 入 系 统 前 需 要 进 行 登 录 或 注 册 才 可 使 用 系 统 功 能  

（ ２ ） 用 户 审 核 ： 主 要 用 于 管 理 员 对 申 请 接 入 的 商 家 用 户 的 资 质 信 息 等 进 行 查 看  

与 核 验  

（ ３ ） 溯 源 查 询 ： 接 入 系 统 的 用 户 可 以 输 入 产 品 溯 源 码 来 对 产 品 的 溯 源 信 息 进 行

查 看  

（ ４ ） 接 入 申 请 ： 商 家 用 户 在 接 入 系 统 前 需 要 提 交 接 入 申 请 供 管 理 员 审 核 ， 以 此  

来 确 保 可 进 行 溯 源 信 息 上 传 的 用 户 不 是 恶 意 或 无 资 质 的

（５）

溯源信息上传 ：

用 于商家用 户 上传产 品 的溯源信息 ，

可 支 持 单 个 上 传 与 批  

量 上 传  

４ ２ １ ．

．

区块链溯 源 信 息存 取 需 求  

想 要 完 成 基 于 区 块 链 的 溯 源 就 需 要 将 溯 源 信 息 存 储 至 区 块 链 中 ， 每 次 上 传 信  

息 时 将 溯 源 信 息 存 储 在 区 块 链 中 ， 溯 源 时 根 据 溯 源 码 进 行 查 询 从 区 块 链 中 获 取 不  

可篡改 的可靠溯源信息 。

溯源信 息 的 存储与 查询主要借助智 能合约来实现 ，

智 能

合 约 需 要 提 供 合 约 函 数 使 得 溯 源 信 息 能 够 进 行 写 入 与 读 取 ， 同 时 也 要 具 备 对 上 传

３ ０

第 四 章 基于 区块链的农副 产 品 溯源系统的需求分析与总 体设计



  

的 溯 源 数 据 进 行 检 查 和 判 断 的 逻 辑 功 能 ， 如 一 个 产 品 的 生 产 商 只 能 有 一 个 等 。   想 要 把 信 息 存 储 上 链 就 需 要 与 合 约 函 数 进 行 交 互 ， 而 每 次 对合约 函 数 的 调 用  
都 是 通 过 发 起 对 合 约 账 户 的 交 易 来实 现 的 。 发 起 交 易 的 用 户 需 要 通 过 自 己 的 私 钥   对 交 易 进 行 签 署 ， 交 易 被 成 功 签 署 后 由 矿 工 节 点 接 收 并 进 行 打包 存 储 至 区 块链 的   交 易 树 中 ； 当 交 易 被 成 功 打 包 后 既 代 表 了 一 次 与 智 能 合 约 交 互 的 完 成 。  

４ ． １ ．３ 区块链大文件存储需求  

在 溯 源信 息 存 储 的 过 程 中 ， 可 能 会 有 存 储 图 片 等 较 大 文 件 的 需 求 ， 如 存 储 商  

家 的 营 业执 照 等 ， 存 储 此 类 信 息 可 以 使 得 商 家 的 身 份 更 加 可 信 。 而 在 区 块 链 中 ，  

每 个 区 块 的 大 小 不 是 没 有 限 制 的 ， 当 数据 大 于 区 块 大 小 的 上 限 时 ， 需 要 对 数 据 进  

行 切 片 存 储 ， 分 割 和 组装 的 过程 必 然 影 响 效 率 。 同 时 大 量 的 数据 上链 也 会 使 得 区

块 链变 得 臃 肿 ， 造 成 区 块 链数 据 的 冗 余 。  

与 其 他 文 件 存 储 系 统 不 同 ， 由 于 ＩＰＦ Ｓ 是 基 于 内 容 寻 址 的 ， 因 此 其 本 身 就 拥  

有 防 篡 改 的 特 性 。 数 据 哪 怕 进 行 了 任 何 一 个 微 小 的 改 动 地址 都 将 随 之 变 化 。 想 借  

助 修 改 文 件 达 到 目 的 ， 难 度 就 陡增 。 Ｉ ＰＦ Ｓ 通 过 Ｍｅｒｉｄ ｅ ＤＡＧ 进 行 数 据 存 储 ， 当 数  

据较大时会进行拆分 ，

每个节点存储其中 的 几块 ，

这 样 就 保 证 了 不 会有 节 点 获 得  

他人文 件 的 全部数据 ，

保证 了 数据的 安全性 。

当 上传文件至

Ｉ ＰＦ Ｓ

节点后 ，

节 点  

会 返 回 一 个 哈 希 值 ， 这个 值 是 一 个 长 度 为 ４ ６ 的 字 符 串 ， 其 是 原 始 文 件 在 经 过 数  

据 封装 、 哈 希 计 算 、 结 果 转 换 等 一 系 列 操 作 后 得 到 的 结 果 。  

可 以 看 出 ， ＩＰＦ Ｓ 其 分 布 式 以 及 基 于 内 容 寻 址 的 特 点 保 证 了 去 中 心 化 和 防 篡  

改，

与 区块链的特性相吻合 ，

二 者 结 合 可 以 实 现 大 文 件 的 上 链 存 储 。  

４． １ ４ ． 共识算法 需求   共 识 算 法 确 保 了 区 块 链 中 由 哪 个 节 点 来 进 行 出 块 ， 因 此 共 识 算 法 的 选 择 对 整  
个 区 块 链 的 安 全 性 以 及 运 行 的 稳 定 性 和 响 应 时 间 都 至 为 重 要 。 共 识 算 法 应 该 更 加   适 合联 盟 链 的 特性 不 消 耗 过 多 的 算 力 来 进 行 无 意 义 的 计 算 ， 同 时 也 尽 量 使 得 参 与 出 块 的 节 点 不 是 恶 意 的 或 易 受攻击 的 ， 使 其 尽 可 能 地 保 持 活跃 在 线 从而 避 免 用 户 发 出 的 请 求 因 为 区 块 链 无 法 出 块 而 不 能 被 响 应 的 问 题 。 第 三 章 中 提 出 的 在 原 有 的 ｃｌｉｑｕｅ 共 识 算 法 基 础 上 进 行 改 进 的 权 威 节 点 动 态 选 择 算 法 可 以 保证 参 与 出 块 的 权   威 节 点 尽 可 能 地 保 持 活 跃 和 在 线 ， 从 而 满 足 对 系 统 稳 定 出 块 的 需 求 。

３ １  

北京邮 电大学工程硕士学位论文



  

４ ． ２ 系 统整 体 架 构 设 计  

２ ４ ．

．１

系 统 逻 辑 结 构 设计  

如图

４ －２

所示为系统 的整体逻辑结构 ，

包 含 系 统 中 的 各 个 部 分 以 及 用 户 在 使

用 系 统 时 系 统 的 整 体 运 作 流 程 。 在 区 块 链 节 点 网 络 中 有 多 个 接 入 区 块 链 的 主 机 节  

点 ，

它 们共 同 构成一个 Ｐ２Ｐ

网络 ，

溯 源 信 息 会 存 储 在 区 块 链 中 并 在 各 个 节 点 之 间

扩 散 和 广 播 。 溯 源 系 统 与 所 搭 建 的 区 块 链 节 点 网 络 建 立 连 接 来 实 现 溯 源 信 息 的 上  

传 与 查 询 。 用 户 在 操 作 系 统 时 可 以 输 入 溯 源 信 息 ， 系 统 获 取 到 溯 源 信 息 后 通 过 与

区 块 链 网 络 建 立 的 连 接 将 溯 源 信 息 上 传 至 区 块 链 中 当 上 传 的 信 息 中 包 含 图 片 、   ；

附 件 等 非 表 单 类 数 据 时 ， 系 统 会 与 搭 建 的 Ｉ ＰＦ Ｓ 节 点 建 立 连 接 ， 将 文 件 上 传 至 Ｉ Ｐ Ｆ Ｓ  

中 ， 系 统 获 取 Ｉ ＰＦ Ｓ 返 回 的 文 件 哈 希 值 并 将 其 上 传 至 区 块 链 中 。 系 统 中 一 些 无 需  

去 中 心 化 的 数 据 存 储 在 数 据 库 中 ， 如 进 行 登 录 和 注 册 等 操 作 时 ， 系 统 从 数 据 库 中  

读 取 和 存 储 数 据 来 实 现 系 统 其 他 部 分 的 功 能 。

Ｉ Ｐ Ｆ Ｓ
星 际 文 件 系 统  

手  

返 國 函片 ｉｋ

 图 Ｍａ ｓ ｈ

／ ＾  

   区
厂

块

链

节

点

网

络

４ ；
］

  节 点 存 储 图 片  辱－

！

丨

ａ ｌ 丨

？ ？ 存 储 数 据  
ｔ

点 ＊

５ 读 取 数 ？ ？ ？

？？…

５

 溯 源 系 ＃ 数 据 库  
｜

Ｔ Ｔ
！

 〇   节 点３ Ｉ

 节 点４

 ＣＤ  
１





用 户  

图 ４ － ２ 系 统 逻 辑 结 构 图

４ ． ２ ． ２ 系 统 架 构 设计  

如 图 ４ ３ － 所 示 为 系 统 架 构 设 计 图 ，

系 统 主 要 分 为 应 用 层 、 业 务 层 、 合 约 层 、  

共 识 层 、 网 络 层 和 数 据 层 六 层 。  

应 用 层 主 要 完 成 系 统 与 用 户 的 交 互 以 及 页 面 的 展 示 等 ， 主 要 包 括 前 端 进 行 页

面 展示 的

ｖｕ ｅ

框架 ，

以 及与 其相配合使得页面展示更加 直观的

ｗｅｂｇｉ ｓ

和

ｈ ｅ ｃ

ａ ｒ ｔ ｓ ；

３ ２

第 四 章 基于 区块链 的农副 产 品 溯源系 统 的 需求分析与总体设计



  

还 有 与 以 太 坊 交 互 的 ｗｅｂ３ ｊ ． ｓ 接 口 。 用 户 通 过 应 用 层 的 ｗｅｂ 端 进 行 注 册 、 登 录 ，   或 者 进 行 溯 源 信 息 的 查 询 以 及 录 入 等 。  

业务 层 主 要 实 现 系 统 各 个功 能 的 业 务逻 辑 ， 业 务 类 型 主 要 分 为两 部 分 ， 与 以

太 坊 进 行 交 互 的 业 务 如 溯 源 和 以 太 坊 账 户 注 册 等 以 及 一 些 通 用 业 务 ， 主 要 包 括溯  

源 部 分 除 智 能 合 约 外 的 业 务逻 辑 如 地 图 展 示 、 用 户 审 核 、 和 登 录 注 册 等 。 其 作 为  

系 统 中 除 了 以 太坊 智 能 合 约 外 的 另 一 个 后 台 服 务 端 ， 完 成 没有 去 中 心 化 需 求 的 其  

他 业 务 逻 辑 。  

合 约 层 包 括 完 成 溯 源 功 能 的 以 太坊 智 能 合 约 ， 包 括 溯 源 主 智 能 合 约 、 产 品 信  

息 智 能 合 约 和 商 家 信 息 智 能 合 约 ， 合 约 层 相 当 于 系 统 中 的 第 二 个 后 端 。  

共 识 层 即 为 以 太坊 所 使 用 的 共识 算 法 ， 本 系 统 使 用 了 以 太 坊 提 供 的 Ｐ ｏＡ 共  

识 算 法 Ｃ ｌｉｑｕｅ ， 并 在 其 基 础 上 设 计 了 权 威 节 点 的 动 态 选 择 算 法对 ｃｌｉ ｑｕｅ 进 行 了 补  

充 和 改 进 。 两 者 相 互 配 合 共 同 构 成 系 统 的 共 识 层 。  

网 络 层 主 要 为 在 区 块 链 中 的 各 个 节 点 间 建 立 Ｐ２Ｐ 连 接 以 及 各个 节 点 对 区 块  

的 信 息 进 行 验 证 提 供 了 支 持 。  

在 农 副 产 品 运输 的 各 个环 节 ， 负 责 将 产 品 信 息 上 传 至 区 块 链 的 人 员 如 果 能 同

时 将 自 己 的 个 人 信 息 、 产 品 照 片 以 及 营 业 执 照 等 凭证 同 步 上 传 ， 就 可 以 使 得链 上  

数 据 更 加 可 信 ， 避 免 伪 造 虚 假 数据 上 链 。 考 虑 到 在 区 块 链 上 存 储 较 大 的 数 据 或 文  

件 需 要 消 耗 很 多 的 资 源 ， 所 以 将 图 片 等 信 息 存 储 上 链 并 不 合 适 。 ＩＰＦ Ｓ 的 去 中 心  

化 和 分 布 式 共 享 的 特性 以 及 对 文 件 的 大 小 的 无 限 制 使 得 其 可 以 很 好 地 解 决 这 个  

问 题 。 当 搭 建 完 成 属 于 自 己 的 ＩＰＦ Ｓ 节 点 后 ， 用 户 可 以 上 传 文 件 至 节 点 并 通 过 节  

点 返 回 的 哈 希 值 对 文 件 进 行 访 问 。 借 助 ＩＰＦ Ｓ 可 以 只 在 链 上 存 储 文 件 的 哈 希 值 ，  

从 而 大 大 减 少 了 区 块 链 的 开销 。  

出 于这种考虑 ，

数据层主要分为三部分 ：

存 储 去 中 心 化 数 据 的 区 块链 数 据 服  

务 、 存 储 需 要 上 链 的 较 大 数 据 的 ＩＰＦＳ 节 点 服务 和 存 储 可 中 心 化 管 理 的 其 他 数据  

的 数 据 库 。 其 中 ＩＰＦ Ｓ 与 区 块 链通 过 哈希 值 进 行 交 互 。  

３ ３

北京 邮 电大学工程硕士学位论文



  

――

  １

   应 用 层    ｗ ｅ ｂ Ｂ ｊ ｓ

Ｖｕｅ． ｓ ｊ

ｒ—
ｒ

 ｒ — ￣ —

－￣

｜
ｅ ｃｈ ａ ｒｔｓ ｗｅ ｂ ｇｉ ｓ

丨

 以 太 坊 交 互

 通 用

ｉｉ 务 层  

ｉ

丨

丨

丨



ｉ

Ｉ

 灘 源 倍 息 录 入  溯 源 傖 悤 查 逾 Ｉ

  用 户 登 录  用 户 注 册

ｊ

１

」

二

＿













；

；

 ＊  
Ｉ ＿ ＿ ＿ ＿ ＿ ＿

ａ太 坊 藏 户 注册
Ｉ

商家接 入 申请



个人信息管理

｜

｜

丨

用户审核
ｉ  

  溯課 智 能 含 约

产 品值患 智 能 合 约

商家信患 智 能 合约

｜

｜

｜

ｊ

合 约 层  

 共 识 算法

基 子ＰＯＡ共识 的 权 威节 点动态 选 择算 法

；

共 ｉ只 层  

络 层    网 Ｐ Ｚ Ｐ 网 络  传 输 ＃１制  验 ｉｌ 桃制  ｇ ｅ ｔ ｈ？ 盟 链

 Ｑ Ｑ  Ｉ

？Ｓ

ｙ－＊

Ｓ

｜

２＾

 以 太 坊 区 块 链 数 据 服 务

ｊ  

块 二 … Ｌｉ

 ％   ｗ ｅ ｉ

ｒｋ

 －

ｔ

；ｃ

＝

Ｉ

｜

｜





）

ｉ

！   ）  

ｉ

＿ ｊ
｜











 ？  
 ；

  螓 卷 函 数  ＿蜀 戳  審 対称 加 巒
ｆ ｜
＾：：：：：：二＝：：： ：：：：二」 星 际 文 件 系 统 一

图 ４ ３ － 系 统 架 构 设 计 图

４ ． ３ 系 统 功 能 模块 设 计  

系 统 功 能 模 块 设 计 图 如 图 ４ ４ － 所 示 ，

整 个 溯 源 系 统 主 要 包 括 三 个 大 的

模块 ，

登录注册模块 ，

用 户 管理功 能模块和产 品溯源功 能模块 ，

其 中 系 统  

的 主 要 模 块 是 产 品 溯 源 功 能 模 块 其 中 每 个 大 模 块 下 又 细 分 为 多 个 小 模   ；

块 。  

登 录 注 册 模 块 主 要 实 现 用 户 对 系 统 的 登 录 和 注 册 ， 主 要 包 括 用 户 登  

录 、 普 通 账 户 注 册 和 以 太 坊 账 户 注 册 这 些 子 功 能 。 每 个 用 户 除 了 拥 有 最 基  

本 的 账 户 信 息 外 还 拥 有 以 太 坊 账 户 信 息 ， 该 模 块 会 根 据 用 户 自 己 设 定 的 以  

太 坊 账 户 密 码 生 成 以 太 坊 账 户 。

用 户 管 理 功 能 模 块 主 要 完 成 包 括 个 人 信 息 管 理 、 用 户 审 核 和 接 入 申 请  

在 内 的 用 户 信 息 管 理 以 及 对 区 块 链 的 接 入 审 核 功 能 。 用 户 可 以 对 包 括 密 码  

３ ４

第 四 章 基于区块链的农副产品 溯源 系统的需求分析与总体设计



  

在 内 的 自 己 的 个 人 信 息 进 行 查 看 与 修 改 同 时 管 理 员 可 以 对 申 请 接 入 区 块   ；

链 进 行 信 息 上 传 操 作 的 商 户 进 行 审 核 ， 审 核 通 过 的 商 户 可 以 获 得 以 太 坊 账  

户 地 址 并 接 入 以 太 坊 进 行 溯 源 信 息 的 上 传 。  

产 品 溯 源 功 能 模 块 是 系 统 最 主 要 的 功 能 模 块 ， 其 主 要 完 成 系 统 与 区 块  

链 平 台 以 太 坊 的 交 互 并 实 现 溯 源 信 息 存 储 上 链 和 信 息 的 查 询 展 示 ， 确 保 准

确 可 靠 地 实 现 对 溯 源 信 息 的 去 中 心 化 存 储 。 主 要 包 括 上 链 前 信 息 确 认 、 批  

量 溯 源 码 上 传 解 析 、 溯 源 结 果 分 析 、 错 误 信 息 分 析 、 信 息 修 改 、 单 个 产 品  

上 传 、 溯 源 结 果 查 询 等 子 功 能 。 产 品 溯 源 模 块 不 只 支 持 单 个 产 品 操 作 ， 同  

时 提 供 批 量 操 作 可 以＃ ５见 信｜的 批 量 录 入 与 分 析 ， ＂   基 于 区 ｇ 链 的 农 ｉｊ 产 品 溯 源 系 统  

提 高 信 息 录 入 效 率 。  

＿＿
 ｉ

：

： 

｜ 



ｉ  

  

登 录 注 册 梭 块  用 户 管 理 功 能 授 坱  产 品 漂 Ｓ 功 能 模 块  
：

．

       ｊ
ｔ

１
＾

Ｉ

＇

— ＂ ＂ ＂

；

；

：

；

  ｒｒ

ｉ

 丄

ｌ

厂
：

＾ 「溢

 ｒ ：

Ｔ

ａ

＾ ＇

丄 －  

ｒ

ｉ「

；

    ＊

ｔ

个

￡

    ａ ２

人

用接

ｐ

卢
     ２

 

？ ｐ





＊ ？





信

户 ；
审：

入 Ｊ

申

ｆ

ｌ

瀠

Ｊ５ 

源 结

＾

集

ｓ

  注

管

核

 清 ￥

￡ ：



？

１ 理

Ｓ

Ｓ

分 析

裙


ｉ

单

多

？  ｍ  

误

信

１

＾

个 个 ｓ

ｓ  

 ２  § ｉ ｎ

．
；



产 产 结  结  
：

 ｆ

ｓ ＆累
：

果  

  分 改 ｊ

析

ｆ

＇

上 ：



传

上  查 展  

传

询

示  



ＬＪ

｜

１

 ｜

１

Ｉ

   ＃       Ｊ Ｉ＿

；—

：

１ ｊ

Ｌ



Ｉ

１

；

Ｉ

！

—

＿

Ｉ

Ｉ—

＿

｜

ｊ

— ＿  

图 ４ － ４ 系 统 功 能 模 块 设 计 图

４ ． ４ 系 统 区 块 链溯 源 设 计

４ ４ ．

１ ．

区块链溯源 流程设计  

在 与 区 块 链 平 台 以 太 坊 进 行 交 互 的 过 程 中 ， 每 一 次 调 用 智 能 合 约 函 数 的 操 作

如 上 传 溯 源 信 息 等 ， 其 实 都 是 一 次 交 易 的 发 起 。 如 图 ４ ５ － 所 示 为 交 易 打 包 过 程 图 ，

在 区 块 链 中 一 次 交 易 从 发 起 到 打 包 的 过 程 如 下 ：

１．

用 户 发起一笔交 易 ，

即 调 用 合 约  

２ ．

用 户 使 用 私 钥 签 署 这 个 交 易

３ ． 交 易 在 被 签 名 后 被 发 送 给 接 入 网 络 的 某 个 节 点

４ ．

节点对交 易进行验证，

验证有效通过后放入交 易 队列 中 ，

此 时 该 交 易 为  

状 态 Ｐ ｅｎ ｄ ｉ ｎ ｇ

，

所 有 人 都 可 以 读 取  

５ ．

节 点 将 该 交 易 向 其 它 的 邻 近 节 点 进 行 广 播  

６ ．

接收到这个交 易 的 节 点 会对交 易 进行验证 ，

验 证 通 过 后 继 续 进 行 广 播  

３ ５

北京 邮 电大学工程硕士学位论文



  

７ 重 复 上 述 步 骤 直 至 交 易 在 全 网 广 播 完 成   ．

８ ．

矿 工 生 成 新 的 区 块 并 将 交 易 打 包 进 去  

９ 新 产 生 的 区 块 向 全 网 广 播 ．

０ １

．

所有节 点 接收新 区 块并从

自

己的交易

队 列 中 移 除 该 区 块 所 包 含 的 交 易

，



调

＿
，

合

约



用

户

签

署

交

交 赛发 送全

发 ＇ 起 交 ｓ  ａ 以 太坊节 点

，
＿

节 点 验ｆ交 易 放入 交易 池

＾＾  向 部 逬 节 点 广 播 交 》

Ｘ Ｉ

？ ＾  ｔ ｏ 

，





所有 触

节 区

ｓ 块

 一 新 ＿  ｒ ±

－
ｎ
８

一

 交暴 ｔｒｍ 到

＿ 其 － 节 点 验证 免  

整 个 ＿ ？ Ｓ 并 賴 广 播  

结 束  

图 ４ ５ － 交 易 打 包 过 程 图

根 据 以 上 对 区 块 链 中 一 次 交 易 打 包 过 程 的 描 述 ， 本 文 设 计 了 实 现 区 块 链 溯 源  

即 与 智 能合约 交互 的 一次完整 的流程

如 所 示 图 ４ － ６

。

溯 源 的 过 程 主 要 分 为 两 个

，

部分 ：

通过合约 部署并通过

ｗｅｂ３ ．

ｓ

与 以 太坊建立连接 、

数 据 被 广 播 并 存 储 进 区

ｊ

块 链 中 。  

首 先 将 编 写 好 的 合 约 代 码 部 署 到 搭 建 好 的 以 太 坊 环 境 中 ， 通 过 获 取 到 的 ＡＢ Ｉ

和 合 约 实 例 与 合 约 进 行 交 互 ， 上 传 溯 源 信 息 。 当 调 用 合 约 后 ， 相 当 于 一 次 交 易 产  

生 ，

上传信息 的用 户 输入 自 己的 以太坊账户 私钥进行交易签名 ，

并 将 该 交 易 发 送  

至 连 接 的 以 太 坊 节 点 中 。 以 太 坊 中 的 节 点 在 接 收 到 这 笔 交 易 后 会 将 交 易 在 整 个 区  

块链 的

Ｐ２Ｐ

网络 中 进行广播扩散 。

收到该交 易 的节点会对交 易 进行验证 ，

验 证 无  

误 的 交 易 会 被 负 责 出 块 的 节 点 打 包 进 一 个 区 块 中 ， 该 区 块 会 被 链 接 在 区 块 链 中 的

最长合法链 的末尾 ，

交 易 信 息被存储至 区块链中 。

至此 ，

这 些 步 骤 形 成 了 一 个 完

整 的 ｆｅ 息 上 传 流 程 。  

＾  令 ｆ

Ｗ ／

ｅｂ ３ ． ｓ

ｊ

以 太 坊   Ｅ ｔ ｈ ｅ ｒｅ ｕ ｍ 



合 约 夂互 ＡＰ 丨

 査询 ／ 上 传 瀰 源 信 ， Ｓ

Ｎ ｅ ｔ ｗ 〇 ｒ ｋ  

 Ｔ ｒ ａ ｎ ｓ ａ ｃ ｔ ｉ ｏ ｎ

ｄ Ｓ ｉ ｇ ｎ ｅ

Ｉ

ｒａ

ｎ

ａ ｓ

ｃｔｔ

ｏ

ｎ  

Ｓ  ｖ ｍ Ｐ ｉ ｅｖ

ｉ

？ ？ ？

     ｒ ｍ ｅ ｒ

Ｔ ？ ａ 〇 ＾ ｒ

）

± ￡

！

〇

Ｔ ｄ ？ ｏ  ａ

ｄｒ ｔｆ

Ｔ ｏ ｓ ａ ｄ ｆ ｆ ｉ ＆ｓ 

Ａｃ ｃｅ ｐｔ ／

ｆｉ

娜  签    如

ｒ ＋ 拟  — ￣

－

名

Ｍ  Ｄ ａ ｗ ｅ Ｖ ｉ

ｔ ｅ ｂｙ ｔ ＾ ｗ

）

＾ Ｒ Ｂ

ｃｔ

Ｃ Ｓ ｅ ｎ ｌ   ，  

―

    ＇ 厂 Ｃ ｒ ｒ ａ ｔ ｒ ．

ｖ ：ｉ

６ ｐ  ｏ ａ ｖ

ｃ ｆ ｌ

（

＊

ｐｒ

．

…

…

ｃｍｋ  ？

〇  ？  Ｇ  Ｓ  －

Ｃ

ｎｔ

ａ＜

ｔ

Ｔｊ ３ｃｅ Ｃ６

ｒ ａ ｔｔ

ａ Ｍ ｎ ｓ 

ｒ

ｉｔ

ａ ｎ ｓ

ｉ ｆｆ

ｉ；

、

Ｚ

Ｖ ＇

’  

＾ ＾  ｄ ｅ ｐ ＜ ？

ｗ ａ Ｅ

ｆｉ ｉ

＞ ５

  ＾

 Ｗ  Ｃｔ ｔ ａ ｗ ｓ ｕ ｍ

ｉｉ ｈ

ｗ ｆ

ａ

： Ｆ ａ ｓ ？ ＊ ｐ ？？ ！

〇  Ｅ

＆ ５ Ｓ Ａ

ｇＪＷｔ ｕ ｒ ｅ

？  Ｃ ｈ ｅ

…  ． ． ．  

  Ｃ ｏ ｍ ｐ ａ ｃ ｔ  ｜

ｊ

■

■

■

＿

 

 Ｊ  Ｔ ｔｍ ｍ ｏ ｎ ？ Ｋ ？ ｔ ｒ ｉ ？ ｒ ｓ ｓ ？ ｃ

ｉ

｜Ｔ

ｆ＜

￣ ￣—￣ —

ｒ ￣



   —



  

—

 Ｂ ｌ ｏ ｃ ｋ ｃ ｈ ａ ｍ

Ｎ ｅ ？  Ｂ ｌ ｏ ｃ ｋ  

冰

 权 威 节 点  Ｂ ｏ Ｈ ｄ ？ ？ ？



ｃ ｆｅ
ｌ

ｓ ｅ ｔ

＾ ＊  ｔ

－



 打 包 区 块
．

 Ｔ ｒ ａ ＾

 ｏ Ｔ ｒ ａ ｎ ｓ ａ ｃ ｔ ｉ

ｎｉ

 Ｍ Ｔ ｒ ａ ｍ ａ ｃ ｔ ｒ ｏ ｒ ；  １

ｋ ｉ ｅ ｓ

 Ｓ￡  ＿ ＿ ：

ｃ

２

ｒ

＾ ＿  

 Ｓ ５

＾

１ ＳＳ

ｍ    Ｃ ａ

—＞
：

Ｔ

ｔ＾ａ

＾

ａ

ｔ

Ｏ

ｆ ｉ



．



？  ？

  ＊

Ｒｃｃ ｅｉ

＾ ｊ

Ｓ＾ａ ｎａｇｅ ｒ 

 ？

Ｉ

ｔ ｅ  ｆ ｅ Ｔ ｊ ａ ｎ Ｍ ｃ ｌ

ｎｒ ？ 

Ｔ ｒｏ ｍａ ｃｔ

ｎ  ｎ  

图 ４ － ６ 区 块 链 溯 源 流 程 示 意 图

３ ６

第 四 章 基于 区块链的 农副 产品 溯源系 统的 需求分析与总体设计



  

４ ． ４ ． ２ 区 块链大 文 件存储设计 方 案  

Ｉ Ｐ Ｆ Ｓ 的 分 布 式 存 储 和 基 于 内 容 寻 址 的 特 性 使 其 能 够 很 好 地 保 证 去 中 心 化 和  

防篡 改 ，

与 区块链的 特性相 吻合 ，

因 此 利 用 Ｉ Ｐ Ｆ Ｓ 可 以 很 好 地 解 决 大 文 件 上 链 的

问 题 。 区 块 链 与 Ｉ Ｐ Ｆ Ｓ 交 互 示 意 图 如 下 图 ４ － ７ 所 示 ， 在 搭 建 好 Ｉ ＰＦ Ｓ 节 点 后 ， 上 传  

至 Ｉ Ｐ Ｆ Ｓ 节 点 的 文 件 会 在 经 过 一 系 列 的 加 密 处 理 和 计 算 后 返 回 该 文 件 的 哈 希 值 ，  

该 哈 希 值 是 一 串 长 度 为 ４ ６ 的 字 符 串 。 文 件 由 一 个 几 Ｍ 甚 至 几 十 Ｍ 的 大 小 变 为

一 串 字符 串 ，

将哈希值存储在区块链中 ，

可 以大幅降低链上空间 的 占用 ，

使 存 储  

和 读 取 变 得 更 加 轻 松 。  

当 上传 的 文件大 小大 于 ２５６ＫＢ 时 ，

Ｉ Ｐ Ｆ Ｓ 会 将 文 件 进 行 拆 分 并 在 一 个 空 白 的

Ｏｂ ｅ ｃ ｔ 中 存 储 组 织 起 来 每 个 节 点 可 能 存 储 其 中 一 个 或 几 个 部 分 使 得 每 个 节 点  

ｊ

，

，

无 法 获 取 整 个 文 件 的 内 容 ， 确 保 了 其 安 全 性 。  

大 于 的 文 ２ ５ ６ Ｋ Ｂ

ｉ 牛  

ｐ—

〇 ｖ 

ａ ｔ ａ  

上 传 文 件 存 储   

舞 

 ＊

 １

．

於 －

Ｄａ ｔａ

，

Ｌ ｉ ｎ ｋｓ

【

Ｊ

 ｌ

ｉ

ｎ

ｋｓ 

ｔ

ｌ

｝  

  Ｖ ｔ

ＴＴ

＇  

   ＊

＼

Ｄ ａ ｔ ａ

ｊ

返囡 哈希值… 一 」

  ｌ ｎ ｉ ｋｓ  

ｌ

＼

＾  诲 查 ？

 基 于 内 容 寻 址

 ？  
＼

 用 户 ＼  

Ｑ Ｖ Ｖ ｍ

ｍ ８ ．

．

ｒ５

１

 ｚ



ｉ 件＾ ▲ 值 国 哈 希 存 储 链 、  乂

度 字 符  ＾ｐＦ １  长 为 ４ ６ 的

串

卞 …：

鱉 ？ ？ ？

丨 ：

？

俏

上

＇
 ，

＇ 、

＿ ＿ ＿ ＿＿ 國 ■

＿

Ｉ １

Ｍ Ｉ

１

 ＂

〇 ａ ｔ ３

溯 源 智 能  区 块 链  

 Ｌ

ｎ
ｉ

ｋ

ｓ

１  

｛

Ｍ ＿ ■
Ｉ

合 约

图 ４ － ７ 区 块 链 与 Ｉ Ｐ Ｆ Ｓ 交 互 示 意 图

４ ． ４ ． ３ 溯 源数 据 的 页 面 展 示 设 计   溯 源 系 统 中 的 结 果 页 面 展 示 主 要 分 为 如 下 四 种 ： １ ）ｖｕｅ 和 ｅ ｌ ｅ ｍ ｅ ｎｔｕｉ 结 合 实 现 基 础 数 据 展 示 和 表 单 录 入   ２ ） 对 多 个 溯 源 结 果 进 行 综 合 分 析 和 统 计 ， 通 过 ｅ ｃ ｈａｒｔ ｓ 展 示 统 计 结 果   ３ ） 通 过 ｗ ｅ ｂｇｉ ｓ 在 地 图 中 展 示 溯 源 途 经 地 点 和 路 线 ４ ） 获 取 哈 希 值 在 Ｉ Ｐ Ｆ Ｓ 中 根 据 内 容 寻 址 获 得 并 展 示 图 片 如 下 图 ４ － ８ 所 示 为 溯 源 结 果 数 据 前 端 展 示 设 计 示 意 图 用 户 在 输 入 溯 源 码 后  
，
获 取 的 溯 源 结 果 主 要 形 式 可 分 为 三 种 类 型 ： 包 括 产 品 信 息 在 内 的 文 字 信 息 、 文 件   或 者 图 片 的 哈 希 值 以 及 包 括 经 炜 度 在 内 的 地 理 位 置 信 息 。

３ ７

北京邮 电大学工程硕士 学位论文



  

文字基本信 息直接通过前端框架

ｖｕｅ

和

ｅ ｌ ｅ ｍ ｅ ｎｔｕ ｉ

结合进行表单结果展示 ，

当 需 要 对 多 个 溯 源 码 的 溯 源 结 果 进 行 展 示 时 ， 借 助 ｅ ｃ ｈ ａｒｔ ｓ 进 行 图 表 的 统 计 分 析 ，

使 得 展示结 果 不 只

是表单数据 的堆砌 ，

而是对于用

户

来 说 更 加 容 易 查 看 和 理 解 的

统 计 结 果 图 片 的 哈 希 值 则 在 上 传 至 Ｉ ＰＦ Ｓ 节 点 后 将 获 取 到 的 实 际 图 片 在 前 端 进   ；

行 展示 ；

地理 位 置 信 息 需 要借 助 ｗｅｂｇｉｓ ，

在 地 图 上 将 不 同 位 置 点 通 过 气 球 样 式 的

Ｄ ３  ｏ ｂ ｅ ｃ ｔ ｊ

进行展示并使用 箭头路径将不 同 点进行 串 联 ，

使 得 溯 源 路 径 得 到 更 加  

直 观 的 可 视 化 展 示 效 果 。  

Ｑ ： 输 入

码

…．

网 ……

＾ ｊＫｌ — ｆ

＋？＋
文 件 ／ 函 片

？ ＜

＞  

 用 户

麵 系统

   １ Ｉ

漏单 卜

睹 〒査

地理

信 －  

 ； 

＼

ｉ

ｉ  

 ＊

 ＊

＊  ？

  ＊  ＊

？

？  

  ？

 ？

ｔ

＜  

   ＊

＊

＊

＊

＊ ＊ ＊

ｉ

   ＊

：

ｔ

ｉ  

ｗ ＋ ｏ〇  

   圈 片 展 ｖ ｕ ｅ

＋ｅ

ｅ
ｌ

ｍｅ

ｎ

ｔｕ

ｉ

ｅｃ ｈ ａ ｒｔｓ

ｔｐ ｐ￥

ｗ ｅ ｂ ｇ ｉ ｓ  

表 单 展 示 溯 源 结 果 统 计 节 点 示 标 记 展 示

图 ４ ８ － 溯 源 结 果 数 据 前 端 展 示 设 计 示 意 图  

４ ． ５ 数 据 库 设 计  

下 面 给 出 系 统 中 使 用 ｍ ｙ ｓｑｌ 进 行 中 心 化 存 储 的 数 据 的 表 结 构 设 计 。  

链上上传交 易 信息表主要用 于存储 由 于信息上链而发起的交 易

的数据 ，

具 体  

结 构 见表 ４－ １  

表 ４－ １

链上上传 交 易 信息表





  

   名 歹Ｕ

说明

数据类型

约 束

｜

｜

｜

 交 易 信 息 增  ｄ ｉ

自

 ｄ ｉ

ｎ ｉ

ｔ

ｐ ｒ ｉ ｍ ａｒｙ  ｋ ｅ ｙ

ｎ ｏ ｎ ｕ ｔ 

ｌ ｌ  

 溯 源 码  Ｃ ｔ ｒ ａ ｃ ｅ ｏ ｄ ｅ

ｖ ａｒ ｃ ｈ ａｒ ３ ０

（

）

ｎ ｏ ｎ ｕ ｔ 

ｌ ｌ

 交 易 哈 希 值   Ｈ ｔ ｒ ａ ｎ ｓ ａ ｃ ｔ ｉ ｏ ｎ

ａｓ ｈ

ｖ ａｒｃ ｈ ａｒ （

ｌ

ＯＯ ）

ｎ ｏ ｎ ｕ ｔ 

ｌ ｌ  

 交 易 发 送 者 以 太 坊  ｔｘＦ ｒｏ ｍ

ｖ

ａｒ

ｃ

ｈ

ａｒ （

ｌ

ＯＯ ）

ｎ ｎ ｕ ｏ ｔ 

ｌ ｌ

账户 地址



  

 交 易 接 收 者 以 太 坊  ｔｘＦ ｒｏ ｍ

ｖ ａｒ ｃ ｈ ａｒ １ （

００ ）

ｎ ｕ ｎ ｏ ｔ 

ｌ ｌ  

贩户 地址



  

 交 易 所 在 区 块 哈 希  Ｈ ｂ ｌ ｏ ｃ ｋ ａｓ ｈ

ｖ ａｒｃ ｈ ａｒ １ ０ ０

（

）

ｎ ｎ ｕ ｏ ｔ 

ｌ ｌ  

Ｍ



  

 交 易 所 在 区 块 高 度  Ｎ ｂ ｌ ｏ ｃ ｋ ｕ ｍ ｂ ｅ ｒ

ｖ ａｒｃ ｈ ａｒ（

ｌ

ＯＯ ）

ｎ ｏ ｎ ｕ ｔ 

ｌ ｌ

３ ８

第 四 章 基于 区块链的农副产 品溯源系统的 需求分析与总体设计



  

用 户 信 息 表 用 于 存 储 系 统 中 的 用 户 信 息 ， 包 括 用 户 基 本 信 息 和 密 码 等 ， 具 体  

结 构 见 表 ４ －２  

表 ４－２ 用 户 信 息 表







  

   ＞ 名 Ｊ ！

说明

数据类型

约 束

丨

｜

丨

 用 户 増  ｉ ｄ

自

 ｄ  ｉ

ｎ ｉ

ｔ

ｐ ｒｉｍ ａｒｙ  ｋ ｅｙ  

 ｎ ｕ ｎ ｏｔ 

ｌ ｌ  



ｕｓ ｅｒ ｎ ａｍ ｅ

用户名

ｖ ａｒｃ ｈ ａｒ（ ３

０
）

 Ｎ ｏ ｎ ｕ ｔ 

ｌ ｌ  







ｎａｍ ｅ

姓 名  

ｖａｒｃｈａｒ（３ ０ ）

ｎ ｎｕ ｏ ｔ 

ｌ ｌ



 性 别 ｇｅｎｄｅｒ

ｎ ｉ ｔ

 密 码  ｐ ａｓ ｓｗ ｏｒｄ

ｖａｒｃｈａｒ（ ２ ０ ）

ｎ ｎ ｕ ｏｔ 

ｌ ｌ  

 头 像 保 存 地  ｐ ｏｒｔｒａｉｔ

，

ｕｒｌ 

ｖａｒｃｈ ａｒ（

１

００ ）



  

 电 子 邮 箱 ｅｍ ａｉ ｌ

ｖ ａｒｃ ｈ ａｒ（ ３ ０ ）

 用 户 种 类 生 产  ｃ ａｔｅｇｏｒｙ

（

ｖａｒｃ ｈａｒ（

１

０ ）

ｎｕ ｎ ｏｔ 

ｌ ｌ  

商 、 经 销 商 、 零 售

商、 消费者 ）



  

ｐｈｏｎｅ

电 话 号 码 

ｖａｒｃ

ｈ

ａｒ （

３

０

）  



 商 家 地 址 文 字 描  Ａ ｆｏｒｍ ａｔｔｅ ｄ ｄ ｄｒｅ ｓ ｓ

ｖ ａｒｃｈａｒ（

１

００ ）



＾   

Ｊ ａｔ

商 家 地 址 炜 度 ｆ ｌ ｏ ａｔ



＾

 ｔ ａ ｇ

＾ 家 地址经 度

 ｆ ｌ ｏ ａｔ

 用 户 详 细 描 述 信 ｄｅｓｃｒｉｐｔｉ ｏ ｎ

ｖａｒ ｃｈ ａｒ （

１

５

０ ）



息

 ＥＴＨＦ ｌ ａｇ

是

否

拥

有

以

太坊

账 户 的 标 志 位 拥   ；

有 以 太 坊 账 户 的  

 ｔｉｎｙ ｉ ｎｔ

ｎ ｕ ｏ ｎ ｔ 

ｌ ｌ  

用 户 才 能 使 用 溯

源功能



  

 太 坊 账 密 码 ＥＴＨＰａｓ ｓｗ ｏｒｄ

以

户

ｖａｒｃｈａｒ ３ ０

（

）  

 太 坊 账 地 址 ＥＴＨＡ ｃｃ ｏｕｎｔ

以

户

ｖ ａｒ ｃ ｈａｒ （

１

００ ）  

 商 家 的 营 业 执 照  Ｈ ｃ ｅ ｒｔ ｉ ｆｉ ｃ ａｔ ｉ ｏｎ

ａｓｈ

ｖａｒｃ ｈａｒ １ ０ ０

（

）

图 片 所 对 应 的  

ＩＰＦ Ｓ 生 成 的 哈 希  



  

 上 传 的 其 他 附 件  Ｈ ａｔｔａｃｈｍ ｅｎｔ ａｓｈ

ｖ ａｒｃｈ ａｒｆ

ｌ

ＯＯ ）

｜ 

所 对 应 的 ＩＰＦ Ｓ 生  

 成 的 哈 希 值

｜ 



  

３ ９

北京邮 电大学工程硕士学位论文



  

用 户 接 入 申 请 表 主 要 用 于 存 储 商 家 用 户 发 出 的 接 入 系 统 的 请 求 数 据 ， 具 体 结

构 见 表 ４ － ３  

表 ４ ３ － 用 户 接 入 申 请 表







  

   列 名

ｉ兑 明


数据类型

约 束

｜

｜

｜

 申 请 增   ｉ ｄ

自

ｄ  ｉ

ｎ ｉ

ｔ

ｐ ｒｉｍ ａｒｙ  ｋ ｅｙ  

ｎ ｎ ｕ ｏｔ 

ｌ ｌ  

 申 请 的 用 户  ｕｓ ｅｒｉ ｄ

ｉ ｄ

 ｕ ｎ ｉ

ｔ

ｎｏｔｎ

ｌ ｌ  

 姓 名  ｎａｍ ｅ

ｖ ａｒｃ

ｈｍ

＊
（

３

０

）

ｎ ｎ ｕ ｏｔ 

ｌ ｌ  

 ｃ ａｔ ｅｇｏｒｙ

商 家种类 （ 生产商 、

 ｖ

ａｒｃ

ｈ

ａｒ
（

３

０

）

ｎ ｎｕ ｏｔ 

ｌ ｌ  

经销 商 、 零售商 ）



  

 电 话 号 码  ｐｈｏｎｅ

ｖ

ａｒｃｈａｒ（

１

００ ）

ｎ ｎｕ ｏｔ 

ｌ ｌ  

 商 家 地 址 文 字 描 述  Ａ ｆｏｒｍ ａｔｔｅｄ ｄｄｒｅ ｓ ｓ

ｖａｒｃ ｈ ａｒ（

１

００ ）

ｎ ｎ ｕ ｏ ｔ 

ｌ ｌ  

＿

＾  

  ｌ ａｔ

商 家 地 址 纬 度 ｆｌ ｏａｔ

＿

 ｔ ａｇ

商

家

地址

 经 度

ｆｌ ｏ ａｔ

 商 户 详 细 描 述 如 ｄｅｓ ｃｒ ｉ ｐｔ ｉ ｏｎ

，

ｖ ａｒ ｃ ｈ ａｒ（

１

５０ ）

经 营 情 况 等 一 些 额

夕卜 信 息



  

 录 入 信 息 商 家 ＥＴＨＡ ｃ ｃｏｕｎｔ

的

以

ｖ ａｒｃｈａｒ （ １ ０ ０ ）

太 坊 账户 地址



  

 太 坊 账 户 密 码  ＥＴＨＰａｓ ｓｗｏ ｒｄ

以

ｖ ａｒ ｃ ｈａｒ（ ３ ０ ）

ｎ ｎｕ ｏｔ 

ｌ ｌ

 商 家 的 营 业 执 照 图   Ｈ ｆ ｉ ｃ ｅｒｔｉ ｃ ａｔｉ ｏｎ ａｓ ｈ

ｖ ａ ｒ ｃｈ ａｒ （

１

００ ）

ｎ ｎ ｏｔ

ｕ ｌ ｌ

片 所 对 应 的 ＩＰＦ Ｓ 生  

成 的 哈希值



  

 上 传 的 以 其 他 附 件 Ｈ ａｔｔａｃｈｍｅｎｔ ａｓ ｈ

ｖａｒｃｈａｒ（

１

００
）  



所 对 应 的 ＩＰＦ Ｓ 生 成

的 哈希值



  

 审 核 状 态  ｃｈｅ ｃｋ Ｓ ｔａｔｕｓ

 ｕ ｔ ｉ ｎ ｙ ｉｎ ｔ

ｎ ｏ ｎ ｔ 

ｌ ｌ  

４ ． ６ 本 章 小 结  

本 章 主 要 介 绍 了 系 统 的 需 求 分 析 与 总 体 设 计 ， 需 求 用 例 设 计 明 确 了 系 统 中 的

主 要 用 户 角 色 以 及 每 个 角 色 所对 应 的 职 责 与 涉 及 到 的 功 能 。 接着 对 涉 及 区 块链 溯  

源 部 分 的 需 求 进 行 了 说 明 ， 包 括 信 息 上 链 存 储 、 大 文 件 上 链 的 解 决 方 案 以 及 共 识  

算法等 的 需求 ；

并在此基础上对 区块链的溯源流程、

溯 源 数据 的 页 面 展 示 等进 行  

了 设计 ，

结 合 和 来 实 现 更 好 展 效 果 Ｉ Ｐ Ｆ Ｓ 、 ｗｅｂｇｉ ｓ

ｅ ｃｈａｒｔｓ

的示

。

同 时 对 系 统 的 整  

体 架 构 和 功 能 模 块 进 行 了 设 计 与 说 明 。 最 后 给 出 系 统 的 数据 库 设计 。  

４ ０

第五章 基于 区块链 的农副产品 溯源系统的详细设计与实现



  

第 五 章 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 详 细 设 计 与 实 现  

本 章 对 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 详 细 设 计 与 实 现进 行 了 说 明 。 其 中 包 括 了 对 实现 区 块 链溯 源 功 能 的 智 能 合 约 的 详 细 设 计 与 实 现 、 区 块 链 的 环 境 搭 建   以 及 系 统 中 各 个 模 块 的 具 体 实 现 和 实 现 效 果 展 示 。  

５． １ 智 能合约 的 详细 设计 与 实 现  

智 能合约 语 言 ５ １ ．

．１

ｓ ｏ ｌｉｄ ｉ ｔｙ

智 能 合 约 的 编 写 主 要 使 用 了 类 似 与 ＪａｖａＳ ｃｒｉｐｔ 的 ｓｏｌｉ ｄｉｔｙ 语 言 来 实 现 ， 它 是  

一 个 主 要 用 于 编 写 智 能 合 约 的 高 级 语 言 。 合 约 在 经 过 其 编 译 之 后 会 生 成 机 器 码 ，  

然 后 在 ＥＶＭ 上 运 行 。 ｓｏｌｉｄｉｔｙ 的 编 译 器 会 将 高 级 语 言 代 码 拆 分 为 一 个 个 可 执 行 的

指 令 ， 其 主 要 使 用 在 线 编 译 器 ｒｅｍｉｘ 进 行 编 写 和 调 试 。 ｓｏｌｉ ｄｉｔｙ 语 言 中 包 含 的 基 本  

数据类型和 其他高级语 言 相 仿 ，

其 特 有 的 关 键 字 中 较 为 重 要 的 是 ａｄｄｒｅ ｓ ｓ ，

该 类  

型用 于保存 一个 ２０ 字节 的 以 太坊地址 。

中 同 样 支 持 和 等 ｙ ｄ ｏ ｓ

ｌｉ

ｉｔ

ｓｔｒｕｃｔ

ｍａｐ

，

但  

采 个 表 不 支 持 遍 般 列 单 独 存 储 所 有 是 的 ｓｏｌｉｄｉｔｙ

ｍａｐ

历 此 因 ，

一

用一

的 ｋ ｙ ｅ

。  

５． １ ．２ 智 能合约 的 运行与 交互  

智 能 合 约 在 编 写 完 成 后 可 以 部 署 到 以 太 坊 环 境 中 ， 部署 成 功 后 的 合 约 将 按 照  

代 码 中 的 逻辑 持 续 运 行 。 与 其 他 的 语 言 代 码 不 同 ， 部 署 成 功 的 合 约 将 不 能 再 进行  

修 改 ， 这 也 遵 循 了 区 块 链 不 可 篡 改 的 原 则 。 智 能 合 约 代 码 可 通 过命 令 行 工 具 ｓｏ ｌ ｅ  

进 行 编 译 ， 编 译 之 后 生 成 了 字 节 码 和 ＡＢＩ 接 口 。 字 节 码 会 部 署 在 以 太 坊 中 ， 部 署  

成功后会获得合约 的地址 ，

借助 ＡＢＩ 接 口 和 合 约 地 址 可 以 通 过 向 合 约 地 址 发送  

交 易 来 实 现 对 合 约 函 数 的 调 用 。

在 成 功 部 署 合 约 后 可 通 过 控 制 台 实 现 与 智 能 合 约 的 交 互 ， 但 是 这 种 交 互 方 式  

显然是非常繁琐和不现实 的 ，

太 坊 还提 供 库 以

了 Ｊ ａｖａ Ｓ ｃｒｉｐ ｔ

ｗｅｂ ３ ｊ ｓ ，

借助 这 个库  

可 以 使 用 ｓ 代 码 来 和 以 太 坊 智 能 合 约 建 立 联 系 并 进 行 交 互 。 通 过 以 太 坊 网 络 的 ｊ

ＩＰ 地址 创 建 ｗｅｂ３ 对 象 ，

使 用 编 译 后 生 成 的 ＡＢＩ 以 及 返 回 的 合 约 地 址 可 以 通 过  

ｗｅｂ３ 对 象 来创 建合 约 实 例 ，

可 以通过与合约 实例 的交互来操作合约 函 数 ，

实 现  

与 以 太坊 上 部 署 的 智 能 合 约 的 交 互 。 ｗｅｂ３ 与 以 太 坊 的 交 互 是 通 过 ｒｐｃ 调 用 发 起  

的 ， 因 此 想 要 通过 ｗｅｂ３ 建 立 与 以 太 坊 的 交 互 则 必 须 启 用 所 连接 以 太 坊 的 ｐ ｒ ｃ 。

除了 这种方式外 ，

还 可 以 借助 以 太 坊 开 发 框 架 ｔｒｕｆ ｌ ｅ 实 现 更 加 便 捷 的 操 作 ，  

ｆ ｌ ｔｒｕ

ｅ

可

以 实现对

多个合约

的

同

时编译与

部署

，

对 ｆ ｔｒｕ ｌ ｅ 获 取 的 合 约 实 例 可 以 直  

４ １  

北京 邮 电大学工程硕士学位论文



  

接 进 行 类 似 函 数 调 用 的 操 作 ， 可 以 大 大 简 化 与 合 约 交 互 的 复 杂 度 。 合 约 与 ｗｅ ｂ ３ 的 交 互 示 意 图 如 下 图 ５ １ － 所 示 。  

编译一

Ｕ 或 

函 ＋

  

溯 能  接 节 源 智

合 约   Ｔ ｒ ｕ ｆｆ ｌ ｅ

ｏ ｄ Ｓ

ｉｉ

ｙ ｉ ｔ

口

声

明

ａ

ｂ 字 ｉ

码  

 源 代 码 框 架 编 译 器

｜  

 部 ■ 成 功 后 获 得 以 太 坊 地 址 ＊  

部 署

＆３

”

， 一一

＾ ａ ｉ ｉ ｉ ｉ ｉ

ｉ

ｉ

ｒ

匕斑     ？
  ＾  卜 查 看 交 互 ｗ ｅ ｂ ３ ． ｓ

＜  ｗ ｍ ？ ？ ？ ＂ ？

 ｗｎ ｆ ｗ ｍ ａ ｉ 馨

Ｋ ｎ ｏ ｎＥｔｈ ｅｒｅｕ

Ｃ
Ｊ

Ｐ ｒ ｏ ｖ ｉ ｄ ｅ ｒ  

 ＾   Ｐ ｒ 〇Ｖ ， ｄ ｅ ￥ 

？

一
／

一  

＾  ｆ 譯  

ｊ

乂 太 ／ － ｊ  

Ｍ  ｜

ｅｔ ａ ｍ ａ ｓｋｐ ｌ ｕｇｉ ｎ

（

Ｊ
 — ＇ 一 …

交 合 约 与 图 ５ － １

ｗｅ ｂ３

互 示 意 图

３ ５ １ ．

．

智 能合 约 内 容  

编 写 智 能 合 约 所 使 用 的 Ｉ Ｄ Ｅ 为 在 线 编 译 器 ｒｅｍ ｉ ｘ 。 合 约 使 用 ｍ ａｐ 来 存 储 用

户、

产 品 等的溯源信息 ，

存 储 产 品 信 息 的 ｍａｐ 使 用 溯 源 码 作 为 ｋ ｅｙ 关 键 字 来 获  

取产 品 的溯源信 息 。

特 性 支 持 于 语 言 不 由

ｙ ｏ ｄ ｓ

ｌｉ

ｉｔ

中 ｍ ａｐ

遍历的

，

因 此 为 了 读 取  

与 查 询 的 方 便 ， 应 单 独 采 用 数 组 存 放 ｍ ａｐ 的 关 键 字 信 息 便 于 数 据 的 遍 历 和 查 找 。  

在溯源过程 中 ，

溯 行 唯 标 产 品 由

源 码 进 ｔ ｒ ａｃ ｅ  ｃ ｏ ｄ ｅ

一

识 ，

因 此 合 约 应 确 保 不  

会 有 重 复 的 溯 源 码 出 现 。 合 约 在 生 产 商 环 节 对 溯 源 码 进 行 判 断 ， 防 止 溯 源 码 重 复  

出现 ，

也 防 止 恶 意 攻 击 以 传 入 相 同 使 得 溯 源 结 果 出 现 偏 差 或 被 混 淆 。  

智 能 合 约 的 设 计 采 用 将 产 品 的 信 息 和 商 户 的 溯 源 信 息 分 别 定 义 在 一 个 合 约

中，

每一次需要生成一个新 的产 品或商 户 时都

个 实 ｎ ｅ ｗ —

合约

例中 ，

因 此 每 个

不 同 的产 品都是一个合约实例 ，

确 保 其 性 了

唯一

。  

４ ２

第 五章 基于 区块链 的农副产 品 溯源 系 统 的 详细设计与 实现



  

表 ５ １ － 为 对 商 家 信 息 进 行 处理 的 合 约 中 的 属 性 详 情 ， 这 些 属 性 用 于 存 储 上 传   的 溯 源 信 息 中 商 家 的 信 息 。

表 ５－ １

商 家信 息合约属 性表

 ￣

  

  ｎ ＾

说明

数据 类 型  

｜

｜

 姓 名  ｎａｍ ｅ

ｓｔｒｉ ｎｇ  

 ｃ ａｔ ｅｇ ｏ ｒｙ

商家种类 （ 生产商 、 经销商 、

ｓｔｒｉ ｎ ｇ  

零售商 ）



  

 话 号 码 ｐ ｈｏｎｅ

电

ｓｔｒｉ ｎ ｇ  

 商 家 地 址 文 字 描 述 Ａ ｆｏｒｍ ａｔｔｅｄ ｄｄｒｅｓｓ

ｓｔｒ ｉｎ ｇ  

一

  ｌａｔ

高 冢地Ａｂ纬 度

 ｓｔｒｉｎｇ

  

  ｌｎｇ

商家地址经度

ｓｔｒｉｎｇ

  

 商 户 详 细 描 述 ｄｅ ｓ ｃｒｉｐｔｉ ｏｎ

，

如经营情况

ｓｔｒｉ ｎｇ  

等一些额外信 息



  

 时 戳  ｔ ｉｍ ｅ ｓｔａｍ ｐ

录入信息的 间

ｓｔｒ ｉｎ ｇ  

 Ｅ ＴＨＡ ｃ ｃ ｏｕｎｔ 录 入 信 息 的 商 家 以 太 坊 账 户 地 址  

ｓｔｒ ｉ ｎ ｇ  

 家 执 片 所 应 Ｈ ｃ ｅ ｒｔ ｉ ｆｌ ｃ ａｔｉ ｏ ｎ

ａｓｈ

商 的营业 照 图

对

的 ＩＰＦ Ｓ 生 成 的 哈 希 值  

ｓ ｔ ｒ ｉ ｎ ｇ  

 上 Ｈ ａｔｔａｃｈｍ ｅｎｔ ａｓｈ 传 的 其 他 附 件 所 对 应 的 Ｉ ＰＦ Ｓ 生 成 的 哈 希 值

ｓｔ ｒｉ ｎｇ  

４ ３

北京 邮 电大学工程硕士学位论文



  

表 ５ －２ 为 对产 品 信 息 进 行 处 理 的 合 约 中 的 属 性 详 情 ， 这 些 属 性 用 于 存 储 上 传   的 溯 源 信 息 中 产 品 的 具 体 信 息 。  

表 ５－２ 产 品 信 息 合 约 属 性 表



  

  列 名

说明

数据 类 型  

丨

丨

 姓 名 ｎａｍｅ

ｓ ｔｒｉ ｎｇ  

 产 种 类 ｃａｔｅｇｏ ｒｙ

品

ｓｔ ｒｉ ｎ ｇ  

 生 产 期  Ｄ ｐｒｏｄｕｃｅ ａｔｅ

日

ｓｔｒｉｎ ｇ  

 产 品 保 质 期 单 位 天  Ｄ ｅｘｐ ｉｒａｔ ｉｏｎ ａｔ ｅ

【

：

】

ｕｎ ｉ ｔ ｌ ６

 产 描 新 鲜 度 ｄｅｓｃｒｉｐｔｉ ｏｎ

品 详细

述如 ，

程

ｓｔｒｉ ｎｇ  

等一些额外信息



  

 产 品 质 量 为 的 整 数 ｑｕａｌｉｔｙ

５ 〗 －
，

ｕｎｉｔ ８  

 ｕｎｉｔ 产 品 的 溯 源 单 位 ， 如 盒 、 箱 、 个 等  

ｓ ｔｒｉ ｎ ｇ  

 产 所 应 Ｈ ｉ ｍ ａｇｅ ａｓ ｈ

品 的图片

对

的 ＩＰＦ Ｓ  ｓｔｒｉｎ ｇ  

生 成 的 哈 希 值

 前 所 溯 ｃ ｕｒｒｅｎｔ Ｓｔａｇｅ

当

处的 源阶段 ，

如生

产 商 录 入 、 经 销 商 录 入 等

ｓ ｔ ｒｉ ｎ ｇ  

溯 错 状  是 否 出 现 Ｅ ｔｒａｃ ｅ ｒｒｏｒ Ｓｔａｔｕｓ

源

误的

态

位 ，

当 下 游 商 户 发 现 溯 源 信

息 与 当 前 信 息 不 符 时 将 其 设  

置 为 ｔｒｕｅ

 Ｄ ｅｒｒｏｒ ｅｓ ｃ 对 于 出 现 的 溯 源 错 误 的 描

述 当 Ｅ 未 ，

 ｔ ｒａ ｃ ｅ ｒｒ ｏ ｒ Ｓ ｔ ａｔ ｕｓ 

 ｔ ｒｕ ｅ

时 必 须 不 能 为 空  

ｂ ｏ ｏ ｌ  
ｓ ｔ ｒｉ ｎ ｇ  

 ｔｒａｃｅ Ｓｔａｇｅ ｓ 每 个 溯 源 阶 段 的 商 家 信 息 数 据 列 表  

ａｄ ｄｒｅ ｓ ｓ ［ ］

主合约为

ｔｒａｃ ｅ

合约 ，

合约

中 主要存储 了 一个

ｍ ａｐｐ ｉｎｇ

映射 ，

其 中 ｋｅｙ 为 溯

个 个 储 产 信 源 码 为 ｔｒａｃｅ ｃｏｄ ｅ ， ｖａｌ ｕｅ

一

能 合 约 地 址 是 智

ａｄｄｒｅ ｓｓ ，

一

存

了 农副

品

息  

的 合 约 实 例 Ｆ ｏ ｏｄｌｎｆｏｌｔｅｍ

。  

Ｆ ｏ ｏ ｄｌ ｎｆ ｏｌｔ ｅｍ

合约

中

除

了

存储产 品

的 具体信

息之外 ，

还 需 要 存 储 当 前 所 处 的

４ ４  

第 五章 基于 区块链 的农副产 品 溯源系统的 详细设计与实现



  

溯 源 阶 段 如 生 产 商 信 息 上 链 等 ， 便 于 后 续 信 息 录 入 时 的 验 证 ， 避 免 溯 源 过 程 的 混  

淆 ；

Ｆ ｏ ｏ ｄｌｎｆｏ ｌ ｔｅ ｍ 中 还 存 储 了 每 个 溯 源 阶 段 的 商 家 信 息 数 据 列 表 ，

列 表 中 存 储 了

商 家 信 息 数 据 合 约 的 实 例 地 址 ｍ ｅ ｒｃ ｈ ａｎｔｌ ｎｆｏ ｌ ｔ ｅ ｍ

ａ ｄ ｄ ｒ ｅ ｓ ｓ 。  

ｎ ａ ｍ ｅ ：  ａ ａ

ａ：，  

ｃ ａ ｔ ｅ ｇ ｏ ｒ ｙ ｐ ｒ ｏ ｄ ｕ ｃ ｅ Ｄ ａ ｔ ｅ

Ｍ ｐ ｉ ｒａ ， ｉ ｏ ＂ ０ ａ ， ｅ

ｄ ｅ ｓｃｒ ｉ ｐ ｔｉ ｏ ｎ 

－  

—

／

！

０ ２ 

２ ｓ ｌ

， ． ＾ｉ６ ７  Ｏｘｉａ

．

  ０ ９ ｉ ￡ ？

．

．

．

＊７

．

０８３

— — — 



  

   ｑ ｕ ３ ， ￥ ｉ ｔ

ｒ

：

Ｉ

ｕ

＊ 奶 ＜

？

 ｕ ｎ  ？ １ ｉｔ

 Ｖ Ｋ ｅ ｙ （ ｔ ｒ ａ ｃ ｅ  ｃ ｏ ｄ ｅ ｝

ａ ｉ ｕ ｅ ａ ｄ ｄ ｒ ｅ ｓｓ

Ｃ

）

０ ０ ２  ０ “

“

２ “ “ 

２０ １ １

４…

３

ｔ ｉ ８ Ｂ ｘ ７ Ｓ ５ ｃ

．

．

．

３３

 —  

  ｆ  ｉ ｍ ａ ｇ ｅ Ｈ ａ ＆ ｈ

：

＂   ＇

０  ０ ６    ２

０ ０ ２

１１

９ ３ ５ ．

．

．

４ ０ ｘ ５ ｃ

ｅ．

．

．

５ １ ５

ｃ ｕ ｒ ｒ ｅ ｎ ｌ Ｓ ｔ ａ ｇ ｅ  

    ：

：

ｔｒａ ＾ Ｅｒ ｒｏ ｒＳｔ ａ ｔｕ ｓ

；

ｎａｍｅ

；  ｒ ｈ ａ ｎｇｓａｎ 

ｎａ ｍ ｅ

 Ｕ ：

ｓ ｉ

  ２ ０ ２ ０ １ ２ １ Ｓ ． ． ． ４ ７

０ ｘ ｂ ６ ａ ｅ ｆｃ ． ．

   ７ ６  ａ

Ｉ

— ？－ 一

Ｄ ｅ ｒ ｒ ｏ ｒ ｅ ｓ ｃ

；

ｃ ａ ｔ ｅｇｏｒｙ ：

生 产 商 ｃ ａ ｔ ｅ ｇｏ ｒｙ ：

；

  Ｊ ：

— ａ ｔ ｒ ｃｅ Ｓ ｔ

ｓ

ｐ ｈ ｏ ｎ ｅ  ｐ ｈ ｏ ｎ ｅ

零 毪 商

   ＊
＊ ｌ



：



！

；

  ？

ｆ ｏ ｒ ｍ ａ ｔ ｔ ｅ ｄ Ａ ｄ ｄ ｒ ｅｓ ｓ

ｆ ｏ ｒ ｍ ａ ｔ ｔｅ ｄ Ａ ｄ ｄ ｒ ｅ ｓ ｓ  

 ？

…  

．  

  ？

ｌ



   ：

ｌ

   ：

 Ｉ ｎ ｇ

ｌ ｏ ｇ  

 ｄ ｅ ｓ ｃ ｒ ｉ ｐ ｔｉ ｏ ｎ

ｄ ｅ ｓ ｃ ｒ ｉ ｐ ｔ ｉ ｏ ｎ

  ｎ ａ ｍ ｅ ｉ  ｘ ｘ 

ｔｉ ｍｅ ｓｔ ａ ｍ ｐ

ｔ ｉ ｍ ｅ ｓ ｔ ａ ｍ ｐ

  ！

  ＊ １

ＥＴＨ Ａｃ ｃ ｏ ｕ ｎ ｔ

Ｅ Ｔ Ｈ Ａ ｃ ｔ ｏ ｕ ｎ ｔ

—



—







—？

ｉ   

Ｈ Ｍ  ２ Ｑ ２ ０ １

０ ０ ２ ３ ０ ． ． ．

 ２ ２

１１

９ ３ ５ ． ． ．



 ０ ２ ０ ２

１ ２ １ ５ ， ４ ７ ． ，

…

  ｔ ｏ  Ｐ ｒ  ｕ ｃ ｅ  ａ ｔ ｅ

ｃ ｅ ｆ ｒ ｔ ｉ ｉ ｃ ａ ｔ

ｎ Ｈａ ｓ ｈ

ｅ ｃ

ｒｔ ｉ ｆｉ

ｃ ａ ｔｉ ｏｎ

Ｈ

ａｓ

ｈ  

 ＾

ｘ

＿＿ 

＿



＾

癩 源 码 列 表  

，

  Ｄ ｐ ｅ ｘ

ａ ｏ ｌ ｒ

ｔｉ

ｒ？

ａｔｅ

ａ ｔｔａ ｃｈ ｍ ｅ ｎｔＨ ａ ｓｈ

ａ ｔｔ ａ ｃ ｈ ｍ ｅ ｎ ｔ Ｈ ａ ｓ ｈ  

．

ｐ ｏ ｄｍ

 ｅｓｃ ｒ

ｉ

．
ｔｉ

ｎ

ｑ ｕ ａ ｌ ｉ ｔ ｙ

ｕ ｎ ｉ ｔ  

Ｈ ｉ ｍ ａ ｇ ｅ

ａ ｓ ｈ  

ｃｕ ｒ ｒ ｅ ｎ ｔ Ｓ ｔａ ｇ ｅ

ｔ ｒ ａ ｃ ｅ Ｅ ｒ ｒ ｏ ｒ Ｓ ｔ ａ ｔ ｕ ｓ

Ｏ ｅ ｒ ｒ ｏ ｒ ｅ ｓ ｃ  

Ｉ ｒ ａ ｃ ｅ Ｓ ｔ ａ ｇ ｅ ｓ

图 ２ ５ － 智 能 合 约 中 溯 源 数 据 存 储 示 意 图

每 个 产 品 的 溯 源 过 程 中 只 能 有 一 个 生 产 商 ， 经 销 商 和 零 售 商 各 自 最 多 只 能 有  

两 个 ， 因 此 合 约 使 用 ｒｅ ｑｕｉｒ ｅ 来 确 保 用 户 以 生 产 商 身 份 上 传 的 产 品 溯 源 码 之 前 并  

不存在 ，

与 此 同 时 用 户 作 为 经 销 商 和 零 售 商 身 份 上 传 的 产 品 溯 源 码 必 须 己 经 存 在 ，  

同 样通过

ｒｅ ｑｕｉｒｅ

保 证 状 态 转 变 为 生 产 商 ＞ － 经 销 商 －＞ 零 售 商 的 顺 序 ，

不 允 许 步 骤  

的 打 乱 。  

借 助 在

了Ｉ Ｐ Ｆ Ｓ

满足 了大文件的上链需求后 ，

合 约 中 需 要 设 计 字 段 存 储 图 片  

或文 件 的 哈希 值 ，

系统通过链上获取的 哈希值与

Ｉ ＰＦ Ｓ

节 点 交 互 并 获 取 文 件 详 情 。  

５ ． ２ 区块链环 境 搭建  

个 端 Ｇ 是 ｏ － ｅｔｈ ｅ ｒ ｅ ｕｍ

一

以太坊 的客户

，

般 称 其 为 一

Ｇｅｔｈ ，

它 是 基 于 Ｇ ｏ 语 言  

实现的功能完备的 以太坊节点 ，

主要通过命令行来对其进行操作 。

可 以 将 Ｇｅ ｔｈ

４ ５

北京 邮 电大学工程硕士学位论文



  

视为 以太坊协议 的具体落地实现之一 ，

其提供 了

多种操作和 命令实现与

以 太 坊 的

交互 ，

可 以使用

Ｇ ｅｔｈ

提供 的 命令 行 界面形式 的

ｃｏｎｓｏ ｌｅ

控 制 台 来 接 入 以 太 坊 的 主  

网 、 测 试 链 或 者 自 己 搭 建 私 链 。 其 可 以 实 现 以 太 坊 所 具 备 的 各 种 功 能 ， 如 创 建 新  

的 以太坊账户 ，

开启 挖矿 ，

以太 币 的转账操作 ，

部 署 智 能 合 约 以 及 调 用 已 部 署 的

合 约 函 数 等 等 。 因 此 ， 选 择 ｇ ｅｔｈ 工 具 来 进 行 开 发 。  

除 了ｇｅｔｈ

之外 ，

还可 以通过测试链工具

ｇａｎａｃ ｈｅ

来 完 成 合 约 的 测 试 和 调 试 等  

作 工

。

ｇａｎａｃｈｅ 是 一 个 方 便 高 效 的 以 太坊 测 试 环 境 开 发 工 具 ，

其 可 以 直 接 搭 建 私

链 环 境 生 成 默 认 账 户 并 且 开 启 自 动 挖 矿 ， 因 此 大 大 降 低 了 在 开 发 前 期 环 境 搭 建 的  

繁 琐 程 度 ， 本 系 统 通 过 ｇａｎ ａｃ ｈ ｅ 来 进 行 正 式 搭 建 前 的 系 统 测 试 。

由 于系统的开发的 需求是实现溯源 ，

而 溯 源 信 息 的 上 传 和 维 护 并 不 是 每 个 节  

点都需要参与 的 ，

更多 的节点接入是为 了 查询操作 ，

因 此 如 果 在 公 网 上 开 发 不 仅

需要消 耗 以太 币 更会导致过度暴露 ，

没有太大 的 必要 ，

因 此 选 择 牺 牲 一 定 去 中 心  

化程度 的私链

（ 联盟链 ）

来进 行溯 源 ，

使 得 获 得 授 权 的 节 点 接 入 区 块 链 并 进 行 维  

护 。

想 要 在 远 程连接 上

自

己搭建 的 私 链 ，

需 要 开 放 ｗｅｂ ３ 端 口 和 ｒｐｃ 访 问 ，

并 且  

设置跨域 。

启 动 命 令 为   ｈ ． ／ｂ ｕ ｉ ｌ ｄ ／ ｂ ｉ ｎ／ ｇ ｅ ｔ

－ ｈｔｐ

－ｈｔｐ ． ｃ ｏ ｒ ｓ ｄ ｏ ｍａｉ ｎ

＂＊ ＂

ｄ －

ａ ｔ ａ ｄ ｉ ｒ

   ＂ ． ． ／ ｍ ｙ ｇ ｅ ｔｈ ｄ ａｔ ａ／ ＂  — ａ ｌ ｌ ｏ ｗ － ｉ ｎ ｓ ｅ ｃ ｕ ｒ ｅ － ｕｎｌ ｏ ｃ ｋ

ｐ —

ｏ ｒｔ

３ ０３ ０３

ｈ ｐ ｐ —

ｔｔ

ａ
．

ｉ

    ＂

ｅｔｈ ｎｅｔ ｗｅｂ３

，

，

ｐ ． ｅ ｒ ｓ ｏ ｎ ａ ｌ ，

ａ ｄｍ ｉ ｎ ｍ ｉｎ ｅ ｒ ＂— ｎｅ ｔｗｏ ｒｋｉ ，

ｄ

２３ ３

ｈ ｐ ｐ —

ｔｔ

．

ｏ ｒｔ

８ ５４５

ｐ ｈ —

ｔｔ

． ａ ｄ ｄ ｒ

下 图 为 启 动 后 的 结 果 ”

”

２ ４ １

０ ．

１

０ ５ ２４ ．

．

１

ｃｏｎｓｏｌ ｅ

。  

建 私 链 搭 图 ５ － ３  ｇ ｅ ｔ ｈ

结 果 图

启 动 私 链 后 各 个 想 要 接 入 的 节 点 通 过 ａｄ ｄ Ｐｅ ｅｒ 接 入 区 块 链 并 建 立 与 其 他 节 点

４ ６

第 五章 基于 区 块链的农副产 品 溯源系 统 的详细设计与 实现



  

之 间 的 连 接 。 私 链 中 多 节 点 的 接 入 可 以 通 过 在 同 一 台 机器上 不 同 端 口 下 开 启 节 点   进 行 节 点 连 接 来 进 行 模 拟 实 现 。 至 此 以 太 坊 网 络 搭 建 完 成 。  

５ ．３ 系统功 能模块详细 设计 与 实 现  

系 统 的 实现 主 要 分 为 以 下 几 个 部 分 ： 实 现 区 块 链 溯 源 功 能 的 区 块 链 环 境 与 智

能 合 约 、 前 端 ｗｅｂ 页 面 、 后 端 与 数 据 库 。 智 能 合 约 部 分 的 详 细 设 计 已 在 前 边 讨  

论 。 系 统 前 端 主 要 使 用 了ｖｕｅ 框 架 结 合 Ｕ ｅｌｅｍｅｎｔ Ｉ 来 实 现 页 面 表 单 和 数 据 的 展 示 ；  

ｗｅｂ ｇｉ ｓ

使用 高德地 图来进行地理位置信息展示 ；

通 过 ｅｃｈａｒｔｓ 来 进 行 图 表 和 统 计  

结果展示 。 系统后端主要使用

ａｖａ 语 言
ｊ

ｓｐ ｒｉｎ ｇｂ ｏ ｏｔ

框架来实现， 数据库选用

ｍｙ ｓ ｑ ｌ

来进 行 用 户 信 息 等 数 据 的 存 储 。 如 下 表 ５ － ３ 为 溯 源 系 统 的 后 端 代 码 中 的 使 用 到 的

主 要 功 能 类 的 具 体 描 述 。  

表 ５ ３ － 溯 源 系 统 主 要 功 能 类 描 述 表



  

类名

类功 能描述



  

Ｕ ｓ ｅ ｒｌ ｎｆｏ

用户信息类



  

Ａ Ａ ｃ ｃ ｅ ｓ ｓ ｐｐ ｌ ｙ

接入 串请信息类

￣



  

 Ｈ Ｔｘ！ｎｆｏ

： 交 易 信 息 类  

Ｒ Ｌ ｏ ｇｉ ｎ ｅ ｇ Ｓ ｅｒｖ ｉ ｃ ｅ

主要用 于 处理用 户 的登录和注册请求



  

Ｕ Ｍ ｓ ｅ ｒｌ ｎｆｏ

ａｎａｇｅ Ｓ ｅ ｍ ｃ ｅ

主 要 对 用 户 的 基 础 信 息 进 行 管 理 ， 如 对 用 户 个 人 信 息 的 更 改 、 密 码 的 更改 等  



主 要 实 现 用 户 审 核 的 相 关 功 能 ， 包 括 处理 商

 家 发 起 接 入 请 Ｕ Ｃ ｓｅ ｒ ｈｅ ｃｋ Ｓ ｅｒｖ ｉ ｃｅ

的

申

、

处理 管 理 员 的 审 核 通 过  

申请



  

主 要 处 理 溯 源 功 能 部 分 与 区 块 链 无 关 的 请  

 求 Ｔｒａｃ ｅ Ｓ ｅ ｒｖ ｉ ｃ ｅ

，

如批量生成溯源码 ，

处 理 溯 源 信 息 上 传

后 的上链交易信息等

｜ 

  

３ ５ ．

．１

登录注册縣  

每 一 个 用 户 在 使 用 系 统 之 前 都 需 要 进 行 用 户 的 注 册 和 登 录 ， 用 户 初 次 注 册 时  

选 择 自 己 的 账 户 类 别 ， 有 生 产 商 、 经 销 商 、 零 售 商 和 消 费 者 ， 选 择 顾 客 的 账 户 无  

需 审 核 ， 因 为 对 于 消 费 者 来 说 ， 由 于 其 只 使 用 溯 源 查 询 功 能 ， 因 此 在 注 册 时 除 了  

需 要 输 入 自 己 的 账 户 密 码 外 ， 同 时 可 以 输 入 想 要 申 请 的 以 太 坊 账 户 密 码 ， 系 统 会  

根 据 户 输 入 密 码 调 创 建 新 的 太 坊   用

的

用 Ａ ｗ ｅ ｂ ３ ． ｐ ｅｒ ｓ ｏｎａｌ ． ｎ ｅ ｗ ｃ ｃ ｏ ｕｉｉｔ（ｐ ａｓ ｓ ｗｏ ｒｄ）

以

账 户 ， 并 将 账 户 地 址 返 回 给 用 户 ， 用 户 可 在 自 己 的 个 人 信 息 页 进 行 查 看 。  

而 对 于 商 家 用 户 来 说 ， 由 于 其 会 进 行 信 息 的 上 传 ， 因 此 不 能 直 接 接 入 以 太 坊 ，  

需 要 进 行 审 核 。 其 初 次 使 用 系 统 前 需 要 注 册 账 户 ， 此 时 只 是 进行 普 通 账 户 注 册 ，  

并 没 有 以 太坊 账 户 和 使 用 系 统进 行溯 源 的 功 能 之 后 进 行 以 太 坊 接 入 申 请 并 在 管   ；

４ ７

北京邮 电大学工程硕士学位论文



  

理员 审核通过后可获得

自

己的

以太坊账户 地址 ，

可 以 使 用 溯 源 功 能 如 信 息 上 传 等 。

成 功 注 册 后 的 用 户 输 入 用 户 名 、 密 码 并 选 择 自 己 的 用 户 类 别 后 可 以 登 录 到 系

统 看 到 对 应 的 页 面 管 理 员 无 需 注 册 。   ；

５ ． ３ ． ２ 用 户 管理模块   用 户 管 理 模 块 主 要 包 括 个 人 信 息 管 理 、 用 户 接 入 申 请 和 管 理 员 对 接 入 用 户 的  
审 核 。 个 人 信 息 模 块 主 要 提 供 对 用 户 个 人 信 息 的 查 看 和 管 理 ， 包 括 对 基 本 的 姓 名   信 息 等 进 行 修 改 和 账 户 密 码 修 改 等 功 能 。 用 户 可 在 个 人 信 息 页 面 查 看 自 己 的 以 太 坊 账 户 地 址 。  
商 户 接 入 审 核  
商 家 用 户 管 理 员 系 统  

 ｆ １

 — — ＾

普 通 錄 户 注 册 ／ 登 录  

Ｋ

）  



广 设 定 以 ＾  

Ｖ

？

，  





 ？







  

送 彳爸入 ＿

查看

Ｌ

 Ｊ

ｖ

；





、
：

．
根

、  
以太

  － 坊 账 户 乂  

「 获得

坊 账  

 ：

羞

，

一故

丨 ．

＾



  







  ＾Ｖ—

—

＿  

图 ４ ５ － 用 户 审 核 功 能 活 动 图

如 图 ４ ５ － 所 示 为 用 户 审 核 功 能 的 活 动 图 ， 对 于 商 家 用 户 来 说 ， 要 想 使 用 后

续 的溯源功 能必须输入 自 己 的 信息包括姓名 ，

商 户 种类 ，

联系方式 ，

常 用 地  

址、

描述 、

营业资质 照片 、

附件

可 选 （

）

和 以太坊密码 。

用 户 发 起 接 入 申 请 后

可 以 在 个 人 信 息 中 的 已 提 交 的 接 入 申 请 页 面 查 看 自 己 提 交 的 申 请 以 及 审 核 状

态 ，

当 审 核 通 过 后 方 可 获 得 以 太 坊 账 户 地 址 。  

４ ８

第五章 基于 区块链的农副产品溯源系统的详细设计与实现



  

对 于 管 理 员 来 说 需 要 进 行 用 户 审 核 ， 管 理 员 可 以 查 看 所 有 用 户 的 接 入 申  

请，

查看详情并通过其审核 。

当 管理员 点击审核通过后 ，

系 统 会 根 据 用 户 输 入  

的 太 坊 密 码 调 用 创 建 新 的 以 太 坊 账 户 以

Ａ ｗ ｅ ｂ ３ ． ｐ ｅ ｒ ｓ ｏ ｎ ａ ｌ ． ｎ ｅ ｗ

ｃ ｃ ｏ ｕｎｔ （ ｐ ａ ｓ ｓ ｗ ｏ ｒｄ）

，  

获 得 以 太 坊 账 户 地 址 。  

５ ． ３ ． ３ 产 品 溯 源 模 块  

产 品 溯 源 模 块 的 功 能 主 要 分 为 溯 源 查 询 和 溯 源 信 息 上 传 两 大 部 分 ， 而 溯 源 信  

息 上 传 中 又 有 许 多 小 功 能 ， 如 单 个 信 息 上 传 ， 批 量 上 传 以 及 信 息 确 认 等 。  

可 以使用 信 息上传功 能 的主要有生产商 、

经销 商和 零售 商 ，

经 销 商 和 零 售 商

都可 以算作 中 间 商 ，

与 生 产 商 区 分 。

生 产 商 上 传 溯 源 信 息   生 产 商 用 户  溯 源 功 能 模 块  溯 源 智 能 合 约

｜ Ｉ

账 户 登 录  

乂   Ｖ ． 



；

录入单个产品 信息
ｉ  

■

置

￣

Ｊ

１

所有細

 ｊ

ｊ

爾 满 码  

，

ｆ  提 示 产 品 已 存 在 ） ｔ  
上 传 文 ＇  

厂 获 得 上 传 结 果  提 示 上 传 成 功 丨

Ｕ例

Ｊ  

．

—

？ ＞



Ｉ   

图 ５ － ５ 生 产 商 信 息 录 入 活 动 图

如 图 ５－５ 所示为生产商进行信 息录入 的 活动 图 ，

由 于 生 产 商 是 溯 源 的 源 头 ，

因 此 生 产 商 需 要 进 行 产 品 信 息 的 上 传 。 生 产 商 上 传 的 产 品 信 息 会 在 后 续 溯 源 过 程  

中 一直存在并基本保持不变 ，

不 需要再次上传 ，

但是下游用 户 可 以修改信息 ，

修  

４ ９

北京 邮 电大学工程硕士学位论文



  

改 的 信 息 会 被 标记 并 在 后 续 溯 源 过 程 中 加 强 展示 。 生 产 商 需 要 录入 产 品 的 具 体 信  

息 ，

包括食 品 名 称 、

食品种类、

生产 日 期 、

保质 期

单 位 【

：

天 】、

描述 、

食 品 质

量 【 用 １ 到 ５ 的数字表示 】、

溯源单位

箱 【

、

盒等 】、

食 品 数量 、

照 片 可 选 【

】 ；  

除此之外还需要录入商家 自 身 的信息 ，

其中 地址信 息直接获取当 前定位 ；

生 产 商  

是 溯 源 的 源 头 ， 可 以 输 入 录 入 的 产 品 件 数 进 行 批 量 录入 ， 此 时 需 要 规 定 溯 源 的 最  

小单位 ，

系统会对规定好的每个溯源单位 自 动生成溯源码 ，

上 传 成 功 后 返 回 生 成

的 溯 源 码 。 对 于 每 个产 品 来 说生 产 商 只 有 一 个 ， 即 已 经 存 在 的 产 品 不 能 进 行 生 产  

商信 息录入 。

当信息录入成功后 即可点击按钮查看本次信 息录入 的上链交 易

信息 ，

包 括 交 易 哈 希 、 交 易 发 送 者 、 交 易 接 受 者 、 区 块 高 度 和 区 块 哈 希 值 ， 便 于 用 户 了  

解 本 次操 作 与 区 块 链 的 具 体 交 互 结 果 。  

５ ０

第五章 基于 区块链的农副 产 品 溯源系 统的详细设计与 实现



  

中 ＿ 商 上 传 灝 源 信 患   经 销 商 ／ 零 舊 商 用 户  溯 深 功 能 禳 块  濯 源 智 能 合 约  





療 户 登 录  

Ｖ

Ｊ  

，



ｆ

输 入瀠瀑码

、



＇  

． ‘  上 传 涵 源 码

Ｌ

＾  

  

Ｉ  



  

 ４

厂

 提 示镥 误 懷悤 ｊ

ｍ  

核 对 灑 源 倍 息  产  ？  展 示 瘸 源 Ｈ 悤  ＇  

＇
ｆ Ｓ Ｓ  Ｓ—  
品 儘 恩

修 改 慈 鑛 氧  

Ｉ

Ｉ

 录 入修 改 傜 皂



＇

，

上 传修改信 患 

存 储 修 改信 患  

 伞

Ｉ  

  Ｉ

－  ／

｜  

｜

援 示修 改 成 功命

― 

＂

 ｆ

Ｖ

Ｊ


 ｔ  
＼

 厂  Ｉ

＾  

＾录 入 商家信 慈

Ｘ



  

上 传 商 家 箔 恩  

“、
广
｜

一－ ＇

一

— ？ － 一  

  ｊ

＾

匕

 ！

  ： 提 示 错 误 信 悤

存 储 商 家 僂 Ｓ －  

｜

＇
Ｖ



／
 — 

、

？

＇  

．

？？

  


ｆ

＂ －ｕ

１

广

… １

， ，

＇

 ＼   Ｍ  ＂ ＂

得 上传  提 上 传 成 功 获

结果

示

务

一一

一

－  



图 ５ － ６ 中 间 商 单 个 产 品 信 息 录 入 活 动 图

如 图 ５ － ６ 所 示 为 中 间 商 对 单 个 产 品 的 信 息 进 行 录 入 的 活 动 图 ， 中 间 商 在 进 行  

信息录入 的时候 ，

可 以 直接输入溯源码进行单个产 品 的信息录入 ，

在 信 息 录 入 前  

５ １  

北京邮 电大学工程硕士学位论文



  

系 统 会 根 据 溯 源 码 与 以 太 坊 交 互 获 取 当 前 产 品 的 信 息 以 及 上 游 用 户 填 入 的 信 息  

等供用户 确认，

用户 确认无误后输入 自 己的信 息 ；

由 于产 品必须要有生产商 ，

因

此 中 间 商 在 信 息 录入 时 输入 的 溯 源 码 所对 应 的 产 品 必 须 存在 除此 之 外 还 会对 当 ；

前 产 品 所 处 的 溯 源 阶 段进 行 判 断 ， 一 个 产 品 只 能 有 一 个 生 产 商 ， 经 销 商 和 零 售 商

分别 只 能有两个 ；

溯源应按照 生产 商一经销 商一零售商 的 顺序进行商 家信 息 录入 ，  

打 不 能 乱 。  

如 果 用 户 认 为 当 前 信 息 存 在 一 定 问 题 ， 可 以 对 信 息 进 行 修 改 ， 但 是 用 户 必 须

输入修 改 的理 由 与 描述 ，

修 改 后 该 产 字 段 将 更 改 品 的 Ｅ ｔｒａｃｅ ｒｒｏｒ Ｓ ｔａｔｕｓ

，

并 在 后 续  

下 游 用 户 溯 源 时 进 行 展 示 表 明 信 息 曾 发 生 过 修 改 。  

系 统 还提 供 了 多 个 信 息 的 批量 录 入 功 能 ， 可 以 实 现 中 间 商 对 一 批 产 品 的 同 时  

录 入 ， 因 为 对 于 同 一 商 家 录入 的 不 同 产 品 来 说 商 家 信 息 的 录 入 内 容 是 相 同 的 ， 批   量 录 入 可 以 避 免 操 作 的 繁 琐 。 将 所有 需 要 录 入 的 溯 源 码 写 入 ｅｘｃｅｌ 并 上 传 至 系 统 ，   系 统 会 自 动 解 析 并 展 示 所 有 溯 源 码 ， 并 对表 格 中 的 所有 溯 源 码 对 应 的 商 品 进 行 溯

源 信 息 查 询 和 分 析 展 示  

系 统 通 过 ｅｃｈａｒｔｓ 来 进 行 数 字 统 计 和 图 表 展 示 ， 包 括 一 共 多 少 件 商 品 ， 溯 源   正 确 的 比 例 ， 溯 源 错 误 的 原 因 等 。  

具 体 分 析 内 容 如 下 ：  

＊

总件数 ，

能 追 溯 到 的 件 数 ， 追 溯 异 常 的 件 数  

＊ 能 追 溯 到 信 息 的 产 品 百 分 比 ， 即 追 溯 成 功 概 率  

？

产 品溯源过程 中 的质 量变化情况 【 质 量 良好 、

合格 、

差等 ，

产 品 质 量  

采用 数字进行展示 ，

从１

到５ ；

使用

３ ｄ 柱 状 图 展 示 溯 源 过程 中 产 品 质 量 的 变  

化 ， ｚ 坐 标 是 质 量 ， ｙ 坐 标 溯 源 中 每 个 流 程 如 生 产 商 经 销 商 等 ， ｘ 坐 标 为 产 品

溯 源 码 】  

＊ 如 果 有 追 溯 异 常 ， 异 常 的 原 因 和 各 自 有 几 个 【 异 常 原 因 包 括 ： 无法 追   溯 、 追 溯 过 程 中 产 品 信 息 不 一 致 、 己 超 过 保 质 期 】

５ ２

第五章 基于 区块链的农副产 品溯源系统的详细设计与实现



  

溯 源 查 询   用 户 溯 源 智 能 合 约

Ｉ



  

普 通 账 户 注 册 ／ 登 录  

Ｖ

Ｊ  

ｒ  ．

＿

±



  

输 入 溯 源 码

 Ｌ

Ｊ  

  麵码 存 在
１
  

上 传 溯 源码 一

获 取溯源信息
３

 ＾  
 获 取 不 存 在 错 误  
Ｊ ＇

／  

ｊ

  

一

？ 获 得 溯

果 并展 ： 返 回 溯 源 结 果

Ｉ

、

 不 」

、

＾  



＃  
图 ５ － ７ 溯 源 查 询 活 动 图

５ ３

北京邮 电大学工程硕士学位论文



  

．

．

一 厂



—



  ± ｍ  ｒ

Ｔ ｒａｃ ｅ

Ｆ ｏ ｏ ｄ ｌ ｎ ｆ ｏ

ｊ

 Ｃ ｏ ｎ ｔ ｒ ａｃ ｔ

Ｃ ｏ ｎ ｔ ｒ ａｃ ｔ  

 、 ｔ 只  一

哪丄

门

ｕ —  

   输 Ａ 溯 源 码 查询

１

丨

丨

  １

Ｔｌ

１

 ｑ 根 据 溯 源 码 ｜  

获 取 产 品 合 约 Ｉ  

令 Ｉ  









Ｊ —





 ！  


替 换  暑

溯 源 码 不 存 在  

， 遥國结 累 不存 在错误懷患

 Ｉ

！

  Ｉ

１  

Ｉ

  」 ！

Ｉ

｜

溯 源 码 存 在  



Ｉ

Ｉ

  Ｘ

ｊｅ ｔ Ｆ ｏｏ ｄ ｌ ｎ ｆ ｏ

！  

  Ｔ

Ｊ

获 取 产 品  

 溯 源 信 息

；

ｒ   ｜ 

；

 返 回产 品 ＿源 信息

Ｉ

Ｉ

  ｉ

Ｉ

Ｉ



ｔ

ｉ

Ｉ

图 ５ － ８ 溯 源 查 询 时 序 图

如 图 ５－７ 所示为溯源查询活动 图 ，

图 ５－８ 为溯源查询 时序 图 ，

用 户 输 入 溯 源  

码进行查询 ，

在溯源码存在 的情况下将结果返回 并展示 。

查 询 后 将 展 示 产 品 信 息

以及溯源经过 的路径 。

会 路 径 在 式 进 行 观 示 上 以 的 形 ｗ ｅｂ ｇ ｉ ｓ

Ｄ Ｏ ３



ｂ ｅｃｔ

ｊ

直展 ，

同

时 系 统会展示溯源流程 中 的 商 家信 息 ，

包括商家基本信 息 、

以 太 坊 账 户 信 息 和 合  

约 信 息 等 。 当 溯 源 码 不 存 在 时 返 回 错 误 信 息 。

５ ． ４ 系 统 效 果 展 示  

本 节 主 要 对 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 的 主 要 功 能 进 行 效 果 展 示 。  

５ ． ４ ． １ 登 录及 注 册 界 面  

如果首次使用 系 统 ，

则 需要进行注册 。

消 费 者 用 户 注 册 时 可 同 步 注 册 以 太 坊  

账户 ，

用 户 输入想要设定的 以太坊密码 ，

系 统将 自 动生成 以 太坊 账户 ，

登 录 成 功  

后 通 过 个 人 信 息 页 面 就 可 以 看 到 自 动 生 成 的 以 太 坊 账 户 地 址 。 如 果 是 其 他 用 户 如

５ ４

第五章 基于区块链的农副产 品 溯源 系统的详细设计与实现



  

生产商等 ，

则 需要在注册账户 成功后再单独 申 请接入 以太坊 以 使用 溯源功 能 ，

经  

图 ５ － ９ 注 册 界 面

５ ． ４ ． ２ 用 户 审 核 界 面  

该页面只 对管理员 可 见 ，

管理员 可 以对商户 发送的请求进行查看 、

附 件 下 载  

等并进行 审 核 ，

审 核通过 的用 户 会根据其提供 的

以 太坊 账户 密码

自

动 生 成 以 太 坊  

账 户 并 获 得 以 太 坊 账 户 地 址 。 用 户 审 核 页 面 如 图 ５ １ － ０ 所 示  

已雜

來 雜  

ｍｍ 鏺 泠 樊别

丨

ｂｂ  ｂｂ  经销商

寧＿ 态 撵 徉  
朱刺 Ｉ

搿 庐 客 比  經名 ｂｆ ｅ  

羯 泠类别 经Ｂ商

雜拭 恣 ｆ ａ ｌ ｓ ｅ  

联 式  联 系您 系 方

１ ３６ ｘ ｘ ｘ ｘ Ｂ０ ４ ３

址

；

海淀区  

描 述  ＣＣＣ 营 处 资 格

參

；

丨

ｍｍ，

图 ０ ５ － １

用 户 审 核 页 面

５ ５

北京邮 电大学工程硕士学位论文



  

审 核成功后 获得 以太坊账户 地址 ，

己审核用户 列表页面如 图

５－ １１

所 示 。  

已雜 ■核  

齡 名  纖  ■户 麵 寧裱麵   ５  ａ ａ  ａ ａ  经 销 商  
ｂ ｂ   ｂ ｔ ＞ ｍｍ ｍ  ｍｍ  

箱 户 名 魴 姓名 叻  

潑 户类 擬 经镝 商 窜漏 态 谷 说  

联黏式

 縣纖 ＿ 伽 飞 ：

欠

４３

您寒 雜淀区  

纖  以 纖遂 户  ｃｃｃ

娜 没   細 ｎ 〇

〇２ｌ３〇 ３４ ｇ ５２ａ？ １ ２ｅｅ ２

１ 孩 ？ ３Ｓ ｂｄ

 ？  营 资 格 ｉｉｉｉ

齡件

營 １ 执 叛  

Ｖ  ＊  

文忤 ． ｐ ｄ ｆ  ±  Ｔ ＆５ ： 件  

，

ｕ ； ： ’

． … Ｓ

图 ５－ １１

已 审 核 用 户 列 表 页 面  

５ ． ４ ． ３ 信 息 录入 界 面  

信 息 录 入 页 面 主 要 分 为 三 部 分 ： 生 产 商 录 入 、 单 个 信 息 上 传 和 多 个 信 息 上 传 。  

生产商录入为产 品 信 息 的首次录入 ，

因此生产商 需要录入产 品 的具体信息 ，

包括食 品 名称、

食 品 种类 、

生产 日 期 、

保质 期

单 位 【

：

天】、

描述、

食 品 质 量 【 用

１ 到 ５ 的 数字表示 】 、

溯源单位

箱 【

、

盒等 】、

食 品 数量、

照片

可 选 【

】；

生 产 商 录  

入 部 分 中 的 产 品 信 息 录 入 页 面 如 图 ２ ５ １ － 所 示  

５ ６

第 五章 基于 区块链的 农副 产 品 溯源 系 统 的详细设计与 实现



  

生續 录入 草个上传

多 个 上传  

产 品 名 称  ＊ １ １ １  

产 品 信 息录 入  

产 品种 类  

生产 曰 期  

保 质 期  １   产 雜 述  

产 品 质 置  一  Ｓ

潔潭单 位件  

产 品 数 Ｍ  １   上传产品 園 片
＋  

图 ２ ５ － １

生 产 商 录 产 入 一 品 信 息 录 入 页 面

除此之外还需要录入商家 自 身 的信 息 ；

生产商是溯源的源头 ，

因 此 需 要 规 定  

溯源的最小单位 ，

输入录入 的 产 品 件数 ，

则 对 规 定 好 的 每 个 溯 源 单 位 自 动 生 成 溯  

源码 ，

填入输入的产 品信息 。

生产商录入部分中 的商家信息录入页面如 图

５ ３ － １

所

０

生 产 商 一 个 产 品 只 有 一 个 即 已 经 存 在 的 产 品 不 能 进 行 生 产 商 信 息 录 入 地  

，

；

址 信 息 可 以 通 过 点 击 按 钮 获 取 当 前 定 位 。 不 同 种 类 商 家 用 户 的 商 家 信 息 录 入 页 面  

相 同 ， 之 后 不 再 赘 述 。

５ ７

北京邮 电大学工程硕士学位论文



  

ｔ  ＿ 家 类 别  

商 家信 息录入  

？ 姓 名  

？ 联 系方 式  

＇ 洋细 地 址  此 京 市 海 淀 区 ：ｆａ 平 庄 街遒 固土城路 元 土 城 遷 坡公 园 ｉ纖 当？酿 泣  
描 述  

， 以 太坊 账 户 密 码  

营 錄 照  
＋  

其他 附件

可 选 【

】

只能 ＃ 轉   ｔ ＿

〇 ｗ ｏ ｒ ｄ 、

ｐｄ

ｔ

图 ５ ３ － ］

生 产 商 录 商 入 ＿ 家 信 息 录 入  

当 信 息 录 入 成 功 后 点 击 查 看 上 链 交 易 按 钮 可 以 查 看 本 次 交 易 的 具 体 详 情 ， 包  

括 交 易 哈 希 、 交 易 发 送 者 、 交 易 接 受 者 、 区 块 高 度 和 区 块 哈 希 值 。 具 体 的 交 易 信

息 页 面 如 所 示 图 ４ ５ － １

。  

５ ８

第五章 基于 区块链 的农副 产 品 溯源系 统的详细设计与 实现



  

交 易 信 息   ｘ Ｉ  

 騰 體舰

Ｉ  

 Ｈ   ３

ｔｆ ａ ｎ ｓ ａ ｅｔｊ ｏ ｎ ａ ｓ ｈ

：；

 ４ ？

＇

，

ｖ  ．

 －
 ，

１   疆  



ｆ ｒ

ｏｍ



祕敏

￡

初窗

７

鱗滅

Ｓ

Ｃ

夜嫌 ；

《

？

２

４

２

级您

斑３

£

龄 ＾  

（

 符 雜 松 ｔＸ＞  逆？ Ｃ ？

Ｓ ２５ ？你！ §

愈 ：： 拓＞ｉ 忿 驗

｜

热 義  

 Ｈ  ？

ｂｌｏ ｃ ｋ

３ｓｈ

 － ；

’ －  

Ｎ ｌ ？ ｝ 〇 ｃ ｋ

ｕ ｍ ｂ £ ｒ

ｍ ｍ Ｌ－ｉｌＢｌＩｌＩＢＢｉ

Ｂ

Ｂｌ  

图 ４ ５ － １

生 产 商 录 查 入 一 看 交 易 信 息  

进行 多 个信 息上传 时 ，

可 以 将 所有 溯 源 码 存 至 ｅｘｃｅｌ 表 格 中 ，

系 统 对 ｅ ｘ ｃ ｅ ｌ 表  

格 中 的 信 息 自 动 进 行 解 析 ， 实 现 对 多 个 产 品 的 一 次 性 商 家 信 息 录 入 。 在 解 析 获 得  

溯 源 码 之 后 ， 系 统 会 对 这 批 产 品 的 溯 源 结 果 进 行 分 析 并 展 示 ， 包 括 一 些 溯 源 异 常

情况的展不和广 品 质 量状态 的 改变等

如 图 所 ５ － １

５

Ｋ ７

。  

；

５ ９

北京 邮 电大学工程硕 士学位论文



  

生， 默

单个上传

多 个上传  

■賴 文件   Ｒ社 齡 你ｊ ｃ文件  
．
通 潔諷 ｘ ， ｓ ｘ  

漏 信 麵 认  

灘 瀑羁 ｄ ’

，

１：

． 、

，

 、 ，

＇

、

 Ｖ 拍 、

Ｄ Ｈ ：

；：

ｖ

■

纖 麵 ｜ ｒ賴 纖 １  、

－ 纖更 多  

 ｍｍ ｍｒ＾ ｍ

，繁、

瑨 灤 羅产 磊数  灤蘧 鏺 常 产 織翳  

  １ 〇 〇

ｓｏ

１ 〇

＿ 满＿

瞧

■纖  
；

灘源成功 率 溯 源 异常 分祈  

１ ｜ 一＇ 

一  
｜

 Ｔ   、 －

麵ｕ

＾ｍｍ  ｍ  ＾ ｍ ｍｍ  

＼

１
， 產 Ｗ源结麟 清  

２０ ２ １ ０３ ２ ２ １

＾ １ ２ Ｓ ０ ０
２０ ２ １ ０ ３２２ １

 １ ２ ６ ０ ０ ５ ３

？ ＂ ＊ ＇？

Ｗ  Ｗ  ＊？＊ Ｖ  

  ＾   ．

．

＼

ｍ ｒ ±

 ２ ０ ２ １ ０ ５ ０ ２ ５ ３ ２ ９ ０ ０ ０ １

＼

ｎ   ０ ０ ２ ０ ２ １

５１ １

９ １ Ｔ 〇〇 

图 ５ － １ ５ 多 个 上 传 溯 一 源 信 息 确 认  

６ ０

第五章 基于区块链的农副产品溯源系统的详细设计与实现



  

５ ． ４ ． ４ 溯 源查询 界 面  

输入溯源码进行查询 ，

也可通过之前 的查看详情按钮跳转至该页面 ；

系 统 基  

于高德地图对溯源结果和路径进行可视化 的直观展示 ，

如图

６ ５ － １

所 示  

＾ ｜Ｐｐ｜



，



查 卷 涵 各 阶 段 商 家 信 悬  

， 浐 鸯 ‘”
，

办

、 ；

夺ｖ ＇
、

Ｈ  ｓ  

 ■ ＾

ｐ  ＾ 

， ＿

＾  



 ＇ 二 ？

、

 ． ■

二 ，

二 ：

 －Ｔ

免

＇
ｄ  ， ＇

〇七
■

 — －

４．，

－

二 ：  

Ｉ ＾ Ｓ ？  ０ ｘ

Ｓ － ｓ

Ｅ ４

ａ

Ｄ ５ｉ＞４ ７

３

Ａ２

ｌ

４

３ ３ Ｆ０９ ３５

ｌ

ｆ ６

ｔ＜Ｊ

ｌ

０

Ｄ ５ ３ ８ Ｂ

圖Ｏ ｜

Ｃ  二 ．
．
ｒ

 Ｈ ＾

Ｉ

Ｉ  ａ  －  

＇



：

－

 

７

？


 ＞ ＂
－

＇
Ｖ

：
ｔｆ ｜ ％ 着 ｔ意 ｜ｊ ；

    ％  

＊



ｖ－

：
Ｊ

＇

 －





：

＇

    Ｊ



ｖ 

’ 

 ？
：

图 ５ ６ － １

溯 源 查 询 页 面  

｜ Ｓ ｆ ＾ ＇

＇  



５ ． ４ ． ５ 系 统 落地 应 用 该 溯 源 系 统 在 润 泽 远 成 智 慧 社 区 项 目 中 得 到 了 具 体 的 落 地 应 用 ， 在 智 慧 社 区
项 目 中 借 助 ｉ ｆｒａｍ ｅ 来 链 接 该 溯 源 系 统 ， 为 智 慧 社 区 项 目 中 有 溯 源 码 信 息 的 可 溯   源 商 品 提 供 基 于 区 块 链 的 可 靠 去 中 心 化 溯 源 。

６ １

北京 邮 电大学工程硕士学位论文



  

＾

＝ ＝＝＝ ＝ —  

ＨＨ   春麵   ■

ｍｍ ｍ

｜

＼

  ＼ ｍ ｍ ｍ
｜

＿费 ｉＬ

丨

     ？ ＾ＨＨｉ
Ｉ ｛

ｍ ？ ｗｍ

 ｊ

ｊ

￣￣

－－

｜

战复．

１  

       ￣

桷 肝 ，  ＾ ，

ｓ ？ ？ ； ｉ

ｉ

ｒ


ｊ ；

：


ｇ ＜ ｙ

ｆ ；

ｊ

［

＊：Ａ ＊ ｍ ｉ

—＇

衿 ＿

一

■Ｈ 士  ９Ｈ 匕 ｍ

： 

―

—

商

Ｌ＾Ｌｊ





，

｜

＾  ］ ＂

 — 贿  ＿ １

 舰 雜  

｜

，

 ＨＨ  ｈ 細

ｉ

ｙ

剛
！

＿ 孩 ｉ

＂＂ ＂ ＂

￣￣

  ＆ｓ＾   ｓｓｓ ｅ ｈ      ｒ ５

ｉ

Ｉ ｊ

｜

［

！

｜

＼

！

！

ｕ 」   ， 

 ：

 Ｌ 

— ？ ？…？ ？ ？ 

！ —￣ ８

？ ￣ —  
 ，
［ ＾   ＿ ＿ － ＿

ｙ

＾ 



  －＇
－

电子 锫 ｓ公能

｜ ｜

｜

广隹梭毪



 歸 腿

Ａ ｐ ｍ ｐ ｃｍｍ ｍ



 Ｉ

■ｍ  ｚｎｎｎ   ＨＨ   義   ｊｙ

：

： ：
：

忑 ：

：

：

 ： ｆ ；

 ＩＥＳＩ３

阚
ｉｉ４

一

■ ￣

ｚｚｉｚｚｉ

，

ｍｍｍ 纖麟

确 ＾  

ｈ ｅ

■ＨＩ段

」  

」 ＾ 

」
——

 一 — —

— ｉ

Ｉ ，  

＝ 

二

＝

：

心八

   厲霉 疆 ★ ＇ ，

：

ｈ

Ｌ＾ ：： ， ＝ ± ｚｌ ：  ｓ

基 雄 敎 据
ｚｉ：

安防 ｎ 萊 系 轻 ｍｍ ＾ ｉ ｗ ｍｍ ？ ｉ ｗ

—

ｚＬ ＿

ｉｚ

．

．

．．．

：
．．

＾ －－ ：

髮
ｕ

—

￣￣



— 

 

ｅｉ

 ｔ

■

Ｖ    ＇

＊

ｘ

■■ ？     Ｍｌ ；

＊ａ



丨

  Ｓ Ｄ Ｒ ｆ ｉ

掇 ？ ． 头

ｆＩ

ｒ ａ





！

￣．

－

ｉ

＇ ｔ ｏｓ 机

Ｉ

Ｊ Ｌ





＇

■

■ ＇ 、  

［［

图 ５－ １

７

智 慧 社 区 系 统 架 构 图

如 图 ７ ５ １ － 所 示 为 润 泽 远 成 智 慧 社 区 项 目 的 架 构 图 ， 本 系 统 可 以 在 项 目 的 社

区 帮 购 和 社 区 电 商 功 能 模 块 中 提 供 溯 源 查 询 子 功 能 ， 为 社 区 中 的 农 副 产 品 提 供  

基于 区块链的可信溯源 ，

从而确 保食 品 安 全 ，

实现项 目 的实际落地 ，

如 图 ５－ １

８  

所 示 为 溯 源 系 统 在 智 慧 社 区 中 的 应 用 效 果 图 。

６ ２

第五章 基于 区块链的 农副 产 品 溯源系 统 的详细设计与 实现



  

食菘名 稃 食 ？介绍

進潔秋怒  溺藤Ｈ  食 盔 杖态

操 作  

錄 雜嫌馱来

劈繼

 ＿   麵擬鮮

 ？ １ ０ ２ ２
Ｊｆ

找 ＿

＞

Ｂ 麵 麵  麵麵 麵  柯藝  織 ｆ ｌ

Ｉ  

Ｊ ， 登 絲 系 各 ｍ療 家 ⑶  

＾ ｜ ｜

：

ｈ

Ｈ  ？ Ｉ ３ ６ ＊ ？ ｃ ｒ ｔ

４ １  

＾ ；

？ ＾ ： ｃ

ｉ ｃ ＝ ｐ ＊ｊ  

＾ ０ ＆ ｊ ？ ＾ ￡ ＆ ￡ ＜

ｃＣ

６？ｈＣ

７

ｉ

＆４

Ｂ－ ＜＞ ａｅＤ

ｉ

ｙ

 ｐｍ  ｍ ？ ＆ ｅｒｒ：

ｉ

ｉ ｉ  

＾ ＾ ＾＾＾

〇 ＾ ｄ： ＾ Ｕ Ｃ


＾ ＾ Ｗ Ｄ ４ ４ ＜

６Ｓ

；

Ａ￡ Ｕ

Ｆ＾

？

｜  

＾   ＞ ？ ±

？

２Ｃ ２ Ｍ Ｃ ２２  ０＆ ３ ２ ２３

＂
Ｊｆ

■  Ｏ＾ Ａ 

Ｓ

ｆＴ

；

 汰 猓

／  ＾  

酿

… ４  

图 ５ ８ － １

溯 源 系 统 在 智 慧 社 区 中 的 应 用 效 果 图

５ ． ５ 系统 测 试 与 评估  

境   测 试 环 ５ ． ５ ． １

如 下 表 ４ ５ － 所 示 为 系 统 具 体 的 硬 件 环 境 。  

  表 ５ － ４ 系 统 硬 件 环 境

 一

  

 硬件环境 软件环 境  

系 统 前 后 端 Ｍ Ｒ Ｃ Ｔ ｎ Ｉ

ｔｅ ｌ （

）

ｏｒｅ （

）

 ｖ ｕ ５ －
ｉ

ｅ ｊ ． ｓ  

＿

＿

＠   ８ ２ ５ ０ Ｕ Ｃ Ｐ Ｕ

Ｇ Ｈ ０ ６ １ ．

ｚ ，

８

ｔ ｏ ｍ ｃ ａｔ  

＿

＿

＿

 核 ６ ４ 位 操 作 系 统

ａｖ ａ  
ｊ

ｗ ｅ ｂ ３ ． ｓ   ｊ

ｔ ｒ ｕ ｆｆｌ ｅ

ｍ ｙ ｑ ｓ

ｌ  

ｉ ｐ ｆｓ  

区 块 链 节 点   Ｒ Ｘ Ｒ Ｕ Ｅ ｎ Ｉ

ｔｅ ｌ （

）

ｅ ｏｎ （

ＣＰ
）

 ５ －２６４３

ｔ ｒ ｕ ｆｆ ｌ ｅ

＠ 存 硬 ｖ ３ 

内 Ｇ Ｈ ３ ４ ０ ．

ｚ



Ｇ （ ６ ４

）

ｇ ｅ ｔｈ  

盘  Ｔ （ １

）

ｇ ａ ｎ ａ ｃ ｈ ｅ

ｓ ｏ ｌ ｅ





ｇ〇



  

６ ３  

北京邮 电大学工程硕士学位论文



  

如 下 表 ５ － ５ 所 示 为 系 统 所 需 的 软 件 详 情 列 表 。  

表 ５－５ 系 统所 需 软 件列 表


 软件名称

   ￣ ￣  
说明

｜
ＭｙＳ ＱＬ 存 储 系 统 运 行 所 需 的 中 心 化 数据  

ＯｐｅｎＪＤＫ

系 统 后 台 运 行 依 赖 的 Ｊａｖａ 环 境



  

Ｔ ｏ ｍ ｃ ａｔ

Ｗｅｂ 系 统运行 的 容 器



  

ｖｕ ｅ ．ｊ ｓ

前端 ｗｅｂ 页 面运行所 需 的 框架



  

提 接 个 库 
．
Ｍ Ｓ

—

Ｊ ａｖａＳ ｃｒｉｐｔ

，

其

供 了 在前端直

使

Ｊ

用 ｓ 代 码 与 以 太坊 建 立连接 和 交 互 的 接 口

ｊ



个 基 于 太 坊 语 言 发 框 架 一

以

的 ｓ ｏｌｉ ｄｉｔｙ

开

，

 ｔｒｕｆ ｌｅ 借 助 该 框 架 可 以 便 捷 地 完 成 智 能 合 约 的 编  

译部署 ，

并建立与合约 的交互

 ￣ ￣

  

 星 际文件系统 ，

可 以 自 行搭建

ｉｐ ｆｓ 节 点 实 现  

１Ｐ

大文件 的上链



  

一 个 以 太 坊 节 点 仿 真 软 件 ， 会 自 动 生 成 以 太

 ｇａｎａｃｈｅ 坊 账 户 并 自 动 挖 矿 ， 主 要 用 于 系 统 和 代 码 的  

ｉｍ



  

 全 称 为 是 个 以 太 坊 官 方所 ｇｅｔｈ

１

ｇ〇 － ｅｔｈｅ ｒｅ ｕｍ ，

一

提供 的 客 户 端 软件 ， 其所拥 有 的 交 互 式命 令

控 制 台 可 以 实 现 以 太坊 的 各 种 功 能  

 ＂

 ｓ ｏｌ ｅ

以 太 坊 智 能 合 约 的 编 译 器  

以 太 坊 源 码 搭建 以 及编 译 所 需 的 环 境 ， 因 为

以 太 坊源 码是 由 ｇｏ 语 言 编 写 的

｜



  

５ ． ５．２ 主要功 能测 试  

如 下 表 ５ －６ 所 示 为 对 用 户 登 录 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ５－６ 用 户 登 录 测 试





  

测 试编 号１
  

测 试 内 容用 户 登录功 能测 试
  

测试 目 的测试 已经注册 的 用 户 能否顺利 登录系 统 并看 到 页 面
  

前置条件用 户 已经成功注册账户
  

测 试 步骤  

输入用 户 名 ，

密码 ，

并选择 用 户 类别 【 生 产商 、 经销 商 、 零售 商 、

消 费 者 、  

管理员 】 后点击登录按钮



  

预期 结 果系 统提示登录成功 进入系统主 界面可查看 系 统各项功 能 ，   

测 试结 果

与 预 期 结 果 相 符  

｜

６ ４

第五章 基于 区块链的农副产品溯源系统的详细设计与 实现



  

如 下 表 ５ － ７ 所 示 为 对 消 费 者 用 户 注 册 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ５－７ 消 费 者 用 户 注册测 试





  

测 试编 号２
  

测 试 内 容消 费者用 户 注册功 能测 试
  

测试 目 的测 试想要注册 成为 消 费者 的 用 户 能 否注册成功
  

前置条件无
  

测 试步骤  

选择 用 户 类 别 为 消 费 者 ， 输 入 用 户 名 ， 密 码 ， 确 认 密 码 ， 以 太 坊 账 户 密 码 后  

点 击注册按钮



  

预 期 结 果 系 统 提示 注 册 成功 ， 用 户 能 够 使 用 注册 账 号 登录 并进入 系 统 主 界 面  

１１ 试 结 果

与 预 期 结 果 相 符  

１

｜

如 下 表 ５ － ８ 所 示 为 对 商 家 用 户 注 册 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ５－８ 商 家 用 户 注 册测 试





  

测 试编号３
  

测 试 内 容商 家 用 户 注册功 能测 试
  

测试 目 的测 试想要注册成为商 家 的 用 户 能否注册成功
  

前置条件无
  

测 试步骤  

选 择 用 户 类 别 为 生 产 商 ／经 销 商 零 ／ 售 商 ，

输入用 户名 ，

密码 ，

确 认 密 码 后 点  

击注册按钮



  

预期 结果系 统提示注册成功 ，

用 户 能 够 使 用 注 册 账 号 登 录 并 进入 系 统 主 界 面  

测试结果

与 预 期 结 果 相 符  

｜

如 下 表 ５ －９ 所 示 为 对 商 家 接 入 申 请 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ５ ９ － 商 家 接 入 申 请 测 试





  

测 试编号４
  

测 试 内 容商家接入 申 请功 能测拭
  

测 试 目 的测 试 想 要 申 请 接 入 以 太 坊 进 行 溯 源 信 息 上 传 的 商 家 能 否 成 功 发 送 申 请  

前置条件用 户 登录 系 统
  

按 照 提示 依 次输入姓名 ，

商户 种类，

联系方式 ，

常用 地址 ，

描述 ，

营 业 资 质  

测 试 步骤  

照片 ，

件 选 附

（可

），

以太坊账户 密码 ，

点击按钮确认 申 请



  

系 统 提 示 发 送 申 请 成 功 ， 用 户 能 够 在 个 人 信 息 页 面 查 看 自 己 的 接 入 申 请 详

预期 结果情 以 及 审 核通过情 况 ；

当 审 核 通 过 后 可 在 个 人 信 息 页 面 查 看 到 根据 自 己 输  

入 的 以太坊账户 密码生成 的 以 太坊账户 地址



  

测 试 结 果 与 预 期 结 果 相 符 ｜

６ ５

北京邮 电大学工程硕士学位论文



  

如 下 表 ５ － １ ０ 所示 为 对 管 理 员 审 核 功 能 的 具 体测 试 详 情 与 测 试 结 果 。  

表 ５－ １ ０ 管 理 员 审 核 测 试





  

测 试编 号５
  

测 试 内 容管理员 审 核功 能测 试
  

测 试 目 的测 试管理员 能否 查 看到 用 户 发送 的接入 申 请并通过 审 核
  

前置条件用 户 登录系 统
  

进入 审 核 功 能 页 面 可 查 看 到 以 通 过 审 核 和 未 通过 审 核 的 用 户 发 送 的 接 入 申

测 试步骤请信 息 ，

内 容包括姓名 ，

商户 种类，

联系 方式 ，

常用 地址 ，

描述 ，

营 业 资 质  

照片 ，

附件 ，

以 太坊 账 户 ；

点 击 未 通 过 审 核 的 某 用 户 所 对 应 的 通过 审 核 按 钮  



系 统提示 审 核 成功 ，

该用 户 由 未 审 核 用 户 列表移至 审 核通过用 户 列 表 ，

管 理  

预 期 结 果员 可 在 审 核 通过 用 户 页 面 查 看 到 接 入 申 请 详 情 以 及 根据 用 户 输 入 的 以 太 坊

账户 密码生成 的 以太坊账户 地址



  

测 试 结 果 与 预 期 结 果 相 符 ｜

如 下 表 ５ １ － １ 所 示 为 对 个 人 信 息 管 理 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ５－１ １ 个人信 息 管理测试





  

测 试编 号６
  

测 试 内 容个人 信 息管理功能测试
  

测 试 目 的测试用 户 能否 查看 自 己 的个人信 息 并对信 息进行修改
  

前置条件用 户 登录系 统
  

测 试 步 骤  

点 击侧边栏进入个人 信 息 页 面 ；

在 基 本 资 料 卡 片 中 修 改 个 人 信 息 或 密 码 并

点击保存按钮



  

预 期 结 果系 统 提示 修 改 成 功 ， 用 户 能 够 在 个 人 信 息 页 面 查 看 已 经 修 改 的 个 人信 息

测 试结果

与 预 期 结 果 相 符

｜

６ ６

第五章 基于 区 块链的农副产 品 溯源系统 的详细设计与 实现



  

如 下 表 ２ ５ １ － 所示 为 对 溯 源 结 果 查 询 功 能 的 具 体测 试 详 情 与 测 试 结 果 。  

表 ２ ５ － １

溯 源结 果查询測试





  

测试编 号７
  

测 试 内 容溯源结果 查询 功 能测 试
  

测 试 系 统 能 否 根 据 溯 源 码 成 功 完 成 与 以 太 坊 的 交 互 并 从 链 上 获 取 产 品 的 完

测 试 目 的  

整溯源信 息并展示



  

前置条件用 户 登录 系 统
  

测 试步骤

输入溯源码 点 击查 询 按钮
  

系 统 提 示 查 询 成 功 右 侧 通 过表 单 显 示 产 品 的 详 细 信 息 与 溯 源 各 阶 段 的 商 ，

家信息 ；

左侧在

ｗｅ ｂｇｉｓ

上通过

Ｄ Ｏ ３



ｂ ｊ

ｅ

ｃｔ

标 明 产 品 溯 源过程 中 所 经 过 的 每  

 ＾
一个地点 ，

并通 过 动 画 和 线 条 动 态 连接各 个 地 点 来 表 明 产 品 溯 源 的 整 个 过  

ｍ



  

１ｍ 试结果

与 预 期 结 果 相 符

｜

如 下 表 ５ － １ ３ 所 示 为 对 生 产 商 信 息 录 入 功 能 的 具 体 测 试 详 情 与 测 试 结 果 。  

表 ３ ５ － １

生产 商信息 录入测试





  

测 试编 号８
  

测 试 内 容生产 商 信 息录入功 能测 试
  

测试 目 的测 试生产商 能否 成功将信息录入并上链
  

前置条件生产 商 用 户 登录系 统
  

输入食 品 名 称 ，

食品种类、

生产 日 期 ，

保质 期

单 位 【

：

天 】，

描述 ，

食 品 质  

测 试 步 骤  

量 【 用 １ 到 ５ 的 数字表示 】 ，

溯源单位

箱 【

、

盒等 】，

食品 数量 ，

照 片 （ 可  

选 ） 录入食 品 信 息 ；

输入姓名 ，

商户 种类，

联系方式 ，

常 用 地址 ，

描述 ，

营

业资质照片 ，

件 选 附

可 （

），

以太坊密码录入商家信息 ，

点 击按 钮 确 认 录 入  



系 统 提示 录 入 成 功 并 展 示 包括 交 易 哈 希 、 交 易 发送者 、 交 易 接 受 者 、 区 块高

预 期 结 果

度和 区块哈希值在 内 的本次上链操作 的 交易 信 息

— － 

  

测试结果

与 预 期 结 果 相 符

｜

６ ７

北京 邮 电大学工程硕 士学 位论文



  

如 下 表 ４ ５ １ － 所示 为 对 中 间 商 单 个 信 息 录 入 功 能 中 的 溯 源 信 息 确 认 子 功 能 的

具 体测 试 详 情 与 测 试 结 果 。  

 表 ４ ５ － １

中 间 商 单 个 信 息 录 入一湖 源 信 息 确 认 测 试



  

测 试编 号９
  

测试 内 容中 间 商单个信 息录入过程中 的溯源信息 确认功能测试
  

测 试 中 间 商 在 单 个 信 息 录 入 前 能 否 根 据 溯 源 码 成 功 将 本 产 品 之 前 的 溯 源 信

测 试 目 的  

息 从链上读 出



  

前置条件中 间 商用 户 登录系 统
  

测 试步骤输入溯源码 ， 点击按钮 查询溯源信 息
  

系 统 提 示 查 询 成 功 并 展 示包 括 溯 源状态 、 产 品 名 称 、 种 类 、 生 产 商 信 息 等 在  

预 期 结 果  

内 的 简要溯源信息 ， 点击查看更多 详情按钮可查看完整溯源信 息



  

测 试结 果 与 预 期 结 果 相 符   ｜

如 下 表 ５ － １ ５ 所 示 为 对 中 间 商 单 个 信 息 录 入 功 能 中 的 信 息 上 链 子 功 能 的 具 体  

测 试 详 情 与 测 试 结 果 。  

表 ５ － １ ５ 中 间 商 单 个 信 息 录 信 入一 息 上 链 测 试





  

测 试编号１ ０
  

测 试 内 容中 间 商单个信 息录入过程 中 的 信 息上链功能测试
  

测 试 目 的测 试 中 间 商 能 否 成功将单个产 品 信 息录入并上链
  

前置条件中 间 商 用 户 己经根据溯源码进行溯源信 息 确 认
  

输入姓名 ，

商户 种类，

联系方式 ，

测 试 步 骤  

选 ） ， 以 太坊密码录入商家信 息 ，



常 用 地址 ，

描述 ，

营业资质照片 ，

附 件 （ 可  

点 击按 钮确 认录 入
  

系 统 提 示 录 入 成 功 并 展 示包 括 交 易 哈希 、 交 易 发 送 者 、 交 易 接 受 者 、 区 块 高

预 期 结 果

度和 区块哈希值在 内 的本次上链操作 的交易 信息



  

测试结果

与 预 期 结 果 相 符

｜

６ ８

第五章 基于 区块链 的农副产 品溯源 系 统 的详细设计与 实现



  

如 下 表 ５ － １ ６ 所 示 为 对 中 间 商 批 量 信 息 录 入 功 能 中 的 溯 源 码 文 件 解 析 子 功 能  

的 具 体测 试 详 情 与 测 试 结 果 。  

 表 ６ ５ － １

中 间 商 批量 信 息 录 入一溯 源 码 文件解析测 试



  

测 试编 号１ １
  

测 试 内 容中 间 商批量信 息录入过程 中 的 溯源码文件解析功 能测 试
  

测 试 能 否 成 功 解 析 溯 源 码 文 件 中 包 含 的 溯 源 码 并 根据 解 析 获 得 的 溯 源 码 查  

测 试 目 的

询溯源信息 ，

并 对 结果进行 分 析展示



  

前置条件中 间 商用 户 登录系 统
  

测 试步骤点击按钮上传溯源码文件
  

系 统 解析 文 件 成 功 并 显 示 文 件 中 所 有 的 溯 源 码 获取 每 个 溯 源 码 对 应 的 产 ；

预 期 结果品 溯源信 息 ，

借助

ｅ ｃ ｈ ａｒ ｔｓ

对所有产 品

的溯源结果信息进行分析统计并展示 ；

点击列表展开查看每个产品 的溯源结果 详情



  

测 试结 果 与 预 期 结 果 相 符   ｜

如 下 表 ５ １ － ７ 所 示 为 对 中 间 商 批 量 信 息 录 入 功 能 中 的 信 息 上 链 子 功 能 的 具 体  

测 试 详 情 与 测 试 结 果 。  

表 ５ － １ ７ 中 间 商 批 量 信 息 录 信 入一 息 上 链 測 试





  

测试编 号１ ２
  

测 试 内 容中 间 商批量信息录入过程 中 的 信 息上链功 能测试
  

测试 目 的测试 中 间 商能否成功将 多 个产 品 信 息录入并上链
  

前置条件中 间 商 用 户 已经根据溯源码进行溯源信 息 确 认
  

输入 姓 名 ，

商户 种类，

联系方式 ，

测 试 步 骤  

选 ） ， 以 太坊密码录入商家 信 息 ，



常用 地址 ，

描述 ，

营业资质 照片 ，

附 件 （ 可  

点 击按钮确 认录入
  

系 统 提 示 录 入 成 功 并 展 示 包 括 交 易 哈 希 、 交 易 发 送 者 、 交 易 接 受 者 、 区 块 高  

预 期 结 果

度和 区块哈希值在 内 的本次上链操作 的父 易 信 息



  

测试结果

与 预 期 结 果 相 符

｜

６ ９

北京 邮 电大学工程硕士学位论文



  

如 下 表 ５ － １ ８ 所 示 为 对 中 间 商 信 息 录入 功 能 中 的 修 改 产 品 信 息 子 功 能 的 具 体  

测 试 详 情 与 测 试 结 果 。  

表 ５－ １ ８ 中 间 商 信 息 录 入一修 改 产 品 信 息 測 试





  

测 试编 号１ ３
  

测 试 内 容中 间 商信 息录入过程 中 的修 改产 品 信 息 功能测 试
  

测 试 目 的测 试 中 间 商 能否 成功修 改产 品 信 息 并使 下游 用 户 获得提示
  

前置条件中 间 商 用 户 已经根据溯源码获取溯源信 息
  

测 试步骤对如 产 品 质 量等信 息进行修改并填写修改理 由
  

系 统 提示 修 改 成 功 ， 产 品 溯 源 错 误 状 态 改 变 ， 下 游 用 户 使 用 该 溯 源码 进 行 溯

预 期 结 果  

源时系统会有提示信 息 曾 进行过修改



  

测 试 结 果 与 预 期 结 果 相 符   ｜

５． ５．３ 系统性 能测 试  

系 统 中 与 区 块 链 交 互 的 部 分 功 能 为 系 统 的 主 要 功 能 ， 因 此 其 响 应 时 间 直 接 影  

响 了 系 统 的 性 能 ， 本 文 之 前 阐 述 的 基 于 Ｐ〇Ａ 共 识 的 权威 节 点 动 态 选择 算 法 可 以

使 得 系 统 的 出 块 保持 稳 定 ， 本 节 排 除 了 权 威 节 点 离 线 的 干 扰 ， 主 要 对 稳 定 情 况 下  

系 统 的 性 能 进 行 测 试 。  

如 下 表 ５ － １ ９ 所 示 为 对 涉 及 区 块 链溯 源 的 主 要 功 能 的 响 应 时 间 的 测 试 与 测 试  

结 果 。 测 试 时 在 前 端 发 送 １ ０ ０ 次 请 求 并 记录 每 次 测 试 结 果 ， 最 终 结 果 取 平 均 值 。

从 测 试 结 果 可 以 看 出 查 询 请求 耗 时 低 于 信 息 上传 请 求 ， 当 查询 或 上 传 的 溯 源信 息

中 包 含 图 片 信 息 从而 需 要 与 ＩＰＦ Ｓ 建 立 交 互 时 耗 时 会 更 长 。  

表 ９ ５ － １

系 统 区 块链溯 源 功 能 响应 时 间 測试结 果



  

功 能名 称 测试次数 平均响应时 间

—

  无 图 片 溯 源 结 果 查 询 １ ００ 次

０ ． ２ ｓ

．

—

    无 图 片 溯 源 信 息 上传

次 １ ０ ０

０ ． ５ ｓ

有 图片溯源结果查询

次 １ ０ ０

０ ６ｓ





  

有 图 片 溯 源 信 息 上 传 １ ０ ０ 次 〇 ． ９ ｓ

除 了 系 统 的 主 要 功 能 外 ， 为 了 系 统 功 能 更 加 完 善 、 页 面 更 加 美 观 而 所 使 用 到

的 ｅｃｈａｒｔｓ 组 件 与 ｗｅｂｇｉ ｓ 地 图 展 示 也 会 在 一 定 程 度 上 影 响 系 统 性 能 ， 因 此 单 独 对  

其 的 耗 时 进 行 测 试 。 依 然 记 录 １ ０ ０ 次 的 耗 时 取 平 均 值 作 为 最 终 的 测 试 结 果 。 从 测  

试 结 果 可 以 看 出 ｅｃｈａｒｔｓ 组 件 的 平 均 耗 时 较 低 ， 基 本 不 产 生 影 响 ， ｗｅｂｇ ｉ ｓ 从 加 载  

到完整显示 需 要消 耗

左 右 １ ． ５ ｓ

，

对性 能有一 定影响 ；

获 取 定 位 服 务 也 会 消 耗 一 定  

的 时 间 ， 后 续 系 统 可 以 在 此 基 础 上 继 续 优 化 。

７ ０

第五章 基于区块链的农副 产 品溯源系统 的详细 设计与 实现



  

表 应 时 测 试 果 和 响 ５ － ２ ０ ｅｃ ｈａｒｔｓ

ｗ ｅｂｇｉ ｓ

间

结

—

    功能名称

ｍｉｍｅ

平均 响应时 间

｜

｜

ｗｅｂｇｉｓ 获 取 用 户 定 位

次 １ ０ ０

０ ９ｓ





  

ｗｅｂｇｉｓ 力口 载 地 图 显 示 溯 源 结 果

次 １ ００

Ｌ５ｓ





  

ｅ ｃｈａｒｔ ｅ 组 件 统 计 结 果

次 １ ０ ０

 Ｍ ＜ （

ｓ





５ ． ６ 本 章 小 结  

本 章 主要 对 溯 源 系 统 的 详 细 设 计 与 实 现 进 行 了 介 绍 ， 对 提 供 去 中 心 化 溯 源 功  

能 的智 能合约 的具体设计与实现进行 了 说 明 ，

说明

了

区 块链私链搭建 的 私链环境 ；  

对 系 统 的 登 录 注 册 、 用 户 管 理 和 产 品 溯 源 三 个 功 能 模 块 的 具 体 实 现 过程 进 行 了 详  

细 阐 述 。 本 章 同 时 对 系 统 进 行 了 功 能 测 试 和 性 能 测 试 ， 并 对 测 试 结 果 进 行 展 示 ，  

也 对 系 统 最 终 的 页 面 效 果 进 行 了 展 示 。  

７ １

北京 邮 电大学工程硕士学位论文



  

７ ２

第六章 总结与展望



  

第 六 章 总 结 与 展 望

６ ． １ 工作 总结  

随 着 互 联 网 技 术 的 发 展 ， 在 食 品 安 全 问 题 中 至 关 重 要 的 食 品 溯 源 问 题 有 了 全  

新 的 解 决 方 案 一基 于 区 块 链 的 去 中 心 化 溯 源 。 本 文 通过 对 区 块 链 的 原 理 以 及 主 要  

应 用 以 太坊 进 行 研 宄 ， 结 合 国 内 外 区 块链 溯 源 的 发 展 现 状 ， 提 出 当 前 溯 源 系 统 存  

在 的 主 要 问 题 并 在 此 基 础 上 提 出 解 决 方 案 来 设 计 并 实 现 一 个 安 全 、 透 明 、 高 效 的

去 中 心 化农 副 产 品 溯 源 系 统 旨 在 实 现产 品 从供应 商 到 消 费 者 的 全 过程 的 追 踪 和   ；

溯 源 ， 确 保 产 品 的 质 量 和 安 全 。 借 助 开源 的 区 块 链 平 台 以 太 坊 设计 并 实 现 了 溯 源  

的 智 能合 约 ， 完 成 对 本 文 的 核 心 内 容 区 块链溯 源 的 研 宄 与 实 现 。 同 时 基 于 以 太 坊  

现 有 共 识 算法 进 行 改进 ， 使 得 共 识 算 法更 加 符 合 系 统 的 实 际 需 求 ， 确 保 区 块 链 出

块和 系 统 运 行 的 稳 定 性 。 添 加 除 了 溯 源 功 能 之 外 的 其 他 附 加 功 能 如 审 核 、 接 入 申

请 等 ， 使 得 系 统 的 功 能 更 加 丰 富 和 完 善 ， 提 高 系 统 的 易 用 性 和 实 用 性 。 将 溯 源 结  

果 展 示 与 和 相 结 合 ｗｅｂｇｉ ｓ

ｅ ｃ ｈ ａｒｔｓ

，

实现在地 图 展示溯源途经路线 ，

使 得 溯 源 过  

程 更 加 清 晰 明 了 。 本 文 的 主 要 工 作 如 下 ：  

１ ． 研 究 并 实 现 基 于 以 太 坊 的 食 品 溯 源 智 能 合 约  

在 商 品 溯 源 的 过 程 中 ， 溯 源 信 息 由 中 心 机 构 数据 库 进 行托 管 ， 数 据 的 中 心 化  

管 理 可 能 造 成 数 据 被 篡 改 或 损 坏 的 风 险 ， 本 文 使 用 区 块 链 进 行 溯 源 数 据 的 存 储 ，  

以 此 来 保 障 数 据 的 去 中 心 化 特性 和 不 可 篡 改 特 性 ， 避 免 了 中 心 化 存 储 所 带 来 的 潜  

在隐患 ；

设计并实现 了 基于

ｓ ｏ ｌ ｉ ｄｉｔｙ

语 言 的溯源智 能合约 并通过

Ｗｅｂ ３ ．ｊ ｓ

与

ｓ ｊ

代  

码 建 立 连 接 实 现 与 以 太 坊 的 交 互 ， 以 此 来 实 现 溯 源 功 能 。  

将 溯 源 的 全 过 程 及 其 数 据 放 置 于 以 太 坊 主 网 显 然 不 合 适 且 不 现 实 ， 以 太 坊 提  

供 测 试 网 络 以 及 搭 建 私 链 的 功 能 便 于 ＤＡｐｐ 的 开 发 和 使 用 。 本 文 中 的 系 统 建 立 在   搭 建 的 私 链 上 ， 只 有 获 得 权 限 的 账 户 才 能 接 入 私 链 ， 使 得 系 统 在 一 定 数 量 的 人 群  

或 联 盟 内 进 行 使 用 ， 确 保 信 息 的 安 全 与 防 止 外 泄 。 使 用 ｓｏｌｉ ｄｉｔｙ 语 言 编 写 溯 源 智

能 合 约 并 与 系 统 交 互 ， 将 信 息 上 链 确 保 溯 源 信 息 是 不 可 篡 改 的 。  

区块链中每个区块的大小是有限制 的 ，

同 时 区块链 的

决 定 链 上   “

”

ｇ ａｓ

ｍ ｌ ｉ

ｉｔ

了

数据应尽可能简洁 ，

较长的文件或 内 容上链不仅 需要进行拆分 ，

更 会消 耗 过 多 的

资 源 和 算 力 ， 对 于 整 个 区 块 链 的 运 行 和 维 护 都 是 不 利 的 。 在 溯 源过 程 中 ， 除 去 溯  

源 的 信 息 数据 外 ， 如 果 能 将 录入 信 息 的 个 人 或 商 家 的 凭 证 同 时 上 链 ， 就 可 以 更 好  

地进行追责和追溯 。

本文把

ＩＰＦ Ｓ

和 区块链相结合 ，

将 大 文 件 上 传 至 ＩＰＦ Ｓ 再将 与  

文 件 内 容 一 对 一 应 的 哈 希 值 存 入 链 中 ， 有 效 解 决 了 大文 件 的 存 储 问 题 ， 使 得 链上  

７ ３

北京邮 电大学工程硕士学位论文



  

数据 更加 简 洁 ， 不 仅有 利 于 区 块链 的 维 护 ， 也 使 得 查 询 等 操 作 更 加 高 效 ， 提 高 系

统 效率 的

。  

２ ．

研 宄 并 实 现基 于 ＰｏＡ 共 识 的 权 威 节 点 动 态 选 择算 法  

以 太 坊 主 网 使 用 基 于 工 作 量 证 明 的 Ｅｔｈａｓｈ 共 识 算 法 进 行挖 矿 以 此 来 达 成 共  

识 ， 这 对 于 私 链 来 说 显 然 是 不 合 适 的 ， 将 对 算 力 和 资 源 造 成 大 量 的 浪 费 。 以 太 坊  

提 供 了 基 于 ＰｏＡ 的 适 用 于 私 链 的 共 识 算 法 ｃｌ ｉ ｑｕｅ 来 解 决 此 问 题 。 本 文 在 ｃｌｉｑｕｅ   算 法 的 基 础 上进 行 改 进 ， 不 将 消 费 者 纳 入 权 威 节 点 的 考 虑 范 围 内 ， 同 时 不 断 更 新  

权 威 节 点 列 表 使 得 列 表 中 节 点 尽 可 能 地保持 活 跃 ， 从 而 使 得 出 块速 度 和 系 统 稳 定  

性 都 得 到 提 升 。 通过 ｇｅｔｈ 提 供 的 工 具 ｐｕｐｐｅｔｈ 来 生 成 创 世 纪 区 块 时 可 实 现 对 共 识   算 法 的 更 改 ， 开 放 ｒｐｃ 接 口 实 现 与 以 太 坊 节 点 间 的 交 互 。
通过 实 验对 比 发 现 改 进 算 法 使得 系 统 吞 吐 量 得 到 了 提 升 ， 能 使 系 统保 持 持 续  

稳 定 的 出 块 ， 当 交 易 越 频 繁 时 ， 算 法 的 提 升 效 果 越 明 显 。

３ ． 设 计 并 实 现 基 于 区 块 链 的 农 副 产 品 溯 源 系 统  

本 文 实 现 了 基于 区 块链 的 溯 源 系 统 ， 使得 系 统 能 够 完 成 与 以 太 坊 中 部 署 的 溯  

源 智 能 合 约 的 交 互从 而 实 现溯 源 功 能 。 同 时 实现 以 太 坊 账 户 注 册 、 账 户 审 核 等 其  

他功能 ，

结合溯源功 能使得系 统功能更加完善 。

使 将 溯 源 用 和 ｗｅｂ ｇｉ ｓ

ｅ ｃ ｈａｒｔ ｓ

查  

询 的 结 果 在 地 图 上 进 行 直 观 的 展 示 。  

６ ． ２ 研究展 望  

本 文 通 过 对 区 块 链 技 术 的 研 究 和 学 习 ， 将 其 与 农 副 产 品 溯 源 相 结 合 实 现 农  

副 产 品 的 去 中 心 化 可 信 溯 源 ， 同 时 研 宄 了 现有 的 共 识 算 法 ， 在 基 于 权 威 证 明 的

共 识 算 法 基 础 上进 行 了 改 进 ， 最 终 设计 并 实 现 了 一 个 面 向 农 副 产 品 的 区 块 链 溯

源 系 统 ， 以 此 来 解 决 溯 源 过 程 中 遇 到 的 问 题 。 但 本 文 依 然 存 在 一 些 不 足 ：  

如 在 本 文 设 计 的 权 威 节 点 动 态 选 择 算 法 中 ， 为 了 避 免 半 数 以 上 节 点 离 线 时  

造 成 的 错 误 使 得所 有 节 点 都 在 等 待 并 陷 入   “

”

Ｓ ｉ ｇｎｅ ｄ  ｒｅ ｃ ｅｎｔｌｙ，  ｍｕ ｓ ｔ  ｗ ａｉ ｔ  ｆｏ ｒ  ｏ ｔ ｈｅｒｓ

死锁 ，

算法根据 系统的 吞吐量变化情况动态灵活调 整 了 节 点切换 的 时 间 间 隔 ；  

但是

目

前的

时

间

间

隔设置是在

５ ｔ －

ｔ

秒之

内 进 行 变 动 而 不 是 完 全 基 于 系 统 运 行情  

况 去 决 定 的 ， 是 在 一 定 范 围 内 的 灵 活 变 动 ， 时 间 间 隔 最 长 不 超 过 ５ｔ 是 为 了 使 得  

当 存 在 权 威节 点 离 线 时 系 统 吞 吐 量 能 够 尽 快 收 敛 ， 因 此 当 权 威 节 点 都保 持在 线  

时 这种 频 繁 的 计算 和 切 换 实 际 是 一 种 消 耗 未来 可 能 的 改 进 可 以 聚 焦 在 如 何 设   ；

置 时 间 间 隔 使 其 能 够 最 大 限 度 地 贴 合 系 统 的 实 际 运 行 情 况 ， 使其 更加 合 理 。 除

此 之 外 权 威 节 点 的 个 数 是 根据 输入 值 ｎ 进 行 设 定 的 固 定 ｎ 个 ， 后 续 算法 可 以 在  

权 威 节 点 的 个 数 设 置 上 进 行 进 一 步 的 研 究 ， 可 以 根 据 网 络 中 接 入 的 节 点 个 数 来  

７ ４

第六章 总结与展望



  

设置 更 加 合 理 的 权 威 节 点 个 数 。  

本 文 设 计 的 基 于 区 块 链 的 农 副 产 品 溯 源 系 统 在 一 些 细 节 上 仍 有 优 化 空 间 ，  

如

ｗｅ ｂｇｉ ｓ

在获取定位时会有一定 的 时延 ；

以 及 需 要 在溯 源 过 程 中 更 动 产 品 信 息

时 需 要 对 当 前 链上 的 数据 有 更 加 详 细 的 记 录 以 及 为 下 游 用 户 提 供 更 加 详 细 的 信  

提 息 展 和 醒 ７Ｋ

。  

７ ５

北京邮 电大学工程硕士学位论文



  

７ ６

参考 文献



  

参 考 文 献  

１ ［］

《 中 国 区 块链 技 术 和 应 用 发 展 白 皮 书    （ ２ ０ １ ６） 》 ， 工 业 和 信 息 化 部 信 息 化  

和软件服务业司 ．

 Ｎ Ｂ Ａ Ｏ Ｌ ２
［］

ｋ ａ ａｍｏ ｔ ｏ  Ｓ ． 

ｎ ｏ ｉｔ ｃ

ｉ



ｈ ｐ ｅ ｅ ｒ－ｔｏ － ｐ ｅ ｅ ｒ  ｅ ｌ ｅ ｃｔｒｏ ｎｉ ｃ  ｃ ａｓ




ｓｙ

ｓｔｅｍ

Ｊ／
［

２ ０ ０ ．

８ ．

］

３
［］

何蒲

于戈

张岩峰

鲍玉斌 区块链技术与应用 前瞻综述 ．

Ｊ ． 计 算 机 科  

，

，

，

［］

学 ＋ ２ ０ １ ，

７

，

４４

（

０４ ）

：

１

７ －

５ １

．  

４
［］

盛利 民 ，

魏雪

涛

．

二

维码

在农

产

品

溯

源

中

的

应

用

Ｊ．
［］

现代农

业科技

，  

２ ０ ０ １ ３ （ １ ８ ） ： ３ ３ ０ － ３ ３

，  

５
［］

徐文艳 基于 ．

ＧＩＳ

农 产 品 质 量 安 全 溯 源 系 统 的 设 计 与 实 现 Ｐ］ ． 江 西 农 业 大  

学 ２ ０ ４ ４ ４ ６ １

：

＊

８ ．  

，

６

［

］

闫

师

杰

．

我

国

牛

肉

质

量

安

全

可

追

溯

系

统

研

宄

现

状

及

发

展

前

景

Ａ

［

］

．

中 国 农 业  

产

业经济

发

展

协

会

：

北

京

晟勋

炎

国

际会

议

服

务

中

心

２０
，

１

０

：

５

．  

７ 姜 德 科 昝 林 森 谢 毅 超 李 酷 张 海 辉 基 于 物 联 网 的 牛 肉 生 产 加 工 全 过 程  

［］

，

，

，

，

．

质 量 溯 源 及 站 式 供 销 服 务 系 统 研 发 牛 业 科 学 一

中 国 Ｊ ．
［］

２ ４ ＋ ４ ，

０

１

５４ ，

１

０６

（

）：

３

９－

５

８ ．  

８
［］

李久林 ．

基

于

二

维码

的

蔬菜

溯

源

信

息

管

理

平

台

的

设

计

Ｐ． ］

河

北

农

业

大  

学 ＋ ２ ０ ，

１

５

：３３

３ －

６

３ ９ ．

Ｂ Ｄ Ｍ Ａ Ｄ Ｂ Ａ ｒｉ ９
［］

ｕｍ ｂ ｌ ａｕ ｓ ｋａ ｓ  ，

ａｎｎ 

，

ｕｇ ａｎ

ｅ ａ ｔ 

ｌ ．

，

ｈ ｂ ｌ ｏ ｃｋ ｃ ａｉｎ  ｕ ｓ ｅ  ｃ ａｓ ｅ  ｉｎ  ｆｏ ｏ ｄ  ｄｉ ｓｔ

ｂｕ ｏ ｎ ｔｉ

：  

Ｄ ｏ ｙ ｏ ｕ ｋｎｏ ｗ  ｗｈｅｒｅ  ｙ ｏ ｕｒ  ｆｏ ｏ ｄ  ｈａｓ  ｂ ｅ ｅｎ？

Ｊ
［］

．  Ｉ ｎｔｅ ｒ ｎ ａｔｉ ｏ ｎａｌ  Ｊ ｏ ｕｒ ｎ ａ ｌ  ｏ ｆ  Ｉ ｎｆｏ ｒｍａｔ ｉ ｏ ｎ  

Ｍ   ａｎａｇ ｅ ｍ ｅｎｔ ，  ２ ０

１

９ ５２ ，

：

２ ０ ０ １ ０

８ ．  

Ｄ Ｎ Ｂ Ｂ Ｔ Ｖ １ ０ Ｐ ｒａｓｈａｒ 

［

］

ｈ ，  Ｊ ａ 

ｈ ，  Ｊ ａ  Ｓ ，  ｅｔ  ａｌ ． 

ｌ ｏ ｃｋｃｈａｉｎ－

ａｓ ｅ ｄ  ｙ ｒａｃ ｅ ａｂ ｉ ｌ ｉ ｔ  ａｎｄ 

ｉ ｓ ｉ ｂ ｉ ｌ ｉｔｙ  ｆｏ ｒ

Ａ Ａ Ｄ Ｗ Ｅ ｇ ｒｉ ｃ ｕｌｔｕｒａｌ  Ｐ ｒｏ ｄｕ ｃ ｔ ｓ ： 



ｅｃｅｎｔｒａｌ ｉ ｚｅｄ

ａｙ  ｏ ｆ 

ｎ

ｓ

ｕ

ｒ

ｉ

ｎ

ｇ



Ｆ

ｏ

ｏ

ｄ



Ｓ

ａ

ｆｅ

ｔ

ｙ



ｉ

ｎ



Ｉ

ｎ

ｄ

ｉ

ａ

Ｊ
［

］

．  

 Ｓ ｕ ｓｔａｉｎ ａｂ ｉ ｌ ｉ ｔｙ，

２０２０ ，

１

２８ （）

：

４ ７ ３

９

．

Ｇ Ｒ Ｖ Ｈ Ｈ ０ Ｒ １ １

［

］

ｅｏｒｇ ｅ



，

ａｒｓｈ



？

ａｙ



Ｐ ５



ｅ

ｔ



ａ

ｌ

．



Ｆ

ｏ

ｏ

ｄ



ｑ

ｕ

ａ

ｌ

ｉ

ｔ

ｙ



ｔ

ｒ

ａ

ｃ

ｅ

ａ

ｂ

ｉ

ｌ

ｉ

ｔ

ｙ



ｐ

ｒ

ｏ

ｔ

ｏ

ｔ

ｙ

ｐ

ｅ



ｆｏ

ｒ  

ｒ ｅ ｓ ｔａｕｒａｎｔ ｓ  ｕ ｓ ｉｎｇ  ｂ ｌ ｏ ｃｋｃ ｈ ａｉｎ  ａｎｄ  ｆｏ ｏ ｄ  ｑ ｕ ａｌ ｉｔｙ  ｄ ａｔａ  ｉ ｎｄ ｅｘ

Ｊ
［］

．  Ｊｏ ｕｒ ｎ ａ ｌ  ｏ ｆ  ｃ ｌ

ｅ ａｎ ｅ ｒ  

ｐ ｒｏ ｄｕｃｔｉ

ｏｎ ２ ，

０

１

９ ２４０

，

：

１

１

８０２ １

．  

Ｗ Ｎ Ａ １ ２

［

］

Ｓ

ｕ

ｒ

ａ

ｓ

ａ

ｋ



Ｔ ５



ａｔｔａｎａｖｉ ｃ ｈｅ ａｎ 

，Ｐｒｅｕｋ ｓ ａｋａｍＣ ？ ｅｔａｌ ．  Ｔｈａｉ

ｇｒｉ ｃ ｕｌｔｕｒｅ  Ｐ ｒ ｏ ｄｕｃｔｓ  

Ｂ Ｔｒａｃ ｅ ａｂ ｉ ｌ ｉ ｔｙ  Ｓ ｙ ｓｔｅ ｍ  ｕ ｓ ｉｎｇ 

ｌ ｏ ｃ ｋｃｈａｉ ｎ  ａｎ ｄ Ｉ ｎｔｅ ｒ ｎ ｅｔ  ｏ ｆ  Ｔ ｈｉ ｎｇ ｓ

Ｊ ［］

．  Ｉｎｔｅ ｒ ｎａｔｉ ｏ ｎａｌ



Ａ Ｃ Ａ Ｊｏｕｒ ｎ ａｌ  ｏ ｆ

ｄｖａｎｃ ｅ ｄ  ｏ ｍｐｕｔｅｒ  Ｓ ｃ ｉ ｅ ｎｃ ｅ  ａｎｄ 

ｐ ｐ ｎ ａ ｏ ９ ｌ ｉ ｃ ｔｉ

ｓ ，２ ０

１

９ ，

１０ （

７ ５ ５ ） ；

８－

８ ３ ．  

Ｋ Ａ Ａ Ｂ １ ３

［

］

ｍ ａ

ｉ ｌ ａｒｉ ｓ 

， Ｆ ｏ ｎｔｓ

，  Ｐ ｒ ｅｎａｆｅｔａ－

ｏ ｌ ｄｕ Ｆ ．  Ｔ ｈ ｅ  ｒｉ ｓ ｅ  ｏ ｆ ｂ ｌ ｏ ｃｋｃｈａｉｎ ｔｅ ｃ ｈｎ ｏ ｌ ｏ ｇｙ  ｉｎ  

ｒｉ Ｔ ＆ Ｔ ｈ ａｇ

ｃｕｌｔｕｒ ｅ  ａｎｄ ｆｏ ｏ ｄ  ｓ ｕｐ ｐ ｌ ｙ  ｃ

ｎ ａｉ

Ｊ ｓ

．

［］

ｒｅｎｄ ｓｉｎＦ ｏ ｏ ｄＳ ｃｉ ｅ ｎｃｅ

ｅ ｃｈｎｏ ｌ ｏ ｇｙ，

２０ １ ９ ，  

９ ６ ４ ２ １ ：

０－６５ ．  

Ｔ Ｙ Ｃ Ｋ Ｗ Ｃ Ｈ Ｂ Ｄ ｒｉ Ｔ Ｔ １ ４

［

］

ｓａｎｇ

Ｐ  ，

ｈｏｙ

Ｌ  ，

ｕ



ｅ ａ ｔ 

ｌ ．

，

ｌ ｏ ｃｋｃｈａｉｎ－

ｖ ｅ ｎ  Ｉ ｏ  ｆｏ ｒ  Ｆ ｏ ｏ ｄ  ｒａｃ ｅ ａｂ ｉ ｌ ｉｔｙ

７ ７

北京 邮 电大学工程硕士学 位论文



  

Ｃ Ｍ ＥＥ Ｅ Ａ ｗｉｔｈ  ａｎ Ｉ ｎｔｅ ｇｒａｔｅ ｄ ｏ ｎｓ ｅ ｎ ｓ ｕｓ 

ｅ ｃｈａｎｉ ｓｍ

Ｊ

 ．

Ｉ

［］



２ ｃ ｃ ｅ ｓ ｓ ，  ２ ０ １ ９ ，  ７ （ １ ） ： １

０ ０ ９ ０

－  

２ ９ ０ １

７ １

．

１５

［

］

禹

忠 郭畅 谢永斌 等．基于

，

，

，

区块链 的

医药防伪溯源系

统

研

究

Ｊ ［］

．

计

算

机

工

程

与

应 用 Ｙ Ｇ Ｃ Ｘ Ｙ Ｒ Ｚｈ ２ ，

０ ２ ０ ， ５ ６ （ ３ ） ： ３ ５ － ４ １  ．

ｕ

ｏｎｇ ，

ｕｏ

ｈａｎｇ ，

ｉ ｅ  ｏ ｎｇ ｂ ｉｎ ， ｅ ｔ  ａｌ ．  ｅ ｓ ｅ ａｒｃｈ  ｏ ｎ  

Ｍ  Ａ      ｅ ｄｉ ｃａｌ

Ｃ ｎｔｉ －

ｏ ｕｎｔ ｅ ｒｆｅ ｉｔｉｎ ｇ

Ｔｒ ａｃ ｅ ａｂ ｉ ｌ ｉｔｙ

Ｓｙ ｓｔｅ ｍ

Ｂ ａｓｅｄ

ｏｎ

Ｂ ｈ ｋ ｎ ｌ ｏ ｃ ｃ ａｉ

Ｊ

．  

［］

Ｃ Ｅ ｒｉ Ａ ｏ ｍｐ ｕｔｅ ｒ  ｎｇ ｉｎｅ ｅ ｎｇ  ａｎｄ

ｐ ｎ ｐ

ｌ ｉ ｃ ａｔｉ ｏ

２ ２ ６ ４ ｓ ５

０

０５ ，

（３ ） ： ３ ５ －

１ ．  

［

１

６ ］

董

云

峰

，

张

新 ，

许

继

平

，

等

．

基

于

区

块

链

的

粮

油

食

品

全

供

应

链

可

信

追

溯

模

型

Ｊ ［］

．

食  

品 科 学 Ｄ Ｙ Ｘ Ｘ Ｂ ４ ２ ０ ２ ０

，

，

９ ０ ６ １ （

）：３

３ －

．

ｏｎｇ  ｕｎｆｅｎｇ ， Ｚ ｈａｎｇ

ｉｎ ，

ｕ ｐ ｎ Ｊ 

ｉ

ｉ

ｇ ａ ｅｒ ，

ｌ ．

ｋ ｈ ｎ ｌ ｏ ｃ

ｃ ａｉ

－  

Ｍ Ｇ Ｏ Ｗ Ｂ ａｓｅｄ Ｔｒａｃ ｅａｂ ｉ ｌ ｉｔｙ

ｏ ｄ ｅ ｌ ｆｏ ｒ  ｒａｉｎｓ  ａｎｄ   ｉ ｌ ｓ

ｈｏ ｌ

ｅＳ

ｕｐ ｐ ｌｙ 

Ｃ ｈａｉｎ

Ｊ
［］

．

Ｆ ｏ ｏ ｄ

４ ６ Ｓ ｃ ｉ ｅｎｃ ｅ ，  ２ ０ ２ ０ ，

９ ０ １ （ 

）：３

３ －

．  

［

１

７ ］

陶

启

，

崔

晓

晖

，

赵

思

明

，

等

．

基

于

区

块

链技

术

的

食

品

质

量

安

全

管

理

系

统

及

在

大 米  

溯 源 中 的 应用 研 究 中 国 粮 油 学 报 Ｘ Ｊ ， ［］

Ｔ Ｑ Ｃ ２ ０ ２ ，

１

８３ ，

３（

１

０ ８ ） ： １ １

－
１１

．

ａｏ

ｉ

ｕｉ

，

ｉ ａｏｈｕｉ ，  

Ｍ Ｑ Ｚｈａｏ Ｓ ｉｍｉ ｎｇ ，  ｅ ｔ ａｌ ． Ｔｈｅ  Ｆ ｏ ｏ ｄ ｕａｌ ｉｔｙ Ｓ ａｆｅｔｙ

ａｎ ａｇ ｅ ｍｅｎｔ Ｓ ｙ ｓ ｔｅｍ Ｂ ａｓ ｅ ｄ ｏ ｎ  

Ｂ Ａ Ｒ ｌ ｏ ｃｋｃｈａｉｎ Ｔｅ ｃｈｎｏ ｌ ｏ ｇｙ ａｎｄ

ｐｐ ｌ ｉ ｃ ａｔｉ ｏ ｎ  ｉｎ

Ｔ ｉ ｃ ｅ 

ｒａｃ ｅ ａｂ ｉ ｌ ｉｔｙ

Ｊ
［］

．

Ｊｏ ｘｉｍａｌ  ｏ ｆ  ｔｈ ｅ  

Ｃ Ｃ Ｏ Ａ ｈｉｎｅ ｓ ｅ

ｅｒｅａｌ ｓａｎｄ

ｓ ｉ ｌ



ｎ ｓ ｓ ｏ ｃ ｉ ａｔｉ ｏ

２ ０ ， 

１

８ ３３

，

（

２ １

）：

１

１

０－

１

１

８  

Ｂ Ｃ 丄 Ａ Ｍ Ｍ Ｒ Ｅ  １
［

８ ］

Ｉ

．

ｅｎｔｏｖ ，

ｅｅ ．

－

ｈ ｚ ａ ｉ ｒ

ｉ．

．

Ｐ ｏ ｓ ｅｎｆｅ ｌ ｄ ．  ｙ ｒ ｏ ｏ ｆ  ｏ ｆ  ａｃ ｔｉｖ ｉ ｔ  ：

７
ｘｔｅｎｄｉｎｇｂｉｔｃ ｏｉｎ

ｓ



Ｍ Ｍ Ａ ｐｒｏ ｏ ｆ ｏ ｆ ｗｏ ｒｋ ｖｉ ａ ｐｒｏ ｏ ｆ ｏ ｆ ｓｔａｋｅ  ［ ｅｘｔｅｎ ｄ ｅ ｄ ａｂ ｓｔｒａｃｔ］  Ｃ

ＳＩ Ｇ

Ｅ ＴＲＩ Ｃ Ｓ  

Ｅ Ｒ Ｐ ｅ ｒｆｏ ｒｍ ａｎ ｃ ｅ  ｖ ａｌ ｕａｔｉ ｏ ｎ 

ｖ ｗ ４２ ｅ ｉ ｅ



２ ４ ４ ３
（

）（

０１

３
）

３ ７ — ．  

Ｍ Ｃ Ｂ Ｌ １ ９

［

］

．

ａｓｔｒｏ ， 

． ｉ ｓ ｋｏｖ ． Ｐ ｒａｃｔｉ ｃ ａｌ  ｂｙ ｚａｎｔｉｎ ｅ  ｆａｕｌｔ  ｔｏ ｌ ｅｒａｎ ｃ ｅ  ａｎｄ  ｐｒ ｏ ａｃ ｔ ｉｖ ｅ  ｒｅ ｃ ｏ ｖｅ ｒｙ，  

ＡＣ Ｍ Ｔ Ｃ ＴＯ Ｃ  ｒａｎｓ ａｃｔ ｉ ｏ ｎｓ  ｏｎ ｏｍｐｕｔｅｒ  Ｓｙ ｓ ｔ ｅｍ ｓ  （

Ｓ ２０ ４

２００２

Ａ ３ ９ ８ ６ －

）

（ ）（

）

１

．  

Ｄ Ｖ Ｋ Ｋ Ａ ２ ０ Ｓ

［

．
］

Ｆ ｚｉ ｅ ｍ ｂ ｏ ｗｓｋｉ ？  Ｓ ． ａｕ ｓ ｔ？  ．

ｏ

ｌ

ｍ

ｏ

ｇ

ｏ

ｒ

ｏ

ｖ ，



． Ｐ ｉ ｅｔｒｚ ａｋ ，  Ｐ ｒ ｏ ｏ ｆｓ  ｏ ｆ  ｓ ｐ ａｃ ｅ ，  ｉ ｎ ｒ

ｎｎｉ ｉａｌ

Ｃ Ｃ ｒｙｐｔｏ ｌ ｏ ｇｙ

ｐ ｏ ｎｆｅｒｅ ｎ ｃｅ Ｓ ，

ｇ ２ ｐｐ ｒｉｎ ｅｒ ０ １ ５

，

，

５ ６ ０ ５ ．  ８

—

５ ．  

 Ｖ Ｒ  Ｄ  Ｃ Ｋ  Ｋ Ｋ  Ｎ Ｄ ２ Ｓ Ｓｈ ｙ １

．

［

］ 



ｅｔ ｔ ，

．

ｅｄ

５

． Ｓ ａｔｔｅｒｆｉ ｅ ｌ ｄ ，

．

ａｉｎｉｉ ｏｕａ

，

．

ｗｉ ａｔ

，

Ｌ ．

ａ ｉ ｌ ｌ
ｊ

，

ａｔ ａ  

Ｅ Ｄ ｐｒｏ ｖｅｎａｎｃ ｅ  ａｓ ｓｕｒａｎ ｃ ｅ  ｉｎ ｃ ｌ ｏ ｕ ｄ ｕ ｓ ｉｎｇ  ｂ ｌ ｏ ｃ ｋｃ ｈａｉｎ，  ｉｎ ： Ｓ Ｐ Ｉ  ｅ ｆｅ ｎ ｓ ｅ  ＋  Ｓ ｅ ｃ ｕｒｉ ｔｙ

Ｃ ｏ ｎｆｅ ｒｅｎｃ ｅ ，  ２ ０ １ ７ ．

晓 光 块 链 技 术 共 算 法 综 述 信 脑 ２２ 王

［

］

区
．

识

Ｊ ［ ］ ．

息与 电

２ ０ ７ ６ １

．

．  

，

２ ３ 杨 绿 林 ． 基 于 改 进 ＰＢ Ｆ Ｔ 算 法 的 区 块 链 溯 源 系 统 设 计 与 实 现 Ｄ ． 北 京 邮 电 大

［

］

［

］

学 ２ ０ ９ １

．

，

袁 飞 跃 块 链 技 术 发 展 现 状 与 展 望 动 化 学 报 ２４

［

］

勇王 ，

区
．

自 Ｊ ．
［］

２０
，

１

６ ４２ ４

，

（）

：４８

１

－ ４ ９ ４  

Ｋ Ｎ Ｌ Ｐ Ｐ ２ Ｓ ５

［

］

 ．

ｎ ｇ ｉ

Ｓ ， 

．

ａｄ ａ



ｐｃｏｉｎ ：

ｙ ｈ ｋ ｅ ｅｒ－ ｔｏ － ｐ ｅ ｅ ｒ  ｃｒｙ ｐ ｔｏ － ｃ ｕ ｒｒｅｎ ｃ

ｗｉｔ


 ｐ ｒｏ ｏ ｆ－ ｏ ｆ－  ｓ ｔａ

ｅ ｅ ｆ ｓ

－  
ｌ

５

ｐ

ｕｂ

ｌ

ｉ

ｓ

ｈ

ｅ

ｄ



ｐ

ａｐ

ｅ

ｒ ，



２

０

１

２

．

Ｖ Ｒ Ｄ ｆ ｉ Ｃ Ｋ Ｋ Ｋ Ｌ Ｎ Ｄ ｈ ｙ ２ ６ Ｓ Ｓ

［

．
］

ｅｔｔ

，

．

ｅｄ ，

Ｓ ａ ． 

ｔｔ ｅ ｒ

ｅｌｄ ，

．

ａｉ ｎｌ ｉ ｏｕａ ，

．

ｗｉ ａｔ ，

．

ａ ｊ ｉ ｌ ｌ

，

ａｔａ ｐ ｒｏｖ ｅｎ ａｎｃ ｅ   

Ｅ Ｄ Ｃ ａｓ ｓｕｒａｎｃ ｅ  ｉｎ  ｃ ｌ ｏｕ ｄ  ｕ ｓ ｉ ｎｇ  ｂ ｌ ｏ ｃｋ ｃｈａｉｎ ５ ｉｎ ：  Ｓ Ｐ Ｉ 

ｅ ｆｅ ｎ ｓ ｅ  ＋  Ｓ ｅ ｃ ｕｒｉ ｔｙ 

ｏ ｎｆｅｒｅ ｎｃ ｅ

２ ０ ７ １

．  

５

２７

［

］

刘

敖

迪

，

杜

学

绘

，

王

娜 ，

李

少

卓

．

区

块

链技

术

及

其

在

信

息

安

全

领

域

的

研

究

进

展

Ｊ ［］

．  

７ ８

参考 文 献



  

软件学报 ２〇 ，

１

８

，

２

９

（

０

７
）

：

２

０

９

２

２ －

１

１

５ ．  

Ｒ Ｍ ＡＣ Ｍ ２
［

８ ］

Ｌ ａｍｐｏｒｔＬ

．

Ｓｈｏ ｓｔａｋ

． Ｐｅａｓｅ

．

Ｔｈｅｂｙ

ｚａｎｔｉｎｅ ｇｅｎｅｒａｌ

ｓ ｐ ｒｏ

ｂ

ｌ ｅｍ

Ｊ
［］

．

 Ｔ ｒａｎｓ

 ＆ ｏｎ

Ｐｒｏ ｇｒａｍｍｉｎｇＬ ａｎｇｕａｇ ｅｓ

Ｓ ｙ ｓｔｅｍｓ

１ ． 

９

８

２

．

４３ （

）

：

３

８

２－４０

１

Ｅ Ｗ Ｋ ＷＭ ＥＢ ＯＬ Ａ ２ ９

［

］

ｔｈｅｒｅｕｍ ．

ｉ

ｉ．

ｔｅＰ ａｐｅｒ ｜

／

＾ ｈ ｈ ．

ｔ

］

ｇ ） ｓ ： ／ ／ ｉ ｔ

ｕｂ ． ｃ ｏ ｍ／ｅｔｈｅ ｒｅｕｒｎ／／ｗｉｋｉ

Ｖ Ｐ ａ Ｔｉｉ ｔｅ

－  

ｐ ２ ０ ６ ｅ ｒ ，

１

ｌ ５ －

－

１

．  

Ｄ Ｎ Ｒ Ｄ Ｐ ３ ０ Ｊ ．

．

［

］

．

ｇｕｙ ｅ ｎ ，  ． Ｓ ａｎｄｈｕ ？  ｅｐ ｅｎ ｄ ｅ ｎ ｃｙ  ｐ ａｔｈ  ｐ ａｔｔｅ ｒ ｎ ｓ  ａｓ  ｔｈｅ  ｆｏ ｕｎ ｄ ａｔｉ ｏ ｎ ｏ ｆ  ａｃ ｃ ｅ ｓ ｓ

ｃ ｏ ｎｔｒｏ ｌ  ｉｎ  ｐｒｏ ｖ ｅｎａｎｃ ｅ － ａｗ ａｒｅ  ｓｙ ｓｔｅｍ ｓ ，  ２ ０

１

２ ．  

Ｘ Ｌ Ｄ Ｃ Ｋ Ｋ Ｋ Ｎ Ａ   ３ １

［

］

．

ｉ ａｎ ｇ ，  Ｓ ．  Ｓ ｈ ｙ ｅ ｔｔ ， 

Ｔ ｈ ｏ  ．

ｓ  ．

 ．

ａｍｈｏ ｕａ，


．

Ｌ ｗｉ ａｔ   ．

Ｐ ｈ ａ ｉ ｌ ｌ
ｊ

 ．

ｒｏｖｃ

ａ ｎ ｉ

：

   ｂ ｌ ｏ ｃｋｃｈ ａｉ ｎ － ｂａｓ ｅ ｄ

 ｄａｔａ ｐ ｒｏｖ ｅｎａｎｃ ｅ  ａｒｃ ｈｉｔｅ ｃｔｕｒｅ

ｉ ｎｃｌｏｕｄ

ｅｎｖｉｒ ｏｎｍｅｎｔ  ｗｉｔｈ  

  Ｃ ｅ ｎｈ ａｎｃ ｅｄ  ｐｒ ｉｖａｃｙ ａｎｄ ａｖａｉ ｌ ａｂ ｉ ｌ ｉｔｙ，

ｎ ｉ

：

Ｉｎｔｅｒ ｎａｔｉ ｏ ｎａｌ  Ｓｙｍｐ ｏ ｓ ｉｕｍ  ｏ ｎ 

ｌｕｓｔ ｅ ｒ ，  

Ｇ Ａ Ｍ Ｃ ｌ ｏ ｕｄ ａｎ ｄ ｒ ｉ ｄ Ｃ ｏ ｍｐｕｔｉｎｇ ， Ｉ ＥＥＥ／ Ｃ

２ ０ ７ １

．  

，

Ｋ Ｍ   Ｍ  Ｒ    Ｍ   ３ ２

［

］

ｏ ｌ ｖａｒｔ

Ｐｏｏｌａ
？

ｕｌ ｌ

Ａ ．

Ｓ ｍａｒｔ

Ｃ ｏ ｎｔｒａｃｔｓ

．

Ｔｈｅ

Ｆ ｕｔｕｒｅ  

？

［

］

Ｌ ｏ ｆ

ａｗ  ａｎｄ  ｅ Ｔｅ ｃｈｎｏ ｌ ｏ ｇ ｉ ｅ ｓ ．  Ｓ ｐｒ ｉｎｇ ｅ ｒ  Ｉｎｔｅ ｒ ｎ ａｔｉ ｏ ｎ ａｌ  Ｐ ｕｂ ｌ ｉ ｓ ｈｉｎｇ ，  ２ ０ １ ６ ．  

３
［

３ ］

范

吉

立

，

李

晓

华

，

聂

铁

铮 ，

于

戈

．

区

块

链

系

统

中

智

能

合

约

技

术

综述

Ｊ ［］

．

计

算

机

科  

学 ２ ９ ４ ６ ０ ０ １

，

，

（ １ １ ） ： １ １ －

．  

傅 威 ３ ４

．

基于 改进 的

ＤＰｏ Ｓ

区块链共识机制 的研究与应用

Ｄ

云 南 财 经 大  
．

［

］

［

］

学 ２０２０ ．   ，

Ｖ Ｂ  Ｏ ｒ ｉ Ｅ Ｂ ３ ５

．

ｎ ｕｔ ｅｒｉ

．

［

］

＂


ｎ ｐｕｂｌ ｉ ｃ  ａｎｄ  ｐ

＂
ｖａｔｅ  ｂ ｌ ｏ ｃ ｋｃ ｈａｉｎ ｓ ．  

ｔｈｅ ｒｅｘｉｍ

ｏ ｇ ２ ０ ｌ

 ．

５ １

．  

３
［

６ ］

朱

彦

霞

，

张

雪

萍

５

华

南

，

罗

刘

敏

．

基

于

ＩＰＦ Ｓ

及 区 块链 的 互联 网 融 媒 中 心 平 台 设 计  

Ｊ． ［］

电

子

设

计

工

程

Ｄ Ｏ ＫＵ ２ ２ ２ ，

０

１ ，

９ ０ ６ ８ （ １

）： １

－１

．

Ｉ：

２ ｎ ４ ４ ０

２／ ｊ

．ｉｓｓ

ｌ ６７

－  

２ ２ ２ ６ ３ ６ ．

０

８ ０ ０ ３ １ ． １

．

．  

Ｙ Ｈ Ｒ Ｖ Ｄ Ｕ Ｂ ３ ７

［

］

ｅ

ｙｏ

ｅｕｎ

ａｎｄＰ

ａｒｋ Ｓ

ｅ
ｊ

ｉｎ

．



ｅ ｌ ｉ ａｂ ｌ ｅ 

ｅｈｉ ｃ ｌｅ

ａｔａ  Ｓ ｔｏｒ ａｇ ｅ 

ｓ ｉｎｇ  ｌ ｏ ｃｋｃ ｈａｉｎ  ａｎｄ

ＰＦ Ｓ Ｅ ｎ Ｉ

Ｊ ［］

．

ｌ ｅｃｔｒｏ

２ ２ ０ ０ ０ ０ ｉ ｃ ｓ

０

，

１

１

，

１ （

３ ）  ： １ １

３ － １ １

．  

郭 茜 蓉 ３ ８

［

］

．

基 于 Ｅｔｈｅｒｅｕｍ

和

ＩＰＦ Ｓ

加密算法 的分布式存储网 络安全研 究

Ｄ

北  
．

［

］

京 邮 电大 学 Ｄ Ｏ ２ ２ ０

１ ．

，

ｋ ｙ Ｉ １ ：  ０ ． ２ ６ ９ ６ ９ ／ ｄ ． ｃ ｎ

ｉ ． ｇｂ

ｄｕ ． ２ ０ ２

１

０ ０ ０ ９ ． ０ ８

．

Ｏ Ｗ Ｙ Ｋ Ｂ ３ ９ Ｐ

［

］

ｊ  Ｊ ｉ ａｎ ｕｎ  Ｓ ｕｎ ｊ

ｉａｑ ｉ 

Ｚ ａｎ  ５ ｋｅｍ 

．

Ｚ ．

ｈａｎｇ ．

ｌ ｃ ｏ ｋ ｃ ｈａｉ ｎ － ｂ ａｓ ｅ ｄ  ｓ ｈ ａｒｉ ｎ ｇ  ｓ ｅ ｒｖｉ ｃ ｅ ｓ ：  

Ｗｈａｔ  ｂ ｌ ｏ ｃｋｃｈ ａｉｎ  ｔｅ ｃｈｎｏ ｌ ｏ ｇｙ  ｃ ａｎ  ｃ ｏ ｎｔｒ ｉ ｂ ｕｔｅ  ｔｏ  ｓｍ ａｒｔ  ｃ ｉｔｉ ｅ ｓ

Ｊ ［］

．

２０

１

６ ．

２  

Ｂ Ｇ Ｄ Ｍ Ｋ ｋ ４ ０

［

］

ｅｒｔｏ ｎｉ 

，

ａｅｍｅｎＪ，Ｐｅ ｅｔｅｒｓ

ｅ ａ ｔ
，

ｌ ．

ｅｃｃａ

２ ７ ４ Ｊ ［

． ］

０ １ ３ ，

８ ８ １ ３ ： １ ３ ３ － １

．  

Ｇ ＾ Ｌ Ｈ Ｋ Ａ Ｅ Ｋ Ｐ Ｇ Ｔ Ｂ ４ １

Ｊ．

ｏ

［

］

ｅ



Ｐ ． 

．

ｅ ｅ ｌ ｅｒ． 

．

．

ｎ ｋ ｒｚ ｅ ｓ ｉ

ｓ

ｉ ．

．

．

ｙ ｏ ａ ｌ

ｒ． 

ｉｔｃ

ｏ

ｎ ｂ ｉ



ｌ

ｏ

ｃ ｋｃ ｈａｉ ｎ

 ｄｙ ｎａｍｉ

ｃ

ｓ

：  

Ｔ ｈｅ ｓ ｅ ｌ ｆｉ ｓｈ － ｍｉ ｎｅ ｓ ｔｒａｔｅ ｇｙ ｉｎ  ｔｈ ｅ ｐｒｅ ｓ ｅｎ ｃ ｅ  ｏ ｆ  ｐ ｒｏｐ ａｇ ａｔｉ ｏ ｎ  ｄｅ ｌａｙ ． Ｐ ｅｒｆｏ ｒｍ ａｎ ｃ ｅ  

Ｅ ｖａｌ ｕａｔｉ ｏ ｎ  １

０４ ２０ （

１

６ ２ ３ ４ － １ ）

．  

Ｄ Ｋ Ｘ Ｋ Ｋ Ｋ Ｎ ４２

［

］


．

．  Ｔｏ ｓｈ ，  Ｓ ． Ｓ ｈ ｅｔｔｙ ． 

Ｌ Ｃ  ． ｉ ａｎｇ ． 


．

ａｍｈｏ ｕａ ． 


．

Ｌ ｗｉ ａｔ ． 


．

ｊ ｉ ｌ ｌ ａ ．  Ｓ ｅ ｃ ｕｒｉ ｔ ｙ

ｉｍｐ ｌ ｉｃ ａｔ ｉ ｏ ｎ ｓ  ｏ ｆ  ｂ ｌ ｏ ｃ ｋｃｈａｉｎ  ｃｌ ｏ ｕ ｄ  ｗｉｔｈ  ａｎ ａｌ ｙ ｓ ｉ ｓ  ｏ ｆ  ｂ ｌ ｏ ｃ ｋ  ｗ ｉ ｔｈ －ｈｏ ｌ ｄ ｉｎ ｇ  ａｔｔ ａｃｋ ，  ｉｎ ：

     Ｇ  Ｉｎｔｅｒ ｎａｔｉ ｏｎａｌ

Ｓｙｍｐ ｏ ｓｉｕｍ ｏｎ

Ｃ ｕ ｌ ｓ ｔｅ ｒ．

Ｃ ｌｏｕｄ

ａｎｄ

ｒｉ ｄ

Ｃ ｏ ｍｐ ｕｔｉｎ ｇ ，  

７ ９

北京 邮 电大学工程硕士学位论文



  

Ｅ Ｅ ＡＣＭ Ｅ Ｉ

／

２ ０ ７ ．

１

．  

４ ３ 方 錢 飚 周 创 明 李 松 宋 亚 飞 高 娜 刘 唐 ． 联盟 链 中 实 用 拜 占 庭 容 错 算 法 的 改 进  

［

］

，

，

，

，

，

 计 Ｏ Ｊ／

Ｌ ．

［

］

算机

工 程与

应

用  ０ ２ ０ ２ ： １ － １

１ １ １ －

－  

［

ｈ ｐ ｋ ｋ ｈ ３ １

．

］

ｔｔ

： ／／

ｎｓ ． ｃｎ

ｉ ． ｎｅｔ／ｋｃｍｓ／ｄｅｔａｉｌ／ ｌ

ｌ

２ ．

１ ２ ７ ． ｔｐ ． ２ ０２ １

０２２４ ．

１

３ ２２． ０

４ １

．

ｍ ｔ

ｌ ．  

翟 冉 陈 学 斌 块 链 共 机 制 研 宄 数 据 与 计 算 发 展 前 沿 ４４

［

］

，

区

的识

．

Ｊ ［］

．

２ ０ ２ ０ ，

１３

，

（

３ ８ ６ ） ：

－  

９４ ．  

Ｏ Ｎ Ａ Ｍ Ａ ４ ５ Ｓ ａｍｕｅｌ 

［

］

，  Ｊａｖａｉ ｄ 

ｗａｉ ｓ
，

ｅ ａ ， 

ｔ

ｌ ．

 ｂ ｌ ｏ ｃ ｋｃ ｈａｉｎ  ｍ ｏ ｄｅ ｌ  ｆｏ ｒ  ｆａｉｒ  ｄ ａｔａ  ｓｈａｒｉｎ ｇ  ｉｎ  

  Ｇ  ｒ ｉ ｄｅｒｅ ｇｕｌ ａｔｅ ｄ  ｓｍａｒｔ  ｇ ｄ ｓ ．  Ｐ ｒｏ ｃ ｅ ｅ ｄ ｉｎｇ ｓ  ｏｆ  ２ ０ １ ９

ＩＥＥＥ

ｌｏｂａｌ

Ｃ ｏ ｍｍｕｎｉ ｃ ａｔｉ ｏ ｎ ｓ

Ｃ Ｇ ＯＢ Ｃ Ｏ Ｍ Ｗ Ｈ Ｕ Ａ ｏｎｆｅｒｅｎｃ ｅ （ Ｌ

） ．

ａｉｋｏｌ ｏａ ，

Ｉ ，

Ｓ

２ ０ ９ ２ ７ ． 

１

 ．

１

３ ８ －

１

．  

４６

吴梦 朱琳玲 刘海彬 王 明 元

陈丽韵 基于 ．

ＰｏＡ

共 识 机 制 的 无 偿 献 血 区 块链 系

［

］

，

，

，

，

统 原 型 设 计 中 国 数 字 医 学 Ｊ ． ［］

２ ＋ ，

０２

１

，

１

６ ０６

（

）

： ２２－２ ７

３ ７ ．

Ｄ Ａ Ｒ ＭＨ Ｕ Ａ  ４ ７

［

］

ｉｎｈ  Ｔ Ｔ

Ｌ ｕ ， 

ｉ



Ｚ ， 

ｈａｎｇ

ｅ ， 

ｔ ａｌ ． 

ｎｔａｎ ｇｌｉｎ ｇ ｂ ｌ ｏ ｃｋｃｈａｉｎ ： 

ｄ ａｔａ

ｐｒ ｏ ｃ ｅ ｓ ｓ ｉｎ ｇ  

  Ｋ ｖｉ ｅｗ  ｏ ｆ

ｂｌ ｏ ｃ ｋｃｈａｉｎ ｓｙ ｓｔ ｅｍ ｓ ． Ｉ Ｅ Ｅ Ｅ  Ｔｒ ａｎｓ ａｃ ｔｉ ｏ ｎ ｓ  ｏ ｎ

ｎｏ ｗｌ ｅ ｄ ｇ ｅ  ａｎｄ

Ｄ Ｅ ＴＫＤ Ｅ ａｔａ

ｎ ｎ ｇ ｇ ２ ６ ｉｎｅ ｅｒｉ

，

０１ ８ ，

３

０７
（）

：１

３

６

ｄ ８ ５ ３ １ －

．［

ｏ ｉ ：１ ０ ． １ １ ０ ９／

２０
．

１

７．２ ７ ８

１

２２ ７ ］

４８

［

］

夏

晨

益 ，

蔡青

松

，

吴杰

．

基

于

ＰｏＡ

联

盟

链

的

微

电

网

无

报

价

交

易

机

制

Ｊ ［］

．

计

算

机

系

统 应 用 ２ ０ ２ ２ ，

０ ，

９ ７ ６ ５ （ １ １ ） ： ５

－

．

Ｄ Ａ Ａ Ｌ Ｂ  Ｒ  Ｂ Ｔ ４ ９

［

］

ｅ 

ｎ ｇ Ｓ ｅ ｌ ｉ ｓ 

，

ｎｉ ｅｌｌ ｏ

， ａｌ ｄｏｎｉ

ｅ ａ ， 

ｔ

ｌ．

Ｐ

Ｆ



ｖｓ


ｐｒｏ

ｏ ｆ－ ｏ ｆ－

ａｕｔｈｏ ｒｉｔｙ

ｐｐ ａ ： 

ｌ ｙ ｉ ｎ ｇ

Ａ Ｃ ｔｈｅ  Ｃ Ｐ  ｔｈ ｅ ｏ ｒ ｅｍ  ｔｏ ｐ ｅｒｍｉ ｓ ｓ ｉ ｏ ｎｅ ｄ  ｂｌ ｏ ｃｋｃｈａｉｎ  ［

］  ／  ／  Ｐｒｏ ｃ  ｏ ｆ  ｔｈｅ  ２ ｎｄ Ｉ ｔａｌｉ ａｎ  

Ｃ Ｃ ｏｎｆｅｒｅｎ ｃ ｅ  ｏ ｎ

ｙｂ ｅｒ  Ｓ ｅ ｃｕｒｉ ｔｙ ．  ２ ０ １ ８ ．  

５ ０ 李 国 张 洁 慧 臧 金 梅 ． 面 向 解 决 民 航 虚 占 座 位 的 改 进 ＰｏＡ 共 识 机 制 区 块 链 系 统  

［

］

，

，

研 宄 计 算 机 应 用 研 究 Ｊ ． ［］

＋ ２ ０２ ０ ３

，

，

７１
（

１

） ： ３ ３６８－３ ３

７２

３ ３ ７ ７ ．  

８ ０

