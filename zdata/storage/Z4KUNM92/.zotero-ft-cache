硕士学位论文
数控机床数字孪生系统的设计与实现

作者姓名：

潘利达

指导教师: 郭向坤 研究员 中国科学院沈阳计算技术研究所

学位类别:

工学硕士

学科专业:

计算机应用技术

培养单位:

中国科学院沈阳计算技术研究所

2021 年 6 月

Design and implementation of digital twin system for CNC machine tools
A thesis submitted to University of Chinese Academy of Sciences
in partial fulfillment of the requirement for the degree of
Master of Philosophy
in Computer Application Technology By
Pan Lida Supervisor: Associate Professor Guo Xiangkun
Shenyang Institute of Computing Technology Chinese Academy of Sciences June 2021

中国科学院大学 研究生学位论文原创性声明
本人郑重声明：所呈交的学位论文是本人在导师的指导下独立进行研究工作 所取得的成果。尽我所知，除文中已经注明引用的内容外，本论文不包含任何其 他个人或集体已经发表或撰写过的研究成果。对论文所涉及的研究工作做出贡献 的其他个人和集体，均已在文中以明确方式标明或致谢。
作者签名： 日 期：2021.04.02

中国科学院大学 学位论文授权使用声明
本人完全了解并同意遵守中国科学院有关保存和使用学位论文的规定，即中 国科学院有权保留送交学位论文的副本，允许该论文被查阅，可以按照学术研究 公开原则和保护知识产权的原则公布该论文的全部或部分内容，可以采用影印、 缩印或其他复制手段保存、汇编本学位论文。
涉密及延迟公开的学位论文在解密或延迟期后适用本声明。

作者签名： 日 期： 2021.04.02

导师签名： 日 期：2021.04.02

摘 要
摘 要
随着互联网技术的快速发展，工业生产的方式也发生了极大的改变，传统制 造行业开始向智能制造转变，数控机床加工逐步取代传统机床加工成为当前机械 现代化发展的重要构成部分之一。为了确保数控加工程序的正确性，保障工件加 工质量，规避加工中途因为程序编码问题而引起的误切和宕机等问题，在对数控 程序编码后，需要对其验证。 因此，采用数字孪生技术对数控机床加工进行切 削仿真，在数控机床生产过程中，以全面直观的方式判断数控加工程序的正确性， 验证加工程序的合理性，从而减少在实际生产过程中的异常情况，降低生产成本， 提高生产质量。
针对数控机床实机试切的短板，本文设计并实现了数控机床数字 孪生系统， 通过笔记本电脑、数控机床、MQTT 消息队列遥测传输协议来完成线上切削仿真 的流程。本文的研究内容有以下几个方面： （1）由于数据传输功能需要在低带宽的情况下正常完成，以及数控机床操作系 统的特殊性，采用 MQTT 通信协议进行数控机床设备与数字孪生系统进行集成 通讯，保证了系统在低带宽、小内存的情况下正常运行。 （2）考虑到数控机床种类繁多，以 CK0632、哈斯 VF2YT 以及汉沣为对象，使 用 3DS Max 进行数控机床数字孪生体模型进行一比一建模绘制，用户可以根据 需求进行自由选择，同时根据机床工作人员在数控机床实体加工过程中对观察视 角的需求，本系统将透明视角、偏向角、结构爆炸图作为用户界面开发过程中的 需求之一，展现科技以人为本，为人所用的思想。 （3）根据切削仿真的需求，在系统研发过程中对工件模型建模、刀具模型建模 进行了研究与实现，对模型间的碰撞检测进行了设计以及模型与模型间的布尔运 算进行了研究与实现。 （4）结合本系统，完成了以 CK0632 数控机床为实例，以功能、性能测试为目 的系统测试。
测试结果表明，本系统能够完成切削仿真任务，仿真过程方便快捷，仿真结 果真实可靠，满足数控机床生产线上线前的试切需求，使用本系统可以减少现场 调试时间和物料成本，提高数控机床利用率，减少因加工程序错误带来的机床宕 机。
I

数控机床数字孪生系统的设计与实现
关键词：数控机床，数字孪生，切削仿真
II

Abstract
Abstract
With the rapid development of Internet technology, great changes have taken place in the mode of industrial production. The traditional manufacturing industry has begun to transform to intelligent manufacturing. CNC machine tool processing has gradually replaced the traditional machine tool processing and become one of the important components of the current development of mechanical modernization. In order to ensure the correctness of NC machining program, ensure the quality of workpiece processing, and avoid the problems of miscutting and downtime caused by program coding in the middle of processing, it is necessary to verify the NC program after coding. Therefore, the digital twin technology is used to simulate the machining of CNC machine tools. In the production process of CNC machine tools, the correctness of CNC machining program is judged in a comprehensive and intuitive way, and the rationality of machining program is verified, so as to reduce the abnormal situation in the actual production process, reduce the production cost and improve the production quality.
Aiming at the short board of NC machine tool, this paper designs and implements the digital twin system of NC machine tool, which completes the process of online cutting simulation through notebook computer, NC machine tool and mqtt message queue telemetry transmission protocol. The research contents of this paper are as follows
(1) Because the data transmission function needs to be completed normally in the case of low bandwidth, and the particularity of CNC machine tool operating system, mqtt communication protocol is used for the integrated communication between CNC machine tool equipment and digital twin system to ensure the normal operation of the system in the case of low bandwidth and small memory.
(2) Considering the wide variety of CNC machine tools, taking CK0632, Haas VF2YT and Hanfeng as the objects, using 3DS Max carries out one-to-one modeling and drawing of digital twin model of CNC machine tool. Users can choose freely according to their needs. At the same time, according to the viewing angle requirements of machine tool workers in the process of entity processing of CNC machine tool, this system takes transparent viewing angle, deflection angle and structure explosion diagram as one of the requirements in the process of user interface development, showing that science and technology are people-oriented and human-oriented The ideas used.
III

数控机床数字孪生系统的设计与实现
(3) According to the requirements of cutting simulation, the workpiece model and tool model are researched and implemented in the process of system development, the collision detection between models is designed, and the Boolean operation between models is researched and implemented.
(4) Taking CK0632 as an example, the performance of the machine tool is tested. The test results show that the system can complete the cutting simulation task, the simulation process is convenient and fast, the simulation results are real and reliable, and meet the test cutting requirements before the CNC machine tool production line goes online. Using this system can reduce the on-site debugging time and material cost, improve the utilization rate of CNC machine tools, and reduce the machine tool downtime caused by processing program errors. Key Words: Numerical control machine tool, Digital twin, Virtual machining
IV

目 录
目 录
第 1 章 引言 ....................................................................................... 1
1.1 课题研究背景及意义 ....................................................................................... 1 1.2 国内外研究现状 ............................................................................................... 2
1.2.2 数控机床 .................................................................................................... 2 1.2.3 虚拟调试 .................................................................................................... 3 1.3 论文研究的主要内容 ....................................................................................... 6 1.3.1 课题来源 .................................................................................................... 6 1.3.2 主要研究内容 ............................................................................................ 6 1.3.3 结构安排 .................................................................................................... 6
第 2 章 系统相关理论基础 ................................................................ 9
2.1 相关理论研究 ................................................................................................... 9 2.1.1 数字孪生 .................................................................................................... 9 2.1.2 布尔运算 .................................................................................................. 10
2.2 相关技术研究 ................................................................................................. 12 2.2.1 3DS Max................................................................................................... 12 2.2.2 Unity ......................................................................................................... 12 2.2.3 C#.............................................................................................................. 12 2.2.4 MQTT ....................................................................................................... 13
2.3 本章小结 ......................................................................................................... 15
第 3 章 系统总体设计......................................................................17
3.1 系统设计目标与原则 ..................................................................................... 17 3.1.1 系统设计目标 .......................................................................................... 17 3.1.2 系统设计原则 .......................................................................................... 17 3.1.3 系统设计流程 .......................................................................................... 18
3.2 系统总体框架设计 ......................................................................................... 19 3.2.1 系统需求分析 .......................................................................................... 19 3.2.2 功能需求分析 .......................................................................................... 20
3.3 系统工作流程设计 ......................................................................................... 21 3.4 系统开发工具的选择及环境的搭建 ............................................................. 22
3.4.1 系统开发工具的选择 .............................................................................. 22 3.4.2 系统通讯协议的选择 .............................................................................. 23 3.4.3 系统开发的软件环境 .............................................................................. 23 3.4.4 系统开发的硬件环境 .............................................................................. 24 3.5 本章小结 ......................................................................................................... 24
第 4 章 关键技术与算法研究 .......................................................... 25
4.1 工件模型建模方法研究 ................................................................................. 25 4.2 通用刀具体模型建模方法研究 ..................................................................... 27 4.3 碰撞检测与布尔运算 ..................................................................................... 29
4.3.1 工件模型与刀具模型的碰撞检测 .......................................................... 29 4.3.2 布尔运算在系统中的应用 ...................................................................... 29 4.4 本章小结 ......................................................................................................... 30
V

数控机床数字孪生系统的设计与实现
第 5 章 系统实现..............................................................................31
5.1 数控机床建模及运动学分析 ......................................................................... 31 5.1.1 数控机床建模 .......................................................................................... 31 5.1.2 数控机床运动学分析 .............................................................................. 35
5.2 系统数据传输技术实现 ................................................................................. 36 5.2.1 数据传输架构设计 .................................................................................. 36 5.2.2 数据传输工作流程 .................................................................................. 37
5.3 系统交互可视化界面的实现 ......................................................................... 37 5.3.1 机床配置模块 .......................................................................................... 40 5.3.2 机床展示模块 .......................................................................................... 41
5.4 本章小结 ......................................................................................................... 42
第 6 章 系统测试与验证 ..................................................................43
6.1 系统测试环境及流程 ..................................................................................... 43 6.1.1 系统测试环境 .......................................................................................... 43 6.1.2 系统测试流程 .......................................................................................... 44
6.2 数控机床 CK0632 测试实例 ......................................................................... 45 6.2.1 系统功能测试 .......................................................................................... 45 6.2.2 系统切削仿真功能测试 .......................................................................... 50 6.2.3 系统性能测试 .......................................................................................... 51
6.3 本章小结 ......................................................................................................... 53
第 7 章 总结与展望............................................................................55
7.1 全文总结 ......................................................................................................... 55 7.2 创新点 ............................................................................................................. 55 7.3 展望 ................................................................................................................. 56
参考文献 ............................................................................................... 57 致 谢...................................................................................................61 作者简历及攻读学位期间发表的学术论文与研究成果 ..................... 63
VI

图目录
图目录
图 1.1 数控机床虚拟调试流程图....................................................................... 2 图 1.2 国 外 虚 拟 调 试 软 件 (a)Tecnomatix;(b)Simumatik3D;(c)Visual
Components;(d)Demo 3D................................................................................ 4 图 2.1 块布尔运算主要流程图......................................................................... 11 图 2.2 块体布尔差运算的有效面判定............................................................. 12 图 2.3 MQTT 协议的实现方式 ........................................................................ 13 图 3.1 数控机床数字孪生系统开发流程图..................................................... 18 图 3.2 数控机床数字孪生系统需求框架图..................................................... 19 图 3.3 数控机床数字孪生系统功能模块图..................................................... 21 图 3.4 数控机床数字孪生系统工作流程图..................................................... 22 图 4.1 通用刀具体模型定义............................................................................. 28 图 5.1 数控机床三维模型绘制流程图............................................................. 32 图 5.2 机床床身图............................................................................................. 33 图 5.3 面板模型图............................................................................................. 34 图 5.4 导轨主轴模型......................................................................................... 34 图 5.5 机床模型最终展示图............................................................................. 34 图 5.6 模型变换原理图..................................................................................... 36 图 5.7 系统架构图............................................................................................. 36 图 5.8 用户界面效果......................................................................................... 38 图 5.9 机床透明图............................................................................................. 39 图 5.10 机床偏转图........................................................................................... 39 图 5.11 结构爆炸图........................................................................................... 40 图 5.12 机床配置流程图................................................................................... 41 图 5.13 机床配置完成图................................................................................... 41 图 5.14 机床展示模块图................................................................................... 42 图 6.1 机床设备搭建图..................................................................................... 44 图 6.2 系统测试流程图..................................................................................... 45 图 6.3 工件加工图 1.......................................................................................... 51 图 6.4 工件加工图 2.......................................................................................... 51 图 6.5 资源监视器资源占用图......................................................................... 52 图 6.6 CPU 使用率数据监控图........................................................................ 52
VII

第 1 章 引言
第1章 引言
1.1 课题研究背景及意义 随着信息技术的大爆炸，数字技术开始深入传统制造业，各国为助力制造业
的发展，分别颁布战略计划，如中国智造 2025，德国工业 4.0（缪学勤，2014）。 借助数字孪生技术来实现物理世界与数字世界的互相联通、数字化操作，进而实 现智能制造。智能制造是一种人机一体化系统（李家铎 等，2018），它强调计算 机以高度灵活和全面的方式对人类的智能活动进行模拟，如学习、判断、预测、 构思和总结，在制造环境中替代或扩展部分人脑工作，同时收集、存储、改进、 共享，继承和优化人类的智能系统（张存吉 等，2015）。
就传统制造而言，智能制造具有自主分析能力、自主优化能力、多角度可视 化、多维交互等优势。智能制造以突破物理世界与数字世界壁垒的思想构建一个 两者相互交融，具有虚实映射，数据驱动等特点的系统。因此，采用数字孪生作 为实现该系统的理论基础（周济 等，2018）。
数字孪生是利用物理设备、数字模型、历史数据、信息交互等数据，集成多 维度、多学科、多功能的仿真过程，在数字空间对现实完成映射，表现物理设备 的生命周期的过程；它是一种超脱现实的概念，可以看作几个重要的、有关联的 物理设备的数字映射系统（陶飞 等，2018）。数字孪生的理论技术体系对人类的 生活生产具有普遍适应性，有许多合适的应用场景，如工业产品设计及制造、前 沿医学分析、工程项目建设等场景（李柏松 等，2018）。工程项目建设的应用是 目前最深入的，而智能制造则是关注度最高、研究最热的。
机床是加工制造过程中的关键设备，随着科学技术的发展，机床也在不断更 新迭代。随着我国制造业的政策支持，数控技术得到了大力的推广。就普通机床 而言，数控机床具有产出比高，数字化程度高，加工结果可靠，加工水平稳定等 特点，在机床的加工程序设计和生产准备初期，数控机床调试周期长、风险大、 投入高。与此同时对于数控机床技术人员也有较高的技术水平要求。因此，在实 际生产过程中，技术人员对数控机床加工流程的设计失误将会带来严重的加工事 故。
虚拟调试（Steffen Tram Mortensen，2018）是数字孪生的一种应用，虚拟调
1

数控机床数字孪生系统的设计与实现
试是在虚拟环境中对物理设备进行操作，通过虚拟仿真来验证物理设备的正确性， 然后将调试结果应用到真实设备中，虚拟调试的环境及过程如图 1.1 所示。虚拟 调试的优点在于：提高生产质量的同时降低生产成本，只需要少许工控设备控制 器，然后利用三维仿真软件搭建生产线模型，在实验室就能对设备程序进行检查； 大大降低了调试的风险，数控机床调试时，操作不慎容易造成事故，而采用数控 机床数字孪生系统进行调试时不存在风险问题；验证数控机床程序的可行性，工 程师可以在虚拟环境中对设备进行测试。在测试过程中，可以尽快发现错误并及 时更新程序。
图 1.1 数控机床虚拟调试流程图 Figure1.1 Flow chart of virtual debugging for CNC machine tools
将数控机床和数字孪生技术进行有机结合在对机床加工结果进行 合理的仿 真的同时，有助于减少加工事故与失误，同时，对机床加工结果进行仿真能够大 大减少生产成本以及试切加工时间，在减少数控机床加工程序的研发周期的同时 提高了对生产周期的管控能力和对市场的响应能力。本课题所研究的数控机床数 字孪生系统可提高数控机床调试的效率，并为工厂向数字化转型提供有益参考。
1.2 国内外研究现状 1.2.2 数控机床
上世纪六十年代，最先由美国的科研工作者将计算机技术与机床的制造工艺 结合起来，生产出了世界上第一台数控机床。由于集成了计算机技术，这台机床 能够自动化地执行机械零件的加工任务。这项技术赋予了传统机床新的生命力。 随着后续工业技术的发展以及新工艺在机床上得到应用，数控机床在复杂精密的
2

第 1 章 引言
零件制造中大展身手。此外，数控系统也逐渐具备了数字化以及智能化的特征。 研发出了第一台数控机床后，欧美等国家又对数控机床的结构设计进行了多
次改进并且对数控机床的应用领域也进行了更广泛的探索。数控机床的发展大体 上可以分为三个阶段。科研人员们首先对十字架型的机床进行了研究与设计改进， 最终使得改型机床能够成功商业化。在十字架型机床的基础上，科研工作者们又 研制出了门型机床。在工业化不断发展的背景下，大型零部件的加工一度是工业 生产中的难点。龙门型数控机床的推出顺利解决了这一问题，大大提高了工业生 产的效率（叶佩青 等，2015）。在以上的三个发展阶段中，每个国家都会对数控 机床指定不同的机床型号。这些不同型号的机床在社会的各行各业中得到了广泛 的应用。目前，德国的多家机床厂商在数控铣床的研发领域中表现出了较高水平。 其通过在龙门型机床上安装了专门的机械式手臂，然后搭配使用五轴控制系统实 现机械式手臂的灵活摆动，从而可以生产出对精密度要求更高的零件。与此同时， 在机床运转过程中，还伴随有感应器和跟踪探头，能够对运行的轨迹进行模拟分 析做出及时地调整，从而使数控技术更加智能化。考虑到工业技术再国家发展中 举足轻重的作用，我国也适时出台了很多政策来鼓励支持数控机床产业的发展。 在众多企业的不断努力下，我国的数控机床产业飞速发展，也在国际上拥有了更 多的话语权。我国数控机床的产业规模从 2015 年开始快速发展，到了 2018 年， 市场规模已经超过 3000 亿元。此外，我国也对外出口了很多类型的机床，如 2018 年我国就出口了约 30 万台数控机床（李文化 等，2021）。
数控机床的加工要经过一系列流程，工件程序的编码与上传，工件参考点的 选定，数控加工程序的编码与上传，程序语法规范的检查与逻辑调试，工件的安 装与校正，最后开启数控机床完成加工作业。由于操作人员的设计漏洞或数据在 不同系统中传递而发生错误等原因，先前编写的数控加工程序可能会在运行时产 生各种问题，进而导致加工任务失败。在实际生产活动中，需要在进行加工作业 前对编写的加工程序进行验证以及相应的优化。就传统而言，一般采用实机调试 的方法对数控机床加工程序进行验证，如试切法（马颖化 等，2018）。这种方法 以替代材料或者原材料作为加工对象进行加工，但加工过程需要占用机床设备， 降低了生产效率，使生产成本增加。
1.2.3 虚拟调试
3

数控机床数字孪生系统的设计与实现
国外的虚拟调试技术起步较早，有不少性能优越的虚拟调试软件。比如：德 国的 Tecnomatix、瑞典的 Simumatik3D、芬兰的 Visual Components 及英国的 Demo3D 等软件。
德国工程师利用 Tecnomatix 设计虚拟调试方案，通过在虚拟环境中调试 PLC 代码，然后再拷贝到真实设备，以虚拟仿真的方式来完善自动化程序，提高设备 工作效果，减少安装调试时间，如图 1.2(a)所示。S.Petrila 等使用 Tecnomatix 软 件 模 拟 工 业 生 产 的 制 造 流 程 并 应 用 到 实 际 的 加 工 生 产 。 G.Fedorko 等 在 Tecnomatix 软件中以海运集装箱为出发点进行建模，解决了集装箱装运的问题。 Volvo GTO 为了减少工业设备的调试时间，在 Simumatik 3D 中构建数字模型来 验证调试系统的功能，在项目初期校准设计错误，减少了损失，如图 1.2(b)所示。 芬兰的 KONE 公司使用 Visual Components 完成生产线的建模和策略的部署，向 公司股东们直观展示设计变更带来的劳动力和设备成本上的优化，如图 1.2(c)所 示。英国的 Demo3D 仿真软件利用强大的三维仿真技术实现数字孪生应用，为企 业降低物理资产成本，如图 1.2（d）所示。
图 1.2 国外虚拟调试软件(a)Tecnomatix;(b)Simumatik3D;(c)Visual Components;(d)Demo 3D Figure1.2 Foreign virtual debugging software (a) Tecnomatix; (b) Simulatik3d; (c) Visual Components; (d) Demo 3d
除了上述虚拟调试软件，国外许多研究人员也对该技术开展了研究。T.Lechler 等人对虚拟调试的技术理论进行了研究，并表明虚拟调试与数字孪生 的关系。
4

第 1 章 引言
W.Hofmann 等人在物流控制中完成了高维度仿真的虚拟调试。G.Reinhart 等人对 虚拟调试的理论和设备需求、资金支持进行了分析，提出了可扩展的虚拟仿真概 念。M.Ko 等人将生产系统应用到由传感器和数字设备组成的数 字工 厂 中 。 T.Berger 等 人 提 出 了 一 种 通 用 的 软 制 造 方 式 进 行 虚 拟 车 间 的 仿 真 工 作 。 J.H.Vermark 等人通过虚拟调试来设计、模拟和更新可重构设备系统。
就国外的研究现状而言，国外比较重视此类软件的研发和应用。部分公司或 研究人员在计划开展的早期使用此类软件来模拟制造工厂的生产和战略调整，配 置设备和数字孪生体的交互信号，然后联通传感器进行编程设计，使用数字孪生 模技术完成生产线的可视化，观察整个系统的走向与发展，并通过虚拟调试及时 完成策略的校正和优化。领先的数字技术给国外的生产生活带来了巨大的效益。
就国内而言，虚拟调试这类研究发展较晚，软件体系不完整，而且相关的学 习材料有限，并且对使用人员的学习能力和动手能力有较高要求，因此无法快速 熟悉这类软件。
国内的部分研究人员对虚拟调试也有个人的理解和发现。王位杰对虚拟调试 的理论进行了研究，并对调试策略、技术架构等关键内容进行了讨论和总结，最 后完成了虚拟调试环境的验证（王位杰，2011）。山东大学张代聪设计并实现了 交互式机械仿真系统，该系统可以进行机械的运动仿真、逻辑控制器程序的运动 仿真及用户交互控制模拟，可以在实物实现之前发现及改正设计中存在的问题， 并验证了系统的可行性和有效性（张代聪，2012）。燕山大学郝任义针对工业生 产线中机器人的特点提出一种机器人与 PC 机的集成通讯方案，并针对机器人与 PC 机研发了控制软件，用于机器人的集成控制（郝任义，2018）。
国内部分公司开展了关于 Tecnomatix 软件的虚拟调试研究。张佳俊等人基于 Tecnomatix 建立数字化设计体系，对发动机生产线实现战略计划，优化生产工艺， 提高了生产效率，完成了数字工厂的布局（张佳俊 等，2018）。张朝权等人使用 Tecnomatix 对 500 兆瓦水氢氢燃料发电机安装过程进行设计，验证了安装过程的 合理性，使工作人员在项目开发前期发现和处理问题（张朝权 等，2019）。高建 超等人基于 Tecnomatix 提出了一种机械设备的虚拟调试方法，通过在线交互与 调试完成机械设备的安装，优化了机械设备姿态、提高了工作的效率（高建超 等， 2019）。朱鸿泰使用 MCD 完成动力学引擎的建模，再利用 PLCSIM 仿真软件完 成电机的选型，从而简化了理论计算过程，通过西门子 PLC 1500T 验证了电机
5

数控机床数字孪生系统的设计与实现
选型的匹配度。（朱鸿泰，2018）。 就国内研究现状而言，国内部分研究人员对虚拟调试技术存在一 定的研究。
然而，国内的部分公司大多采用国外成熟的软件完成各个领域的虚拟调试，从而 实现业务的快速上线。学术界和工业界一致认为虚拟调试是传统加工方式向数字 加工方式过渡的最佳方式，但是能够完成此类软件的自我研发的公司寥寥无几， 与国外相比，我国还处于此类研究的初期。
1.3 论文研究的主要内容 1.3.1 课题来源
本课题来源于国家科技重大专项（2019ZX04014001-004），辽宁省工业重大 专项（2019JH1/10100007），沈阳市高层次人才创新创业团队资助（2019-SYRCCXC-08），2019 年工业互联网创新发展工程专项：双创支撑平台专项。
1.3.2 主要研究内容 本文通过对数控机床、数字孪生、虚拟调试等技术及理论进行研究，针对数
控机床使用过程中设计调试步骤繁琐、生产准备周期长、试切成本高等问题，设 计了一款基于数字孪生的数控机床系统用于解决以上问题。本系统采用 Unity 3D 进行用户界面的研发，以 3DS Max 作为数控机床建模软件，以 C#作为脚本语言 进行程序设计，使用 MQTT 通信协议建立数字模型与实体设备之间的联系。通 过虚拟调试实验，从性能和功能两方面对系统进行测试，测试结果表明该系统的 有效性。本文对数控机床数字孪生系统的研究过程及其实现过程给予了详细的说 明。
1.3.3 结构安排 本文的主要工作内容和章节安排如下： 第一章介绍了基于数字孪生的数控机床系统研究的背景与意义，接着分别对
国内外的数控机床技术、虚拟调试理论的研究和应用现状进行了阐述，最后确定 了本文的研究内容及整体的结构安排。
第二章对数控机床数字孪生系统中涉及到的数字孪生、布尔运算相关理论以 及 3DS Max、Unity、C#、MQTT 等技术作了简单介绍。
第三章对数控机床数字孪生系统的总体研究架构进行研究，并对本系统建设
6

第 1 章 引言
过程中所使用的开发工具及环境的搭建进行介绍。 第四章对数控机床数字孪生系统研发过程中涉及的重要算法进行介绍，是系
统建设过程中的关键部分。 第五章为数控机床数字孪生系统的实现部分，其中介绍了关于数控机床数字
孪生体的建模及运动学分析、系统数据传输技术的实现以及用户交互界面的实现。 第六章对数控机床数字孪生系统进行测试，其中包括功能测试、 性能测试。
通过对数控机床 CK0632 数字孪生体的实例测试，证明了本系统的有效性。 第七章对本文的工作内容进行总结，结合本文的创新点，并对系统的不足之
处及未来的发展方向进行说明。
7

数控机床数字孪生系统的设计与实现 8

第 2 章 系统相关理论基础
第2章 系统相关理论基础
2.1 相关理论研究 2.1.1 数字孪生
数字孪生（GRIEVES，2016）的概念最早在 2002 年提出，NASA 将该概念 应用在 Apollo 计划中。2011 年，美国空军对可飞行设备进行研究，以数字孪生 的方式完成其生命周期难以管控的漏洞。通用电气公司将数字孪生体应用到设备 中去，完成对设备生命周期的管控和零部件保养问题，并将该模式应用在工业中。 西门子公司则在西门子数控系统中加入了虚拟调试的概念（VACHÁLEKJ，2017）。 山东大学王春晓针对数控机床开发周期长、调试风险大、成本高的问题对虚拟调 试的关键技术进行了研究，利用 MWorks 平台完成了以 Modelica 语言建模的数 字化模型，以三轴立式数控机床为研究对象，解决了领域间耦合的问题，并设计 实现了机床虚拟调试平台（王春晓，2018）。山东大学李宝超针对非标设备未统 一的问题进行研究，提出一种基于数字孪生的高精设计方案，通过管控技术采集 设备的运行数据，以此完成数据整合，提高模型的契合度，并基于此实现了推力 机的设备模型，提高了设备的稳定性以及工艺设计制造水平（李宝超，2018）。 王峻峰等人针对飞机装配过程视角受限，可视化程度低，区域空间要求高等问题 设计了一种翼身制孔可视化方案，该方案可根据实际需求对孔位特征进行可视化 生成，最终采用 CATIA 平台完成了对制孔过程的监控，提高了制孔的监视能力 （王峻峰 等，2018）。郑宇等人对焊接设备进行了研究，使用 OPUCA 与 Socket 进行实时通信，同时完成设备的信息采集、预处理及交互，最终完成了焊接设备 的映射管理（Yu Zheng 等，2019）。罗伟超等人对数字孪生的映射策略进行了改 进，提出了一种强针对性的数字孪生框架，其中包含了数字孪生体模型、数字孪 生体与设备映射模型、数字孪生体自学习模型（Weichao Luo 等，2019）。电子 科技大学何柳江针对虚拟监控系统进行了研究，研究内容主要包括三维监控技术 的加速、系统渲染效率的提升、包围盒碰撞检测技术与远程控制技术，最终采用 OpenGL 管线技术对系统进行了设计与实现。（何柳江，2019）。
在国外的相关研究中，EncJ.Tuegel 等人对可飞行设备寿命问题进行了研究，
9

数控机床数字孪生系统的设计与实现
利用可飞行设备的局部模型与整体结构的位移差和局部零件的发热程度的统计， 完成对零件损坏和局部状态的预测分析，提出可飞行设备生命周期预测的数学模 型（Tuegel E J 等，2011）。Kahlen F J 等人建立一比一可飞行设备模型，利用可 飞行设备的飞行数据来实现对飞行设备的生命周期管控，从而提升可飞行设备的 管控能力和稳定性（Kahlen F J 等，2017）。Arquimedes Canedo 等人对物联网设 备的周期数据进行研究，提出了数字孪生与物联网相结合的工业物联网优化方法 （Arquimedes Canedo 等，2016）。Thomas H-J Uhlemanna 等人提出了一种多模式 数字孪生体数据的采集策略（Thomas H.-J 等，2017）。Torben Cichon 等人对数 字孪生技术的架构、功能、策略等内容进行了研究，研究结果使用于可扩展的数 字孪生平台，可以强化人机交互的能力（Cichon T 等，2018）。Dmirty Kostenko 等人对静态和动态诊疗中的数字应用进行了研究，并提出了数字孪生与知识库相 结合的诊疗方法（Kostenko D，2018）。Petr Janda 对机床的数字模型的开发进 行了探索，并应用到了 Sinumenk 8400 数控系统的数字模型的开发上（Janda P， 2018）。

2.1.2 布尔运算 布尔运算（刘国歌，2019）是乔治布尔在《思维规律的研究》中提出的，逻

辑运算即布尔运算，逻辑运算的结果即布尔值。布尔运算可以解决数学逻辑方面

各个维度的数学图形问题。布尔运算是虚拟加工的基础，本文中所介绍的块布尔

运算主要应用于三维模型之间。

块体布尔运算包括块体布尔交、并、差运算（杨石扣 等，2016）。布尔交运

算是求解主块体与客块体的公共部分的运算过程；同理，布尔并运算是将主块体

与客块体进行整合的运算过程；布尔差运算是指去除两块体的相交部分后剩余部

分的块体的运算过程。块体布尔交、并、差运算公式如(2.1)所示，A 表示主块体，

B 表示客块体。
𝐶∩ = 𝐴 ∩ 𝐵 𝐶∪ = 𝐴 ∪ 𝐵 𝐶− = 𝐴 − 𝐵
布尔运算一般可分 4 步完成，如图 2.1 所示：

…(2.1)

（1）求出主客块体相交面的交线集合。

（2）以交线集合将主客块体分割成许多面。

10

第 2 章 系统相关理论基础
（3）将主客块体上有效面和无效面进行分类。 （4）去除无效面，新的块体集合由有效面组成。
图 2.1 块布尔运算主要流程图 Figure2.1 Main flow chart of block Boolean operation
块体布尔交运算、块体布尔并运算和块体布尔差的运算过程基本一致，而在 有效面的选择上不同，本节以图 2.2(a)为例，针对有效面的选择作出说明。黄色 立方体设为主块体，灰色立方体为客块体。对两块体相交面的交线求解，主块体 中由顶点 8、10、11 和 12 构成的面，由交线 L57 和 L59 分割形成两个面，即面 12-11-10-9-5-7-12，和面 7-8-9-5-7；客块体中由顶点 1、2、3 和 4 构成的面，由 交线 L76 和 L75 分割形成两个面，即面 1-5-7-6-1，和面 2-6-7-5-4-3-2。
在本系统的开发过程中主要应用块体布尔差运算进行工件模型与刀具模型 之间的切削仿真。进行块体布尔差运算时，由图 2.2 可知，有效面取主块体中不 在客块体内的面和客块体中在主块体内的面。以这种方式，求出所有的有效面的 集合包围形成新的块体，如图 2.2 所示。
11

数控机床数字孪生系统的设计与实现
图 2.2 块体布尔差运算的有效面判定 Figure2.2 Effective surface determination of block Boolean difference operations
2.2 相关技术研究 2.2.1 3DS Max
3DS Max 是当前主流的建模软件，其优势有：（1）与同类软件相比，3DS Max 建模高效稳定，渲染效果真实。（2）利用 3DS Max 建好的模型可以直接导出， Unity 3D 可以直接使用导出得到的 OBJ 格式文件。（3）OBJ 文件中保存了模型 上的三维数据信息，如各点的深度、颜色、明暗、坐标等信息。因此，3DS Max 是本次系统设计开发过程中的首选。
2.2.2 Unity Unity 3D 是一个支持多平台专业引擎开发工具，具有比同类开发工具更优厚
更高的展示效果和可扩展的能力。Unity 3D 提供对 DirectX 和 OpenGL 的图形渲 染。Unity 3D 支持市面上常见的文件格式，如 FBX、OBJ，用户导入模型后，只 需对模型参数进行设置修改，即可快速完成项目的建设。Unity 3D 兼容性强，能 和其他程序协同工作，也能为其他程序提供插件支持。支持各种类型的硬件加载。 内置的物理引擎为用户带来真实的用户体验。提供多角度，多方向，多效果的光 影渲染系统及高效的粒子系统（董叶芊，2017）。
Unity 3D 对开发人员能力要求低、展示效果好、系统渲染快、定制能力强， 完全满足虚拟交互产品的研发需求。同时，Unity 3D 完美兼容各种手机系统以及 各类混合现实设备，轻松实现一版多端。Unity3D 支持多种脚本语言，可以实现 对数控机床数字孪生系统场景的自定义。
2.2.3 C# C#是由 Java 和 C++发展而来，具有高效、稳定、简洁的特点(赵永利 等，
12

第 2 章 系统相关理论基础
2017)。以取其精华去其糟蹋的方式继承了 Java 和 C++中的功能并进行了优化。 C#融合了 Visual Basic 的便捷和 C++的高效，以其完善的功能、简洁的语法、超 前的语言思想成为.NET 开发的官方语言（朱杰 等，2018）。C#与 Java 非常相似， 如继承、接口等语言特性，并且与 Java 的语言规范和代码执行的方式相差无几； 但是 C#借鉴了 Delphi（董帅 等，2019）的语法特点，直接集成组件对象模型。
2.2.4 MQTT MQTT 协议中有几个身份：信息的发布者、订阅者以及代理服务器（范安宇
等，2021）。其协议的实现过程如图 2.3 所示：
图 2.3 MQTT 协议的实现方式 Figure2.3 Implementation of mqtt protocol
发布方负责发布和推送消息，订阅方负责订阅和接收消息，但是两者并不是 直接交互的，而是通过一个“中间商”—代理方来进行交互，发布方将消息发送 给“中间商”服务器，此服务器通过树形结构存储发来的消息，而订阅方通过对 此“中间商”服务器的监听，来让此服务器推送消息至己方，从而获得最新或以 前的消息。
在此协议下 Client 端和 Server 端建立连接，并开始且仅一次发送 CONNECT 报文进行交互，即使返回也被认定为错误。
下面将具体介绍这三方中间交互的变化。 第一步，信息发送。在双方建立连接之后，当出现以下两种情况会断开连接： 第一，Server 端未收到 CONNECT 消息（董志刚，2020）；第二，Server 端收到 CONNECT 消息，但未通过验证。否则进行连接之后的操作。接下来，Server 端 接收信息，根据树形结构的内容确定 Client 端，同时发布消息涵盖报头信息，包 括是否为第一次发，信息质量等，其中服务质量是此协议的特点，据此特点影响 发送次数。
13

数控机床数字孪生系统的设计与实现

表 2.1 Qos 服务质量表

Table 2.1 The Table of Service Quality

Qos 值

0

1

2

-

Bit2 Bit 描述

0 0 最多发一次

0 1 至少发一次

1 0 仅发一次

1 1 保留位

上表中保留位意味着：消息存储与否有保留位数字决定，即数字是 1 时，需

与其服务质量等级一起被存储，同时当一个新的账户建立并添加订阅后，Server

端必保留位数字为 1 的消息传递给订阅方。

根据 Qos 的等级，用户也即接收方需要作出不同的回应：第一，当 Qos 为 0

时，表示 Server 端即发送方发送一次消息，Client 端并不必须作出回应，Server

端尽力发；第二，当 Qos 为 1 时，Server 端发送一次消息，Client 端至少收到一

次，并且必须对 Server 端即发送方作出回应；第三，当 Qos 为 2 时，Server 端发

送一次消息，Client 端只接收一次消息，并且作出回应。

第二步，信息的发送确认和收到确认。发送确认中涵盖 2 长度的报头，报文

中等待确认的标志涵盖在可变长度中。当 Qos 为 1 或 2 时，需要根据规定回应

Server 端一个确认。此规定为：第 1 个字节中第 4 个比特位置 1，同时第 2 个字

节中第 1 个比特位置 1。此外和发送确认一样，收到确认拥有同样位置格式的确

认标识。

第三步，发送释放和完成。当发送了消息收到确认后，需要完成 发送释放，

从而结束报文传输。其中，在固定头中，将第 1 个字节的第 1、6、7 和第 2 个字

节的第 1 位置位 1，标识为发送释放报文。接下来，到达最后一个发送完成报文，

即对发送释放的响应，在其固定头中，将第 1 个字节的第 4、5 位和第 2 个字节

的第 1 置位 1，至此发送完成。同样和发送确认一样，发送释放和发送完成拥有

同样位置格式的确认标识。

第四步，订阅主题及响应。一个 Client 可以同时向 Server 发送多个信息通知

Server，从而订阅主题。同时，Server 端收到此信息并向 Client 端发送固定格式

的子包确认信息。

第五步，取消订阅及确认。一个 Client 可以同时向 Server 发送多个信息通知

Server，从而取消订阅。同时，Server 端收到此信息并向 Client 端发送固定格式

14

第 2 章 系统相关理论基础
的子包确认信息。 此协议涵盖几种必要的信息。第一，固定头，其中包括了报文的 标志位等。
第二，可变头，其中涵盖了标识符、版本、协议名、心跳时间等。第三，有效负 载，其中涵盖了 Client 端收到的各种信息包含注意、编码、账户等。 2.3 本章小结
本章对数控机床数字孪生系统开发过程中所涉及的相关理论与相关技术作 了说明介绍。首先介绍了数字孪生的理论研究，以及对虚拟加工涉及到的布尔运 算作了介绍。另外本章介绍了系统在设计与实现过程中所使用的技术，包括但不 限于 3DS Max 建模软件、Unity 系统开发平台、C#语言、MQTT 通讯协议。在对 上述理论与技术的学习研究下完成了对数控机床数字孪生系统的设计与实现。
15

数控机床数字孪生系统的设计与实现 16

第 3 章 系统总体设计
第3章 系统总体设计
3.1 系统设计目标与原则 3.1.1 系统设计目标
本文设计的数控机床数字孪生系统应用于数控机床的加工生产线，在项目上 线初期，不干扰项目进度及资金紧缺的情况下，工作人员能够使用本系统完成对 数控机床的功能学习，还可以使用本系统对数控加工程序完成线上调试，以及工 件的切削仿真，从而减少实机调试时间和试切成本，轻松实现项目的快速上线。 根据数控加工需求和切削仿真要求，系统最终应达到下列目标：
（1）建立物理设备与数字机床之间的映射关系。本系统针对数控机床建立数 字孪生体，如 CK0632、汉沣等数控机床模型，模型内容中包含材质和纹理信息， 数字孪生体可以根据用户需求对纹理信息进行变更。对于不同加工方式的数控机 床都需要完成对应的数字孪生体模型的建模。
（2）本系统需要具备实时数据映射功能。合理收集打包加工数据完成信息的 通讯，使用加工数据实现机床设备与数字端的实时信息传输（吴钱昊，2020）， 同时确保实时性不会对用户体验带来影响。
（3）本系统需要具备良好的虚拟仿真功能。切削仿真通过工件模型与刀具模 型间的布尔运算来完成对真实的加工场景进行模拟的过程，建模的合理有效性是 切削仿真的核心。因此需要针对不同的工件和刀具进行合理的仿真（ 陈天杰， 2019）。
（4）上述功能开发完成的基础上，还需要对平台兼容性、用户界面交互的便 利性、加工结果可靠性等性能进行综合考量。
本章将基于以上需求和指标，对数控机床数字孪生系统进行设计与实现。
3.1.2 系统设计原则 数控机床数字孪生系统的设计与实现不仅涉及到多个学科，如力 学、数学、
物理学等，还需要了解系统设计原则。为了保证数控机床数字孪生系统的可靠、 稳定、高效，本系统在设计和研发过程中需要遵守以下原则：
（1）可靠性（颜秀铭，2017）：软件可靠性指软件启动后的避障能力。软件
17

数控机床数字孪生系统的设计与实现
系统的可靠性与日常生活生产的安全紧密相关。越复杂的软件系统，可靠性越难 保证，因此，需要在设计阶段确认有效设计方案。并对设计方案的安全性进行验 证和测试。
（2）高效性：数控机床数字孪生系统需要满足实时信息传输及 实时切削仿 真，因此不仅需要有高效的数据传输方式，同时也需要对切削仿真算法进行高效 的优化。
（3）扩展、兼容性：从系统自身方面，数控机床数字孪生系统不仅需要满足 对不同类型、不同运动方式的数控机床进行扩展兼容，从平台方面，还需要对不 同平台的设备进行扩展与兼容。 3.1.3 系统设计流程
在确定软件系统设计目标及原则之后，需要对软件设计流程进行整理，按照 科学的设计流程进行开发可以在提高研发速度的前提下充分保证系统稳定性。确 定数控机床数字孪生系统的总体目标及需求之后，对功能模块进行细化，减少模 块之间的耦合，再进行算法设计、程序实现。具体步骤如图所示：
图 3.1 数控机床数字孪生系统开发流程图 Figure3.1 Development flow chart of digital twin system for CNC machine tools
18

第 3 章 系统总体设计
3.2 系统总体框架设计 3.2.1 系统需求分析
本小节将对数控机床数字孪生系统的需求进行细化，将本系统的需求划分为 系统交互模块、数字孪生体建模模块、数控机床可视化模块、实时数据通信模块、 初始化模块，具体的需求框架如图所示。
图 3.2 数控机床数字孪生系统需求框架图 Figure3.2 function block diagram of digital twin system of CNC machine tool
（1）初始化模块负责系统的初始化。主要有数字孪生体初始化、工件加工数 据初始化、工件模块初始化、刀头数据初始化等。用户可以进行不同类型的数控 机床数字孪生模型的选择，并自由选择配置数据，如刀头类型、工件毛胚大小。
（2）实时数据通信模块主要有数据采集与传输。MQTT 客户端采集数控系 统中的机床运行数据，MQTT 服务端通过订阅得到客户端的采集信息，系统客户 端通过订阅得到 MQTT 服务端发布的机床运行数据。
（3）可视化模块有工件仿真、刀具仿真、切削仿真、机床数据展示。机床信 息包括机床系统信息、机床配置信息。机床切削仿真是根据 NC 程序对采集到的 工件数据与刀具数据进行虚拟加工的过程。
（4）数控机床数字孪生体的建模模块主要有数字孪生体的建模、工件模型的 建模以及刀具模型的建模（李浩 等，2019）。数控机床数字孪生体的建模需要对 数控机床实体设备数据进行一比一的测量，工件与刀具的模型需要根据其本身的 特性进行建模。
19

数控机床数字孪生系统的设计与实现
（5）系统交互模块包括数控机床数字孪生系统面板交互、切削仿真过程中视 角调整。面板交互是指通过鼠标或者键盘对数控机床数字孪生系统用户界面进行 操作，并根据按钮功能给数字机床发送加工指令。用户视角可以通过键盘与鼠标 的交互进行视角的调整，方便用户以最佳视角进行观察。
3.2.2 功能需求分析 数控机床生产线启动之前，需要针对数控程序进行试切，通过工件的试切结
果判断程序的正确性。试切法（王东方，2020）以替代材料或者原材料完成加工， 但加工过程占用机床设备，会影响车间生产效率，同时错误的加工程序还有可能 导致机床宕机或者工作人员受伤的情况出现，存在一定风险，影响整体研发进度。 针对该问题研制了一系列仿真软件，部分研究人员着手对数控设备的研究，以数 字模型为参照完成对数控加工程序的虚拟调试。但部分软件存在缺陷，如仅针对 机床设备模型的仿真，不能进行功能的仿真；机床展示角度受限；机床配置步骤 繁琐；软件支持平台单一。
针对上述需求，本文设计了一种数控机床数字孪生系统。首先，该系统面向 真实的加工生产，设备与模型间需要具备良好的通讯功能，应该数据流量小、集 成度高的通讯协议；其次，该系统需要有良好的用户交互界面，使用便捷，让工 作人员能够快速学习与上手使用；其次，数控机床数字孪生系统的切削仿真需要 支持多视角观察的功能；最后，该系统可以支持用户的多种需求进行个性搭配。
本文设计与实现的数控机床数字孪生系统面向工业生产领域，系统结构要满 足实用便捷的特点，机床实体与数字模型之间信息交换实时性能良好，支持多平 台等特点。在上述技术性指标上，数控机床数字孪生系统需要具备机床配置功能、 模拟演练功能和机床展示功能。系统功能框图如图 3.3 所示，各个模块的内容分 析如下：
（1）机床配置功能：为满足不同用户的需求，本系统可对各项加工数据进行 定制，如对数控机床数字孪生体进行选择，对刀具的选择则依据数控机床的型号 进行针对性的选择，对工件模型进行个性化定制，以及数控加工程序的选择或者 根据用户需求进行自主编码等功能。
（2）模拟演练功能：模拟演练功能涉及到切削仿真及数据的传输，其中切削 仿真涉及到工件与刀具之间的虚拟加工，数据传输方面需要整个系统的架构及功
20

第 3 章 系统总体设计
能进行考量，经过综合考虑，本系统采用 MQTT 作为信息交互的通讯协议。MQTT 具有轻量、简单、开发和易于实现的特点。
（3）机床展示功能：机床展示功能涉及到用户与系统之间的交互，系统的可 视化界面需要充分满足易用性及实用性的特点，从而提升用户体验。机床展示功 能的实现则需要满足数控机床数字孪生体在各个方向上的旋转和移动 以及用户 针对机床细节观察的需求。
图 3.3 数控机床数字孪生系统功能模块图 Figure3.3 Function module diagram of digital twin system of CNC machine tool
3.3 系统工作流程设计 本文所设计的数控机床数字孪生系统主要是 PC 端交互控制软件的设计，使
用，使用交互界面来配置数控机床参数，然后通过仿真软件中的虚拟模型来进行 试切，验证数控程序的正确性。
数控机床数字孪生系统的总体工作流程如图 3.4 所示，首先根据用户需求选 取对应的数控机床孪生体，然后通过 MQTT 通讯协议与数控机床实体设备相连 并同步机床状态，其中机床状态包括对应的工件模型与刀具模型，当机床状态同 步完成后，对试切程序进行编码，同步数控程序后开始虚拟加工，等待虚拟加工
21

数控机床数字孪生系统的设计与实现
开始后，观察虚拟加工过程与结果是否满足预期结果，若实际加工流程与预期出 入较大，则暂停加工流程，分析加工工序的程序逻辑，是否存在遗漏或者错误， 更改和优化后重新进行试切，直到整个试切流程能够按照预期完成，则表示试切 通过。
图 3.4 数控机床数字孪生系统工作流程图 Figure3.4 Work flow chart of digital twin system of CNC machine tool
3.4 系统开发工具的选择及环境的搭建 3.4.1 系统开发工具的选择
目前数字孪生系统的开发工具众多，如：（1）底层三维图像开发工具，如 DirectX、OpenGL。OpenGL 能够提供跨平台的应用接口，但 OpenGL 功能性不 强，建模依赖算法，纹理及材质信息较复杂，实现起来比较复杂。（2）面向 web 端的开发工具，如 VRML、Cult3D。Web 端技术简单，但系统功能弱、扩展性差、 沉浸感差，无法合理利用系统的软硬件资源，因此不适合研发复杂的虚拟仿真系 统。（3）大型的数字孪生开发平台，如 Virtool、Unity 3D、Eon Studio 等软件，
22

第 3 章 系统总体设计
因为 Unity 3D 操作简单、仿真展示效果好，并且具有良好的平台移植性，扩展能 力强，因此选择 Unity 3D 作为基础开发工具。

3.4.2 系统通讯协议的选择 本文从通用性的角度出发，对数控机床数字孪生系统进行设计。工作人员在
确定需求后，有针对性的对数控机床类型进行选择。市场上，数控机床类型繁多， 各机床系统类型也不同。因此，要采用具有通用性的协议实现数据的传输。当前 数字孪生系统可采用的通讯协议主要有 MQTT、HTTP、TCP、FTP 等，本文主 要采用 MQTT，MQTT 是物联网中常用的物对物信息传输协议（孙常青 等，2020）， 只需要少量内存空间和带宽就可以完成高效的远程连接，是一种轻量级信息传输 协议。MQTT 与其他协议相比有很多优点，主要体现在以下几个方面： (1)开放信息协议，简单易实现； (2)发布订阅模式，一对多信息发布； (3)基于 TCP 传输协议，提供可靠、安全、双向连接； (4)报文信息空间占用小，提高网络利用率； (5)信息服务质量认证，保证数据安全稳定。 本系统所支持的数控机床设备目前包括：CK0632、哈斯 VF2YT 以及汉沣。

3.4.3 系统开发的软件环境 确定 Unity 3D 作为本系统的基础开发软件，选择 Micro Win 10 提供开发平
台支持，选择 VS 2017 提供开发环境支持，以 C#作为脚本语言，使用 MQTT 作 为数控机床与数字孪生系统之间的通讯协议，来实现数控机床数字孪生系统。系 统软件开发环境如表 3.1 所示。

表 3.1 软件开发环境表

Table 3.1 Software Development Environment Table

软件名称 Microsoft Windows 10
Unity3D Visual Studio
C# MQTT

版本号 1909
2017.3.1f1(64-bit) 2017
.NET Framework 4.8 3.1

23

数控机床数字孪生系统的设计与实现

3.4.4 系统开发的硬件环境 本系统在开发过程中的硬件环境为一台搭载 Windows 10 操作系统的计算机，
该计算机不仅作为数字孪生系统的载体同时还兼具 MQTT 服务端与 MQTT 客户 端的载体。设备的详细信息如表所示。

表 3.2 硬件配置参数表

Table 3.2 Hardware Configuration Parameters Table

硬件名称 处理器
内存大小 硬盘容量 系统类型

配置参数 Intel(R) Core(TM) i5-4200M CPU @ 2.50GHz
12GB 500G＋120G 64 位操作系统

3.5 本章小结 本章完成了系统的总体设计分析，确定了系统的设计目标和设计原则，并且
完善了该系统的设计流程。采用模块化的思想从系统需求和功能需求两方面对系 统总体框架进行设计。对系统工作流程进行了设计。最后确定了开发平台、开发 工具与通讯协议的选择以及系统开发的软硬件设施。

24

第 4 章 关键技术与算法研究
第4章 关键技术与算法研究
虚拟加工是数控机床数字孪生系统最重要的功能之一，切削仿真是本系统所 涉及到的虚拟加工流程。刀具模型根据数控加工程序发出的运动指令进行运动， 运动过程中对工件模型进行切割，工件模型最终展示被切削加工后的形状，这个 过程涉及到几个重要算法，分别是工件模型、通用刀具模型算法、布尔算法，以 及表面重构算法。工件仿真与刀具仿真是系统的核心，如何进行高效、准确的建 模是系统开发过程中需要考虑的问题。虚拟加工过程中，加工结果能直接反映工 件加工效果，工件模型的算法实现对切削仿真的性能意义重大，因此，选择合适 的模型建立方法尤为重要。布尔算法实现了刀具模型与工件模型之间的加工过程， 而在完成连续的布尔运算之后，工件表面存在较多的自由曲面，针对这些曲面采 用表面重构算法将其转换为三角形网格，有助于提高切削加工后的工件模型的渲 染质量。
本节首先介绍工件模型与通用刀具模型的建模方法，然后介绍布尔运算在本 系统中的应用，最后介绍表面重构算法在本系统中的应用。本文的虚拟加工过程 是几何仿真。因此，在进行工件与刀具的仿真时，不需要考虑加工过程中刀具发 热、刀具变形等因素。
4.1 工件模型建模方法研究 本系统切削仿真的重点在于工件模型与刀具模型的建模，合理的建模能够保
证在进行切削仿真过程中工件模型的会在与刀具模型碰撞后随着刀具 模型的运 动而发生变化。从几何的角度入手，在虚拟加工的过程中暂时不考虑物理影响因 素，数控机床的工件仿真方法分为四类，精确建模法，离散向量法，空间分割法 和混合建模法，接下来对上述几种建模方法进行简单的介绍。
精确建模法（陈波，2018）分两类。第一类是边界表示法，边界表示法能完 美表现模型的造型，但是频繁的布尔运算需要花费大量时间进行计算，并且对系 统资源的占用非常大，因此不适合本系统的中工件的建模。第二类是构造实体法， 构造实体法也具有上述优点，但因为该方法的特性只适用于规则造型的工件建模， 并且由于其算法的复杂度较高，建模过程较慢，若想要流程完成建模过程则对系
25

数控机床数字孪生系统的设计与实现
统的性能有非常高的要求。 离散向量法同样可以用来表达加工曲面。它通过大量离散的点与点到点之间
的向量来进行表达。通过计算刀具模型与工件模型表面的交点来完成切削仿真的 实现，并且这种方法对系统性能要求较低，但在实际应用过程中不适合曲面向量 的自由变换，且造型的构造比较困难。因此，不适用于本系统的开发。
空间分割法（于文斐，2019），顾名思义是将工件空间进行分割，从而得到体 素的表示方法。空间分割法有两类。第一类是像空间法，通过将对象投影在平面 上，对平面上的像素点进行处理，记录像素点的点信息并于实物进行的映射，从 而完成工件的仿真。第二类是物空间法，通过大量保留物体空间位置信息，从而 实现物体的渲染，但若要实现较好的渲染效果，则需要较好的系统配置。空间分 割法在一般情况下表达效果与实际情况出入较大，若要提升渲染效果，则会导致 模型的数据量过大，而影响系统建模的效率，得不偿失。
混合建模法在摈弃上述方法缺点的同时融合了各方法的优点，如可以精确描 述造型轮廓，造型过程快但资源占用少，造型结果可以进行切削仿真且满足进行 快速布尔算法的需求。因此，混合建模法得到了极大的推广。
本小节利用改进的八叉树模型（王鸿亮，2015）算法作为实现工件模型的方 法。该算法以 STL 模型为处理对象，通过算法完成 STL 模型与八叉树模型之间 的数据转换。
在 STL 类型的文件中，大量记录了三角面片的数据信息，通过信息集合完成 了对实体的表述，其中数据集合 S 可以用以下式子进行表示。

𝑛𝑖 𝑥

𝑆 = {𝑠𝑖 |𝑠𝑖: =

𝑝𝑖 1x 𝑝𝑖 2x

[𝑝𝑖 3x

𝑛𝑖 𝑦 𝑝𝑖 1y 𝑝𝑖 2y 𝑝𝑖 3y

𝑛𝑖 𝑧

𝑝𝑖 1z 𝑝𝑖 2z

, 𝑖 = 1,2, . . . , 𝑛𝑢𝑚}

𝑝𝑖 3z]

…(4.1)

其中，第 i 个三角面片的法线矢量为 (nix , niy , niz ) ，第 i 个三角面片的第 k 个顶

点的坐标值为

(

pi

kx

,

pi ky

,

p i kz

)

(k=1，2，3)，三角面片总数量为 num。

三角面片体素化流程步骤如下：

首先，以三角面片 si 数据集合中各顶点的极值作为参数构建包围盒 A，然后

26

第 4 章 关键技术与算法研究
求出 si 的像 si’，生成 si’的面体素，再以 Z cutter 轴为基准，最后计算包围盒 B 关于 si’面体素的集合即得到工件模型。
4.2 通用刀具体模型建模方法研究 刀具扫描体是指对刀具进行连续扫面扫描，沿着空间路径以某种 方式运动，
生成的实体空间并集（黎柏春，2015）。 刀具扫描体的构建方法可以分为两类。第一类显示法是最常用的刀具构建方
法，通过确定刀具模型与工件模型的交线来完成扫描体的构建；第二类隐式法则 是通过建立隐式函数完成刀具体的表示。就显式法而言，隐式的优点有两条，第 一、利用隐式方程可以快速判断坐标点与隐式方程之间的位置关系，当坐标点的 值满足隐式方程的计算，则判断该坐标点的位置在隐式方程所表达的面上，若坐 标点的值不满足隐式方程的计算，则通过坐标点的参数与计算结果进行判断，若 坐标点参数大于计算结果，则该坐标点的位置位于隐式方式所表达的面以外，否 则，该坐标点的位置位于隐式方程所表达的面以内；第二、隐式方程的计算量小， 计算结果可靠，对设备性能要求低，简单实用。
自动编程工具采用参数对通用刀具体作过如下定义，模型如图 4.1 所示，以 刀具体下锥部为原点建立 X cutter、Z cutter 平面直角坐标系，接下来对参数及参 数定义进行说明：rt 值表示环部内径的大小；e 值表示环中心到刀具体轴心的直 线距离的大小；α 值表示下锥部边界线与 X cutter 轴的夹角，夹角的范围为（0， 90°）；β 值表示上锥部边界线与 Z cutter 轴的夹角，夹角的范围为（90°，90°）； l 值表示刀具体沿 Z cutter 轴方向上的长度；r 值表示刀具体沿 X cutter 轴的半径； h 值表示环中心到 X cutter 轴的距离；
27

数控机床数字孪生系统的设计与实现

Zcutter
β 上锥部 θ

l

环部

r

e

h

下锥部

α rt

Ocutter

Xcutter

图 4.1 通用刀具体模型定义 Figure4.1 definition of general tool specific model
其中，r 和 h 可以通过下列式(4.2)及式(4.3)计算得到
ℎ = 𝑒 𝑡𝑎𝑛 𝛼 + 𝑟𝑡√1 + 𝑡𝑎𝑛2 𝛼 𝑟 = 𝑒 + 𝑟𝑡 𝑐𝑜𝑠 𝛽

…(4.2) …(4.3)

根据上述定义，刀具体可以分为环部和上下两个锥部，各部分表面点集的参

数表达式如式(4.4)、式(4.5)、式(4.6)所示，其中 M 上锥(s)表示上锥部的点集，M

环(s)表示环部的点集、M 下锥(s)表示下锥部的点集。

𝑥(𝑐上锥,𝜃) = (𝑒 + 𝑟𝑡 𝑐𝑜𝑠𝛽) 𝑐𝑜𝑠 𝜃 + 𝑐上锥(𝑙 − ℎ + 𝑟𝑡 𝑠𝑖𝑛 𝛽)𝑡𝑎𝑛 𝛽 𝑐𝑜𝑠 𝜃
𝑀上锥(𝑠) = {𝑦(𝑐上锥,𝜃) = (𝑒 + 𝑟𝑡 𝑐𝑜𝑠 𝛽)𝑠𝑖𝑛 𝜃 + 𝑐上锥(𝑙 − ℎ + 𝑟𝑡 𝑠𝑖𝑛 𝛽) 𝑡𝑎𝑛 𝛽 𝑠𝑖𝑛 𝜃 𝑧(𝑐上锥) = ℎ − 𝑟𝑡 𝑠𝑖𝑛 𝛽 + 𝑐上锥(𝑙 − ℎ + 𝑟𝑡 𝑠𝑖𝑛 𝛽)

…(4.4)

𝑥(𝜙, 𝜃) = (𝑒 + 𝑟𝑡 𝑠𝑖𝑛 𝜙) 𝑐𝑜𝑠𝜃 𝑀环(𝑠)： = {𝑦(𝜙, 𝜃) = (𝑒 + 𝑟𝑡 𝑠𝑖𝑛 𝜙) 𝑠𝑖𝑛 𝜃
𝑧(𝜙, 𝜃) = ℎ − 𝑟𝑡 𝑐𝑜𝑠𝜙
𝑥(𝑐下锥, 𝜃) = 𝑐下锥(𝑒 + 𝑟𝑡 𝑠𝑖𝑛 𝛼) 𝑐𝑜𝑠 𝜃 𝑀下锥(𝑠)： = {𝑦(𝑐下锥, 𝜃) = 𝑐下锥(𝑒 + 𝑟𝑡 𝑠𝑖𝑛 𝛼) 𝑠𝑖𝑛 𝜃
𝑧(𝑐下锥,𝜃) = 𝑐下锥(𝑒 + 𝑟𝑡 𝑠𝑖𝑛 𝛼) 𝑡𝑎𝑛 𝛼

…(4.5) …(4.6)

其中 c 上锥的区间范围为 0 到 1、c 环的区间范围为 0 到 1、c 下锥的区间范

围为 0 到 1、θ 的区间范围为 0 到 2π 和 ϕ 的区间范围为 α 到(π/2-β)。根据刀具体

轴对称的性质，可以通过将 Z cutter、X cutter 直角坐标系第一区间内的面绕 Z

cutter 旋转一周完成刀具体空间模型的构建，再利用平方和公式 sin2θ+cos2θ=1，

完成隐式曲面的推到，如式(4.7)所示。

28

第 4 章 关键技术与算法研究

𝐹上锥（𝑥, 𝑦, 𝑧） = 𝑥2 + 𝑦2 − [𝑒 + 𝑟𝑡 𝑐𝑜𝑠 𝛽 + (𝑧 − ℎ + 𝑟𝑡 𝑠𝑖𝑛 𝛽)𝑡𝑎𝑛 𝛽]2 = 0

𝐹环(𝑥, 𝑦, 𝑧) = [𝑥2 + 𝑦2 − 𝑒2 + (ℎ − 𝑧)2 − 𝑟𝑡2]2 − 4𝑒2(𝑥2 + 𝑦2) = 0

…(4.7)

{𝐹下锥(𝑥, 𝑦, 𝑧) = 𝑥2 + 𝑦2 − 𝑐𝑡𝑔2𝛼 ⋅ 𝑧2 = 0

4.3 碰撞检测与布尔运算 本系统中碰撞检测的计算结果将作为布尔运算执行与否的触发参数。仅当碰
撞检测结果为真时，再执行布尔运算，有效减少计算量优化系统性能。 在本系统中，采用投影法（刘建春 等，2021）的方式对碰撞检测进行了实现。
首先，在三维空间内建立空间直角坐标系，分别完成工件模型以及刀具模型在 xoy， xoz，zoy 三个平面内的投影，各个平面内会生成两个投影面，再将平面内的投影 面在对应的坐标轴方向上进行投影，xoy 平面上的投影面的投影坐标轴为 x 轴， y 轴；xoz 平面上的投影面的投影坐标轴为 x 轴，z 轴；zoy 平面上的投影面的投 影坐标轴为 z 轴，y 轴。对坐标轴上的投影结果进行记录，计算各轴上投影面的 投影区间，若工件模型与刀具模型在各个坐标轴上的投影区间连续，则判断发生 了碰撞，若任一坐标轴上的投影区间不连续，则判断未发生碰撞。

4.3.1 工件模型与刀具模型的碰撞检测 假设已知工件模型与刀具模型分别为 W、K，模型所对应的最大值与最小值
分别为 Wmax、Kmax、Wmin、Kmax ，采用差值计算的方法进行碰撞检测 伪代码如下：

表 4.1 碰撞检测算法伪代码

Table4.1 Collision detection algorithm pseudo code

bool CrossingWorkKnife (WorkKnife W，WorkKnife K)

return({no Crossing ， Crossing});

1: if(Wmax.x< K max.x || Wmin.x< K min.x)

2:

return noCrossing;

3: if(Wmax.y< K max.y || Wmin.y< K min.y)

4:

return noCrossing;

5: if(Wmax.z< K max.z || Wmin.z< K min.z)

6:

return no Crossing;

7:

return Crossing;

W，K:WorkKnife 三维模型

4.3.2 布尔运算在系统中的应用

29

数控机床数字孪生系统的设计与实现
依据上述 4.3.1 小节中碰撞检测的规则，布尔运算在系统中的运算流程描述 如下：
第一步：对工件模型与刀具模型作碰撞检测，分别完成工件模型与刀具模型 在空间中投影，再分别计算投影面在各轴上的坐标值范围，记录如下：xmin、xmax， ymin、ymax，zmin、zmax，利用碰撞检测算法完成判断。若判断结果为真，则执 行第二步；否则，继续执行碰撞检测。
第二步：利用刀具模型隐式曲面表达式完成与工件模型的布尔运算，删除相 交部分的模块。 布尔运算的运算流程内容见 2.1.2 小节。 4.4 本章小结
本章对切削仿真过程中涉及到的关键技术与算法实现进行了研究与整理，其 中对当前流行的几种工件模型的建模方法的优劣进行了比较，最终选择改进的八 叉树模型算法进行了实现；通用刀具体模型的建模则采用隐式方程进行合理的建 模，优点在于可以进行高效的布尔运算；碰撞检测算法则采用投影法的方式进行 实现，投影法的优点在于可以减少了碰撞检测算法实现过程中的计算量，在此之 后则介绍了布尔运算在本系统中的实现。
30

第 5 章 系统实现
第5章 系统实现
数字孪生体的建模效果决定了用户的体验，因此本系统中数字孪生体的模型 数据需要通过对数控机床实体设备进行测量获得，其次，相对于传统虚拟现实数 控机床系统，本系统支持数控机床数据的实时传输及展示。本章首先 介绍利用 3DS Max 建模软件绘制数控机床三维模型，再介绍使用 MQTT 作为数据传输的 协议将数控系统采集的数据进行实时传输，实现虚拟场景中数控机床的联动，最 后，根据数控机床工作人员对观察加工过程的需求对系统交互的可视化界面进行 实现。
5.1 数控机床建模及运动学分析 5.1.1 数控机床建模
数控机床数字孪生体作为本系统的展示对象，模型的真实感及精细度将直接 影响用户使用时的沉浸感。目前三维建模软件众多，如 3DS Max、Maya、Zbrush、 CAD 等。3DS Max 的优势有：（1）与同类软件相比，3DS Max 建模高效稳定， 渲染效果真实。（2）利用 3DS Max 建好的模型可以直接导出，Unity 3D 可以直 接使用导出得到的 OBJ 格式文件。（3）OBJ 文件中保存了模型上的三维数据信 息，如各点的深度、颜色、明暗、坐标等信息。
利用 3DS Max 建模软件对数控机床数字孪生体建模的流程如图 5.1 所示，第 一步：在建模之前，首先需要对数控机床实机进行详细的测绘。具体包括机床整 机的材质、尺寸大小、颜色，机床部件材质、尺寸大小、颜色，各个部件的坐标 位置信息及各个部件之间的装配关系。第二步：利用测绘信息使用 3DS Max 进 行数控机床数字孪生体各个零件模型的绘制，然后完成对应零件的材质，颜色信 息的配置。第三步：对零件的纹理材质、场景的灯光效果进行渲染。若不满意预 期效果，则对灯光效果、纹理样式、渲染方式进行调整，满意后则参照机床结构 图完成对机床的组装。
31

数控机床数字孪生系统的设计与实现

图 5.1 数控机床三维模型绘制流程图 Figure5.1 Flow chart of 3D model drawing for CNC machine tools
数控机床种类繁多，现以 CK0632 数控机床作为说明对象展示数控机床三维

模型的绘制过程。CK0632 数控机床是国产的两轴驱动高性能机床，采用整体式

床身，导轨距大。

第一步：详细测量 CK0632 数控机床数据。测量数据包括各个零件的大小、

直径、孔位等，测量单位以 mm、min、kg 等国际通用单位为基准。部分测量数

据如表所示。

表 5.1 CK0632 数控机床规格参数表

Table 5.1 Specification parameter table of ck0632 CNC machine tool

规格/型号

CK0632

床身上最大工件回转直径

320mm

最大盘类车削直径 最大轴类车削直径

320mm 160mm

最大车削长度

300mm

滑板上最大回转直径

160mm

X、Z 轴快速移动速度 X 轴最大行程 Z 轴最大行程 主轴转速范围 主轴头型号

16m/min、12m/min 250mm 300mm
200～3000r/min(无极) A2-5

主轴定位孔

56mm

主轴通孔直径 主轴拉杆孔径

48mm 40mm

32

第 5 章 系统实现

续表 5.1 CK0632 数控机床规格参数表 规格/型号 主电机功率 卡盘动力

CK0632 4kw
手动（或气动、液压）

控制轴数 刀架型式

2轴 排刀

外圆刀具

25×25mm

刀座中心高 外形尺寸（长×宽×高）
机床净重

80mm 1760×1140×1545mm
1360kg

X 轴定位精度

0.01mm

Z 轴定位精度

0.01mm

工作同圆度

0.005mm

直径一致性

0.02mm/200mm 长度上

平面度

0.013mm/150 直径上，只许凹

表面粗糙度

Ra≤1.25(钢件)

第二步：在 3DS Max 建模软件中根据测量数据对各个零部件进行建模。对建

模完成的各个零部件进行合理的灯光调整、烘培与渲染。部分零部件的建模效果

如图 5.2，图 5.3，图 5.4 所示。

图 5.2 机床床身图 Figure5.2 machine bed picture
33

数控机床数字孪生系统的设计与实现
图 5.3 面板模型图 Figure5.3 Panel model picture
图 5.4 导轨主轴模型 Figure5.4 Guideway spindle model
第三步：对建模完成的各个零部件进行装配，根据各个部件的位置信息，确 定零部件在机床模型内所处的位置，对机床模型完成组装，机床模型最终效果图 如图 5.5 所示。
图 5.5 机床模型最终展示图 Figure5.5 CK0632 digital twin model
34

第 5 章 系统实现

5.1.2 数控机床运动学分析 模型在 Unity 3D 空间中的变换有缩放、平移和旋转三种方式。模型的动态造

型由缩放、平移和旋转共同作用。通过对向量（x，y，z）进行矩阵变换完成物体

的缩放、平移和旋转。

任意向量（x，y，z）的缩放变换可以通过缩放变量（s1，s2，s3）与该向量

的点乘完成：

𝑆1 0 0 0 𝑥

𝑆1. 𝑥

[

0 0

0

𝑆2 0 0

0
𝑆3 0

0 0

]

𝑆4

.

(𝑦𝑧 1

)

=

(𝑆𝑆23.. 1

𝑦𝑧 )

…(5.1)

任意向量（x，y，z）的平移变换可以通过平移变量（Tx，Ty，Tz）与该向量

的点乘完成：

1 0 0 𝑇𝑥 𝑥

𝑇𝑥 + 𝑥

[0 0 0

1 0 0

0
1 0

𝑇𝑦] 𝑇𝑧 1

.

(𝑦𝑧 ) 1

=

(𝑇𝑦 + 𝑇𝑧 + 1

𝑦) 𝑧

…(5.2)

任意向量（x，y，z）的旋转变换可以通过绕任意方向向量（Rx，Ry，Rz）

旋转角度完成：

𝑐𝑜𝑠𝜃 + 𝑅𝑥2(1 − 𝑐𝑜𝑠𝜑)

𝑅𝑦𝑅𝑥(1 − 𝑐𝑜𝑠𝜑) + 𝑅𝑧𝑠𝑖𝑛𝜑

𝑅𝑧𝑅𝑥(1 − 𝑐𝑜𝑠𝜑) − 𝑅𝑦𝑠𝑖𝑛𝜑

[

0

𝑅𝑥𝑅𝑦(1 − 𝑐𝑜𝑠𝜑) + 𝑅𝑧𝑠𝑖𝑛𝜑 𝑐𝑜𝑠𝜃 + 𝑅𝑦2(1 − 𝑐𝑜𝑠𝜑)
𝑅𝑧𝑅𝑦(1 − 𝑐𝑜𝑠𝜑) + 𝑅𝑥𝑠𝑖𝑛𝜑 0

𝑅𝑥𝑅𝑧(1 − 𝑐𝑜𝑠𝜑) + 𝑅𝑦𝑠𝑖𝑛𝜑 0

𝑅𝑦𝑅𝑧(1 − 𝑐𝑜𝑠𝜑) − 𝑅𝑥𝑠𝑖𝑛𝜑 0

𝑐𝑜𝑠𝜑 + 𝑅𝑧2(1 − 𝑐𝑜𝑠𝜑) 0

0

1]

…(5.3)

空间中物体的动态造型由矩阵乘法完成，但在进行矩阵乘法计算时，需要优

先进行缩放、旋转操作，再进行位移操作，从而完成矩阵的变换组合。矩阵间以

点乘的方式完成计算，对于任意向量（x，y，z），绕任意方向向量（Rx，Ry，Rz）

旋转角度，平移向量为（Tx，Ty，Tz），缩放向量为（S1，S2，S3），其模型变

换原理如图 5.6 所示。

35

数控机床数字孪生系统的设计与实现
图 5.6 模型变换原理图 Figure5.6 Schematic diagram of model transformation
5.2 系统数据传输技术实现 5.2.1 数据传输架构设计
数控机床数字孪生的系统架构如图 1 所示，该系统结构有三部分：信息发布 者( MQTT 客户端) ，MQTT 信息代理服务器，信息订阅者（数控机床数字孪生 系统）。其中信息的发布者与订阅者的身份根据实际情况发生变换，MQTT 客户 端和数控机床数字孪生系统都具有发布信息和订阅信息的功能（李洋，2018）。
图 5.7 系统架构图 Figure5.7 system architecture
36

第 5 章 系统实现
(1) 信息发布者（MQTT 客户端）。负责将要发送的信息打包并向 MQTT 信息代 理服务器发布。 ( 2) 信息订阅者（数控机床数字孪生系统）。负责向 MQTT 信息代理服务器订阅 信息，信息订阅者对需要的信息进行解包等处理。 (3) 信息代理服务器（MQTT 服务端）。信息代理服务器是信息推送的核心，在接 收信息的同时兼备信息转发的功能。
5.2.2 数据传输工作流程 (1) 应用程序主进程调用信息代理服务器的系统初始化模块来启动信息代理服 务器的功能服务。无论是信息发布者还是信息订阅者都通过信息代理服务器的客 户端初始化模块连接到信息代理服务器。 (2)系统客户端（数控机床数字孪生系统）对信息代理服务器进行连接，发布或订 阅自己需要信息，信息代理服务器信息管理模块记录相应订阅信息及订阅者的账 号标识方便系统运行过程中对信息进行有针对性的转发。 (3)信息发布者（数控机床实体）将数据打包成信息的形式发送给信息代理服务器， 信息代理服务器将信息存放在系统接收队列中，信息处理模块从队列取出信息， 根据数控机床数字孪生系统订阅信息，推送到系统对应的信息接收队列。 (4) 触发 MQTT 信息代理服务器的信息监听器，通过订阅信息来确认订阅者并通 知每个信息订阅者接收信息。 (5)系统客户端时刻侦听信息队列中接收到的新信息，若侦听到，则对信息进行读 取，若未侦听到，则保持当前侦听状态。
5.3 系统交互可视化界面的实现 工作人员通过用户界面与数控机床数字孪生系统完成交互，发送 操作指令，
如机床运动、机床箱门的开闭等指令，因此，用户界面需要满足良好的交互性能， 不仅如此，还需要对系统的实用性和扩展性进行考虑，因此，本系统的用户界面 采用 Unity3D 完成开发。部分用户界面效果图如图 5.8 所示。
37

数控机床数字孪生系统的设计与实现
图 5.8 用户界面效果 Figure5.8 user interface rendering
数控机床数字孪生系统用户界面包括机床状态信息、数控机床三维模型、机 床配置参数、机床视角调整按钮等信息。其中机床状态信息包括报警编号、报警 内容、当前程序名、状态码、进给速度、主轴转速、坐标值等参数。由于采用了 Unity3D 进行用户界面的开发，后期可以针对业务需求对用户界面进行灵活的配 置，系统调试完成后再发布软件即可，大大减少了因用户需求变化而带来的系统 迭代的时间。
为避免加工材料飞溅，保证数控加工过程的安全，数控机床往往采用封闭式 箱体造型，为保证工作人员能对加工过程进行观察，则以钢化玻璃作为箱门的材 料，但在实际加工过程中，工作人员往往需要对工件的加工过程进行多角度全方 位的观察。基于此需求，同时结合数控孪生技术的优势——对零件模块进行快速 变换，在满足系统功能的前提下，本系统还设计了透明化、偏向角和结构爆炸图 多种效果，充分满足工作人员的需求，使工作人员在不影响数控加工的情况下以 个性化的角度对三维数控机床进行观察。
透明化：数控机床数字孪生体的透明化能为工作人员带来全方位观察的视觉 体验，透明值的设定影响工作人员的工作效率，合理的透明度能保证在把握全局 的情况下提升对加工过程的认知。例如当虚拟加工开始后，在不透明的情况下， 工作人员想要观察刀具模型的移动过程，刀具模型会因为被机床床身遮挡而无法 观察；在全透明的情况下，则无法把握数控机床的位置朝向，容易导致认知偏差 （赵泽宇，2020）。所以需要对三维数控机床模型的透明度进行合理设计，既不 会遮挡工作人员的视野，也不会让工作人员的认知出现偏差。同时透明化过程需 要合理的动画过渡，才会显得自然不突兀（李瑞杰，2020）。通过不断调整模型
38

第 5 章 系统实现
组件的 Alpha 值对透明度进行修改校验，设定最终值为 100。机床透明效果图如 图 5.9 所示。
图 5.9 机床透明图 Figure5.9 machine tool transparency
偏向角：数控机床数字孪生体的位置朝向受偏向角影响，若模型水平偏向角 与视线垂直，垂直偏向角与视线平行，则只能观察到数控机床机箱一个面的展示 情况，工业上，往往采用斜侧偏向 45 度角对物品进行展示（欧阳国婧，2019）。 针对三维数控机床加工是一个多轴的加工过程，单一的观察角度无法全面了解加 工过程。而工作人员可以根据需求任意调整偏向角，从而达到最好的观察角度， 以一种更直观的方式去观察虚拟加工的过程，便于工作人员对数控加工程序进行 及时修改与校正。在本系统中，可以通过修改数控机床数字孪生体的 Rotate 值对 三维模型进行角度的调整，Rotate 值不作上限与下限的限制，可以满足数控机床 任意角度的变换与展示。机床偏转效果图如图 5.10 所示。
图 5.10 机床偏转图 Figure5.10 deflection diagram of machine tool
39

数控机床数字孪生系统的设计与实现
爆炸图：爆炸图是作为各种家用产品及工业器械的装配示意图，用于图解说 明各个零部件安装。用户在进行装配时，根据爆炸图即可快速完成装配，提高工 作效率。如今爆炸图广泛应用在生产生活中，如工业产品的装配、机械设备的制 造中（马永敬，2020）。本系统借由爆炸图，以一种拆解零部件的方式对加工过 程进行展示，让工作人员以一种更直观的方式了解核心零部件的运作过程。以 X， Y，Z 三个轴的正方向作为各个部件移动的方向，通过调整各个零件模型与中心 点的位置得到有效的爆炸效果图。结构爆炸图展示效果如图 5.11 所示.
图 5.11 结构爆炸图 Figure5.11 structure explosion diagram
5.3.1 机床配置模块 该模块可以方便用户进行机床的配置，其中包括了机床模型的选择，机床数
据的选择，工件模型的数据配置，刀头模型的选择以及刀头位置的调整。如图 5.12 所示。机床模型方面提供了三款备选模型，分别是 CK0632、哈斯 VF2YT 以及汉 沣机床。机床数据方面分别提供了广州数控、发那科、蓝天数控、华中数控、等 设备的数控数据。工件模型的数据配置选项与机床的加工方式相关，CK0632 提 供三个输入值，分别为长、直径、离散值，而汉沣机床提供了四个输入值，分别 为长、宽、高及离散值。刀头模型的选型也与机床模型的选择相关，其中 CK0632 只提供了车刀的选型，而汉沣机床则提供了三种刀头的选择，分别是球头刀，端 铣刀，钻头。在刀头位置调整页面可以进行刀头的调整，刀头调整的选型与机床 加工方式有关，CK0632 只提供 X 轴与 Z 轴方向上位置的变化，而汉沣机床则提
40

第 5 章 系统实现
供了 X 轴、Y 轴、Z 轴三个方向上的位置变化。
图 5.12 机床配置流程图 Figure5.12 Flow chart of machine tool configuration
最后点击配置完成按钮，完成机床的配置。如图 5.13 所示。
图 5.13 机床配置完成图 Figure5.13 machine configuration completion diagram
5.3.2 机床展示模块 机床展示模块提供了非加工状态下的机床模型展示功能，可以 通过点击第
一栏选项中“前一个”与“后一个”按钮进行当前机床模型的切换，点击第二栏 选项中的按钮进行刀具模型与工件模型之间相对位置的调整，因机床加工方式的 不同提供不同轴向的位置调整，如图 5.14 所示 CK0632 数控机床只提供了 X 轴
41

数控机床数字孪生系统的设计与实现
与 Z 轴的位置调整按钮，点击第三栏选项中的按钮进行机床观察角的变换，点击 第四栏选项中的按钮显示不同状态的机床展示方式。
图 5.14 机床展示模块图 Figure5.14 Display module diagram of machine tool
5.4 本章小结 本章结合第三章的系统需求以及第四章已有算法的基础上，完成了数控机床
数字孪生系统整体的设计与实现。首先，本系统通过实际的测量数据完成了数字 孪生体的建模，对本系统的网络传输架构进行了实现，使用 MQTT 通讯协议完 成了数控机床与数字孪生体之间的信息交互，最后，根据用户实际需求实现了透 明化，偏向角，结构爆炸图等功能，实现了用户多角度多维度观察加工过程的需 求，提高了系统交互的自由度。
42

第 6 章 系统测试与验证

第6章 系统测试与验证
为保证系统功能的正确性以及良好的用户体验，本章主要对数控机床数字孪 生系统的功能与性能进行实验和验证。数控机床数字孪生系统的目标是为数控从 业人员提供良好的数控机床操作功能以及线上加工功能的学习，从而节省实际调 试时间以及试切成本，本章首先将对数控机床数字孪生系统测试环境进行集成， 分析系统的测试流程，并从功能测试和性能测试两方面开展对数控机床 CK0632 的实例测试，功能测试方面包括系统用户界面的功能验证及切削仿真的功能验证， 性能测试方面将使用资源管理器对系统性能进行监控。

6.1 系统测试环境及流程 6.1.1 系统测试环境
为验证数控机床数字孪生系统功能及性能安全可靠，以 CK0632 数控机床作 为对象进行实例测试。本小节根据 3.4 中所列举的开发环境选项进行系统测试的 环境搭建。实验主要设备包括一台计算机、数控系统，计算机同时兼顾 MQTT 服 务器与 MQTT 客户端的作用，设备详情如表 6.1 所示：
表 6.1 设备详情表
Table 6.1 Equipent Details Table

工具项

用途

配置

计算机

数控机床数字孪生系统

Intel(R) Core(TM) i5-4200M CPU @ 2.50GHz，内存 12 GB

计算机

MQTT 服务端/MQTT 客户端 Intel(R) Core(TM) i5-4200M CPU @ 2.50GHz，内存 12 GB

数控系统

数据源

西门子 840D，发那科 0i，蓝天

GJ430，华中 818D，广数 988K，广数 CK0632

在系统测试环境中，数控机床数字孪生系统的网络环境按照 5.2.1 中的网络

架构图进行搭建，MQTT 服务端和 MQTT 客户端均在计算机中运行，设备之间

的网络通信使用 MQTT 完成传输。为了模拟真实的加工环境，数控机床实机放

43

数控机床数字孪生系统的设计与实现
置在车间，由系统客户端从实验室发起操作，车间机床搭建情况如图 6.1 所示。
图 6.1 机床设备搭建图 Figure6.1 Construction drawing of machine tool equipment
6.1.2 系统测试流程 本系统的测试流程如图 6.2 所示，在系统启动后，首先完成系统数据的初始
化，设定通信 IP 地址后建立 MQTT 网络连接，完成数据的加载及配置，如机床 类型、数据来源、毛胚尺寸、刀头型号等，然后同步数据至 MQTT 服务器，数字 孪生系统在首次订阅 MQTT 服务器信息后会自动上传或下载服务器上的实体机 床信息。配置完机床数据后进行工件的切削仿真，观察切削过程并对测试过程中 的功能测试及性能测试结果进行记录，最终根据试切结果判断数控加工程序是否 编写有误。
44

第 6 章 系统测试与验证
图 6.2 系统测试流程图 Figure6.2 system test flow chart
本次测试目的有以下几点： （1）测试数控机床数字孪生系统是否会按照预期进行运行，数字机床的工作流 程是否与数控机床实机一致。 （2）测试数控机床数字孪生系统功能是否满足用户需求，各个按钮的描述文字 是否符合实际情况。 （3）测试数控机床数字孪生系统虚拟加工过程是否符合预期，加工结果是否满 足用户需求。 （4）测试数控机床数字孪生系统性能是否达标。 6.2 数控机床 CK0632 测试实例 6.2.1 系统功能测试
本小节针对数控机床数字孪生系统功能测试以黑盒测试（冯长卿 等，2020） 的方式进行，功能测试所承担的工作就是按系统设计的功能来测试系统是否符合 使用者的预期。本次测试的模块包括机床配置模块、模拟演练模块以及机床展示
45

数控机床数字孪生系统的设计与实现

模块。各模块测试用例表如表 6.2，表 6.3，表 6.4 所示。

表 6.2 机床配置模块测试表

Table 6.2 Machine Configuration Module Test Table

测试功能 机床配置页面展示 数控机床模型选择
数控机床模型切换
流程选择 数据选择
毛胚配置

输入/操作 点击机床配置按钮
点击页面上 “CK0632”型号的数
控机床模型
在上一步操作有效 的情况下，点击页 面上“汉沣”型号的
数控机床模型
点击“下一步”按 钮
点击页面上任意展 示的机床数据
输入毛胚的尺寸值

预期结果 跳转到机床配置页 面并进行模型选择 模型页面展示选中 的“CK0632”数控机 床模型并在机床配 置选项中显示该机
床型号 模型页面展示结果 从“CK0632”数控机 床模型切换到“汉 沣”数控机床模型并 在机床配置选项中
显示该机床型号 跳转到当前流程的
下一个流程 机床数据图标展示 所选中的机床数据 类型并在机床配置 选项中显示数据来
源 机床毛胚根据输入 的尺寸值发生变化 并在机床配置选项 中显示毛胚尺寸的
参数

测试结果 测试结果同预期结
果一致 测试结果同预期结
果一致
测试结果同预期结 果一致
测试结果同预期结 果一致
测试结果同预期结 果一致
测试结果同预期结 果一致

46

第 6 章 系统测试与验证

续表 6.2 机床配置模块测试表

测试功能

输入/操作

刀头配置

点击页面上可点击

的展示中的刀头选

项

刀头调整

点击刀头调整按钮

及机床展示角度按

钮

配置完成按钮

点击刀头调整页面 的下一步按钮

预期结果 展示刀头选项并在 机床配置选项中显
示所选中的刀头 刀头位置根据点击 的刀头调整按钮发 生变化，机床展示 角度根据点击的机 床展示角度按钮发
生变化 显示配置完成按钮

测试结果 测试结果同预期结
果一致 测试结果同预期结
果一致
测试结果同预期结 果一致

测试功能 机床运动 毛胚切削 按钮显隐
机床上翻

表 6.3 模拟演练模块测试表

Table 6.3 Test Table of Simulation Exercise Module

输入/操作 点击“机床运动”
按钮 点击“毛胚切削”
按钮 点击“按钮显隐”
按钮
点击“上翻”按钮

预期结果 机床开始加工，进 给值与进给倍率图 保持稳定图像输出 机床开始对工件进 行加工，系统界面
显示加工细节 在九宫格按钮显示 的情况下，九宫格 按钮隐藏；在九宫 格按钮隐藏的情况 下，九宫格按钮显
示 点击按钮后，机床
上翻一定角度

测试结果 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致
测试结果同预期结 果一致

47

数控机床数字孪生系统的设计与实现

续表 6.3 模拟演练模块测试表

测试功能

输入/操作

机床下翻

点击“下翻”按钮

机床左转

点击“左转”按钮

机床右转

点击“右转”按钮

机床上移

点击“上移”按钮

机床下移

点击“下移”按钮

机床左移

点击“左移”按钮

机床右移

点击“右移”按钮

预期结果 点击按钮后，机床
下翻一定角度 点击按钮后，机床
左转一定角度 点击按钮后，机床
右转一定角度 点击按钮后，机床 向上移动一段距离 点击按钮后，机床 向下移动一段距离 点击按钮后，机床 向左移动一段距离 点击按钮后，机床 向右移动一段距离

测试结果 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致 测试结果同预期结
果一致

表 6.4 机床展示模块测试表

Table 6.4 Test Table of Machine Tool Display Module

测试功能 机床切换
改变刀头位置 机床展示位置 机床开门功能

输入/操作 点击“前一个”/ “后一个”按钮
点击刀头位置改变 按钮
点击机床位置改变 按钮
点击“开门”按钮

预期结果 机床缩略图改变， 页面中心的机床孪
生体模型改变 刀头位置随着按钮
点击发生变化 机床展示位置随着 按钮点击发生变化 在关门情况下点击 “开门”按钮，机 床门打开，在开门
情况下点击“开 门”按钮，机床无
变化

测试结果 测试结果同预期结
果一致
测试结果同预期结 果一致
测试结果同预期结 果一致
测试结果同预期结 果一致

48

第 6 章 系统测试与验证

续表 6.4 机床展示模块测试表

测试功能

输入/操作

机床关门功能

点击“关门”按钮

机床分解功能

点击“分解”按钮

机床合并功能

点击“合并”按钮

机床透明功能

点击“透明”按钮

机床恢复功能

点击“恢复”按钮

预期结果 在开门情况下点击 “关门”按钮，机 床门关闭，在关门
情况下点击“关 门”按钮，机床无
变化 在合并情况下点击 “分解”按钮，机 床模型分解，在分 解情况下点击“分 解”按钮，机床无
变化 在分解情况下点击 “合并”按钮，机 床模型合并，在合 并情况下点击“合 并”按钮，机床无
变化 在原始状态下点击 “透明”按钮，机 床模型透明化，在
透明情况下点击 “透明”按钮，机
床无变化 在透明状态下点击 “恢复”按钮，机 床模型恢复不透明 化，在不透明情况 下点击“恢复”按
钮，机床无变化

测试结果 测试结果同预期结
果一致
测试结果同预期结 果一致
测试结果同预期结 果一致
测试结果同预期结 果一致
测试结果同预期结 果一致

49

数控机床数字孪生系统的设计与实现

续表 6.4 机床展示模块测试表

测试功能

输入/操作

机床左转

鼠标点击机床模型

往左拖拽

机床左转

鼠标点击机床模型 往左拖拽

预期结果 机床向左偏转一定 角度，释放鼠标后
保持不动 机床向左偏转一定 角度，释放鼠标后
保持不动

测试结果 测试结果同预期结
果一致
测试结果同预期结 果一致

机床右转

鼠标点击机床模型 机床向右偏转一定 测试结果同预期结

往右拖拽

角度，释放鼠标后

果一致

保持不动

机床上转

鼠标点击机床模型 往上拖拽

机床向上偏转一定 角度，鼠标释放后

测试结果同预期结 果一致

保持不动

机床下转

鼠标点击机床模型 机床向下偏转一定 测试结果同预期结

往下拖拽

角度，鼠标释放后

果一致

保持不动

功能测试全部操作过程如上述功能测试用例表格所示，系统中所设计的功能

一切正常，且针对典型的用户误操作进行了一定限制，如不能执行连续的透明化、

分解以及合并操作，但在页面跳转过程中存在 0.5s 左右的延迟，而机床配置等系

统功能模块方面不存在延迟，整体不影响用户功能方面的体验。

6.2.2 系统切削仿真功能测试 切削仿真是本系统的核心功能，同时也是本次测试的重点内容。本次测试采
用的数控机床型号为 CK0632，待加工工件毛胚的长度为 100mm，宽度为 100mm， 刀头型号为球形刀。切削仿真功能测试执行多次，单次加工流程持续两分钟，加 工内容为进行自由形状的切削，工件加工过程记录如图 6.3、图 6.4 所示。

50

第 6 章 系统测试与验证
图 6.3 工件加工图 1 Figure6.3 Workpiece processing drawing 1
图 6.4 工件加工图 2 Figure6.4 Workpiece processing drawing 2
在本次实验过程中，共得到 10 组加工数据，单次测试加工数据中延迟最高 为 53ms，最低为 32ms，平均延迟为 39ms，延迟与碰撞检测算法与布尔运算算法 的执行效率有关，延迟时间对加工结果无影响。切削仿真加工的结果符合测试需 求，工件模型与刀具模型之间碰撞时执行的碰撞检测算法与碰撞后执行的布尔算 法均正常执行，符合系统研发初期的需求。 6.2.3 系统性能测试
本次测试为性能测试，使用检测工具完成系统运行过程中性能数 据的记录， 以实验过程中记录的 CPU 使用率、内存使用量等参数的数值为基准进行考核， 性能测试时间为一小时。考核标准如下： CPU 占用量需要小于实际 CPU 总量的 40%，内存占用率需要小于实际内存总量的 30%。在本次实验中，使用任务管理 器中的资源监视器对系统进行监控，系统的整体性能测试结果如图 6.5 所示。同 时，在性能测试过程中针对关键节点的 CPU 使用数据进行监控与记录，如系统 启动时刻、进入机床配置页面的时刻、机床配置完成的时刻、工件模型与刀具模
51

数控机床数字孪生系统的设计与实现
型接触的时刻、工件模型加工完成的时刻等，并对记录结果进行绘制，各节点 CPU 使用数据监控图如图 6.6 所示。

CPU使用率

60.00%

图 6.5 资源监视器资源占用图 Figure6.5 resource usage of resource monitor

50.00%

40.00%

30.00%

20.00%

10.00%

0.00% 0 1 2 3 4 5 6 7 8 9 10 11
加工节点

图 6.6 CPU 使用率数据监控图 Figure 6.6 monitoring chart of utilization data about CPU
本小节对数控机床数字孪生系统进行了持续 1 小时的性能测试。性能测试记 录结果如下：CPU 使用率为 16%，内存使用量为 334.6MB。两者均小于前文中 的考核标准。由 CPU 使用率数据监控图显示，在一次完整的切削仿真过程中， 工件模型与刀具模型接触的时刻 CPU 使用率最高，因为此刻开始进行布尔运算； 在布尔运算开始前与布尔运算过程中，CPU 使用率均较低，与实际使用过程相

52

第 6 章 系统测试与验证
符。综上所述，数控机床数字孪生系统的运行过程中各项资源的占用率均较低， 符合测试考核标准。 6.3 本章小结
本章完成了对数控机床数字孪生系统的测试与验证，首先对系统的测试环境 进行了搭建以及对系统的测试流程进行了设计，之后以 CK0632 型号的数控机床 作为实例展开了本系统的功能、性能以及核心功能——切削仿真进行了测试，测 试结果表明系统功能可靠，运行性能良好。满足系统研发初期的需求。
53

数控机床数字孪生系统的设计与实现 54

第 7 章 总结与展望
第 7 章 总结与展望
7.1 全文总结 针对数控机床开发周期长、实际调试风险大、试切成本高、生产准备周期难
以控制等问题，本文提出了一种基于数字孪生的数控机床系统。在分析现有数控 机床数字孪生系统的基础上，对各种系统的设计与实现进行了研究，总结了各个 系统之间的优势与不足，设计了以 Unity 3D 作为开发平台，使用 MQTT 作为数 据通讯协议，完成了数控机床数字孪生系统的开发。在模型建模方面，通过分析 现有的建模方法并在总结各方法的优劣的基础上，确定了最适合本系统的建模方 法。通过对所建立的数控机床数字孪生系统的测试，从性能和功能两个方面对系 统进行了测试，证明了系统功能的有效性及安全性。本文主要工作总结如下：
（1）分析了虚拟调试技术理论的历史与发展，对数字孪生、布尔运算，3DS Max、MQTT 等技术进行了研究，确定了本文的研究方向及系统的设计目标，设 计了系统工作流程，同时完善了开发工具、通讯协议的选择以及系统开发所需要 的软件环境与硬件环境的搭建。
（2）对系统实现过程中的关键技术进行了研究，确定了工件模型与通用刀具 体模型的建模方法，以及虚拟加工过程中涉及的关键技术——碰撞检测算法、布 尔运算，完成了以 3DS Max 为主的数控机床建模方式，设计了基于 MQTT 的网 络架构，从数控机床工作人员的角度出发，对用户界面进行了设计，使其满足了 工作人员多角度多维度观察数控机床的需求。
（3）数控机床数字孪生系统的测试与验证。对数控机床数字孪生系统环境进 行集成，设计了系统测试流程，以数控机床 CK0632 为实例进行测试，对系统进 行了性能、功能测试，测试结果表明系统功能可靠，运行性能良好。满足系统研 发初期的需求。
7.2 创新点 本文设计的数控机床数字孪生系统，主要创新点如下：
（1）设计了数控机床数字孪生系统的虚拟加工方法，有效降低了数控机床实 际加工过程中带来的物料损耗，在减少材料成本的同时大大提升了加工效率。
55

数控机床数字孪生系统的设计与实现
（2）数控机床价格昂贵，通过数控机床数字孪生系统进行虚拟调试，可以保 证数控机床最大程度的应用于正式的生产加工，减少因程序设置错误或者工件加 工程序编码错误带来的误切、碰撞、宕机等事故，减少设备维修费用，提高机床 设备的使用寿命。
7.3 展望 随着技术的快速发展，工业生产与信息技术相互交融，传统工厂开始向数字
工厂进一步发展。作为工业生产和信息技术的产物，数字孪生成为了热门研究， 虽然国内部分研究人员能够熟练运用虚拟调试软件，但对于自研软件产品的需求 迫在眉睫。本文设计并实现了一种数控机床数字孪生系统用于数控机床加工前的 试切仿真，但仍然有诸多技术瓶颈有待更进一步的解决：
（1）减小软件体积。该系统虽然支持多种不同型号的设备进行虚拟调试，但 是各个数字孪生体模型之间的耦合度比较低，导致系统整体冗余较大，因此，需 要通过进一步的研究，增大设备模型之间的耦合度，减少软件体积。
（2）提升用户体验。该系统可以将增强现实技术融入进去，方便用户以一种 更直接的方式参与到数控机床虚拟调试的流程中去，同时能提高用户的交互体验。
（3）提高仿真质量。由于在模型建模的过程中未考虑切削力、振动等影响因 素，仿真结果与实际加工结果存在出入，需要进一步完善模型建模的准确度。
（4）提高切削仿真质量。经由布尔减运算完成后的工件模型，表面粗糙，后 续可以尝试在完成布尔运算后进行表面重构，对布尔运算后的工件模型表面进行 重构，提高工件的精细程度，给用户带来更好的仿真结果。
（5）提高模型建模多样性。因个人水平能力有限，在试切仿真过程中使用的 工件模型，只尝试了常见的工件模型，如长方体、棱柱体、圆柱体，考虑到工件 模型的多样性，应当对不规则工件的建模也进行完善。
56

参考文献
参考文献
于文斐.基于虚拟现实技术的碰撞检测算法综述[J].民航学报,2019,3(04):85-87+96. 马永敬,刘光俊,安帅,等.基于 CATIA 模型的自动爆炸图制作方法研究[J].机械设计与制造工
程,2020,49(03):121-124. 马 颖 化 , 李 学 成 . 基 于 试 切 原 理 数 控 车 床 对 刀 方 法 的 研 究 与 应 用 [J]. 装 备 制 造 技
术,2017(01):241-242. 王东方. 大口径自由曲面超精密车削关键技术研究[D].中国科学院大学(中国科学院长春光
学精密机械与物理研究所),2020. 王位杰.虚拟调试环境的研究.2011.重庆大学,MA thesis. 王春晓. 基于数字孪生的数控机床多领域建模与虚拟调试关键技术研究[D].山东大学,2018. 王峻峰,刘锐,谢敏,等.现场实时数据驱动的翼身制孔过程三维可视化监视研究[J].航空制造技
术,2018,61(Z1):36-41. 王 鸿 亮 , 郭 锐 锋 , 彭 健 钧 , 等 . 通 用 刀 具 扫 描 体 隐 式 曲 面 建 模 方 法 [J]. 机 械 工 程 学
报,2015,51(23):144-152. 叶佩青,张勇,张辉.数控技术发展状况及策略综述[J].机械工程学报,2015,51(21):113-120. 冯长卿,张欣露,李红伟,等.智能家电黑盒软件测试方法研究[J].家电科技,2020(05):21. 朱杰,郝婧宇,王瑞,等. 基于云技术的农气信息管理软件设计[A]. 中国气象学会.第 35 届中国
气象学会年会 S14 大数据、互联网、融媒体时代气象服务的创新与变革——第八届气 象服务发展论坛[C].中国气象学会:中国气象学会,2018:49. 刘国歌. 三维实体的布尔运算与局部造型[D].西安电子科技大学,2019. 刘建春,秦昆,林彦锋,等.双机械臂碰撞检测算法研究[J].机械传动,2021,45(01):40-44+70. 孙 常 青 , 郑 富 全, 胡代 荣, 等. 基于 云的 工业 物联 网网 关设 计与 实现 [J]. 信息 技术与信息 化,2020(12):166-168+172. 李文化,牛石从,李树鹏,等.数控机床发展趋势及发展策略分析[J].内燃机与配件,2021(01):7173. 李宝超. 基于 Digital Twin 模型的 3C 非标检测设备精益优化设计研究[D].山东大学,2018. 李 柏 松 , 王 学 力 , 王 巨 洪 . 数 字 孪 生 体 及 其 在 智 慧 管 网 应 用 的 可 行 性 [J]. 油 气 储 运,2018,37(10):1081-1087. 李 洋 . 基 于 消 息 队 列 遥 测 传 输 协 议 的 智 能 家 居 消 息 中 间 件 设 计 [J]. 计 算 机 应 用,2018,38(S1):162-164+217. 李浩,陶飞,王昊琪,等.基于数字孪生的复杂产品设计制造一体化开发框架与关键技术[J].计算 机集成制造系统,2019,25(06):1320-1336.
57

数控机床数字孪生系统的设计与实现
李家铎,林文堂. 智能制造时代陶瓷原料标准化探讨[A]. 中国硅酸盐学会建筑卫生陶瓷委员 会、国家建筑卫生陶瓷质量监督检验中心.第三届中国建筑卫生陶瓷质量大会暨中国硅 酸盐学会建筑卫生陶瓷委员会 2018 学术年会专刊[C].中国硅酸盐学会建筑卫生陶瓷委 员会、国家建筑卫生陶瓷质量监督检验中心:中国建材科技杂志社,2018:3.
李瑞杰. 基于混合现实的管网巡检系统的设计与实现[D].中国科学院大学(中国科学院沈阳 计算技术研究所),2020.
杨 石 扣 , 任 旭 华 , 张 继 勋. 基 于布 尔 运算 的 复杂 块 体 几何 形 态分 析 一般 方 法[J].岩土力 学,2016,37(12):3576-3582.
吴钱昊. 基于数字孪生车间的生产车间设备监控和设备故障预警方法研究[D].合肥工业大 学,2020.
何柳江. 基于数字孪生的数控机床虚拟交互系统设计与实现[D].电子科技大学,2019. 张代聪. 基于 OpenGL 的交互式 PLC 虚拟仿真系统[D].山东大学,2012. 张 存 吉 , 姚 锡 凡 , 张 翼 翔 , 等 . 从 “ 数 控 一 代 ” 到 “ 智 慧 一 代 ” [J]. 计 算 机 集 成 制 造 系
统,2015,21(07):1734-1743. 张佳俊,陈成,黄涛. 基于 Tecnomatix 的发动机装配生产线设计应用研究[A]. 中国汽车工程学
会（China Society of Automotive Engineers）.2018 中国汽车工程学会年会论文集[C].中国 汽车工程学会（China Society of Automotive Engineers）:中国汽车工程学会,2018:8. 张朝权,景涛.Tecnomatix 在大型发电机出线装配工艺中的应用[J].电机技术,2019(04):4446+60. 陈 天 杰 . 注 塑 模 具模腔电火 花加工自动编程及加工仿 真系统开发[D].南京航空航天大 学,2019. 陈波. 船舶结构三维建模技术研究与软件开发[D].大连海事大学,2018. 范安宇,鞠欣诚,韩凯,等.基于 MQTT 的手机设备接入和管理功能设计与开发[J].电脑编程技巧 与维护,2021(01):78-79+91. 欧阳国婧. 基于 3D MAX 的哈尔滨冰雪大世界建筑冰景设计与展示研究[D].哈尔滨工业大 学,2019. 周济,李培根,周艳红,等.走向新一代智能制造[J].Engineering,2018,4(01):28-47. 赵永利,郁小松,张佳玮,等. 软件定义光网络[M].人民邮电出版社:信息与通信创新学术专著, 201706.280. 赵 泽 宇 , 吕 健 , 潘 伟 杰 , 等 . 基 于 虚 拟 再 现 行 为 的 VR 空 间 认 知 研 究 [J]. 工 程 设 计 学 报,2020,27(03):340-348. 郝任义. 工业自动化生产线中机器人及 PLC 的集成控制研究[D].燕山大学,2018. 高 建 超 , 常 楠 楠 . 基 于 Tecnomatix 的 机 器 人 滚边 虚 拟 调 试研 究 与 应 用 [J]. 制造 业自动 化,2019,41(06):78-82.
58

参考文献
陶飞,刘蔚然,刘检华,等.数字孪生及其应用探索[J].计算机集成制造系统,2018,24(01):1-18. 董帅,李艳,王琭珉. 基于任务并行的仿真平台研究与设计[A]. 中国自动化学会系统仿真专业
委员会、中国仿真学会仿真技术应用专业委员会、中国科学技术大学.第二十届中国系 统仿真技术及其应用学术年会论文集（20th CCSSTA 2019）[C].中国自动化学会系统仿 真专业委员会、中国仿真学会仿真技术应用专业委员会、中国科学技术大学:中国自动 化学会系统仿真专业委员会,2019:4. 董叶芊.Unity3d 产品虚拟展示技术的应用研究[J].无线互联科技,2017(17):144-145. 董志刚,宋维,周新虹.基于 MQTT 协议的智慧校园多传感器融合监测系统的设计与实现[J].信 息技术与信息化,2020(11):113-116. 缪学勤.智能工厂与装备制造业转型升级[J].自动化仪表,2014,35(03):1-6. 黎柏春,杨建宇,于天彪,等.在 GPU 上实现基于高斯映射的通用刀具扫描体建模[J].计算机辅 助设计与图形学学报,2015,27(07):1334-1340. 颜秀铭. 基于虚拟交互技术的连铸自动化系统的设计与实现[D].华北理工大学,2017. Arquimedes Canedo. Industrial IoT lifecycle via digital twins[P]. Hardware/Software Codesign and System Synthesis,2016. Cichon T , Romann J . Digital Twins: Assisting and Supporting Cooperation in Human-Robot Teams[C]// 2018 15th International Conference on Control, Automation, Robotics and Vision (ICARCV). IEEE, 2018. GRIEVES M.Digital Twin: Manufacturing Excellence through Virtual Factory Replication[EB/OL].[2016-12-20]. Kahlen F J , Flumerfelt S , Alves A . Transdisciplinary Perspectives on Complex Systems[J]. 2017, 10.1007/978-3-319-38756-7(Chapter 2):25-48. Kostenko D, Kudryashov N, Maystrishin M, et al. Digital twin applications: diagnostics, optimisation and prediction[J]. Annals of DAAAM & Proceedings, 2018 Steffen Tram Mortensen,Ole Madsen. A Virtual Commissioning Learning Platform[J]. Procedia Manufacturing,2018,23. Thomas H.-J. Uhlemann,Christian Lehmann,Rolf Steinhilper. The Digital Twin: Realizing the Cyber-Physical Production System for Industry 4.0[J]. Procedia CIRP,2017,61. Tuegel E J , Ingraffea A R , Eason T G , et al. Reengineering Aircraft Structural Life Prediction Using a Digital Twin[J]. International Journal of Aerospace Engineering, 2011, 2011(16875966). VACHÁLEKJ,BARTALSKYL,ROVNY O,etal.The digital twin of an industrial production line with in the industry 4.0 concept[C]//2017 21st International Conferenceon Process Control(PC).[Sl..]:[s.n.],2017:258-262. Weichao Luo,Tianliang Hu,Chengrui Zhang,et al. Digital twin for CNC machine tool: modeling and using strategy[J]. Springer Berlin Heidelberg,2019,10(3). Yu Zheng,Sen Yang,Huanchong Cheng. An application framework of digital twin and its case
59

数控机床数字孪生系统的设计与实现
study[J]. Springer Berlin Heidelberg,2019,10(3).
60

致 谢
致 谢
时光匆匆，三年前我带着憧憬来到中国科学院大学。三年时间一晃而过，期 间有欣喜、激动、焦虑、茫然、无所适从，唯一不变的是沈阳计算所 18 级同学 的陪伴，接下来又将是一个人生新阶段，满怀欣喜，期待无比。
感谢父母的养育之恩，感谢一如既往的关爱与陪伴，在生活的方方面面，他 们是我坚实的后盾，为我提供一切需要的帮助。
感谢渤海大学在我措手不及的时候肯定我，认可我，给我机会，让我拿到了 通往研究生生活的门票。它让我明白了默默耕耘的每一个日子都将在未来大放光 彩，走过的每一个脚印都是人生的一部分。
感谢沈阳计算所在三年前认同茫然无措的我，让我有机会与全国各地数万名 优秀的大学生共同学习、一起进步，与院士们近距离交流，了解全球最新的技术 与理论。
感谢中国科学院大学在雁栖湖校区集中授课的老师们，计算机算法设计与分 析的卜老师、矩阵分析与应用的李老师、人机交互的王老师、彭老师，他们提升 了我的眼界，拓展了我的高度，他们对科研的热情、对工作的激情时刻激励着我 前进，丰富的学科理论与知识为研究生阶段的工作学习打下了基础。
感谢尽职尽责的丁老师、宁老师、张老师，感谢他们为全体师生的辛勤付出 及认真管理，为学生们的每一次进步保驾护航。
感谢雁栖湖的室友王常辉、张学震、张强、马振勇、王昊、许鹏 、吕言成， 他们在课后的答疑解惑，课余的互帮互助，为研一的生活添加了不少欢声笑语。
感谢导师郭老师，王老师。在课题的选定、系统的实验和论文的撰写过程中， 他们总是能解答我的疑问，为我提供思路和问题的解决方案、给予细致的指导。 导师们乐观开朗、积极向上的生活态度和无微不至的关心令我印象深刻，同时也 将影响我未来的为人处世。
感谢我的学长学姐张泓、王帅、张晓星、王蕾、李瑞杰、黄鹤翔，他们以自 己的经验教授于我，以他们走过的弯路指导我；感谢我的学弟学妹付超、金国梁、 李文杨、刘云江、胡丹宁、朱瑞琪舒缓了紧张的学习气氛。
感谢研究生室友张学震、杨彬彬、史小磊的包容与关心，在宿舍营造了和谐
61

数控机床数字孪生系统的设计与实现
融洽的气氛。 感谢宗学妍、顾旭、李含曦、王振阳等同学在实验室的陪伴与帮助，你们的
存在为实验室的生活增添了许多光彩。 感谢周杰伦、林俊杰、吴青峰、周深、伏仪等众多优秀的歌手，你们的音乐
作品是一种有声的力量，支持我走过每一个独处的日子。 感谢哔哩哔哩、慕课网、腾讯课堂提供的海量的学习资源，助力我每一个求
知的日子。 感谢自己在困难、无助的时候没有轻易尝试放弃。 最后，感谢审阅本文的老师们，向你们致以最衷心的感谢。 祝所有老师和同学在未来的生活中工作顺利，学习进步，前程似锦，牛气冲
天！
于中国科学院大学沈阳计算技术研究所 2021 年 3 月
62

作者简历及攻读学位期间发表的学术论文与研究成果
作者简历及攻读学位期间发表的学术论文与研究成果
作者简历： 2014 年 09 月——2018 年 06 月，在渤海大学软件科学与技术院（系）获得学士 学位。 2018 年 09 月——2021 年 06 月，在中国科学院大学沈阳计算技术研究所攻读硕 士学位。 获奖情况： 工作经历： 已发表（或正式接受）的学术论文：
Design and Realization of Cutting Simulation Function of Digital Twin System of CNC Machine Tool. （已录用，第一作者）
参加的研究项目及获奖情况：
63

