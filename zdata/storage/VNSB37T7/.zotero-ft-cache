分类号 UDC 注 1

密级

硕士专业学位论文

数据驱动的数字孪生模型
构建与在线监控应用
（题名和副题名）
杜宏祥
（作者姓名）

指导教师姓名
学 位 类 别 学 科 名 称 研 究 方 向 论文提交时间

徐骏善

副教授

金自力

工程硕士

工业工程

制造业信息化

2018.12

注 1：注明《国际十进分类法 UDC》的类号。

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

摘 要
近年来，随着先进信息与计算机技术的发展，智能化是制造业发展的必然趋势。然 而，智能制造的实践过程始终面临一个瓶颈问题——数字空间与物理空间的交互与融合， 由此提出了数字孪生的解决方法。数字孪生技术目前仍处于理论研究，对其的应用实践 仍处于探索阶段。因此，对数字孪生技术在生产中的应用研究对智能制造的发展具有十 分重要的意义。
首先，本文在分析了数字孪生技术在生产线中的应用现状后，对本课题项目的数字 孪生系统进行了需求分析，基于需求分析提出了系统总体运行原理和功能结构，并提出 了本课题需解决的三个关键技术。然后针对本课题生产线的功能现状，对生产线中的各 种功能模型进行了数字孪生建模；针对数字空间与物理空间的数据交互问题，设计了 OPC UA 技术的系统通讯网络架构，对 UA 服务器进行了源数据集成与建模，并开发了 数据服务程序；针对数字空间对物理空间的数据驱动映射问题，利用数据通讯网络沟通 了数字空间与物理空间，利用实时数据驱动了孪生模型对实体的实时映射，并对数字空 间中的关键数据进行了数据统计与存储。
最后，在课题的项目中，对整个系统进行了实现与验证，并对主要成果进行了展示。

关键词：数字孪生，建模，通讯，实时映射

I

Abstract

Abstract

硕士学位论文

In recent years, with the development of advanced information and computer technology, intellectualization is the inevitable trend of the development of manufacturing industry. However, the practice of intelligent manufacturing always faces a bottleneck problem, that is, the interaction and integration of digital space and physical space. Digital twin technology is still in theoretical research, and its application is still in the exploratory stage. Therefore, the research on the application of digital twin technology in production is of great significance to the development of intelligent manufacturing.
Firstly, after analyzing the application status of digital twin technology in production line, this paper carries out requirement analysis on the digital twin system of the application project of this subject. Based on requirement analysis, the overall operation principle, function structure of the system, and three key technologies to be solved are put forward. Secondly, according to the function status of the production line, the digital twin model of various functional models in the production line is built. Aiming at the problem of data interaction between digital space and physical space, the system communication network architecture of OPC UA technology is designed, the source data integration model of UA server is built, and the data service program is developed. Driving mapping problem, using data communication network to communicate the digital space and physical space, using real-time data to drive the twin model real-time mapping of entities, and data statistics and storage of key data in the digital space.
Finally, in the project of the subject, the whole system is implemented and validated, and the main results are displayed.

Key words: Digital twin, modeling, communication, real-time mappin

II

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

目 录
摘 要 ............................................................................................................. I Abstract ............................................................................................................. II 目 录 ............................................................................................................ III 图表目录 .......................................................................................................... VI 1 绪论 ................................................................................................................. 1
1.1 研究目的和意义 ......................................................................................................... 1 1.2 国内外研究现状分析 ................................................................................................. 1
1.2.1 数字孪生的发展 ............................................................................................... 1 1.2.2 产品数字孪生的研究现状 ............................................................................... 3 1.2.3 生产系统数字孪生的研究现状 ....................................................................... 4 1.3 课题背景与主要研究内容 ......................................................................................... 5 1.3.1 课题来源与背景 ............................................................................................... 5 1.3.2 论文主要研究内容及框架 ............................................................................... 5 1.4 本章小结 ..................................................................................................................... 6
2 总体方案设计 ................................................................................................. 7
2.1 生产线现状分析 ......................................................................................................... 7 2.2 数字孪生构建及在线监控需求 ................................................................................. 9 2.3 数字孪生应用方案 ..................................................................................................... 9
2.3.1 系统功能原理 ................................................................................................... 9 2.3.2 系统功能模块设计 ......................................................................................... 10 2.4 关键技术 ................................................................................................................... 12 2.4.1 数字孪生建模技术 ......................................................................................... 12 2.4.2 多源异构数据处理技术 ................................................................................. 12 2.4.3 孪生模型实时映射技术 ................................................................................. 13 2.5 本章小结 ................................................................................................................... 13
3 数字孪生建模 ............................................................................................... 14
3.1 孪生模型建模需求 ................................................................................................... 14 3.2 建模环境简介 ........................................................................................................... 16 3.3 功能模型的构建 ....................................................................................................... 18
3.3.1 产品和托盘建模 ............................................................................................. 18 3.3.2 作业设备建模 ................................................................................................. 19
III

目录

硕士学位论文

3.3.3 物流设备建模 ................................................................................................. 24 3.3.4 仓储设备建模 ................................................................................................. 27 3.3.5 虚拟服务组件 ................................................................................................. 28 3.4 生产线模型的构建 ................................................................................................... 31 3.4.1 生产线工艺流程 ............................................................................................. 31 3.4.2 模型的连接处理 ............................................................................................. 32 3.5 本章小结.................................................................................................................... 35
4 多源异构数据处理 ....................................................................................... 36
4.1 数字孪生通讯需求 ................................................................................................... 36 4.2 OPC UA 技术 ............................................................................................................ 37 4.3 系统通讯网络架构 ................................................................................................... 38 4.4 通讯模块的设计与实现 ........................................................................................... 39
4.4.1 UA 服务端的设计与实现 ............................................................................... 39 4.4.2 数字空间的数据通讯 ..................................................................................... 46 4.4.3 数据服务平台的设计 ..................................................................................... 48 4.5 本章小结 ................................................................................................................... 50
5 孪生模型实时映射 ....................................................................................... 52
5.1 孪生系统虚实交互结构 ........................................................................................... 52 5.2 实时映射的实现 ....................................................................................................... 53
5.2.1 数字空间层次结构 ......................................................................................... 53 5.2.2 驱动数据逻辑配合 ......................................................................................... 53 5.3 数字空间数据处理 ................................................................................................... 55 5.3.1 数据统计与可视化 ......................................................................................... 55 5.3.2 数据存储 ......................................................................................................... 57 5.4 以虚控实的实现方法 ............................................................................................... 58 5.5 本章小结 ................................................................................................................... 59
6 系统实现与应用 ........................................................................................... 60
6.1 数字孪生系统实现过程 ........................................................................................... 60 6.2 应用结果展示 ........................................................................................................... 60 6.3 本章小结 ................................................................................................................... 64
7 总结与展望 ................................................................................................... 65
7.1 工作总结 ................................................................................................................... 65 7.2 工作展望 ................................................................................................................... 65
致 谢 ........................................................................................................... 67
IV

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

参考文献 ........................................................................................................... 68 附 录 ........................................................................................................... 72

V

图表目录

硕士学位论文

图表目录
图 2.1 生产线布局图 ............................................................................................................. 7 图 2.2 生产线现场图.............................................................................................................. 7 图 2.3 制造平台数据流图...................................................................................................... 8 图 2.4 数字孪生系统运行原理............................................................................................ 10 图 2.5 数字孪生系统功能模块............................................................................................ 11 图 3.1 VC 建模模块界面 ..................................................................................................... 17 图 3.2 VC 通讯模块界面 ..................................................................................................... 17 图 3.3 产品和托盘模型 ....................................................................................................... 19 图 3.4 D-H 参数原则............................................................................................................ 20 图 3.5 装配线上下料机器人模型........................................................................................ 21 图 3.6 上盖装配设备的运动机构和正反解脚本 ............................................................... 23 图 3.7 AGV 及其虚拟控制器模型 ...................................................................................... 25 图 3.8 上下料输送装置 ....................................................................................................... 26 图 3.9 立体仓库和堆垛机 ................................................................................................... 27 图 3.10 脚本服务程序 ......................................................................................................... 29 图 3.11 AGV 消息结构......................................................................................................... 30 图 3.12 仓储消息结构 ......................................................................................................... 30 图 3.13 生产线模型与工艺流程 ......................................................................................... 31 图 3.14 生产线工艺流程 ..................................................................................................... 32 图 3.15 模型连接与验证方案 ............................................................................................. 33 图 3.16 模型信号连接与交互 ............................................................................................. 34 图 3.17 生产线各工位工时 ................................................................................................. 34 图 3.18 生产线模型和信号连接 ......................................................................................... 35 图 4.1 生产车间底层数据类型 ........................................................................................... 37 图 4.2 OPC UA 信息建模框架 ............................................................................................ 38 图 4.3 数字孪生系统通讯网络架构 ................................................................................... 39 图 4.4 OPC UA 服务端架构 ................................................................................................ 40 图 4.5 NI OPC Servers 软件................................................................................................. 41 图 4.6 对象和基本节点模型 ............................................................................................... 42 图 4.7 地址空间节点类 ....................................................................................................... 42 图 4.8 生产线数据地址和功能 ........................................................................................... 43
VI

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

图 4.9 Air 10P 型机器人数据模型....................................................................................... 44 图 4.10 装配上盖设备数据模型 ......................................................................................... 44 图 4.11 数控磨床数据模型 ................................................................................................. 45 图 4.12 传送带和上下料设备数据模型 ............................................................................. 45 图 4.13 Air 机器人地址空间组织形式................................................................................ 46 图 4.14 软件通讯接口.......................................................................................................... 47 图 4.15 创建订阅变量对 ..................................................................................................... 48 图 4.16 数据服务功能原理 ................................................................................................. 49 图 4.17 数据服务程序 ......................................................................................................... 50 图 4.18 服务器数据订阅与存储 ......................................................................................... 50 图 5.1 孪生系统虚实交互结构 ........................................................................................... 52 图 5.2 数字空间数据驱动逻辑结构 ................................................................................... 54 图 5.3 模型统计属性列表 ................................................................................................... 56 图 5.4 统计数据可视化........................................................................................................ 57 图 6.1 系统工作流程............................................................................................................ 61 图 6.2 生产线孪生模型 ....................................................................................................... 61 图 6.3 实时交互变量连接 ................................................................................................... 62 图 6.4 管控中心成果展示 ................................................................................................... 63 图 6.5 上下料+装配工位..................................................................................................... 63 图 6.6 工位虚拟显示屏数据可视化 ................................................................................... 64 图 6.7 全局统计数据 ........................................................................................................... 64

表 3.1 生产线设备功能与驱动数据 ................................................................................... 15 表 3.1（续） 生产线设备功能与驱动数据 ....................................................................... 16 表 3.2 产品和托盘模型信息................................................................................................ 19 表 3.3 工业机器人控制器参数 ........................................................................................... 21 表 3.4 机器人模型信息........................................................................................................ 22 表 3.5 加工设备模型信息.................................................................................................... 24 表 3.6 数控磨床模型信息.................................................................................................... 24 表 3.7 AGV 模型信息 .......................................................................................................... 25 表 3.8 传送带模型信息........................................................................................................ 26 表 3.9 上下料输送装置模型信息........................................................................................ 26 表 3.10 立体仓库模型信息.................................................................................................. 28 表 3.11 软件内部虚拟服务组件和功能 ............................................................................. 29
VII

图表目录

硕士学位论文

表 3.12 虚拟服务组件和功能 ............................................................................................. 31 表 5.1 数字空间关键统计数据 ........................................................................................... 56

VIII

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

1 绪论
1.1 研究目的和意义
近年来，为了实现智能制造，各国先后提出了工业 4.0、工业互联网、中国制造 2025 以及 EU H2020 MAYA 计划等先进制造战略或模式。同时，物联网、大数据、云计算以 及人工智能等先进信息与计算机技术的发展为智能制造的实现提供了强有力的支撑。然 而智能制造的实践过程始终面临一个瓶颈问题——信息空间与物理空间的交互与融合， 由此提出了数字孪生的解决方法[1]。数字孪生（Digital Twin, DT）是充分利用物理模型、 传感器、运行历史等数据，集成多学科、多物理量、多尺度的仿真过程，通过在数字空 间中对实现对实体空间的映射，反映相对应的实体装备和产品的全生命周期过程[2]。数 字孪生系统本质上是一个由物理实体与孪生模型结合成的、可进行连续过程控制优化的 功能系统[3]，因此数字孪生也成为信息物理系统（Cyber-Physical Systems，CPS）的核心 技术之一。
早期生产制造的要素管理、活动计划和过程控制仅限于物理空间。随着计算机和信 息技术的发展，生产制造的数字空间诞生并不断发展。然而目前的自动化系统，如制造 执行系统（MES）、数据采集与监视控制系统（SCADA）和企业资源计划（ERP）系统 等，对生产现场数据的利用大多为形成文字或动画形式的监管与控制或者作为历史追溯 记录等，往往造成数字空间与物理空间的信息孤岛化，并未用来实现物理与数字空间连 续、实时的交互和融合。而随着数字孪生技术的兴起，学者纷纷开始探索其在产品全生 命周期的应用，并提出了构建数字孪生车间（DTS）等新概念[4]。利用仿真平台构建基 于生产现场数据驱动的数字孪生模型；利用有效的通讯方式和标准数据格式进行物理空 间与数字空间的实时通讯；利用管控技术管理信息的实时上下行与过程控制。由此建立 的生产数字孪生系统可以实现数字空间中孪生模型与物理空间中实体设备的实时映射 与交互，为管理层提供了远程监控、生产过程控制与优化、大数据分析等功能服务，对 智能制造的实现起到推进性作用。
1.2 国内外研究现状分析
1.2.1 数字孪生的发展
NASA(National Aeronautics and Space Administration)在其阿波罗项目中最早提出了 “孪生体”的概念。它们制造了两个完全相同的飞行器，其中一个孪生体（Twin）用来在 地面上精确映射执行任务的飞行器的工作状态，从而辅助航天员在太空中的作业。2003 年，Michael Grieves 教授提出了“物理产品的数字化表达”概念，其具备了数字孪生中
1

1 绪论

硕士学位论文

物理空间、数字空间以及两者之间的关联和接口的所有组成要素，由此被认为是数字孪 生体的雏形[5]。2011 年，美国空军实验室为了解决未来复杂环境下的飞行器维护及寿命 预测问题，提出了数字孪生体的概念并促使其进一步发展。2012 年，他们提出了创建飞 行器机体数字孪生体作为正在制造和维护的机体的超写实模型，用来对真实机体进行数 字化的诊断和分析。此时，数字孪生从概念模型阶段初步的进入实践与应用阶段，对其 性质和内涵的描述和研究也更加深入，突出了数字孪生体的层次性、集成性、超写实性、 广泛性、一致性和可计算性。同年，他们和 NASA 合作并共同提出了在未来构建飞行器 的数字孪生体范例[6]。但由于当时的科学技术水平、学术氛围和社会需求等问题，数字 孪生的概念并未得到足够的重视。
近几年，随着相关技术的快速发展与成熟，数字孪生重新进入了人们的视野并获得 了世界范围内的高度关注。其技术支撑在于：
（1）CAE 软件、工业仿真软件的功能日益成熟，网格简化技术、MBD 等数字化建 模技术的广泛应用，使得在虚拟空间数字化表达产品全生命周期的演变及物理设备、乃 至整个生产系统运作成为了可能。
（2）物联网、工业互联网、大数据等现代通信与信息技术为现场数据获取与数据传 输提供了支持。
（3）高性能 GPU、并行分布式计算、云计算等计算机科学技术为海量数据信息的 高效处理提供了支持。
（4）人工神经网络、机器学习等人工智能的优化算法可以有效对生产系统惊醒管 控、优化、诊断与预测，促进了生产系统的智能化与自治能力。
这些科学技术及学术研究的蓬勃发展使得数字孪生技术的应用实现成为了可能。而 在另一方面，由于目前工业界的数据断层很多，从设计到制造、装配和检验过程中数字 量的连续流动仍然存在许多的断点需要打通。而数字化研制各环节的流动也是单方向的， 并且在各环节中存在大量的瓶颈，阻碍了企业级信息化的效果。由此，伴随数字孪生发 展的另一个重要技术——数字主线(Digital Thread)，也在世界范围内兴起。数字主线是 指利用先进建模和仿真工具构建的，覆盖产品全寿命周期与全价值链，从基础材料、设 计、工艺、制造以及使用维护全部环节，集成并驱动以统一的模型为核心的产品设计、 制造和保障的数字化数据流[7]。
对于数字孪生，数字主线是既与其有所区别，又相互关联的概念。数字孪生旨在对 产品、设备等进行数字化的表达，以便在虚拟空间内通过数字模型间接观测到物理实体 的状态、动作等要素，再进一步通过虚拟映射对实体空间进行优化反馈，最终实现虚拟 空间与实体空间的闭环交互、迭代优化。而数字主线正是实现系统中标准数据流动的方 法。利用数字主线，在产品设计、制造、检测的全生命周期中，数字孪生模型的参数可 以传递到产品定义的多维几何模型中，再传递到数字化生产线加工成真实的物理产品，
2

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

在生产过程中通过在线的数字化检测与测量系统反馈到产品的孪生模型中，进而又反馈 到仿真分析模型中。其中所有的数据模型都能够双向沟通，因此真实物理产品的状态和 参数将通过与智能生产系统集成的赛博物理系统 CPS 向数字化模型反馈，致使生命周 期各个环节的数字化模型保持一致，从而能够实现动态、实时评估系统的当前及未来的 功能和性能。而装备在运行的过程中，又通过对不断增加的传感器、设备的联接而收集 到的数据进行解释利用，可以将后期产品生产制造和运营维护的需求融入到早期的产品 设计过程中，形成设计改进的智能闭环。
近几年，随着世界范围内智能制造的兴起，国内外学者和企业纷纷探索数字孪生技 术在各个领域的应用，并取得了一定的成果。而目前数字孪生技术在生产中的应中主要 体现在产品数字孪生和生产系统数字孪生两个方面。
1.2.2 产品数字孪生的研究现状
孪生模型的构建依托于仿真软件，而世界上的主流仿真软件公司纷纷开始进行探索。 西门子为了建立更加完整的数字孪生模型体系，近年来研发和整合了质量管理、生产计 划排程、制造执行、仿真分析等各领域领先厂商和技术，支持企业进行涵盖其整个价值 链的整合及数字化转型。达索公司推出了 3D experience 平台，具有多套行业解决方案， 可服务于工业、交通、航空航天等 12 个行业。平台中包含了 3D 建模应用程序、内容与 仿真应用程序、智能信息应用程序和社交协作式应用程序，以实现 3D 设计、工程、CAD、 建模、仿真、数据管理和流程管理，帮助客户以数字方式重塑先进产品开发与制造的方 法，助力数字孪生的发展[8]。
数字孪生技术在产品的应用本质上是 MBD（Model Based Definition）技术的进一步 发展。于勇据此提出了一种将产品构型信息融入数字孪生模型中的解决方案[9]，通过构 建包含构型数据的数字孪生模型本体表达方法，使得产品本体的构型数据与孪生模型关 联在一起，在产品设计中的技术参数也同样可以建立起联系，为实现产品全三维研制下 孪生模型驱动的构型数据快速响应和追溯提供了理论支持。在产品的物理特征建模方面： Soderberg 研究了产品孪生模型中几何因素的功能和数据模型的建立概念，使产品几何 特 征 融 入 孪 生 模 型 ， 为 产 品 在 生 产 加 工 过 程 中 的 几 何 特 征 的 保 障 提 供 了 依 据 [10] 。 Benjamin Schleich 利用 Skin Model Shapes 的技术理念提出了反应产品物理特性的参考 模型[11]，该参考模型使得概念模型与针对数字孪生的虚拟表示之间能够清楚地区分，还 简述了该参考模型在几何变化管理中的应用，为产品数字孪生提供了一种理论和概念框 架。对产品制造而言，增材制造是一种特殊的制造方法，其生产零件的性能受其几何形 状、微观结构和缺陷的影响，这些重要的属性目前大都是通过试验和错误来优化，因为 重要的过程变量目前不能根据科学原理提取。由此，G.L. Knapp 将数字孪生技术应用到 增材制造，提出了反应产品速度场、温度场、固话参数等物理特性的模型框架，此项研

3

1 绪论

硕士学位论文

究的未来实现将大大缩减增材制造的研发周期并减少研发经费[12]，使增材制造的知识库 以实用的方式拓展开来。
相对而言，数字孪生对于产品的应用最早也最成功的是在航空航天领域，由于航空 航天机体是一项庞大的生产和管理过程，从产品的设计、生产到运行中的管理和运维都 具有十分重要的意义。传统对机体全生命周期的服务一般依赖于确定性物理模型和地面 检查，这造成了很大程度上的困难并且效率低下。近些年里，NASA 通过构建飞行系统 的孪生模型，研究了基于数字孪生的复杂系统故障预测与消除方法，并应用在各种飞行 系统的健康管理中[13]。Eric 提出了预测飞机结构寿命和结构完整性的数字孪生概念模型 [14]。Chenzhao Li 提出了通过动态贝叶斯网络构建机翼的健康监测与预测的数字孪生模 型，美国空军正在对其理论进行实际应用验证[15]。D.Iglesiast 使用数字孪生方法构建喷 气式飞机偏滤器孪生模型，在准备、调试和运行阶段，对数字孪生组件进行虚拟测试[16]。
可见，当需要对复杂操作条件下的产品进行实际评估时，数字孪生技术增强了现有 系统的传统工程分析工作流。在准备、调试和操作阶段，可以通过使用验证的孪生模型、 操作专家和实验数据库来虚拟地测试组件。

1.2.3 生产系统数字孪生的研究现状

对于制造系统而言，要根据生产制造的需求构建不同功能的孪生体，再将其有机的 结合起来。早在 2015 年，美国通用电气公司便计划构建发动机的数字孪生体，采用大 数据、物联网和云平台等先进信息技术，实现对发动机的实时监控、及时检测和预测性 维护。
在理论层面，陶飞等业界不同领域的学者围绕产品的全生命周期，总结出数字孪生 应用的一些准则。基于此类准则探索并提出了数字孪生驱动的 14 类应用的初步概念， 全面覆盖了产品层、车间层和企业层的应用[16]，为数字孪生的更一步研究与应用奠定了 基础。其中对于车间层，陶飞等人提出了数字孪生车间（Digital Twin Workshop）的概念 模式，从理论分析提出了其系统组成、运行机制、特点和关键技术等更深层次的实现方 法。并就以数字孪生数据驱动的物理车间与虚拟车间的交互与融合进行了探讨和总结， 分别对车间实体、虚拟、服务和数据四部分的实现做了理论探索。为数字孪生技术在智 能制造车间中的应用和实现提供了理论和方法参考。
而在车间级的实际应用中，德国的罗伊特林根商学院已经建立了基于云和 app 应用 程序的数字孪生工厂原型——ESB Logistics Learning Factory，它建立在动态的、多维的 数据和信息模型之上，通过软件代理和定位系统集成了标准化语言的机器人控制系统[18]。 国内的张新生对基于数字孪生的车间管控系统的关键技术进行了研究，主要基于数字孪 生重构了车间管控系统，给出了数字孪生车间的实现思路，并采用了适度超前的信息技 术对系统关键组成部分进行了设计[19]。张琦等人提出了面向复杂产品装配车间的数字孪

4

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

生智能生产管理与控制框架，并详细阐述了该框架中通讯、数字孪生建模、大数据预测 和生产管控四项关键技术的实现方法，并在卫星的装配车间进行了初步应用[20]。
除了上述对系统级的应用研究，对实现数字孪生的各种技术也有一定的研究进展。 为了实现建模与通信的通用化，Greyce 提出了基于 AutomationML 的数字建模方法和一 种通用数据交互方法[21]，该方法将需要交换的数据放在一个中间模块中，数字孪生系统 中的任何部分都可以访问这个模块进行数据交换。Delbrugger 就虚拟工厂中人员、机器 人的运动路径问题提出了一种基于信息模型的虚拟工厂空间位置和导航的框架[22]，。在 数字孪生设备的构建上：T. DebRoy 等人针对 3D 打印制造结构性能良好的部件的耗时 与高成本，提出了构建 3D 打印机孪生模型的理念[23]，虽然想要实现还需很多工作要做， 但未来其可以有效降低实验所花费的时间。西门子根据自己的控制技术研发了对应的虚 拟的 NC 内核，构建了可以仿真和试运转的数控机床数字孪生体，可以利用其对数控程 序和复杂运动序列提前进行虚拟测试与验证。数字孪生数控系统在执行数控程序时，可 以识别程序和序列中的错误、发现加工过程中的碰撞等问题、确定程序运行时间、分析 加工过程，这样可以在数字空间中对数控程序进行验证与优化，提高实体数控机床后续 加工的精确度和可靠性，提高更换产品的效率。
从以上研究现状可以看出，目前数字孪生技术在产品和生产系统的应用实践尚处于 理论与探索阶段，同时目前建模分析软件对二者的支持往往是单方面的，其中探索数字 孪生在生产系统中的应用是本课题的主体研究内容。

1.3 课题背景与主要研究内容

1.3.1 课题来源与背景
课题依托于天津某公司的智能制造示范线的项目，是其赛达智能制造综合运营平台 构造中的重要一环，包括仓储区、制造加工区、装配工位、质量检测工位、成品测试工 位和物流输送系统（AGV 及线体托盘输送），可以实现电子产品的全自动化生产。
根据智能制造的需求，现需要根据生产线自动化系统建立其对应的数字孪生系统。 这样可以在生产过程中实现数字孪生系统对物理系统的实时映射，打破管理层与生产现 场的信息壁垒，实现过程监控、孪生数据的统计与存储等功能，增强整条生产线的灵活 性，同时利用在虚实交互过程中产生的大规模孪生数据为大数据分析提供支持。
1.3.2 论文主要研究内容及框架
全文共有七章，各部分内容及组织结构如下： 第一章：通过分析，引出研究的必要性与可行性；分析现状进行综述；介绍了论文 的组织结构安排。

5

1 绪论

硕士学位论文

第二章：进行总体方案设计，用于指导后续的工作与研究。在对课题的应用企业的 生产线进行现状分析以及生产业务分析后，确定孪生模型的建立目标以及所应具备的必 要功能。然后对总体进行设计与描述，并对关键技术进行梗概。
第三章：根据生产线实体设备三维模型，构建了关键设备孪生模型，通过脚本开发 实现相应的虚拟服务功能。在此基础上，根据实际生产线工艺流程对虚拟生产线进行连 接处理并建立了通讯控制信号接口，为实时映射的实现提供支撑。
第四章：利用 OPC UA 技术对现场多源异构数据进行服务器获取与数据建模，以驱 动孪生模型的实时映射，同时开发数据处理软件实现对孪生数据的存储与回溯。
第五章：建立数字空间与现场数据服务器的实时通讯，将虚拟生产线的逻辑与实际 生产线对应起来，利用实时数据驱动虚拟生产线运行。对虚拟车间的孪生数据进行有效 的数据统计、可视化与存储，为后续的利用提供支撑。
第六章：对本课题的实际项目的应用实现与成果进行介绍和展示。 第七章：对论文研究工作进行总结，提出需要改进的部分，为后续研究指明方向。

1.4 本章小结

本章介绍了本论文的研究背景及课题的研究意义；接着，概述了数字孪生技术的发 展与目前国内外的研究与应用现状；然后介绍了本课题的来源背景以及任务要求；最后 介绍了论文的组织架构和各章大致内容。

6

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

2 总体方案设计
2.1 生产线现状分析
本课题应用项目——赛达智能制造平台的功能为 RFID 阅读器产品的加工、装配与 检测，其核心的生产线由如图 2.1 所示的立体仓库、AGV 物流、加工区和装配区四个部 分组成，图 2.2 为生产线的核心装配区的现场图。整个综合应用平台向下整合硬件资源、 向上承载软件应用，包含基础数据采集、设备互联互通、数据分析、生产资源优化等功 能。生产线中控室模块主要由大屏幕和系统工作站组成，负责对生产系统管控以及对生 产关键监控数据进行综合监控。

图 2.1 生产线布局图

图 2.2 生产线现场图
7

2 总体方案设计

硕士学位论文

整个平台的数据流如图 2.3 所示：仓库管理系统（WMS）负责原材料和零部件的出

库和成品的入库调度；AGV 负责零部件和产品在仓储、加工和装配区间的流动，其中仓

储和加工区使用一种托盘，装配区的物流使用另一种样式的托盘，这些托盘尺寸精度一

致，在各个工位之间流通，避免由于多次抓取产品影响生产线效率，或由于工位之间衔

接失误，造成停线；数字加工中心实现对来料的加工，为装配工作做前期的准备；装配

线完成生产线的核心装配与检测工作，其中经过多道工序完成最终产品的装配、验证及

质量检测。整个系统的调度核心为 MES（制造执行系统），ERP（企业资源计划）等生

产管理层下达的任务由 MES 进行解析，进而控制车间的生产调度，并将数据采集系统

的生产数据回馈给上层，起着承上启下的核心作用。

订单状况 大数据

工业 云平台

订单需求
物料信息 出库信息 库位信息

ERP
订单信息 生产信息 故障信息

完成信息 故障信息 质量信息

MES

出库完成信息

WMS

库存信息 成品入库信息

库位信息 出库信息 材料信息

成品入库 库存信息
运输信息

加工信息 物料信息

完成信息 加工数据 质量信息

原材料信息

完成信息 检验信息 生产效率 设备运行数据
产品信息 装配信息 生产参数

数字 仓储

到位信息 AGV
产品信息

数字 成型

数字 装配

图 2.3 制造平台数据流图

目前整个生产系统实现了全自动化无人生产，但在智能生产制造需求下，为了进一

步实现生产系统数字空间和物理空间的交互和融合，当前主要存在以下几方面的问题：

（1）构建真实数字模型：生产线中的加工设备、AGV、立体仓库和机器人等装备

由不同的厂商提供，各种设备的功能大多是定制化的，设备间的通过复杂的逻辑连接构

成了生产系统。因此生产线的复杂度比较大，缺少刻画和反映物理系统真实行为、约束、

规则等的数字模型，从而难以实现数字空间对物理空间的真实映射。

（2）物联与数据集成：生产线中各种设备和管理软件的通讯接口、协议、标准等有

很大差距，缺乏多源异构要素的全面互联互通，这为底层设备与上层系统同层间和跨层

间的实时数据通讯造成了较大的困难。传统的通讯方式构建困难且不具有通用性，难以

实现大批量多源数据的实时通讯，无法满足智能制造的需求。

（3）生产运行管控：当前对生产过程监控的可视化程度低，停留在传统的数据监控

和摄像头监控阶段，对很多环节缺乏必要的监测手段，生产中的很多数据也难以被有效

8

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

的统计与存储。同时由于信息—物理数据的融合性差，导致生产管理的过程中数字空间 和物理空间的信息不同步，难以获得全面的生产运行数据以供分析利用，因此生产的智 能化程度提升困难。
由此可见，当前生产线中的信息物理融合不足，导致当前生产过程的智能化程度不 高，难以形成快速、实时、精确的产品全生命周期生产监控与控制。本课题将数字孪生 技术应用到生产系统中，实现数字孪生系统的部分关键功能。

2.2 数字孪生构建及在线监控需求

针对生产线中管理层和现场之间的信息孤岛问题，现需要利用数字孪生技术在数字 空间中构建生产线数字孪生模型，并利用实时数据与物理空间进行对接，实现生产线模 型对实体运行状况的真实映射，为后续的孪生模型优化并反控实体提供支撑。
根据本课题生产线的现状，实现其数字孪生构建及在线监控的需求有如下几个点： （1） 在数字空间中构建生产线的真实数字模型，可以对生产线中设备/产品的状态、 生产行为活动和运行逻辑关系进行真实的刻画，实现包括立体仓库的库存状态与堆垛机 货物调度、AGV 的物料运送、机器人的上下料、装配线的装配/检测和产品的全生命周 期演变等； （2）对生产系统中各种设备和系统的多源数据进行有效的集成，建立高效灵活的 系统数据通讯网络，为数字空间和其他系统提供生产线中 100 个以上的实时数据源，确 保数据时延在 60ms 以内，满足实时通讯的要求，为孪生数据的处理和存储提供支撑； （3）孪生模型在生产线实时数据的驱动下实现对现场的同步映射，实时反应生产 线生产情况，包括产品装配过程、仓储状态、物流状态和生产信息等。可通过数字空间 对生产过程进行数据统计分析与存储，给上层管理者提供全方位、多角度的生产活动监 控和信息可视化服务，并为未来的反向生产管控奠定基础。

2.3 数字孪生应用方案

2.3.1 系统功能原理
生产线是一个多技术的复杂组织体，根据未来发展的需求，结合当前生产系统的现 状，提出了如图 2.4 所示的数字孪生生产线的运行原理。整个系统由物理生产线、孪生 生产线、服务系统和孪生数据四个部分组成：物理生产线是真实存在的实体，与传统的 生产系统相比，未来智能制造的生产线应该具有更高效、更灵活的多源异构数据接入与 融合方式，为与其它模块的互联互通提供支撑，同时应当具备对全要素感知与共融的能 力；孪生生产线是对实体真实映射，融合了模型、规则、行为、逻辑关系等要素，目的 是刻画出真实反应物理生产线的孪生模型；服务系统是以数据驱动的各类生产服务系统
9

2 总体方案设计

硕士学位论文

的集合，负责为生产活动提供各种支持和服务；孪生数据是整个系统交互运行中产生的 数据，是整个数字孪生系统运行的血液。
该数字孪生系统的运行原理为：在生产系统运行时，服务系统根据生产计划控制物 理生产线进行真实的生产活动；同时，孪生生产线根据实体的实时数据对生产运行进行 实时映射；未来可以将分析计算的结果反馈给服务系统，实现对生产过程的报警、管控 优化与预测分析。
实时映射

孪生生产线

实时 数据

孪生数据

分析结果 反馈

物理生产线

实时数据 实时管控

服务系统

产出

生产任务

图 2.4 数字孪生系统运行原理

2.3.2 系统功能模块设计

根据图 2.4 所提出的数字孪生系统原理，进一步提出了如图 2.5 所示的数字孪生生 产线系统功能模块，将整体划分为物理实体、孪生模型、服务系统、孪生数据和连接[4] 五个模块。
（1）物理实体 物理实体是数字孪生技术实现的基石，主要包括设备、产品、工装、传感器、环境 等等，它们通过各种先进技术的有机结合，实现对产品的加工、装配及检测等生产活动。 而随着信息化和智能化技术的发展，未来需要具有数据采集、数据传输、自我感知及自 我决策与优化等功能。 （2）孪生模型 孪生模型的构建是数字孪生技术的核心。孪生模型是对生产现场的数字化重建，旨 在数字空间内映射实体空间的生产活动，其中包括虚拟空间的各类模型、规则、知识等。 孪生模型以物理实体的功能做相对应的开发，满足对应的需求，并对虚实交互控制建立

10

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

相应的通讯控制接口。 （3）服务系统 服务系统除了提供生产过程管控、设备健康管理等传统生产服务外，可以利用生产
线孪生模型实现在数字空间内生产实时映射，对生产现场进行多角度的实时监控。虚实 交互过程统计得到的孪生数据可进行可视化展示且为后续的分析利用提供了支撑。

ERP 服
务 MES
系
统 WMS

生产管控 三维生产过程
监控 孪生数据监控

… …
… …

交互

数据 上行

反馈 驱动

孪 生 数 据
数据库

数据处理平台 数据存储 数据挖掘 数据计算 数据转换

交互

数据 采集

作业 指令

工控机

物

理

PLC

生

单片机

产

线

RFID、传感器

机器人 设备 AGV 立体仓库

生产活动

驱动 数据

统计 数据

机器人模型

孪

设备模型

生

模

AGV模型

型

立体仓库模型

功能模型 虚拟服务 数据驱动

映射 连接
图 2.5 数字孪生系统功能模块
（4）孪生数据 孪生数据贯穿于系统的每一个环节，是确保系统稳定流畅运行的血液。数据服务平 台具备孪生数据的处理、集成、存储等功能，负责为物理生产线、数字空间和服务系统 运行提供数据支撑服务，其存储的海量数据为工业大数据分析提供了支持。 （5）连接 高效稳定的数据通讯连接是系统有机运行的保障，其中包括生产现场至系统的连接、 服务系统之间的连接、管理层级之间的连接乃至工业互联网的接入等。
11

2 总体方案设计

硕士学位论文

上述五个功能模块共同构成了生产线数字孪生应用系统，其中物理实体和服务系统 是本课题项目中已经搭建完成的部分，本文在这两个模块的实现基础上，以孪生模型的 构建、数据通讯的建设、孪生模型的实时映射以及孪生数据的处理作为主要研究内容， 最终实现整个系统的关键功能。

2.4 关键技术

在生产系统中，数字空间对实体空间的实时映射是数字孪生技术应用的基础目标。 为了实现此目标，生产线孪生模型的建立与数据通讯是关键，在此基础上可进一步实现 孪生模型对实体的实时映射与孪生数据的统计。本文重点对这些方面进行研究，可将研 究的关键技术总结为如下三方面。
2.4.1 数字孪生建模技术
数字孪生的建模环境可根据需求独立开发或者依赖于工业仿真软件，模型的功能性 和真实性要由建模软件的功能来支撑。市场上主流的 V-REP、芬兰的 Visual Components 以及西门子的 Process Simulate 等建模仿真软件都支持工业机器人、专业设备、AGV 及 工作人员等模型的订制化建模与功能开发，且拥有开放的控制或和通讯接口[26]。选择合 适的建模软件，根据实际功能需求构建任意功能的孪生模型，并通过软件开发或者脚本 语言的二次开发实现个性化的功能，从而建立多维度的数字孪生空间。
数字孪生模型的建立应提炼出统一的数据结构。首先，在对实体 CAD 模型进行导 入的基础上，定义模型的外观、几何、运动结构、关节层次等。然后，面对不同的设备 类型和多样化的功能，要通过脚本的二次开发实现其对应的虚拟服务功能，例如机器人 的运动正反解、各类工具头与工件的物理交互、AGV 的姿态定位、产品的形态变化和信 息描述等。这样对关键工业设备提炼出通用化的面向对象的建模方式，方便项目的快速 开发与海量模型库的建立。除此之外，模型要建立数据驱动的交互接口，由此实现在数 字空间中对实体的映射。在数字空间进行孪生模型的功能构建是数字孪生系统实现的引 擎。
2.4.2 多源异构数据处理技术
数字孪生作为工业互联网的一个重要概念，其基础问题就是解决各家厂商多类型设 备的接入、多元数据类型解析和格式统一、海量数据管理及分析计算的问题。同时随着 建模软件功能的日益丰富，孪生模型的真实性与功能性也不断提升，其中大量的信息交 互、图形渲染、数据处理等会对软件造成很大负担。为了集中处理现场数据、缓解上层 管理软件和建模软件的压力，数据处理与计算任务可通过外部数据计算服务平台或者云 计算实现。

12

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

为了保证孪生模型与现场的实时交互，稳定、迅速、安全的通讯方式尤为重要。对 于大场景、多样性设备的场景，存在大量的并行、异构性数据，工业互联网几种常用的 多源数据类型解析技术，如 OPC UA、Modbus、CAN 总线等可有效建立起上下游的沟 通。通讯控制中心应根据现场设备的通讯情况选择适合的通讯协议与通用的数据交换格 式如 XML 或 JSON[27]，建立现场实时信息上行与反馈数据下行的桥梁。可以说，多源 异构数据处理技术是数字孪生系统实现的基础。
2.4.3 孪生模型实时映射技术
数字孪生体对实体的实时动作、行为和状态的映射是数字孪生技术的基础应用。 与对生产现场分析相比，通过对孪生体的实时监控可以间接提供更全面、透明、多层 次的观察视角，可以更方便的获取生产过程数据。而如何利用实时数据驱动多种设备 的动作、工件位置状态、故障预警及调度规划等功能，最终实现整个数字空间与实体 空间的有机融合，需要大量的信号处理与逻辑建模等二次开发。其中对应实体设备的 任务调度（控制器、MES）功能与逻辑控制关系，软件中需要建立功能类似的虚拟服 务组件。
在实时映射的实现基础上，以虚实交互产生的大量孪生数据为基础，需要对设备 状态、系统运行状况、生产率、设备利用率等有效数据进行统计，为上层提供生产现 场的数据可视化及数据库存储。以此为监管层提供更透明、多层次的视角，也为生产 管控、优化、大数据预测等算法提供了数据支撑。

2.5 本章小结

本章首先根据智能制造平台项目的现状，对生产线的总体布局情况进行了介绍。然 后分析了当前管理与生产现场间信息交互与融合的不足，经过研究分析提出了生产线数 字孪生系统的总体框架，以实现生产线数字空间对实体空间的实时映射。最后，提出了 在数字孪生系统在实现中面临的三个关键技术：数字孪生建模技术、多源异构数据处理 技术以及实时映射技术，对整个论文的研究内容起到了指导意义。

13

3 数字孪生建模

硕士学位论文

3 数字孪生建模
数字孪生的引擎是多维度的孪生模型。数字孪生模型主要分为产品、设备、环境和 人员等，在生产运行的过程中，这些孪生模型间的相互作用、有机结合才能体现出数字 孪生的价值。而产品和设备的种类繁多，孪生模型的功能实现也大不相同。对于工业生 产中常用的设备，如工业机器人、加工设备、AGV、堆垛机等，为了实现其孪生模型对 应实体设备的运动、控制方法、虚拟服务等功能，需要一套高效、统一的建模方法。这 里根据所应用的建模软件中丰富的建模工具与脚本功能开发功能，实现了生产线中各种 功能设备与虚拟服务的构建，进一步完成了整个虚拟空间的构建，为数据驱动建立了信 号控制接口。
3.1 孪生模型建模需求
数字孪生系统的基础就是孪生模型的构建。在生产制造过程中，孪生模型主要分为 产品\零部件、设备、环境和人员，本课题生产线实现了无人化生产，人员的模型不在研 究范围内。为了实现数字空间对实体空间的同步映射，首先需要建立对应实体设备的功 能模型，然后通过虚拟服务实现实时数据驱动的数字空间同步运行。本生产线中的设备 和关键驱动数据如表 3.1 所示，表中分析并列出了生产线中设备的主要功能，并根据实 际设备运行情况给出了工作过程中涉及的关键数据、数据类型和数据来源。据此可以提 出如下对孪生模型的构建需求：
（1）功能模型的构建：数字空间要根据实体设备建立对应功能的孪生模型，保证二 者在几何尺寸、物理结构关系、运动特性等多维度的一致性。因此面对各种类型设备的 多种动作和行为需求，要有高效灵活的建模功能和技术的支撑，同时数字空间要支持对 生产线这种大规模场景的运行。
（2）模型通讯控制接口：为了实现模型间的数据交互和外部实时数据的交互，孪生 模型要根据运行逻辑交互信号和表中的驱动数据建立通讯控制信号接口。因此需要数字 空间内部具有灵活的信号通讯机制，并可以与表中 PLC、RFID、HTTP 接口等外部数据 进行实时通讯。
（3）虚拟服务的构建：功能模型的有机连接与运行需要各种虚拟服务的支撑。包括 设备功能的实现、信号的处理、模型行为的指导、运行规则的约束等等。因此，数字空 间应该具有灵活的开发和脚本二次开发能力。

14

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

表 3.1 生产线设备功能与驱动数据

设备名称

主要功能

驱动模型关键数据

数据类型

库存状态信息

字符串

出库库位号

整型

立体仓库

零件出库/

入库库位号

整型

（巷道机） 成品入库

出库托盘到位信号

布尔型

入库托盘到位信号

布尔型

作业执行信号

布尔型

X/Y/RZ 空间位置

整型/实型

AGV*2

托盘物流

载货信号 卸货信号

布尔型 布尔型

状态信息

字符串

托盘流入控制

布尔型

上下料

零件托盘的

零件就位信息

字符串

输送装置*2 送入和送出

托盘换向信号

布尔型

托盘流出控制

布尔型

CNC 上下料机 器人(单功能执
行器)

加工中心的 上下料

J1~J6 关节值 执行器吸取信号 执行器释放信号 机器人状态

实型 布尔型 布尔型 字符串

J1~J6 关节值

实型

装配线上下料机 器人(三功能执
行器)

装配线的上 下料

执行器一/二吸取信号 执行器一/二释放信号
执行器三夹取信号 执行器三释放信号

布尔型 布尔型 布尔型 布尔型

机器人状态

字符串

装配线传送带 托盘的流转

传送带启/停信号 托盘到位信号

脉冲型 布尔型

装配体打螺 打螺钉设备*2
钉紧固

X/Y/Z 关节气缸值 打螺钉动作信号
设备状态

实型 布尔型 字符串

焊接设备 PCB 板焊接

X/Y/Z 关节气缸值 设备状态

实型 字符串

数据来源 HTTP 接口
PLC PLC RFID 阅读器 RFID 阅读器 PLC HTTP 接口 PLC PLC HTTP 接口 PLC RFID 阅读器 PLC PLC
PLC
PLC
PLC RFID 阅读器
PLC
PLC

15

3 数字孪生建模

表 3.2（续）生产线设备功能与驱动数据

设备名称

主要功能

驱动模型关键数据

数据类型

检测焊点和 视觉监测设备
螺钉的质量

检测数据

字符串

X/Y/Z 关节气缸值

实型

装配产品的 上盖装配设备
上盖

执行器夹取/释放信号 执行器翻转信号

布尔型 布尔型

设备状态

字符串

X/Y/Z 关节气缸值

实型

产品称重和 称重/翻转设备
翻面

执行器夹取/释放信号 执行器翻转信号 称重信息

布尔型 布尔型 字符串

设备状态

字符串

装配机器人 （单功能执行
器）

装配产品绿 盖

J1~J6 关节值 执行器吸取信号 执行器释放信号
机器人状态

实型 布尔型 布尔型 字符串

激光打码设备

产品绿盖 打条形码

启动/停止信号 条码信息

布尔型 字符串

涂胶设备

产品上表面 涂胶

X/Y 关节气缸值 设备状态

实型 字符串

硕士学位论文
数据来源 PLC
PLC
PLC PLC PLC 称重传感器 PLC
PLC
PLC PLC

3.2 建模环境简介
为了满足上述孪生模型的建模需求，需要有一个合适的数字空间建模环境。目前市 场上存在着多种商用和教育用的仿真软件，本课题采用了芬兰的工业机器人仿真软件 Visual Components（VC），它提供给自动化设备制造商、系统集成商以快速和高度有效 性的方式构建工厂内部的整体可视化制造过程，内部拥有快速设计 3D 机械设备的支持 及组件库。
VC 是全方位的数字规划工具、数字化工厂仿真软件，集离散物流仿真模拟、机器 人离线编程、PLC 虚拟调试三大功能于一个平台。而其内部的 OPC UA 通讯接口可以支 持虚拟调试、数字孪生在线监控等应用。相较西门子的 Tecnomatix 产品和达索的 Delmia 产品，VC 具有更高的性价比和更强大的功能[29]。VC 软件的建模界面如图 3.1 所示，在 此页面上可导入市场上主流的 CAD 三维模型并进行功能模型的构建。模型内部的实体、

16

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

变量、属性、信号等在软件周围的功能页中显示。软件的通讯模块如图 3.2 所示，此模 块提供标准的 OPC UA 通讯接口，在确保数据安全的条件下支持大批量的数据通讯。

图 3.1 VC 建模模块界面

图 3.2 VC 通讯模块界面
从应用层面来说，VC 具有如下的特点： （1）建模高效、灵活：在数字建模方面，软件支持市场上各种格式的 3D 模型的导 入与建模，其网格简化技术、实体渲染技术、物理仿真技术可以更高效的表现模型的实 体特性，支持大规模场景的运行。针对各种复杂运动的机器人等设备提供通用的运动学 算法支持和用户开发的接口，可以构建功能丰富的组件。 （2）功能组件库：VC 自带的组件库（网络组件库）中，有超过 2000 多种的成熟
17

3 数字孪生建模

硕士学位论文

设备和虚拟服务组件，其中核心的虚拟服务组件如产品工艺框、零件抓取功能组件等可 以直接利用，功能设备组件可以作为孪生模型构建的参考。
（3）开发自由：VC 将 Python 语言作为二次开发的内核，可导入各种开源的 Python 功能模块，快速实现各种功能。其中每个 Python 脚本即是一个运行线程，构建的各种虚 拟服务以并行的方式服务与整个数字空间。
（4）通讯接口：软件内部有 OPC UA 标准通讯接口，其对模型的组织形式类似于 面向对象的编程思想，模型中的每个数据和信号都可在通讯接口中与外部 UA 服务器数 据源建立连接。同时 Python 脚本开发也支持非常多的通讯形式，为通讯提供了辅助。
VC 的功能特点支持对生产线多维度模型的构建与融合。为了实现虚拟空间对物理 空间的真实完整映射，需要从多个维度对虚拟空间进行建模，在仿真软件中对生产线的 构建要按照以下四个层次部分进行：
（1）几何模型：即一个模型的可视部分，直观体现了模型的形状、颜色、材质、装 配关系、位置、尺寸等等，几何精度的准确是建模的基础。VC 根据实体的精确三维装 配模型进行建模，以确保几何准确性。
（2）物理模型：包含模型的运动结构、物理性状、力学关系、误差等，其建立在几 何模型的基础上，对设备、产品等更深层次的物理属性进行集成。
（3）行为模型：包含加工行为、故障行为、协作行为等，在物理模型的基础上，对 单个或集体模型的行为进行指导与规划。行为模型是为设备服务的脚本程序即虚拟服务 组件，协助模型完成实体的相关功能。
（4）规则模型：包含推演规则、关联规则、约束规则、装配规则等，其是对模型行 为的进一步约束与选择，以应对实际生产中的各种状况。其是为单元/系统级的脚本程序， 同样是虚拟服务组件[30]。
在课题实现的过程中，除了几个核心功能服务组件可以直接利用，其余全部的实体 模型、设备服务组件、信号处理服务等都需要按照上述的建模层次，针对 3.1 节中生产 线现场设备的分析表，进行专门的开发，以满足课题的需求。

3.3 功能模型的构建

3.3.1 产品和托盘建模
产品和托盘是相互依赖的整体，在生产系统的数字孪生中属于弱化的地位，主要包 含几何模型和内部的产品信息两部分，用来在生产过程中的流动。不同工艺阶段的产品 有不同的形态，在相应的工艺阶段，产品应该根据加工过程表现出对应的形态。产品的 订单、条码、质量等全生命周期数据应该存于每个产品的虚拟标签中。生产线中的产品 为 RFID 阅读器，其装配零部件分为下盖、PCB、上盖、螺钉和绿盖五个部分。零部件

18

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

从出库到入库的全过程中完成了整个几何形态的演化，所有产品的数据集成在产品内部 的虚拟条码内，这里需要产品的信息数据关系服务程序。
生产线中产品的流转依托于托盘，托盘内部装有 RFID，以对托盘进行定位，其上 有对各个零件和成品的夹具和容器。在生产的时候，托盘可以在巷道机、AGV 和传送带 上流转，因此需要对托盘本身进行模型容器的控制，同时根据所流到工位的工艺对本身 容器中产品的演变做出相应的控制，因此需要产品的工艺控制服务程序。本课题中产品 和托盘的模型和建模信息分别如图 3.3 和表 3.3 所示。

模型名称 产品/零件
托盘

图 3.3 产品和托盘模型

表 3.3 产品和托盘模型信息

实时驱动信号/数据

数据类型

数据作用

ProductInfo

字符串 全生命周期信息

ProcessingInfo

字符串

产品工艺数据

Position

字符串

托盘定位

PalletInfo

字符串 托盘 RFID 信息

服务程序 数据处理程序
容器管理程序 产品控制服务

3.3.2 作业设备建模

3.3.2.1 工业机器人建模 工业机器人因融合了多学科的先进技术，可以说是智能制造领域具有代表性的装备。
虽然机器人与外围设备交互的灵活性较强，但其作业大多是被动的执行重复的任务，不 符合智能制造的需求[31]，因此以工业机器人为代表的智能设备是实现数字孪生重要的一 环。机器人的机械运动结构是由一系列的关节和连杆连接起来的，关节通常分为转动关 节和移动关节。机器人的连杆和关节按照不同的坐标形式进行连接,可分为五种运动形 式：直角坐标形式，圆柱坐标形式，球坐标形式，关节坐标形式及平面关节坐标式。其 坐标铀是指机械臂的三个自由度轴，并未包括手腕上的自由度。常用工业机器人的运动 形式为：
（1）机身的旋转运动 （2）肩关节和肘关节的摆动
19

3 数字孪生建模

硕士学位论文

（3）腕关节的俯仰和旋转运动 工业生产线中常用的工业机器人大多为串联型的，而串联型机器人按照关节种类和 运动结构的不同，通常分为关节型机器人（RRR）、球坐标机器人（RRP）、SCARA 型机 器人（RRP）、圆柱型机器人（RPP）以及笛卡尔型机器人（PPP）。其中关节型机器人（机 械臂）应用最广泛，其运动学建模大多采用 Denavit 和 Hartenberg 提出的 D-H 参数建模 方法，然后通过一系列连杆坐标系间的齐次变换实现运动学正解、通过雅各比矩阵方法 实现机器人运动学逆解。根据 D-H 参数法，关节连杆坐标系的建立有如图 3.4 所示的规 定： （1）zi 坐标轴沿 i+1 关节的轴线方向； （2）xi 坐标轴沿 zi 和的 zi-1 公垂线，且指向背离 zi-1 轴的方向； （3）yi 坐标轴的方向需满足与 xi 轴、zi 轴构成 xiyizi 右手直角坐标系的条件。

图 3.4 D-H 参数原则
上面的 di、θi、li、αi 这 4 个参数，确定了相邻杆件相对位置关系和结构形态。因 而市场上主流的机器人仿真软件大多以据 D-H 建模开发出标准的关节型机器人建模方 法和通用的正反解算法，以供用户快速开发利用。VC 中的建模方式将物理结构与运动 控制分开，首先对导入的数模进行物理结构的构建，然后在通过接口实现运动控制等功 能。而对机器人运动连杆机构的精准构建依赖于实体三维模型的精度以及关节点参考坐 标系的定位精度，这里主要利用特征点捕捉功能过对数模关节旋转中心的定位与提取。 在此基础上，根据 D-H 法则从机器人基坐标系开始依序建立各个关节的参考坐标系，对 机器人关节运动连杆机构进行精确的构建[32]。多关节机器人的运动特性则由表 3.4 所示 的关节运动学行为列表构建，其中涉及关节长度、角度、定位、耦合、配置和公差水平 等因素。在机器人机械运动结构精确构建的基础上，通过机器人手册设置其运动特性参 数，配合软件内部的通用正反解算法完成其运动学建模。
20

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

表 3.4 工业机器人控制器参数

参数名 L01X/Y/Z ~L56 X/Y/Z
A45 JointZeroOffset1~ JointZeroOffset6 JointSign1~JointSign6
Coupling23 ShoulderValid ElbowValid
WristValid ConfigName1~ ConfigNameN
PalletizingMode PalletizingNormal XYZ PolarSingularityTolerance
WristSingularityTolerance ExtendedPositionTolerance
Coupling456

功能 定义给定轴上两个关节之间的偏移量
定义第四和第五关节之间的角度 定义机器人的关节零位（手臂向上空间）
定义哪个方向是关节的正方向(如转动关节的顺时针和逆时针) 指示第二和第三关节是否耦合 肩关节是否有效选项 肘关节是否有效选项 腕关节是否有效选项
定义机器人手臂的配置名称。对于相同的配置，不同的机器人 类型可以使用不同的命名约定
打开/关闭机器人手腕的方向，以指向由其定义的方向 当 PalletizingMode 启用时，定义机器人手腕的方向 定义机器人奇点圆的半径，定义在机器人手臂末端的小圆形空
间 定义机器人腕关节奇异性的角度公差 当机器人处于伸展位置或肘部通过零点到达某一点时，定义公 差值来检测机器人配置中的奇异性 定义 4、5 和第六轴之间的耦合关系

采用上述方法对生产线中装配线上下料机器人的构建如图 3.5 所示，该机器人的末

端执行器为三功能型，具有两个吸盘和一个气动手爪，可对不同特点的零件和产品进行

拿取。为了实现执行器对零件的作用，需要建立信号与实体设备的信号匹配，并触发相

应的动作，因此需要建立对应的信号处理脚本程序。生产线中三个工业机器人及末端执

行器的建模信息如表 3.4 所示。

图 3.5 装配线上下料机器人模型
21

3 数字孪生建模

硕士学位论文

表 3.5 机器人模型信息

模型名称

实时驱动信号数据 数据类型

数据作用

服务程序

CNC 上下料机

A1~A6

实型

关节驱动

器人(单功能末

SuckSignal

布尔型

执行器吸取/释放 信号处理程序

端执行器)

Status

字符串

机器人状态

A1~A6

实型

关节驱动

装配线上下料 机器人(三功能 末端执行器)

SuckSignal1 SuckSignal2
PickSignal

布尔型 布尔型 布尔型

执行器 1 吸取/释放 执行器 2 吸取/释放 执行器 3 夹取/释放

信号处理程序 执行器动作服务

Status

字符串

机器人状态

装配机器人

A1~A6

实型

关节驱动

（单功能末端

SuckSignal

布尔型

执行器吸取/释放 信号处理程序

执行器）

Status

字符串

机器人状态

3.3.2.2 加工设备建模

装配线中的加工设备都以三个平移关节的运动机构为基础，附加特定的作业工具，

因此设备的主体部分可以按照笛卡尔坐标系机器人的方式进行构建。其中每个关节都由

气缸驱动，由于气缸值采用的单位是米（m）制，软件中的单位是毫米（mm）制，因此

在构建关节时对关节值做了等比例的转换。

对于此种三关节运动设备的运动学结构，位置矢量可表示为：

=[

]

(3.1)

姿态矢量表示为：

=[

]

(3.2)

对于生产线中如图 3.6 所示上盖装配设备，其由三个平移型关节和末端的一个旋转

关节组成。对于这类设备的运动学正反解，为了统一和简化建模方法、提高效率，提炼

出一种通用的运动学建模方法。在对其关节的参考坐标系配置中采用了不同于 D-H 的 方法。其三个平移关节的参考坐标系在世界坐标中处于相对平移的位置而没有相对的旋

转，即保证了末端执行器参考坐标系姿态的固定。这样每个关节的平移分别对应着参考

坐标系 X、Y、Z 轴的三个方向的三个自由度，由此三个变量即可表示末端执行器的位

置。最后在末端旋转关节附加同样的参考坐标系，控制末端关节绕 X 轴的旋转。

在任意选取基坐标系、关节处于零位的姿态下，工具坐标系基本偏移量 BASE_O

FFSET 是定值，末端空间坐标有如下关系:

= [0], = [1], = [2]

(3.3)

其中 [ ]代表第 i 个关节的关节值。则其运动学正解可表示为：

Traget[X, Y, Z] = [ , , ] +

_

[, , ]

(3.4)

其运动学逆解可表示为：

22

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

[0,1,2] = Traget[X, Y, Z] −

_

[, , ]

(3.5)

如图 3.6 所示为其建好的模型与运动学正反解脚本程序，同机器人一样，该种设备

的驱动数据也包括关节气缸值、执行器旋转信号、执行器夹取/释放信号和设备状态。生

产线中所有加工设备的模型构建如表 3.6 所示。

图 3.6 上盖装配设备的运动机构和正反解脚本
3.3.2.3 数控磨床建模 本课题中的数控磨床是对零件表面进行简单的打磨，由于数控机床的内部结构非常
复杂，本课题对其做了简化处理，在工件放入磨床的夹具上后，导轨将其送至加工位进 行固定的磨削动作后将零件送出。机床运动机构的构建与上文中的三轴加工设备类似， 采用简单的直线和旋转关节构成[33]，数控磨床的模型信息如表 3.7 所示。

23

3 数字孪生建模

硕士学位论文

模型名称 打螺钉设备*2
焊接设备 上盖装配设备
称重/翻转设备 涂胶设备 模型名称 数控磨床

表 3.6 加工设备模型信息

实时驱动信号/数据

数据类型

数据作用

X、Y、Z

实型

关节驱动

WorkSignal

布尔型

打螺钉信号

Status

字符串

设备状态

X、Y、Z

实型

关节驱动

Status

字符串

设备状态

X、Y、Z

实型

关节驱动

RotateSignal

布尔型 执行器旋转信号

PickSignal

布尔型 执行器夹取/释放

Status

字符串

机器人状态

X、Y、Z

实型

关节驱动

RotateSignal

布尔型 执行器旋转信号

PickSignal

布尔型 执行器夹取/释放

Weighing.

字符串

称重结果

Status

字符串

机器人状态

X、Y

实型

关节驱动

WorkSignal

布尔型

涂胶信号

Status

字符串

机器人状态

表 3.7 数控磨床模型信息

实时驱动信号/数据

数据类型

数据作用

X、Y、Z
PieceIn PieceIn

实型 布尔型 布尔型

轴驱动 零件进入 零件离开

WorkSignal

布尔型

加工信号

WorkDoneSignal

布尔型

加工完成信号

Status

字符串

设备状态

服务程序 信号处理程序 运动正反解程序 信号处理程序 运动正反解程序 信号处理程序 运动正反解程序
信号处理程序 运动正反解程序
信号处理程序 运动正反解程序
服务程序
信号处理程序 运动正反解程序

3.3.3 物流设备建模
3.3.3.1 AGV 建模 AGV（Automated Guided Vehicle）是指利用自动导引装置进行定向行驶，完成各种
移载和安全保护等功能的运输车。AGV 的轮式移动使其无需固定装置的辅助且不受场 地和空间的限制，具有结构简单、可控性强、行动快捷、工作效率高、安全性好等优势 [34]。因此，AGV 在自动化物流系统中最能充分地体现其自动化和柔性，实现高效、灵
24

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

活的无人化生产。AGV 的主要功能表现为能在计算机监控下，按路径规划和作业要求， 精确地行驶并停靠到指定地点，完成一系列物流运输功能。

图 3.7 AGV 及其虚拟控制器模型

为了在软件中实现 AGV 的关键功能并尽可能使其通用化，提出了采用机器人建模

的方式为其创建虚拟的运动控制器。控制器仿照机器人运动结构的构建方法，采用平移

-平移-旋转的关节构成，然后将其功能本体附着在控制器末端，从而控制其在二维平面

上的平移、旋转。这样将 AGV 的运动控制和其余功能动作剥离开来，有利于不同种类

AGV 的快速建模。据此方法构建出的 AGV 运动控制器模型如图 3.7 所示，可以按照机 器人的控制方式直接给出空间位姿控制其位置。除了运动控制之外，AGV 本体上方往 往具有各种移载功能，本项目中采用传送带控制货物托盘的进出。AGV 调度系统根据 系统触发信号控制传送带的正转、反转和停转，对应 AGV 的出货、入货和运货。生产 线中的两个 AGV 完全一致，模型构建如表 3.8 所示。

表 3.8 AGV 模型信息

模型名称

实时驱动信号/数据

数据类型

数据作用

服务程序

X、Y、Rz

实型

空间位置驱动

AGV*2

TransInSignal TransOutSignal

布尔型 布尔型

入货信号 出货信号

位置驱动程序 信号处理程序

Status

字符串

AGV 状态

3.3.3.2 传送带建模

传送带实现托盘、货物等在其上方的流动，通常可以配合传感器实现对货物的位置

控制。VC 中具有通用的带传感器传送带模型，由直线型和转角型两种，其可附加在生

产线传送带的几何模型上并将物理实体隐藏，作为功能驱动。生产线中的传送带会与各

种组件的容器接口进行连接，并支持其虚拟容器中托盘的流转，同时要依靠启停信号、

速度、加速度来控制物料的流动时间。

25

3 数字孪生建模

硕士学位论文

表 3.9 传送带模型信息

模型名称

实时驱动信号/数据

数据类型

数据作用

服务程序

StartSignal

布尔型 传送带启动信号

传送带

StopSignal OnPosition
Speed Acceleration

布尔型 布尔型 整型
整型

传送带停止信号 托盘就位信号 传送带速度 传送带加速度

容器支持程序 信号处理程序

3.3.3.3 上下料输送装置建模

由于加工中心和装配线的作业需要时间，而且加工时并未同时移走零件和托盘，因

此在这两处设计了两个如图 3.8 所示的上下料输送装置。其主要作用为托盘的缓存与换 向，左右两个通道分别是输入和输出，通道尽头有托盘顶起和横移的装置，用来改变托

盘的所在的通道。在作业时，托盘首先经输入通道进入抓取位，底部装置将其顶高。在

机器人对托盘上零件/产品的加工结束后，底部装置将托盘横移入输出通道，送出至 AGV 上，其中托盘流到位的信号由末端的两个 RFID 阅读器提供。

模型的构建由两个通道的传送带和末端的托盘移动装置组成，托盘移动装置由上升

气缸 Z 和平移气缸 X 两个关节驱动。托盘的流入、流出、到位分别通过信号与 AGV 和

机器人作业连接。两个上下料输送装置的模型构建如表 3.10 所示。

模型名称
上下料输送装 置*2
26

图 3.8 上下料输送装置

表 3.10 上下料输送装置模型信息

实时驱动信号/数据

数据类型

数据作用

OnPosition1

字符串

托盘流入到位

OnPosition1

字符串

托盘换向到位

InputSignal

布尔型 输入传送带启动

OutputSignal

布尔型 输出传送带启动

Changedirection

布尔型

托盘换向信号

Speed

整型

传送带速度

Acceleration

整型

传送带加速度

服务程序
信号处理程序 装置动作服务

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

3.3.4 仓储设备建模
自动化立体仓库(Automated Storage and Retrieval System,AS/RS)由负责存储货物单 元的多层货架系统、提升机或穿梭车等搬运设备及计算机控制系统构成的大存储量、高 效率的机电一体化物流系统。其是信息技术和工业生产飞速发展的产物，是物流作业全 流程中具有重要意义的节点。自动化立体仓库通常是由高层立体货架、出入库输送机、 穿梭车或巷道式堆垛机、托盘与货箱等硬件设备，辅以计算机控制调度系统组成[35]。
本项目生产线设计的立体仓库如图 3.9 所示。由于示范线的吞吐量不大，采用的是 双排、低层的小型货架，用于存放出库的装配零部件和入库的成品装配体。零部件的流 转采用定制的托盘，可以将所有零部件精确定位运输，便于实现自动化。立体货架中间 的巷道式堆垛机在调度系统的控制下，对货物托盘进行出入库的运输[36]。为了配合 AGV 实现物流自动化，立体仓库的出入口设计了一个出库输送机、一个入库输送机和一个人 工出入输送机，其高度与 AGV 出入口高度一致，AGV 通过自动定位，其上方的传送带 可以与输送机对接，实现出入库的全自动化。
堆垛机是立体仓库的主要设备，其可在巷道中水平移动、垂直升降，运动范围覆盖 整个立体仓库空间。其末端伺服控制器可以控制托板左右平移，托起货物出入货架。根 据其运动特点，仍然采用串联型机器人的方法进行建模。然而由于运动空间的限制，其 运动控制与直角坐标型机器人与所不同，末端伺服运动必须要在巷道水平和竖直的运动 结束后才可进行，这样才可避免与货架发生碰撞。为了实现此功能，末端伺服控制器的 运动采用脚本开发实现。堆垛机在巷道中纵向运动到指定货架后通过信号触发末端伺服 器的运动，伺服器控制脚本结合系统调度指令判断和控制托板的左右移，实现对货物托 盘的托举与释放。

图 3.9 立体仓库和堆垛机
在立体仓库中，所有的货位和出入库口都有一个对应的库位编号（共 80 个），系统
27

3 数字孪生建模

硕士学位论文

运行中要根据实时仓储数据库对货物状态进行更新，并在货架上生成对应的货物或零部

件。在出/入库命令下达之后，堆垛机到达相应的库位号完成货物的进出。由于仓库的仓

储信息动态存储于数据库中，且只对外提供 HTTP 通讯接口，因此仓库货架的通讯和货

物控制开发了单独的通讯服务脚本。整个仓储系统的建模如图 3.9 所示。

表 3.11 立体仓库模型信息

模型名称

实时驱动信号/数据

数据类型

数据作用

服务程序

仓库货架

WarehouseInfo Port1~Port80

字符串 数组

货物状态 库位空间位置

仓储状态服务 信号处理程序

Speed

整型

关节速度

Acceleration

整型

关节加速度

巷道机

InputPort OutputPort

整型 整型

入库库位号 出库库位号

信号处理程序 调度服务程序

WorkSignal

布尔型

动作信号

Status

字符串

设备状态

3.3.5 虚拟服务组件

无论是利用孪生模型进行离线规划仿真还是基于实时数据的映射，都需要虚拟服务 组件的支撑，以此服务与设备运行并将其有机的结合成整体。对于设备本身，其要有自 身的作业调度和信号处理服务，在对外部的信号进行正确的解析与响应的同时，也可以 对外发布控制信号，满足自身的诉求。数字空间中整个系统的运转也需要类似于实际生 产线的生产调度系统，以此实现数字生产线的有机运转。
数字空间中的服务组件以脚本程序的形式存在，基于 Python 语言的开发相对简单 有效，而且可利用的第三方开源开发包很多，可以实现很多功能服务，这为数字空间的 功能完备性提供了技术支撑。其中每个脚本的形式如图 3.10 所示，OnSignal()函数体对 与脚本连接的信号进行监控与处理；OnRun()函数体相当于程序的 Main 函数入口。每个 脚本程序对应着软件的一个运行线程，基于此可以实现多智能体的并行运行。软件中可 直接利用的虚拟服务组件如表 3.12 所示，工艺调度服务为每个工位的任务调度提供支 持服务，同时也是物料初始生成、物料流转以及物料销毁的容器，利用机器人虚拟控制 器可对机器人正反解进行快速的参数化构建。

28

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

图 3.10 脚本服务程序

表 3.12 软件内部虚拟服务组件和功能

服务组件

功能

工艺调度服务(WorkProcess)

工位的任务调度/产品和物料的容器

机器人控制器

机器人运动学正反解

传送带控制器

传送带虚拟容器控制

组件抓取服务

实现工具对产品/零件的抓取

除了上述可用的服务外，大部分特殊的虚拟服务组件都需要独立的脚本开发。服务

组件通常分为信号处理和行为控制两个方面。信号处理组件对设备的驱动数据监控，在

数据变化到特定值时，触发相应的行为。行为控制对设备的各种生产行为进行控制，以

实现实体空间的相应功能[36]。为生产线模型构建的关键服务组件有如下几种：

（1）运动控制服务

设备的运动控制服务是为了支持无法获取关节值的设备，通过解析运动信号，控制

设备运动到相应的空间位置并完成作业。

（2）AGV 实时控制服务

本生产线中的 AGV 控制系统只提供 HTTP 通讯接口，无法简单的集成到 OPC UA

中，因此在脚本程序中通过 Web Serviece 通讯进行实时位置的获取，控制 AGV 的实时 位置[38]。服务器提供的消息结构如图 3.11 所示，首先利用消息头判断此次数据拉取是

否成功。从信息标识符开始是 AGV 的实际空间位置和旋转角度，服务脚本将数据转化

为虚拟空间的对应位置后，对 AGV 的位置进行动态驱动。

29

3 数字孪生建模

数据拉取 拉取成功 信息

状态符

/失败 标识符

X空间值 Y空间值

旋转角

硕士学位论文

{"IsSuccess":True/False ,"Records":["X":"12.2" ,"Y":"11.0","Rz":"90"],"MessageEnd"}

数据结束符

图 3.11 AGV 消息结构

（3）立体仓库仓储服务

立体仓库的库存信息存储于数据库中，不允许外部的接入，同样采用 Web Serviece

通讯进行库存信息的获取。Web Serviece 服务器的消息结构如图 3.12 所示，首先利用消

息头判断此次数据拉取是否成功。从库位信息标识符开始是所有库位的存储情况，按照

库位号、库位存储情况给出。服务脚本解析库存信息后，对立体仓库的所有库位库存状

态进行实时的刷新。

数据拉取 拉取成功 库位信息 状态符 /失败 标识符

库位号 是否有托盘 零件或产品 (2-80) （1有,0无) (1产品，0零件)

{"IsSuccess":True/False ,"Records":[{"WareID":"2" ,"IsFull":"1","Type":"1"},…… , {"WareID":"79",…… }],"MessageEnd"}

数据结束符
图 3.12 仓储消息结构
（4）产品全生命周期信息集成服务 从产品订单开始至加工完成入库中的一系列数据如订单数据、质量数据、重量数据 等，都需要在对应的工艺流程后写入产品的虚拟标签中。 （5）状态监控服务 设备所建立的驱动信号中有设备的状态信息，状态监控服务对所有设备的状态信息 进行监控，在设备发生异常时给出警报信号。 除了上述几种服务组件，本课题中开发出的虚拟服务组件如表 3.13 所示，从为单 体设备服务贯穿到整个车间，为模型的有机连接和虚拟空间的运行提供了多种服务支持。

30

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

表 3.13 虚拟服务组件和功能

服务组件

功能

设备运动控制服务

控制设备完成指定的动作

AGV 实时位置控制组件

根据实际驱动位置信息控制虚拟 AGV 位置

巷道机调度组件

根据出入库信息调度巷道机进行作业

立体仓库仓储服务组件

根据立体仓库库存数据库进行初始化/库存变化控制

机器人工具抓取服务

根据工具头动作信号控制对零部件的相应动作

设备数据统计服务

根据设备的状态数据对设备工作数据进行相关的统计

数字空间数据存储服务

利用 Python 将数字空间相关数据存储到 Mysql 数据库中

生产状态监控服务

对物理系统中关键报警信号进行监控，在异常时给予报警

数据可视化服务

运行关键数据在仿真空间的虚拟显示屏上给予实时显示

产品全生命周期信息集成服务

将产品全生命周期信息存入虚拟标签

3.4 生产线模型的构建

3.4.1 生产线工艺流程
123

5

6

7

8 17 16 15 14

4

9

10

11 12

13

工位号 工艺
工位号 工艺
工位号 工艺

1

2

3

4

5

6

零件出库 产品入库 缓存站 AGV上下料 加工中心 加工上下料

7

8

9

10

11

12

装配上下料 上下料+装配 自动打螺钉 自动焊接 电性能检测 视觉检测

13

14

15

16

17

装配上盖 自动打螺钉 称重+翻面 点胶+激光 自动烘干

图 3.13 生产线模型与工艺流程
整个生产线的功能为 RFID 读写器的生产，将下盖、PCB、上盖和绿盖等零件装配

成成品，各工位的工艺如图 3.13 中所示。生产线的工艺流程如图 3.14 所示：MES 系统

根据生产任务给 WMS 下达生产指令，WMS 分析当前的库存数据库情况控制堆垛机进

行出库作业，其中在立体仓库和物流采用的是统一的托盘，可以对装配件和成品进行装

31

3 数字孪生建模

硕士学位论文

夹。AGV 取到承载原料的托盘后，送至 CNC 对零件进行加工，接着送至装配线的上下 料点。装配线统一采用另一种相同规格的托盘，且每个加工工位各有一个。在所有工位 的托盘就位后，同时开始作业，在所有工位的作业完成后，托盘同时流出。装配线上下 料机器人在每一次作业的时候，首先将装配好的产品取至上料托盘的成品位，随后在给 装配线上料托盘上料的同时完成产品 PCB 装配至下盖的工作。上完料的托盘在装配线 流动一圈完成产品的装配和加工作业，从新流至上下料点。AGV 将成品运回至立体仓 库，连同托盘一起送至库位中。其中在电性能和螺钉检测到加工错误的时候，托盘直接 流入下一个流程进行从新加工；称重检测到重量低时，即为上盖的螺钉有未吸取的缺失， 在下一个流程重新加工。
出库指令下达

巷道机出库

AGV送料

装配上盖

CNC加工

上盖打螺钉

AGV送料
装配线上料+装 配PCB
PCB打螺钉

否 称重是否合格？
是
点胶+打码+ 粘绿盖

烘干 PCB焊接

否 电性能是否合格？ 是
否 螺钉是否合格？ 是

成品下料 AGV运送
入库

图 3.14 生产线工艺流程
3.4.2 模型的连接处理 生产线整体模型的构建建立在各个功能模型的基础上，目的是从生产系统的角度实
现其数字空间的功能。由于数字空间与实体空间的功能实现方法不同，需要开发孪生模 型的对应功能，为生产线虚实交互的实现提供模型支撑。其实现的关键包括从底层设备

32

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

模型、加工单元到生产系统的各个层级间的验证与调整、每个层级之间和各个层级之间 的逻辑与交互。其中，在设备模型和各个层次的连接之中，需要同时对模型进行一系列 的验证。孪生模型的验证是指模型与实际系统在逻辑结构和数据参数之间的比较过程。 通过验证过程使模型与实际保持一致，并能精确反映系统中各部分之间的逻辑关系、参 数之间的数量关系以及对系统所作的假设等，从而确认数字空间能够复现实际系统的逻 辑和数量关系，进而实现真正模拟物理空间的行为、操作、状态和演变。为了实现对生 产线真实生产情况的映射与优化，需要根据生产工艺流程对建立好的实体模型进行连接 [39]，实现生产活动在虚拟空间中的复现，确保二者在物料流、信息流和控制流上的一致 性。本课题的生产活动以工件的流动为主线，可以划分为四个部分：立体仓库部分、AGV 运输部分、工件加工部分和装配测试部分。

生产 线参 数确认 设备 参数、工艺 参数、布局
参数

系统 连接 将各 个部分 按照逻 辑功能
连接 成系统

建立 生产 策略与 规则 建立 总体调 度策略 并给予
实际 生产任 务的输 入

设备 单体 验证 验证 并修正 设备的 运动特
性

分块 验证 模拟 各个块 的物料 输入输 出，进行 逻辑、规则 验证
与修 正

产线 总体 验证 模拟 运行与 全局数 据统 计，验证 输出与 实际的 偏
差并 进行修 正。

分块 连接 将产 线各个 部分的 设备按
照工 艺流程 连接成 块

建立 调度 规则 建立 配送规 则、任务 调度
规则 等

验证 与确 认完毕 ，进入 生产 线实 时映射

图 3.15 模型连接与验证方案
根据生产系统孪生模型的复杂度，提出了如图 3.15 所示的连接与验证方案。首先 需要获取生产线的设备参数、工艺参数和布局参数等，作为模型构建与仿真的基础。在 设备单体功能构建完成的基础上，对模型演绎过程中的输入/输出准确度、置信度、灵敏 度与精度及运动特性（速度、空间位置等）等的验证与修正，随后按照上节的工艺流程 将设备有机的连接起来。模型中定义的各种信号可以进行自由的连接，如图 3.16 所示， 这与实体空间中的通讯类似且更加灵活。在生产过程中，零部件与产品的流动是运行的 主线，主要依托于统一的物流托盘。通过在托盘流动路径上的工位点设置一系列的 WorkProcess，在托盘流入每一个工位时会触发 WorkProcess 相应的信号，从而控制对应 的设备进行不同的作业。在特定的情况下，单体设备通过定义不同的触发信号来触发相 应的动作，实现对来料的不同响应。

33

3 数字孪生建模

硕士学位论文

图 3.16 模型信号连接与交互
70 60 50 40 30 20 10
0
工作工时 物流工时
图 3.17 生产线各工位工时
根据此方法，对单元内的各个设备按照工艺流程进行信号逻辑层的相互连接，并用 如图 3.17 所示的各个工位的工时进行验证与修正，其主要是对传送带速度、设备的加 工速度、机器人的移动速度等运动性能的综合比较与修正[40]。在上层单元块与系统级的 连接与验证中，采用脚本模拟生产信号控制其输入，通过统计数据与实际数据的对照进 行逻辑、规则的验证与修正。经过从单体设备建模到整条生产线的逻辑连接与验证，最 终构建了如图 3.18 所示的生产线整体孪生模型，其中显示了设备间的部分连接信号， 此模型具备了真实生产线的功能。
34

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

图 3.18 生产线模型和信号连接
3.5 本章小结
本章首先分析了生产线孪生模型的建模需求，选取了数字孪生的建模环境并介绍了 其功能特点。然后以生产线实体设备模型为基础，对生产线中的功能设备与虚拟脚本服 务进行了构建；进一步以功能模型为基础，通过逻辑连接与验证构建了整个生产线，具 备了对生产线的功能映射能力，同时模型根据需求建立的数据驱动接口为后续实时映射 与数据统计的研究工作提供了支撑。

35

4 多源异构数据处理

硕士学位论文

4 多源异构数据处理
数字孪生作为智能制造的一个重要概念，其实现基础就是解决各家厂商多类型设备 的接入、多元的数据类型解析和格式统一、海量的数据管理及分析计算的问题。同时随 着建模仿真软件功能的日益丰富，孪生模型的仿真度与功能性也不断提升，其中大量的 信息交互、图形渲染、数据处理等会对仿真软件造成很大负担。为了满足信息数据在设 备层、控制层、管理层和工业互联网层的自由流动，一种稳定、迅速、安全的通讯协议 尤为重要；同时为了缓解上层仿真软件压力，部分数据处理与计算任务可通过外部通讯 与控制程序完成。
本章首先根据介绍了 OPC UA 通讯技术的技术特点与优势；然后通过 OPC UA 建 立起了生产现场与仿真软件的数据网络通道，并对数据源的设备数据模型进行了构建； 最后开发了基于 OPC UA 的数据获取与处理应用程序；建立起了系统中数据信息通讯与 处理的网络状结构。
4.1 数字孪生通讯需求
智能制造实现“万物互联”的核心是 CPS,即各种智能设备通过信息交互实现智能 生产。而数字孪生作为 CPS 的关键技术，关键问题是要解决各种设备之间、设备与系统 之间、系统与系统之间实时的数据交互，尤其对于复杂的、多样性设备的大场景数字孪 生系统，需要处理大量的并行、异构性数据。除此之外，CPS 各个系统间的信息交互也 不再是传统的串行结构，应该转变为信息可灵活提取与交互的网络状结构。
工业生产现场的自动化设备大多数为以 PLC、工业计算机或者嵌入式系统为控制器 的加工、组装及检测等设备。除此之外，生产线自动化与智能化的实现还需要各种传感 器的相互配合。生产制造是一个信息不断产生、不断变化的动态系统，因此现场数据具 有多源、实时、海量、异构等特性。在生产线的数字孪生的实现过程中，底层数据源按 照数据性质划分可分为生产现场工况数据、设备运行数据、其他数据三大类数据, 如图 4.1 所示。
（1）生产现场工况数据主要包括人员数据、质量数据、生产执行数据（任务数据和 进度数据）、物料数据、产品数据、设备工装等数据。
（2）设备运行数据主要是指在生产制造过程中，生产设备运行的状态数据、运行参 数数据。

36

硕士学位论文
现场工况数据
生 产 车 间 底 层
设备运行数据 数 据

数据驱动的数字孪生模型构建与在线监控应用

人员数据 设备数据 物料数据 进度数据 任务数据 质量数据
……

静态数据

设备运行状态数据 设备运行参数数据
……

动态数据

环境数据

其他数据

故障数据 维护数据

……

图 4.1 生产车间底层数据类型
（3）其他数据主要是指生产现场环境数据、生产过程中出现的生产故障、维护信息 等影响正常生产的数据。
其中按照数据状态又可以划分为静态和动态数据两类，其中动态数据是驱动孪生模 型的主要数据源，静态数据是系统进行管理和分析使用的。数字孪生技术实现的关键就

是对这些多源异构的底层数据源进行处理，为数字空间与物理空间的数据交换提供方便 快捷的通道，实现整个数字孪生系统中数据的交互与融合。

4.2 OPC UA 技术

为了解决数字孪生系统中数据交互与融合的问题，需要一个统一的标准化通讯框架 和协议。OPC UA(OLE for Process Control Unified Architecture)，技术正是解决当前智能 制造系统通讯问题的最有效的国际热门技术之一。OPC UA 是一套集信息模型定义、服 务与通讯标准为一体的标准化技术框架，其中 OPC 是指用于过程控制的 OLE 技术， 是由 OPC 基金会组织管理、用于工业通讯的标准。OPC UA 是一种面向服务的通信协 议，以服务器/客户端的架构实现，其可以是基于 PC 的独立可执行程序或可执行程序 （ERP\MES\SCADA）的一部分[41]。UA 服务器与可编程控制设备、数控机床、工业机 器人、RFID 读写器等现场设备之间可通过现场总线或工业以太网连接，实现底层设备 的与设备操作。UA 服务器汇总现场数据和设备信息后，将其转换为支持 OPC UA 协议

37

4 多源异构数据处理

硕士学位论文

的数据，经过数据管理与逻辑运算为 UA 客户端提供相应的服务与支持。UA 客户端可 嵌入到各种程序、设备控制器、系统（物联网、ERP、MES 等）中，利用从服务端获取 的实时数据为上层提供数据支撑服务。
从技术层面说，OPC UA 独立于各制造商的原始应用、编程语言和操作系统，能实 现各类信息在制造层级各个系统之间的无缝传递，具有平台独立性、扩展性、高可靠性， 可通过互联网进行数据传输。其特点如下：
（1）平台独立性：支持跨平台应用，可拓展到 Unix、Linux、Android 等操作系统 或者云服务、PLC、微控制器等硬件平台中。
（2）功能对等：可对传统 OPC 规范如 A&E、DA、HAD、事件、方法等进行有效 集成。
（3）安全性：是防火墙友好的信息传输，并采用数字证书进行安全认证、对话加 密、权限认证等控件来解决安全问题。
（4）可拓展性：创新的技术和方法，如新的传输协议、安全算法、编码标准或应用 服务，可以并入到 OPC UA 中，同时保持现有产品的向后兼容性。
（5）信息建模：如图 4.2 所示，OPC UA 数据建模框架可以将数据转变为信息。通 过完整的面向对象的功能，即使最复杂的多层次结构也是可建模和可拓展的，同时数据 类型和结构可通过配置文件进行快速定义[42]。
由于 OPC UA 的上述诸多优点，其在物联网、工业互联网环境中具有非常高的应用 价值，也是当前解决数字孪生通讯问题的最有效技术。
供应商信息模型

工业标准信息模型 （配套规范：FDI,PLCOpen，ISA 95,MDIS,...）

信息模型

数据访问(DA) 报警&监控(AC) 历史数据(HA) 程序规范(Prog)

安

工业标准信息模型

鲁

全

（配套规范：FDI,PLCOpen，ISA 95,MDIS,...）

OPC UA基 棒

础支撑

性

性

传输-协议映射

数据发现

图 4.2 OPC UA 信息建模框架

4.3 系统通讯网络架构

在生产线的控制系统中，与现场设备的通讯接口和数据采集模块通常是必不可少的， 这为 OPC UA 通讯的实现提供了便利。因此可以在生产控制系统中直接进行生产现场 OPC UA 服务器的构建，据此提出了如图 4.3 所示的数字孪生系统通讯网络架构。将生 产系统中的底层数据利用 OPC UA 技术进行了整合，消除了数据源的差异，进而为标准

38

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

UA 客户端提供了安全验证、数据读写等各类服务。 UA 服务器主要给两个模块提供支持服务，一个是数字空间，一个是孪生数据服务
平台。数字空间通过内部 UA 客户端与现场实时数据建立连接，一方面驱动模型对实体 空间的映射，另一方面可对生产现场的数据进行写入实现反控。数据服务平台对整个系 统运行的数据提供各种支持，比如数据的存储、现场运行数据的回放模拟和计算等。除 去这两个模块，还允许各种功能客户端的远程接入，例如工业 APP、Web 等。此架构可 以实现数据的网络状通讯，整个生产车间全要素、全流程、全业务的数据进行了有效的 集成与融合，实现了数据共享，消除了信息孤岛，为数字孪生车间的运行提供了全面的 数据支持与高质量的信息服务。下节将根据此通讯网络架构，对其中各个模块的设计与 实现进行研究。
底层设备、其它系统等数据源

生产控制系统
OPC UA服务器 数据源 数据服 数据安
整合 务支持 全管理
……

数字空间

OPC UA客户端

数据读 驱动模 数据写

取

型

入

数据服务平台
OPC UA服务器+客户端 数据库 数据回 数据分
存储 放支持 析计算

工业APP Web端
其它系统

图 4.3 数字孪生系统通讯网络架构
4.4 通讯模块的设计与实现
4.4.1 UA 服务端的设计与实现 4.4.1.1 UA 服务器实现
数据源的接口、通讯协议多种多样，为了有效采用 OPC UA 技术对现场数据进行统 一的实时获取与写入，通常采用如图 4.4 所示的 UA 服务器架构。整个应用架构采用三
39

4 多源异构数据处理

硕士学位论文

层的结构：底层是以数据存储和地址空间模型为基础的数据层，中间是以功能模块和服
[43]
务函数为基础的服务层，上层是以网络通信协议为基础的通信层 。

（1）底层数据源有各种硬件设备、RTU、数据库或其它系统组成，因此数据源通讯

方式、接口和数据类型的差异性较大。底层通过封装各种驱动程序或接口来隐藏底层的

差异，为数据的交互提供统一的交互接口。为了对数据进行统一化管理，要根据实体空

间的数据源，在地址空间中建立统一规则的数据模型，将数据模型与数据源进行一对一

连接，这样方便客户端的接入与数据含义的理解。其中数据建模的具体方法与设计将在

下文论述。

（2）中间层包含了传统 OPC 的数据管理及订阅、事件管理及订阅、历史管理和安

全配置等功能模块，它们对地址空间中的数据进行统一的管理，并给用户提供相应的功

能支持。其中的数据管理模块提供对数据的遍历、订阅与读写等功能，是通讯的核心功

能；

局域网/互联网/工业互联网

网络通信及数据编码模块

UA功能模块

DA:数据 管理及订阅

A&E:事件 管理及订阅

HA:历 史管理

安全及配置 模块等

地址空间及数据存储模块

硬件驱动程序及接口

TCP/IP

Modbus

串口

接口

硬件设备

数据源

RTU

数据库

其它服务器 或系统

图 4.4 OPC UA 服务端架构
事件管理模块给用户提供事件的订阅，可实现关键数据报警等功能；历史管理提供对历 史数据的追溯；安全模块对外部客户端提供安全接入服务，保障数据安全，通常有开放 式接入、账户密码验证接入和密钥接入等方式。
（3）上层是网络通信与数据编码模块，此层将构建的服务端接入到局域网、互联网

40

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

及工业互联网中，为远程客户端的接入提供支撑。不同层次的用户和管理者可以在不同 的地点以不同的工具进行远程访问，实现对生产的监控和管理。
服务器的实现可以采用官方 SDK 开发或者第三方的通用软件，基于 SDK 开发需要 现场各种设备厂商的硬件驱动支持且在面对不同生产线时开发任务繁重，本课题中采用 第三方的 OPC UA 通用服务器软件——NI OPC Servers 构建物理车间 UA 服务器，如图 6.5 所示为软件的数据变量界面。软件内部集成了市场上主流设备和通讯接口的驱动， 可安装在车间的总控服务器上，直接根据设备的通讯接口类型选取硬件驱动，即可获取 现场的各种 PLC、通讯总线等的地址空间中的多源数据。本课题中的立体仓库库存状态 和 AGV 空间位置只能通过 HTTP 接口给出，采用第三章中的服务脚步进行通讯，不在 UA 服务器的构建范围之内。生产线中有两个西门子的总控 PLC，分别控制立体仓库和 其余的部分，其它所有的机器人控制器、RFID 传感器、设备控制器等都连接在总控 PLC 上，可在 PLC 的地址空间中获取数。因此在应用中，将软件安装在生产线服务器工控机 上，通过两个 PLC 直接获取整个生产线的数据。

图 4.5 NI OPC Servers 软件
4.4.1.2 服务器数据模型构建 OPC UA 采用统一的模型结构对对象进行描述，如图 4.6 所示，其内部描述分为变
量和方法，还允许与其他对象构成父子兄弟等层次关联的关系。其中，节点变量用于表 现一个对象真正的数据描述值，客户端可以对这个值进行读写操作以及创建监视项订阅 其变化。方法节点是运算逻辑，代表服务器中一个轻量级的函数，其范围以一个拥有者 对象为界，类似于面向对象编程中一个类的方法。每一种方法都由一个方法节点类的节 点来描述，其中确定了方法的参数，并描述了行为。客户端使用调用服务调用方法，在 服务器上完成，并将结果返回给客户端。
41

4 多源异构数据处理

硕士学位论文

OPC UA 服务器通过地址空间的标准方式向客户端表示对象。底层的驱动程序从硬 件设备、远程终端控制系统（RTU）、实时数据库或其它服务器或系统等数据源获取数据 后，按照标准对象模型对数据源进行类型定义和信息建模，按照 UA 的地址空间模型构 建一个统一的地址空间。对象及其组件在地址空间中的数据模型表示为由属性描述并由 引用互连的一组节点,各类节点的创建采用如图 4.7 所示的标准节点类。

数据变 化通知
读/写
援引 事件通
知

对象 变量
方法
() () ()

对其他 对象的 引用

节点 属性
引用

属性描 述节点
引用定义 与其他节 点的关系 其它节点

Object NodeClass
Attributes
Base NodeClass +EventNotifier
References
+HasComponent +HasProperty +HasModellingRule +HasTypeDefinition +HasEventSource +HasNotifier +Organizes <others>
Standard Properties -NodeVersion -Icon -NamingRule
Method NodeClass
Attributes
Base NodeClass +Executable +UserExecutable
References
+HasProperty +HasModellingRule +GeneratesEvent +AlwaysGeneratesEvent
Standard Properties
+NodeVersion +InputArguments +OutputArguments

图 4.6 对象和基本节点模型
Base NodeClass Attributes
+NodeId +NodeClass +BrowseName +DisplayName +Description +WriteMask +UserWriteMask

Variable NodeClass
Attributes
Base NodeClass +Value +DataType +ValueRank +Arr ayDim ension s +AccessLevel +UserAccessLevel +Minim umSamp ling In te rval +Historizing
References
+HasModellingRule +HasProperty +HasComponent +HasTypeDefinition
Standard Properties
+NodeVersion +HasProperty +LocalTime +DataTypeVersion +DictionaryFragment +MaxStringLength +MaxByteStringLength <others>

ReferenceType NodeClass
Attributes
Base NodeClass +IsAbstract +Symmetric +InverseName
References
+HasProperty +HasSubtype
Standard Properties
+NodeVersion

图 4.7 地址空间节点类

按照节点创建数据模型的方法体现了面向对象的编程思想，这样的好处在于客户接

入服务器的时候可以更清晰的对数据进行分类与利用。同时每个数据在创建的时候包含

了数据的权限，分为只读、只写、可读可写三层权限，这样确保了关键数据的安全性，

42

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

可以避免对现场作业的不必要干扰[44]。NI OPC Servers 中对上述的数据建模的方法进行 了用户快速构建的封装，只需根据地址空间找到对应的数据源，即可对数据名称、数据 类型、数据扫描周期、数据描述和读写权限进行设置，满足了本课题的数据要求。对数 据源的建模除了要包含第三章中数字空间所需的驱动数据外，仍要对其余的设备关键数 据进行构建，以便数据服务平台进行存储与后续的分析利用。生产线的数据地址和对应 功能由设计者给出，如图 4.8 所示，据此对物理空间中的数据建模，将数据源构建成标 准的服务器数据节点，其中几种关键设备的数据模型如下：

图 4.8 生产线数据地址和功能
（1）机器人数据模型 本生产线中的上下料机器人是两个 AIR 10P 型工业机器人，其配有机器人控制器和 工具头。该机器人的为通用的六关节串联型机器人，配有机器人控制器，其上安装吸盘 式和夹取式工具头，对物料进行吸取。根据孪生系统的数据需求，对机器人数据模型的 层次设计如图 4.9 所示。整个机器人模块由六个关节、控制器和工具头八个部分构成。 每个关节包含关节值、电机速度和加减速度等参数、温度和工作状态；控制器包含工作 温度、工作状态及一系列的 I/O 口控制信号；工具头包含状态数据、动作信号、工差等。
43

4 多源异构数据处理
AIR 10P型 工业 机器 人

……

控制 器 关节1 关节6

状态 I/O端口
温度
速度 状态 最大 速度 关节 角 温度

硕士学位论文 端口1 端口2 端口3 ……
范围 值

工具 头

状态 动作 信号

角度 公差

指示 距离

图 4.9 Air 10P 型机器人数据模型

（2）加工设备数据模型

装配线中的加工设备是以气缸驱动关节的设备，其上配有特殊功能的工具如焊接枪、

打螺钉工具头、抓手和吸盘等。对其中装配上盖设备的数据模型的设计如图 4.10 所示，

整个数模分为控制器、三个气缸和工具三部分。每个气缸包含运动速度、气缸行程、最

大速度和气缸状态；控制器包含设备关键温度、设备状态及一系列的 I/O 口控制信号；

工具头包含夹取信号和翻转信号。

状态

端口1

控制 器

I/O端口

端口2

温度

端口3

装配 上盖 设备

……

气缸1 气缸3

速度 状态 最大 速度 关节 值

…… 范围 值

工具 头

旋转 信号 动作 信号

图 4.10 装配上盖设备数据模型

44

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

（3）数控磨床数据模型

装配线中的加工中心是数控磨床，其利用磨削工具对零件表面进行打磨。对其数据

模型的设计如图 4.11 所示，整个数模分为可编程控制器、驱动系统、辅助装置和刀具四

部分。驱动系统主要包含每个轴的速度、状态、最大速度和进给量等等；PLC 包含设备

关键温度、设备状态及一系列的 I/O 口控制信号；辅助装置包含冷却装置状态、磨床状

态和照明控制；刀具包含刀具类型和状态。

状态

端口1

端口2

PLC

I/O端口

温度

端口3

……

数控 磨床

驱动 系统 辅助 装置

……

关节
冷却 状态 机器 状态 照明 控制

速度 状态 最大 速度 关节 值

刀具

刀具 类型 刀具 状态

图 4.11 数控磨床数据模型
（4）传送带和上下料设备数据模型 传送带利用伺服电机控制传送带的启停和速度，利用上方的 RFID 阅读器对托盘定 位。上下料设备建立在两条相反传送带的基础上，通过伺服装置实现对托盘的平移换通

道。二者的数字模型如图 4.12 所示，上下料设备的数模可分为伺服装置、电动机和 RFID 三部分。伺服装置包含工作信号、气缸值和速度；电机包含启动信号、速度和温度；RFID 包含触发时的消息。
工作 信号

传送 带

电机 RFI D阅读 器

启/停信 号 温度 速度
读取 信息

伺服 装置

上下 料设 备

电机

关节 值 关节 速度 启/停信 号
速度 温度

RFI D阅读 器
图 4.12 传送带和上下料设备数据模型

读取 信息

45

4 多源异构数据处理

硕士学位论文

除了上述几类关键模型，采用相同的方法对生产线中所有可用的数据进行模型构建。 为了验证数据建模的结果，运行 UA 服务器后，利用 UaExpert（OPC UA 监控、调试和 测试工具）作为客户端连接服务器浏览其地址空间组织形式，结果如图 4.13 所示。从 中可以看到自己定义的机器人数据模型的节点组织，包含按照信息模型定义的数据变量 节点，相互之间通过引用进行关系连接。其中机器人控制器中包含机器人工作状态和工 作温度两个变量，作为工作状态检测使用，包含一系列的 IO 口信号。机器人六个关节

图 4.13 Air 机器人地址空间组织形式
的属性变量是一致的，包含该关节有范围限制的当前关节值、关节电机状态和温度、最 大加减速度和当前速度等数据变量。机器人上的工具头包含工具名称、状态、距离公差、 角度公差等数据变量，以及一个布尔型的动作信号触发吸取动作。 4.4.2 数字空间的数据通讯
生产系统中实现了 UA 服务端的数据处理后，为客户端数据接入提供了支持，建模 软件要利用客户端与其进行通讯以获取实时数据。本文所用的仿真软件将在第四章进行 介绍，这里不进行赘述，其开发架构中融入了 OPC UA 客户端，可以实现仿真空间中的 信号、数据、变量等与外部的数据交互。客户端可通过以太网与标准 UA 服务器通讯， 为用户提供了批量从服务器获取数据和写入数据的功能。对应 UA 服务器的安全模块， 为了保证客户端接入服务器的安全性，可根据 UA 规范的接入安全模式采取无验证、用 户名+密码认证、证书+密钥认证等多种方式，如图 4.14 所示，这样确保了网络通讯的 安全问题。
46

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

图 4.14 软件通讯接口
与 OPC UA 技术特点相对应，仿真软件同样采用面向对象的思想进行构建。仿真场 景中所有模型的模拟变量（属性或者信号）都在由节点组成的树结构中组织，这些数据 代表了组件的功能特征，也是控制接口，通常为布尔型、整型、实型、字符串四种类型。 UA 客户端模块将场景中的数据以同样的节点关系形式重新组织，并通过遍历服务器获 取现场设备的所有节点数据，将服务器变量同样以树状图的方式呈现。由于客户端对服 务器数据的读取是以订阅的方式实现的，软件通过如图 4.15 所示的创建变量对的方式 将模拟变量与服务器变量一一建立连接变量对，即完成了客户端对服务器节点数据的订 阅。这样在服务器开放读写权限的基础下，数字空间便拥有了对现场数据的大批量、连 续性读写能力。
47

4 多源异构数据处理

硕士学位论文

图 4.15 创建订阅变量对
通过上述监听变量对的创建方法，对生产现场 UA 服务器和孪生模型中的驱动数据 变量进行一对一的连接。通常客户端对服务器数据的获取有两种方式：一种采用按时间 间隔进行轮询刷新的方式，一种是采用变量有变化时更新的方式。由于生产系统中的部 分信号是短脉冲的形式，轮询方式容易造成信号变化无法捕捉，因此为了提高仿真模型 对信号的响应速度，客户端对连接变量的更新采用第二种方式。这样的另一个好处是对 没有变化的信号不做处理，降低了系统性能的无意义消耗。 4.4.3 数据服务平台的设计
对于大规模产线，其现场数据的种类多、数据量大，除了驱动孪生模型和设备状态 等关键数据，生产过程中其余的设备工作状态信息、过程信息、产品信息、流转条码信 息等难以被孪生模型直接利用。在虚实交互过程中产生的大量孪生数据需要数据存储分 析系统进行处理。同时在孪生模型的功能构建过程中，需要现场生产运行数据驱动的实 时调试，这对项目开发造成了一定的限制。为了解决上述问题，提出了基于 OPC UA 技 术的数据通讯服务程序。
48

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

OPC UA数据服务程序

UA客户端

UA服务器

UA服务器

历史 数据

实体设备 数据源

仿真软件

图 4.16 数据服务功能原理
大量的生产现场运行数据和仿真分析数据都需要进行存储，本课题所选用的数据库 为 Mysql，数字空间的数据存储脚本程序和现场 UA 服务器都与其建立数据连接，与其 他数据库软件相比，其具有如下优势：
（1）可移植行高、简单小巧。消耗更少的 CPU 和内存，在灵活地为用户提供服务 时却不占用过多的系统资源；
（2）效率高、处理量大。良好的运行效率，有丰富信息的网络支持，可以处理拥有 上千万条记录的大型数据；
（3）开源、接口丰富。源代码开放，用户可针对系统的应用进行相应修改；具有支 持各种语言调用的 API[45]。
数据服务程序的开发采用了 OPC UA 官方开发 SDK，使用 C++与 QT 开发。数据服 务程序功能原理和界面如图 4.16 和图 4.17 所示，其可在局域网内发现标准 UA 服务器 并与之建立安全连接，其中安全验证方式有无验证、签名验证和签名+证书三种接入方 式，对数据安全提供了保障。程序在局域网内通过以太网分别与车间 UA 服务器和数据 库建立连接，在遍历 UA 服务器所有的信息节点后，将其以如图 4.18 所示的树状图的 形式进行可视化，可对数据节点进行订阅与监听。在生产系统运行时，程序以轮询的方 式从服务器获取订阅节点的现场实时数据，并按时间流存入数据库中。这样将生产现场 运行数据以高频率的连续数据形式进行存储。而在面对大数据量的情况下，可以将程序 在不同的 PC 上并行运行，将数据进行横向切割、分块存储，这样的设计充分利用了 OPC UA 的网络状通讯能力。

49

4 多源异构数据处理

硕士学位论文

图 4.17 数据服务程序

图 4.18 服务器数据订阅与存储
以此为基础，为了方便开发人员进行孪生模型脚本程序逻辑的构建与验证，提出了 利用数据库中的现场数据对生产现场进行反向模拟验证的方法。在仿真模型连接和调试 的过程中，程序可按照时间戳反向读取数据库中的流式数据，发送给仿真软件，以便其 进行脱离生产现场的调试，可以更高效的进行仿真模型的功能构建，同时数据库中的孪 生数据也为大数据的分析利用提供了数据支撑。
4.5 本章小结
本章主要利用 OPC UA 技术进行生产线数字孪生系统数据通讯网络的构建，充分利
50

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

用了 UA 技术的优越性，实现孪生数据的虚实交互；同时，基于 OPC UA 技术开发了数 据服务程序，实现了对孪生数据的存储与复现功能，为模型调试、数据分析、数据挖掘 等后续利用提供了数据支持。本章的研究工作为后续的虚实空间实时交互提供了数据与 通信的支撑。

51

5 孪生模型实时映射

硕士学位论文

5 孪生模型实时映射

数字孪生体对实体的实时动作、行为和状态的映射是数字孪生技术的基础应用，而 如何利用实时数据驱动生产线的孪生模型，实现整个物理空间与数字空间的有机融合， 需要大量的信号处理。在实时映射的实现基础上，以虚实交互产生的大量孪生数据为基 础，需要对设备状态、系统运行状况、生产率、设备利用率等有效数据进行统计与分析， 为上层提供生产现场的数据可视化及数据库存储。以此为监管层提供更透明、多层次的 视角，也为生产管控、优化、预测等大数据算法提供大数据，为实现孪生体对实体的优 化控制提供基础支撑。
5.1 孪生系统虚实交互结构
不同于传统的生产线仿真，数字孪生技术的核心是实现虚实交互融合。在生产线模 型和通讯接口实现的基础上，提出了如图 5.1 所示的孪生系统虚实交互结构。在生产运 行时，UA 服务器将生产调度数据、物料消耗数据、设备状态数据、质量检测数据等实 时发送至数字孪生空间。数字空间跟据接收到的实时信息驱动孪生模型对物理系统的实 时映射，给管理层提供全方位的实时监控。同时对数字空间的运行进行相关的数据统计，
生产执行指令

管理层 ERP MES PLM ……

报警

数字孪生空间

数据分析计 算
状态分析
数据存储

生产实时仿 真
实时监控
数据统计

实时 数据

物理系统 设备
仓储
物流
产品 ……

作业数据反馈 图 5.1 孪生系统虚实交互结构
一方面利用统计数据进行状态分析，并将异常状况反馈给管理层，另一方面将数字空间 的有效数据存储到数据库中，支撑数据的分析。未来的进一步研究应该对运行产生的孪 生数据进行深层次的计算、分析与优化，并根据计算结果控制物理空间的运行。在这个 不断交互迭代的过程中，孪生空间持续的完善生产过程，从而完成基于数据交互的数字 孪生生产系统虚实交互过程[46]。以下针对虚实交互的实现和仿真数据的处理分别进行论 述。

52

硕士学位论文
5.2 实时映射的实现

数据驱动的数字孪生模型构建与在线监控应用

5.2.1 数字空间层次结构
数字空间对物理空间的映射是数字孪生技术虚实交互应用的基础。相比于传统的生 产线仿真，孪生模型对实体的实时映射对智能制造的实现具有重大意义。实现实时映射 后，在数字空间中对实时生产状况的分析与优化将会比传统方式更实时、更便捷、更多 维，也是“以虚控实”的实现基础。
数字空间与实体空间的映射与交互主要分为四个部分： （1）产品：产品是生产线的核心，从零部件出库到成品入库的整个生命周期都由实 际生产数据驱动，完成产品的演化。产品的工艺数据、质量数据等动态存储于虚拟产品 的标签中，伴随产品的全生命周期。 （2）设备：对生产线中机器人、AGV、加工设备等各种设备的动作、空间位置、 运行状态进行实时映射，完成每个工位的加工工艺。 （3）环境：可以实时显示车间当前加工环境参数信息以及一段时间内车间环境参 数的变化情况，并能够依据制造工艺需求对环境参数进行预警。 （4）系统：可以实时映射生产计划进度、作业计划进度、工序进度等信息。其中库 存状态、物流情况、加工工位的流程、在制品数量等信息均可由数字空间进行目视化分 析与管理。
在产品生产制造的全生命周期中，利用生产指令驱动的工艺规划、物流运输、制造 装配和检测检验等是产品的实现阶段，可以将实现此过程的系统狭义的称作智能生产系 统。智能生产系统是在继承和综合了柔性化、集成化、敏捷化制造系统特征基础上，进 一步扩展和增强互联互通、智能处理、并行协同能力，使制造过程体现出智能特征，以 满足多品种、变批量、异地协同乃至个性化的产品研制需求。智能生产系统的建立需要 两个前提，一是有可编程的数字化设备或自动化设备；二是有产品的数字模型。只有上 述四个部分中的数字孪生模型与其对应的实体相辅相成，才能构成智能设备，从而进一 步实现智能生产系统[47]。
5.2.2 驱动数据逻辑配合
为了实现数字空间对物理空间的虚拟验证与同步运行，需要从现场获取的大量驱动 信号，以对数字空间中各个层级进行有效的数据驱动。而数字空间的信号逻辑与物理系 统的信号逻辑是大不相同的，为了利用实时数据驱动模型的高度拟真化运行，需要对数 据和信号进行各种方式的逻辑处理。

53

5 孪生模型实时映射

硕士学位论文

运动驱动数据

实时数据输入

动作信号

状态数据

指令数据

多线程处理

状态/信息

状态/位姿

状态/条件

初始化

状态/生产数据/ 管理数据

产品

设备

环境

数字空间

物

理

空

系统

间

全全生生命命周周期期信信息 息集集成成

动动作作映映射射/状/状态 态监监控控

环境分析/监 环境分析 控

生生产产实实时时映映射射

数据集成分析

生产管控/系 生产管控 统监控

生产优化

异常报警

优化/控制信号回馈

智能管控

图 5.2 数字空间数据驱动逻辑结构
在仿真软件中，模型数据或信号以布尔型、整数型、实数型和字符串型四种形式存 在，其中布尔型可连接实体设备的 IO 口信号、气缸的开合信号等高低电平形式的信号； 整数型可以连接没有精度要求的浮点型、状态数据等；实数型对应着高精度要求的关节 值、气缸值、监测数据等；字符串型可根据自定义的格式接收灵活的数据。数字空间的 驱动数据大体可分为四类：
（1）运动驱动数据：如机器人的关节值、AGV 的坐标位置、气缸值等，这类数据 可以直接利用生产中对应的实时数据驱动，而不需要运动机构的解法进行支撑。
（2）动作信号：动作信号在数据变化至特定值时触发虚拟世界相应的回应，例如机 器人工具头的抓取信号、传送带的正反转信号、气缸的动作信号等等。这里的布尔信号 在物理世界中往往存在着两种形式，一种是脉冲形式的变化，一种是高低电平状态信号，
54

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

脚本程序要对信号量的变化进行捕捉，在对应的时刻触发对应的动作[48]。 （3）状态数据：状态信号对应着工件、设备、环境等的状态信息。例如，立体仓库
的库存信息需要根据库存状态信息进行更新；仿真启动时工件和零部件的初始状态和位 置需要进行初始化；仿真空间需要通过设备的状态信息进行数据统计与分析。
（4）指令数据：生产线各个系统和模块的生产控制指令。数字空间需要根据指令含 义进行解析和转化，控制数字空间的运行[48]。
根据数字空间的层次结构和驱动数据分类，提出了如 5.2 所示的数字空间数据驱动 逻辑结构。数字空间内部的各种算法、脚本和设备的运行是多线程并行的方式，以对离 散事件进行并行处理。数字空间的运行过程分为如下几层：
（1）初始化：由于系统启动时间的不确定性，与实体设备通讯控制的类似，孪生模 型在系统运行时首先需要从多个维度进行初始化，与实体空间状态进行匹配。其中包括： 仓储的初始化，立体仓库货物状态需要按照实时的库存数据库信息进行当前存储状态的 初始化；设备运动位姿的初始化，机器人、AGV 等的运动位置应在启动时迅速与物理实 体达成一致；在制产品与零部件的位置、加工信息的初始化；环境状态的初始化等。
（2）实时映射：数字空间同步初始化后，根据驱动数据对产品、设备、环境和生产 过程进行多维的实时映射。主要体现在产品在出库至入库的整个加工流程中的演变和各 种设备的活动与状态。
（3）数据处理：在实时映射的过程中，对数字空间的运行数据进行统计，并对各种 数据进行集成分析，实现对生产异常的报警，在未来可以有效地实现对物理系统的优化 与管控[50]。

5.3 数字空间数据处理

5.3.1 数据统计与可视化
孪生模型对实体的映射是数字孪生的基础应用，其为管理者提供了目视化管理，而 其更关键的作用是通过数字空间对生产运行中的关键数据进行更深层次的统计和分析。 数据统计功能主要面向上层管理系统和管理者用户，为其提供生产线运行的统计指标与 进一步的计算结果，为管理层提供目视化管理与决策的数据支持，便于其调整生产计划、 生产管控优化和预测性维修，提高生产效能。
在孪生系统运行中，关键任务是对生产过程信息进行综合处理，包括对生产线设备 利用率分析、计划完成率统计、产品合格率统计等方面。数字空间中底层的统计数据来 源于各种设备组件和虚拟服务组件，每个组件中可以建立如图 5.3 所示的 Statistics（统 计数字）属性，属性中可以根据需求定义一系列的统计变量。每个变量的统计算法可在 脚本程序中构建，通过对实时信号的分析与系统运行时间的配合对变量进行持续的计算

55

5 孪生模型实时映射
与统计。

硕士学位论文

图 5.3 模型统计属性列表

表 5.1 数字空间关键统计数据

统计对象

统计层次

统计数据

统计对象

统计层次

统计数据

运行时间

产品计数

设备

基础统计

空闲率 工作率 拥堵率 故障率 维修率

工位

基础统计 二次统计

加工时间 平均间隔 废/次品计数 工位生产率 工位合格率

二次统计

设备利用率 平均作业时间

空闲率 工作率

工作率

仓储

基础统计 出库托盘数

空闲率

入库托盘数

基础统计

拥堵率

AGV

故障率

生产效率 计划完成率

维修率

生产线

全局统计 设备利用率

二次统计

利用率

产品合格率

在数字空间中，各个部分与层级需要统计的数据不同，统计方法也不相同，但总体

来说需要采用从下至上的方法，上层利用下层的统计数据进行更深层次的计算。对设备

来说，其关节值、空间坐标值、气缸值等运动数据已经通过数据服务程序进行了存储，

这里不在仿真空间中进行处理。设备关键统计数据要通过其状态信息来实现，每种状态

要根据现场设备工作的实时数据给出，数字空间根据设备的状态变化和时间流的对应关

系对设备的工作状态变化进行统计，由此可进一步计算出设备的利用率等。对于产品和

零部件来说，每个工位都需要对加工的产品进行计数，质量检测等工位则需要对产品的

56

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

质量信息进行统计，此功能通过产品的工艺框容器完成，可进一步统计出产品的合格率、 计划完成率等。上层可以进一步对生产线中所有设备、服务组件和产品的统计数据进行 分析，得到整个生产线的设备综合利用率、产品合格率、物流状况等数据，为进一步利 用算法实现对生产线的优化控制提供支撑[51]，生产线中关键统计数据如表 5.1 所示。除 了对上述统计数据进行存储，软件提供了折线图、饼状图、柱状图等基本可视化图表， 机器人关节值、状态设备比率、零件计数等都可以直观的进行如图 5.4 所示的展示。除 了图表形式的可视化，数字空间中的屏幕模型利用功能脚本实现了统计数据实时显示的 功能，展示了各个工位的关键数据。

图 5.4 统计数据可视化
5.3.2 数据存储
数字空间运行中产生的数据会随着时间流不断更新，在系统重启或结束时会进行初 始化，为了对上述数字空间中的孪生数据进行后续利用，同样需要进行数据的存储工作。 数字空间的数据存储分为两种形式，一种是输出 Excel 报表；另一种是将孪生数据存入 数据库中。
数字空间中的实时驱动数据已通过数据服务程序进行了存储，这里不再对其进行存 储操作，主要针对在系统运行的过程中计算和统计所得到的数据。数字空间中产生的孪 生数据同样可以分为三种，分别对应不同的存储方式：
（1）产品数据：从零件到成品的生命周期中存在一系列的产品数据，包括订单信 息、装配信息、质量信息及加工信息等。此类数据在每一件产品的加工周期后保存到产 品的虚拟标签中。
57

5 孪生模型实时映射

硕士学位论文

（2）设备数据：设备的数据分为突发性数据和连续性数据。突发性数据是根据数据 驱动信号和运行逻辑所触发的，比如设备故障、异常警报及等，此类数据只有在产生时 才具有意义，需要随时进行监控与存储。连续性数据如设备利用率、产品计数、合格率 等是随着运行不断更新的数据，因此要采用定时存储的方式[52]。
（3）生产系统数据：生产系统数据是对底层数据的综合分析，与设备数据类似，其 同样分为突发性数据（如生产异常）和连续性数据（如生产进度、生产率），因此也同样 需要以两种方式存储。
上述各种数据在数字空间中的存储同样可以利用第三章中的 Mysql 数据库。建模软 件的 Pyhton 脚本支持对 Mysql 数据库进行相关的开发，利用脚本的开发可以实现并行 的多线程存储[53]。除了数据库存储，利用脚本为系统运行建立完整的生产数据报表，在 每次生产运行的仿真过程中利用统计数据不断更行，最终生成生产统计报表。至此，虚 拟空间的孪生数据得到了有效的存储，为后续的数据分析利用提供了支持。

5.4 以虚控实的实现方法

“以虚控实”指的是数字孪生体对实体的反向优化控制，是数字孪生技术的核心 目标。数字孪生空间数汇聚着车间各种数据，如何对这些数据进行应用分析从而达到指 导生产、优化生产的目的，是“以虚控实”应用的关键。从实现角度上来说，其可分为 基于实时数据驱动的优化管控与基于大数据预测的生产指导。
基于实时数据驱动的优化与管控的实现建立在虚实双向通讯实现的基础上，其中虚 实交互在第三章中已经提出了解决方案。在孪生模型可以精确模拟和映射实体空间的作 业后，通过数字孪生系统动态地跟踪和监视实际生产线的运行状况。然后，通过融合数 字空间的统计数据、历史运行数据、实时运行数据以及生产制造过程的评价等多源数据， 采用算法对系统中各个层次的模型进行性能仿真及优化，实现包括人机物的虚实融合与 动态调度，跨层、跨域的分布式网络化协同，协作分析、多工艺方案的工艺规划效率分 析与优化、物流分析与优化等[54]。例如在监控到生产线中的紧急故障等情况，发送报警 信号给管理层或者触发紧急停止；在采集到立体仓库的实时仓储状况后，可以将仓库调 度系统（WMS）的仓库调度算法在虚拟空间中实现；在生产过程中对生产节拍进行优化 等。而基于大数据预测的生产指导过程，在对应着不同的预测需求时，需要提供相对应 的预测模型。在输入生产线的实时数据、历史数据、相关的经验和知识数据后，经过动 态贝叶斯、神经网络等数据挖掘和机器学习方法计算模型输出理论的预测结果。从而发 现生产线中潜在的问题，指导未来的生产[55]。
以虚控实将优化结果反馈给管理层，实现智能工厂生产制造过程的闭环反馈控制以 及虚实之间的双向交互，其实现建立在本文研究的内容之上，其技术应用与实现还处于

58

硕士学位论文
理论阶段，具体实现是未来的研究内容。

数据驱动的数字孪生模型构建与在线监控应用

5.5 本章小结

本章首先在生产系统孪生模型与通讯网络构建的基础上提出了孪生系统虚实交互 的应用结构；然后阐述了利用物理系统实时数据驱动孪生模型的同步映射方法，并提出 了在同步映射的过程中对仿真数据的统计分析和可视化方法；最后对孪生模型对物理系 统的反向控制与优化提出了实现方法与展望。

59

6 系统实现与应用

硕士学位论文

6 系统实现与应用
在上述章节的研究中，设计了数字孪生技术在生产系统中的应用框架，并提出了针 对三个关键问题的解决方案。本章对本课题的研究成果的实现和应用进行了介绍，并展 示了关键的应用成果。
6.1 数字孪生系统实现过程
本课题数字孪生系统的总体实现过程为： （1）首先对课题的生产线现状进行分析，对所有功能设备和其关键驱动数据进行 了归纳，据此提出了数字空间的功能模型、虚拟服务程序和通讯控制信号接口的构建需 求； （2）根据数字空间孪生模型的构建需求，选取了 VC 软件作为数字孪生的建模工 具，对生产线的所有功能设备、虚拟服务程序进行了构建，并按照真实生产线的工艺流 程进行了连接，具备了真实刻画生产过程的能力。同时结合数字空间运行需求和实体运 行数据建立了通讯控制信号接口，为实时数据的驱动提供支撑。 （3）根据数字空间驱动数据的需求，利用 OPC UA 服务器软件——NI OPC Servers 连接了生产线两个总控 PLC，对生产线中所有设备的实时驱动数据进行了服务器集成与 数据建模，给建模软件中的 UA 通讯接口提供实时数据服务。同时利用 UA SDK 开发了 数据服务软件，实现了对孪生数据的数据库存储与回溯。 （4）最后在数字空间内利用实时数据对孪生模型进行驱动，通过逻辑行为的构建 实现了对生产运行活动的实时映射，给管理者提供了全三维的实时监控与可视化。同时 在运行中对实体空间中难以统计的数据进行了统计，对运行状况进行了监控，并将产生 的孪生数据以报表和数据库的方式进行了存储，为后续数据分析利用和“以虚控实”的 实现提供了支撑。
6.2 应用结果展示
采用上述实现过程，最终完成的生产线数字孪生系统的工作流程如图 6.1 所示。在 生产运行中产生的实时运行数据，一方面传递至 MES 等管理软件中，对生产中的关键 数据进行组态化的监控，另一方面通过构建好的 OPC UA 服务器传至数字空间中，驱动 孪生模型对生产线的实时映射，实现了对生产运行的实时监控，在实时映射的过程中， 同时完成了对孪生数据的统计、可视化和存储。未来可进一步对产生的一系列实时数据 和孪生数据进行数据分析，对生产线进行管控，保证产品的高效率输出，提高生产智能
60

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

化程度。以下对各个部分的应用成果进行介绍：
生产指令下达

生产线运行

实时数据采集

状态监控 数据分析 生产管控

孪生模型 实时映射
数据统计/可 视化/存储

产品输出
图 6.1 系统工作流程
（1）孪生模型：生产线孪生模型的构建方法如第三章中所述，利用各个设备厂商的 三维模型对整条生产线中的产品和托盘、3 个工业机器人、7 个加工设备、2 个 AGV、 仓库货架和堆垛机等进行了功能模型的构建，通过功能分析建立了一系列的虚拟服务组 件。然后对各种功能模型和虚拟服务脚本进行了有机的逻辑连接，对生产线实体的功能 进行了真实刻画，最终建立的生产线孪生模型如图 6.2 所示，其具备了数据驱动的实时 映射能力。

图 6.2 生产线孪生模型
（2）数据通讯：利用建模软件（VC）的通讯接口与 UA 数据源服务器建立了如图 6.3 所示的变量连接，变量的更新方式采用事件触发式，降低了建模软件的计算压力。
61

6 系统实现与应用

硕士学位论文

驱动模型的信号与生产线数据源相互连接，一共监听了 126 对变量对，通讯延迟保持在 50ms 内，满足了实时性要求。在生产线运行时，订阅的数据变量值会随着现场不断的刷 新，信号处理脚本根据现场信号驱动孪生模型的运行。

图 6.3 实时交互变量连接
（3）实时监控：通过对实时信号的逻辑处理，实现孪生模型对生产线实体的实时映 射。在生产系统的运行过程中，管控中心的监视屏幕如图 6.4 所示，除了显示 MES、 WMS 等系统的生产状态数据外，生产线的孪生模型以实时映射的方式对生产进程进行 监控，且可以根据需求进行全方位视角的自由切换。数字空间根据实时生产数据驱动， 可以正确表示产品的生产过程：仓库 79 个库位显示当前零件和成品的库存情况；堆垛 机根据任务信号实现对产品托盘的出入库；两个 AGV 实现物流运输；上下料机器人实 现成品的下料和零件的上料，且在零件未吸取成功时给予报警和直观的显示；零件在装 配线上的流转完成了从零件到成品的几何装配状态演化。这里以生产线上下料及装配工 位为例，如图 6.5 所示，图中 AGV 进行零件的送入与成品的取出，工业机器人进行成 品的下料和三个零件的上料，并将 PCB 板装入产品下盖中。
62

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

图 6.4 管控中心成果展示
图 6.5 上下料+装配工位
（4）数据处理：数字空间中每个工位具有虚拟显示屏，其对工位信息和关键数据进 行可视化。装配上盖的工位如图 6.6 所示，虚拟屏幕上实时显示工位的关键统计数据如 加工计数和订单编号等。数生空间在运行过程中，每分钟根据全局统计数据更新如图 6.7 所示的统计数据报表，最终输出一个 Excel 文档。同时开发的数据服务程序将生产线运 行数据和数字空间统计数据存入 Mysql 数据库中，为后续的数据分析提供了支撑。
63

6 系统实现与应用

硕士学位论文

图 6.6 工位虚拟显示屏数据可视化
图 6.7 全局统计数据
6.3 本章小结
本章根据提出的数字孪生应用体系架构，对文中三个关键技术进行了综合应用，实 现了数字孪生模型构建和在线监控的应用，对关键的应用结果进行了展示，并为以虚控 实的实现奠定了基础。
64

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

7 总结与展望
7.1 工作总结
在智能制造的浪潮中，世界各地积极探索数字孪生技术的应用方法并不断实践。本 课题以天津某公司智能制造平台的建设项目为背景，在现有生产系统的基础上对数据驱 动的数字孪生模型构建与在线监控进行了研究与应用，本文的主要工作内容有以下几个 方面：
（1）分析了目前数字孪生技术在产品和生产系统中的研究和应用现状。根据课题 背景项目的现状与需求，结合目前的数字孪生应用理论提出了数字孪生技术在生产系统 中的应用体系结构，将系统实现分成了五个功能模块并将数据通讯的建设、孪生模型的 构建和实时映射的实现作为课题的主要研究内容，最终实现整个系统的关键功能。
（2）根据课题孪生模型的构建需求，以 VC(Visual Components)建模软件为工具， 阐述了生产系统中关键设备和虚拟服务的构建方法，构建了包括工业机器人、生产设备、 AGV、立体仓库等生产线设备的孪生模型和一系列的虚拟服务组件，并为实时数据的驱 动构建了通讯控制接口。
（3）根据数字孪生应用过程中系统通讯的需求，介绍了 OPC UA 技术在解决当前 智能制造系统通讯问题的技术特点与优势，提出了基于 OPC UA 的数字孪生应用系统通 讯网络架构，并利用 OPC UA 技术具体设计了生产系统数据服务器、孪生空间的数据获 取与数据服务平台的实现方法，并在课题实施中进行了开发与应用验证。
（4）在孪生模型以及虚实数据通讯构建完成的基础上，提出了利用实时数据驱动 模型进行实时映射的方案并在课题中进行了应用，阐述了实时映射中数据分析的方法以 及提出了数字空间对物理系统的控制方法。在此基础上构建完成的数字孪生生产系统能 够在数字空间中对生产运行状况进行三维实时映射，对生产关键数据进行统计、可视化 与存储，为对物理系统的反向控制与优化奠定了基础。
7.2 工作展望
本文的研究成果在企业的智能制造项目中进行了应用验证，并取得了预期的设计效 果，实现了数字孪生的部分应用。但数字孪生是一种结合多学科、多技术的技术，目前 对其的探索和实践还处于起步阶段，其中仍有很多的关键问题尚未解决。由于本人学识 水平和时间精力的局限，并不能对其中每个方面逐一研究，还有许多关键技术有待进一 步完善：
（1）数字孪生模型的构建比较复杂，理想的数字孪生体应该具有实体的物理形状、
65

总结与展望

硕士学位论文

运动结构、逻辑信息等各种因素，以对实体进行更真实化的表达，这对建模方法和仿真 软件都提出了很高的要求。本课题对真实生产系统进行了模型构建并最终对生产过程进 行了成功的仿真，然而对实体设备的运动仅仅达到了运动学的基础，对其运动误差、力 学性质等的建模尚未实现，对于产品本身的模型构建也被弱化。同时，在仿真软件的运 行过程中，其数据计算量非常大，对计算机造成了很大的负担。因此，更有效和真实化 的建模方式是未来的研究方向，建模软件的发展将直接影响数字孪生技术的发展。
（2）文章根据智能制造的通讯要求，采用了 OPC UA 技术作为数字孪生应用的网 络支撑，提出并实现了孪生空间与生产现场大规模数据源的实时交互网络通讯架构。在 课题应用中，虽然数据的获取可以满足实时性的要求，然而仿真空间仍会存在一些延迟， 这对与生产系统中一些迅速变化的信号与动作会造成误差，尤其体现在如产品装配等一 些精细动作的过程中，因此未来需要对延迟误差进行有效的修正。
（3）课题在数字孪生应用的过程中，实现了基础的数字空间对实体空间的映射，并 未对孪生数据进行有效的分析利用，未来需要融合当下的算法、大数据分析及人工智能 等前沿技术对数据进行有效利用；同时利用数字空间对物理系统的反向优化控制涉及到 一系列的安全、数据交互等问题，也需要在未来研究有效的反向控制方法。

66

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

致 谢
在论文完稿之际，自己在南京理工大学的求学生涯已接近尾声。自己在南理工六年 半的学习生涯中，在学识、交际和生活的各个方面得到了巨大的提升，除了自身的努力 外，离不开很多人的帮助。
首先，非常感谢我的导师徐骏善老师，徐老师在我们的学习和科研中给了我们很大 的帮助，在遇到瓶颈和论文写作遇到困难的时候，总是不遗余力的给予指导。除此之外， 徐老师在生活中以一种积极向上、刻苦钻研的精神感染着我们，从他身上我们学习到了 许多。
同样感谢教研室的汪惠芬老师、柳林燕老师和刘庭煜老师，在生活和学习中遇到困 惑的时候，老师们以丰富的人生阅历和深厚的学识给予指导，开拓了我们的思维方式和 眼界。
感谢父母以及朋友们一直以来予以的精神支持，让我一直坚定自己的信念，砥砺前 行，有你们的陪伴，我是幸运的。感谢我的室友们，你们的陪伴让我的学习与生活变得 更加丰富有趣。
最后，感谢论文参考文献中的所有研究人员，你们宝贵的研究成果使论文的研究得 以站立在巨人的肩膀上，感谢你们前期的辛勤付出与努力。再次感谢上述所有人们对我 的帮助与付出，谢谢！

67

附录

硕士学位论文

参考文献
[1] 陶飞,程颖,程江锋,等.数字孪生车间信息物理融合理论与技术[J].计算机集成 制造系统,2017,23(8):1603-1611.
[2] Negri E, Fumagalli L, Macchi M. A review of the roles of Digital Twin in CPS-based production systems[J]. Procedia Manufacturing, 2017, (11): 939 – 948.
[3] 汪林生. 虚实融合技术在智能制造中的应用研究[D]. 南京邮电大学, 2018. [4] 陶飞，张萌，程江峰，戚庆林. 数字孪生车间——一种未来车间运行新模式[J].
计算机集成制造系统,2017,23(1):1-9. [5] Ciavotta M, Alge M, Menato S, Rovere D, Pedrazzoli P. A microservice-based
middleware for the digital factory[J]. Procedia Manufacturing, 2017, (11): 931 – 938. [6] Rosen R, Wichert G, Lo G. About The Importance of Autonomy and Digital Twins
for the Future of Manufacturing[J]. IFAC-PapersOnLine, 2015, (48): 567–572. [7] 陶剑，戴永长，魏冉. 基于数字线索和数字孪生的生产生命周期研究[J]. 航空制
造技术. 2017, 21. [8] Fourgeau E,Gomez E, Adli H,et al. System Engineering Workbench for Multi-views
Systems Methodology with 3DEXPERIENCE Platform[C]. Complex Systems Design & Management Asia. Berlin: Springer International Publishing, 2016:269-270. [9] 于勇, 范胜廷, 彭关伟. 数字孪生模型在产品构型管理中应用探讨[J]. 航空制 造技术. 2017, 7: 41-45. [10] Soderberg R, Warmefjord K, Johan S C, Lindkvist L. Toward a Digital Twin for realtime geometry assurance in individualized production[J]. CIRP Annals Manufacturing Technology, 2017, (66): 137–140. [11] Schleich B, Anwer N, Mathieu L, Wartzack S. Shaping the digital twin for design and production engineering[J]. CIRP Annals-Manufacturing Technology, 2017, (66): 141–144. [12] Knapp G L, Mukherjee T, Zuback J S, et al. Building blocks for a digital twin of additive manufacturing. Acta Materialia, 2017, (135): 390-399. [13] Grieves M, Vickers J. Digital twin: mitigating unpredictable, undesirable emergent behavior in complex systems[M]. Transdiscriplinary Perspectives on Complex Systems. Berlin, Germany: Springer International Publishing, 2017. [14] Eric J, Anthony R, Thomas G, and Michael S. Reengineering Aircraft Structural Life Prediction Using a Digital Twin. International Journal of Aerospace Engineering,
68

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

2011: 1-14. [15] Li CZ and Mahadevan S. Dynamic Bayesian Network for Aircraft Wing Health
Monitoring Digital Twin[J]. AIAA Journal, 2017, (55): 930-941. [16] Iglesias D, Bunting P, Esquembri S. Digital twin applications for the JET divertor[J].
Fusion Engineering and Design, 2017, (125): 71-76. [17]陶飞, 刘蔚然, 刘检华等. 数字孪生及其应用探索[J]. 计算机集成制造系统,
2018, 24(1): 1-17. [18] Brennera B, Hummela V. Digital twin as enabler for an innovative digital shopfloor
management system in the ESB Logistics Learning Factory at Reutlingen – University[J]. Procedia Manufacturing，2017, (9): 198-205. [19] 张新生. 基于数字孪生的车间管控系统的设计与实现[D]. 郑州：郑州大学，2018. [20] Zhuang CB, Liu JH, Xiong H. Digital twin-based smart production management and control framework for the complex product assembly shop-floor[J]. The International Journal of Advanced Manufacturing Technology, 2018, (96): 1149-1163. [21] Greyce N S, Charles S, Carlos E P, Danubia B E. Digital Twin Data Modeling with AutomationML and a Communication Methodology for Data Exchange[J]. IFACPapersOnLine, 2016, 49(30): 12–17. [22] Delbrugger T, Lenz LT, Losch D, Rosmann J. A navigation framework for digital twins of factories based on building information modeling[C]. IEEE International Conference,2017: 1-4. [23] DebRoy T, Zhang W, Turner J, Babu S S. Building digital twins of 3D printing machines[J]. Scripta Materialia,2017,(135): 119–124. [24] Eliasson J, Delsing J, Derhamy H. Towards Industrial Internet of Things: An Efficient and Interoperable Communication Framework. IEEE International Conference on Industrial Tecnology, 2015 :2198-2204. [25] Wollschlaeger M, Sauter T, Jasperneite J. The Future of Industrial Communication: Automation Networks in the Era of the Internet of Things and Industry 4.0. IEEE Industrial Electronics Magazine, 2017, 11 (1) :17-27. [26] Freese M, Singh S, Ozaki F, and Matsuhira N. Virtual Robot Experimentation Platform V-REP: A Versatile 3D Robot Simulator[C]. International Conference on Simulation, in Simulation, Modeling, and Programming for Autonomous Robots, 2010: 51-62. [27]任伟,林海波,杨晓明,等.工业物联网关键技术 OPC UA 分析.信息技术与标准化， 2017(10).
69

附录

硕士学位论文

[28] Michniewicz J, Reinhart G. Cyber-Physical-Robotics – Modelling of modular robot cells for automated planning and execution of assembly tasks. Mechatronics， 2016， (34): 170–180.
[29] 叶宏, 崔亚新, 宁鑫, 王琮, 曾海兵. 轨道客车企业数字化制造平台选型研究[J]. 科技致富向导, 2012, (20): 12-12.
[30] 郭东升，鲍劲松，史恭威等. 基于数字孪生的航天结构件制造车间建模研究[J]. 东华大学学报，2018, 44 (4): 578-607.
[31] Piotrowski N, Barylski A. Modelling a 6-DOF manipulator using Matlab software[J]. Arch. Mech. Technol. Automation, 34: 45–55.
[32]梁春艳，李志雄，苏清茂. 六自由度机器人 3D 建模仿真研究[J]. 西南科技大学 学报, 2016, (2) : 81-86.
[33] 张祥雷, 姚博世, 冮铁强, 姚斌. 五轴数控磨床床身结构分析与优化[J]. 机床与 液压, 2012, (15): 18-21.
[34]张迪. 基于 Flexsim 仿真技术 AGV 调度系统的物流方案可行性分析[J]. 物流技 术与应用, 2017, (7): 118-122.
[35] 葛阳. 自动化立体仓库建模及堆垛机运动控制研究[D]. 东北大学, 2008. [36] 刘婧峥. 自动化立体仓库优化调度研究[D]. 华南理工大学，2018. [37]郝建豹，许焕彬，林炯南. 基于 RobotStudio 的多机器人生产线仿真设计. 组合
机床与自动化加工技术, 2017, (11): 122-125. [38]张威, 王月基. 基于 Vega Prime 和 Web Service 的分布式仿真中间件 VPDR-W.
舰船电子工程, 2018, (1): 91-95. [39]黄国安. 基于 Plant Simulation 的汽车混流装配线仿真研究与优化[D]. 山东大学，
2012. [40] 顾嘉，廖栋霞，熊根良，陆远. 装配生产线仿真与优化技术研究[J]. 机械设计与
制造, 2014, (5): 99-101. [41]徐兵兵. 基于 OPC UA 的数据采集与监控系统关键模块的设计与实现[D].西安：
西安电子科技大学计算机学院，2017. [42] 武智强. 面向智慧工厂的柔性数据采集监控系统的研究[D].山东：山东大学机械
工程学院,2017. [43]方辉. OPC UA 服务器地址空间与数据存储研究与开发[D]. 华北电力大学：
2011. [44]谢善益，杨强，徐庆平. 公共信息模型的 OPC UA 地址空间管理[J]. 电力系统
自动化, 2016, (14): 115-121. [45]毛成光, 张理兵, 王林, 钱继超. MySQL 数据库在在线监测系统中的应用研究
70

硕士学位论文

数据驱动的数字孪生模型构建与在线监控应用

[J]. 电子世界, 2012, (4): 10-11. [46]陈振, 丁晓, 唐健钧, 刘玉松. 基于数字孪生的飞机装配车间生产管控模式探
索[J]. 航空制造技术, 2018, 61, (12): 46-58. [47]乔兵, 朱剑英. 多 Agent 智能制造系统研究综述[J]. 南京航空航天大学学报,
2001, (1): 1-7. [48]王楠, 李世其, 王峻峰. 数据驱动的汽车总装线建模与仿真技术研究[J]. 计算
机与数字工程, 2011, (5): 70-75. [49]张翔, 李革, 王鹏. 基于动态数据驱动的反潜战仿真系统目标探测设计[J]. 系
统工程与电子技术, 2018, 40 (11). [50] 魏弦. 数控机床主轴热误差的数据驱动模型研究[J]. 机床与液压, 2018, (3): 103-
107. [51]王聪, 史春明. MES 及生产数据统计优化[J]. 石油化工自动化, 2013, (3): 45-47. [52]王焱, 王湘念, 王晓丽等. 智能生产系统构建方法及其关键技术研究[J]. 航空
制造技术, 2018, 61: 16-24. [53]韩菲, 金磊, 戴文浩, 李艳飞, 杨树. 基于 Python 的实时数据库设计[J]. 仪器仪
表用户, 2017, (6): 28-30. [54]赵申坤, 姜潮, 龙湘云. 一种基于数据驱动和贝叶斯理论的机械系统剩余寿命
预测方法[J]. 机械工程学报, 2018, 54 (12): 115-124. [55] 彭宇, 刘大同. 数据驱动故障预测和健康管理综述[J]. 仪器仪表学报, 2014, (3):
481-495.

71

附录

硕士学位论文

附 录
攻读硕士学位期间发表的论文和出版著作情况：
专利：“一种工业机器人数字孪生实时作业控制、监控与精度补偿的方法”，申请号： 201811535894.9（第二作者）
攻读硕士学位期间参加的科学研究情况：
攻读硕士学位期间学术成果获奖情况：

72

